IDLE is Python's Tkinter-based Integrated DeveLopment Environment.

IDLE emphasizes a lightweight, clean design with a simple user interface.
Although it is suitable for beginners, even advanced users will find that
IDLE has everything they really need to develop pure Python code.

IDLE features a multi-window text editor with multiple undo, Python colorizing,
and many other capabilities, e.g. smart indent, call tips, and autocompletion.

The editor has comprehensive search functions, including searching through
multiple files.  Class browsers and path browsers provide fast access to
code objects from a top level viewpoint without dealing with code folding.

There is a Python Shell window which features colorizing and command recall.

IDLE executes Python code in a separate process, which is restarted for each
Run (F5) initiated from an editor window.  The environment can also be 
restarted from the Shell window without restarting IDLE.

This enhancement has often been requested, and is now finally available.  The
magic "reload/import *" incantations are no longer required when editing and
testing a module two or three steps down the import chain.

(Personal firewall software may warn about the connection IDLE makes to its
subprocess using this computer's internal loopback interface.  This connection
is not visible on any external interface and no data is sent to or received
from the Internet.)

It is possible to interrupt tightly looping user code, even on Windows.

Applications which cannot support subprocesses and/or sockets can still run
IDLE in a single process.

IDLE has an integrated debugger with stepping, persistent breakpoints, and call
stack visibility.

There is a GUI configuration manager which makes it easy to select fonts,
colors, keybindings, and startup options.  This facility includes a feature
which allows the user to specify additional help sources, either locally or on
the web.

IDLE is coded in 100% pure Python, using the Tkinter GUI toolkit (Tk/Tcl)
and is cross-platform, working on Unix, Mac, and Windows.

IDLE accepts command line arguments.  Try idle -h to see the options.


If you find bugs or have suggestions, let us know about them by using the
Python Bug Tracker:

http://sourceforge.net/projects/python

Patches are always appreciated at the Python Patch Tracker, and change
requests should be posted to the RFE Tracker.

For further details and links, read the Help files and check the IDLE home
page at

http://www.python.org/idle/

There is a mail list for IDLE: idle-dev@python.org.  You can join at

http://mail.python.org/mailman/listinfo/idle-dev

This directory exists so that 3rd party packages can be installed
here.  Read the source for site.py for more details.

This directory contains test cases that are known to leak references.
The idea is that you can import these modules while in the interpreter
and call the leak function repeatedly.  This will only be helpful if
the interpreter was built in debug mode.  If the total ref count
doesn't increase, the bug has been fixed and the file should be removed
from the repository.

Note:  be careful to check for cyclic garbage.  Sometimes it may be helpful
to define the leak function like:

def leak():
    def inner_leak():
        # this is the function that leaks, but also creates cycles
    inner_leak()
    gc.collect() ; gc.collect() ; gc.collect()

Here's an example interpreter session for test_gestalt which still leaks:

>>> from test.leakers.test_gestalt import leak
[24275 refs]
>>> leak()
[28936 refs]
>>> leak()
[28938 refs]
>>> leak()
[28940 refs]
>>> 

Once the leak is fixed, the test case should be moved into an appropriate
test (even if it was originally from the test suite).  This ensures the
regression doesn't happen again.  And if it does, it should be easier
to track down.

This is Python version 2.7
===========================

Copyright (c) 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
Python Software Foundation.
All rights reserved.

Copyright (c) 2000 BeOpen.com.
All rights reserved.

Copyright (c) 1995-2001 Corporation for National Research Initiatives.
All rights reserved.

Copyright (c) 1991-1995 Stichting Mathematisch Centrum.
All rights reserved.


License information
-------------------

See the file "LICENSE" for information on the history of this
software, terms & conditions for usage, and a DISCLAIMER OF ALL
WARRANTIES.

This Python distribution contains no GNU General Public Licensed
(GPLed) code so it may be used in proprietary projects just like prior
Python distributions.  There are interfaces to some GNU code but these
are entirely optional.

All trademarks referenced herein are property of their respective
holders.


What's new in this release?
---------------------------

See the file "Misc/NEWS".


If you don't read instructions
------------------------------

Congratulations on getting this far. :-)

To start building right away (on UNIX): type "./configure" in the
current directory and when it finishes, type "make".  This creates an
executable "./python"; to install in /usr/local, first do "su root"
and then "make install".

The section `Build instructions' below is still recommended reading.


What is Python anyway?
----------------------

Python is an interpreted, interactive object-oriented programming
language suitable (amongst other uses) for distributed application
development, scripting, numeric computing and system testing.  Python
is often compared to Tcl, Perl, Java, JavaScript, Visual Basic or
Scheme.  To find out more about what Python can do for you, point your
browser to http://www.python.org/.


How do I learn Python?
----------------------

The official tutorial is still a good place to start; see
http://docs.python.org/ for online and downloadable versions, as well
as a list of other introductions, and reference documentation.

There's a quickly growing set of books on Python.  See
http://wiki.python.org/moin/PythonBooks for a list.


Documentation
-------------

All documentation is provided online in a variety of formats.  In
order of importance for new users: Tutorial, Library Reference,
Language Reference, Extending & Embedding, and the Python/C API.  The
Library Reference is especially of immense value since much of
Python's power is described there, including the built-in data types
and functions!

All documentation is also available online at the Python web site
(http://docs.python.org/, see below).  It is available online for occasional
reference, or can be downloaded in many formats for faster access.  The
documentation is downloadable in HTML, PostScript, PDF, LaTeX, and
reStructuredText (2.6+) formats; the LaTeX and reStructuredText versions are
primarily for documentation authors, translators, and people with special
formatting requirements.


Web sites
---------

New Python releases and related technologies are published at
http://www.python.org/.  Come visit us!


Newsgroups and Mailing Lists
----------------------------

Read comp.lang.python, a high-volume discussion newsgroup about
Python, or comp.lang.python.announce, a low-volume moderated newsgroup
for Python-related announcements.  These are also accessible as
mailing lists: see http://www.python.org/community/lists/ for an
overview of these and many other Python-related mailing lists.

Archives are accessible via the Google Groups Usenet archive; see
http://groups.google.com/.  The mailing lists are also archived, see
http://www.python.org/community/lists/ for details.


Bug reports
-----------

To report or search for bugs, please use the Python Bug
Tracker at http://bugs.python.org/.


Patches and contributions
-------------------------

To submit a patch or other contribution, please use the Python Patch
Manager at http://bugs.python.org/.  Guidelines
for patch submission may be found at http://www.python.org/dev/patches/.

If you have a proposal to change Python, you may want to send an email to the
comp.lang.python or python-ideas mailing lists for inital feedback. A Python
Enhancement Proposal (PEP) may be submitted if your idea gains ground. All
current PEPs, as well as guidelines for submitting a new PEP, are listed at
http://www.python.org/dev/peps/.


Questions
---------

For help, if you can't find it in the manuals or on the web site, it's
best to post to the comp.lang.python or the Python mailing list (see
above).  If you specifically don't want to involve the newsgroup or
mailing list, send questions to help@python.org (a group of volunteers
who answer questions as they can).  The newsgroup is the most
efficient way to ask public questions.


Build instructions
==================

Before you can build Python, you must first configure it.
Fortunately, the configuration and build process has been automated
for Unix and Linux installations, so all you usually have to do is
type a few commands and sit back.  There are some platforms where
things are not quite as smooth; see the platform specific notes below.
If you want to build for multiple platforms sharing the same source
tree, see the section on VPATH below.

Start by running the script "./configure", which determines your
system configuration and creates the Makefile.  (It takes a minute or
two -- please be patient!)  You may want to pass options to the
configure script -- see the section below on configuration options and
variables.  When it's done, you are ready to run make.

To build Python, you normally type "make" in the toplevel directory.
If you have changed the configuration, the Makefile may have to be
rebuilt.  In this case, you may have to run make again to correctly
build your desired target.  The interpreter executable is built in the
top level directory.

Once you have built a Python interpreter, see the subsections below on
testing and installation.  If you run into trouble, see the next
section.

Previous versions of Python used a manual configuration process that
involved editing the file Modules/Setup.  While this file still exists
and manual configuration is still supported, it is rarely needed any
more: almost all modules are automatically built as appropriate under
guidance of the setup.py script, which is run by Make after the
interpreter has been built.


Troubleshooting
---------------

See also the platform specific notes in the next section.

If you run into other trouble, see the FAQ
(http://www.python.org/doc/faq/) for hints on what can go wrong, and
how to fix it.

If you rerun the configure script with different options, remove all
object files by running "make clean" before rebuilding.  Believe it or
not, "make clean" sometimes helps to clean up other inexplicable
problems as well.  Try it before sending in a bug report!

If the configure script fails or doesn't seem to find things that
should be there, inspect the config.log file.

If you get a warning for every file about the -Olimit option being no
longer supported, you can ignore it.  There's no foolproof way to know
whether this option is needed; all we can do is test whether it is
accepted without error.  On some systems, e.g. older SGI compilers, it
is essential for performance (specifically when compiling ceval.c,
which has more basic blocks than the default limit of 1000).  If the
warning bothers you, edit the Makefile to remove "-Olimit 1500" from
the OPT variable.

If you get failures in test_long, or sys.maxint gets set to -1, you
are probably experiencing compiler bugs, usually related to
optimization.  This is a common problem with some versions of gcc, and
some vendor-supplied compilers, which can sometimes be worked around
by turning off optimization.  Consider switching to stable versions
(gcc 2.95.2, gcc 3.x, or contact your vendor.)

From Python 2.0 onward, all Python C code is ANSI C.  Compiling using
old K&R-C-only compilers is no longer possible.  ANSI C compilers are
available for all modern systems, either in the form of updated
compilers from the vendor, or one of the free compilers (gcc).

If "make install" fails mysteriously during the "compiling the library"
step, make sure that you don't have any of the PYTHONPATH or PYTHONHOME
environment variables set, as they may interfere with the newly built
executable which is compiling the library.

Unsupported systems
-------------------

A number of systems are not supported in Python 2.7 anymore. Some
support code is still present, but will be removed in later versions.
If you still need to use current Python versions on these systems,
please send a message to python-dev@python.org indicating that you
volunteer to support this system. For a more detailed discussion 
regarding no-longer-supported and resupporting platforms, as well
as a list of platforms that became or will be unsupported, see PEP 11.

More specifically, the following systems are not supported any
longer:
- SunOS 4
- DYNIX
- dgux
- Minix
- NeXT
- Irix 4 and --with-sgi-dl
- Linux 1
- Systems defining __d6_pthread_create (configure.in)
- Systems defining PY_PTHREAD_D4, PY_PTHREAD_D6,
  or PY_PTHREAD_D7 in thread_pthread.h
- Systems using --with-dl-dld
- Systems using --without-universal-newlines
- MacOS 9
- Systems using --with-wctype-functions
- Win9x, WinME


Platform specific notes
-----------------------

(Some of these may no longer apply.  If you find you can build Python
on these platforms without the special directions mentioned here,
submit a documentation bug report to SourceForge (see Bug Reports
above) so we can remove them!)

Unix platforms: If your vendor still ships (and you still use) Berkeley DB
        1.85 you will need to edit Modules/Setup to build the bsddb185
        module and add a line to sitecustomize.py which makes it the
        default.  In Modules/Setup a line like

            bsddb185 bsddbmodule.c

        should work.  (You may need to add -I, -L or -l flags to direct the
        compiler and linker to your include files and libraries.)

XXX I think this next bit is out of date:

64-bit platforms: The modules audioop, and imageop don't work.
        The setup.py script disables them on 64-bit installations.
        Don't try to enable them in the Modules/Setup file.  They
        contain code that is quite wordsize sensitive.  (If you have a
        fix, let us know!)

Solaris: When using Sun's C compiler with threads, at least on Solaris
        2.5.1, you need to add the "-mt" compiler option (the simplest
        way is probably to specify the compiler with this option as
        the "CC" environment variable when running the configure
        script).

        When using GCC on Solaris, beware of binutils 2.13 or GCC
        versions built using it.  This mistakenly enables the
        -zcombreloc option which creates broken shared libraries on
        Solaris.  binutils 2.12 works, and the binutils maintainers
        are aware of the problem.  Binutils 2.13.1 only partially
        fixed things.  It appears that 2.13.2 solves the problem
        completely.  This problem is known to occur with Solaris 2.7
        and 2.8, but may also affect earlier and later versions of the
        OS.

        When the dynamic loader complains about errors finding shared
        libraries, such as

        ld.so.1: ./python: fatal: libstdc++.so.5: open failed:
        No such file or directory

        you need to first make sure that the library is available on
        your system. Then, you need to instruct the dynamic loader how
        to find it. You can choose any of the following strategies:

        1. When compiling Python, set LD_RUN_PATH to the directories
           containing missing libraries.
        2. When running Python, set LD_LIBRARY_PATH to these directories.
        3. Use crle(8) to extend the search path of the loader.
        4. Modify the installed GCC specs file, adding -R options into the
           *link: section.

        The complex object fails to compile on Solaris 10 with gcc 3.4 (at
        least up to 3.4.3).  To work around it, define Py_HUGE_VAL as
        HUGE_VAL(), e.g.:

          make CPPFLAGS='-D"Py_HUGE_VAL=HUGE_VAL()" -I. -I$(srcdir)/Include'
          ./python setup.py CPPFLAGS='-D"Py_HUGE_VAL=HUGE_VAL()"'

Linux:  A problem with threads and fork() was tracked down to a bug in
        the pthreads code in glibc version 2.0.5; glibc version 2.0.7
        solves the problem.  This causes the popen2 test to fail;
        problem and solution reported by Pablo Bleyer.

Red Hat Linux: Red Hat 9 built Python2.2 in UCS-4 mode and hacked
        Tcl to support it. To compile Python2.3 with Tkinter, you will
        need to pass --enable-unicode=ucs4 flag to ./configure.

        There's an executable /usr/bin/python which is Python
        1.5.2 on most older Red Hat installations; several key Red Hat tools
        require this version.  Python 2.1.x may be installed as
        /usr/bin/python2.  The Makefile installs Python as
        /usr/local/bin/python, which may or may not take precedence
        over /usr/bin/python, depending on how you have set up $PATH.

FreeBSD 3.x and probably platforms with NCurses that use libmytinfo or
        similar: When using cursesmodule, the linking is not done in
        the correct order with the defaults.  Remove "-ltermcap" from
        the readline entry in Setup, and use as curses entry: "curses
        cursesmodule.c -lmytinfo -lncurses -ltermcap" - "mytinfo" (so
        called on FreeBSD) should be the name of the auxiliary library
        required on your platform.  Normally, it would be linked
        automatically, but not necessarily in the correct order.

BSDI:   BSDI versions before 4.1 have known problems with threads,
        which can cause strange errors in a number of modules (for
        instance, the 'test_signal' test script will hang forever.)
        Turning off threads (with --with-threads=no) or upgrading to
        BSDI 4.1 solves this problem.

DEC Unix: Run configure with --with-dec-threads, or with
        --with-threads=no if no threads are desired (threads are on by
        default).  When using GCC, it is possible to get an internal
        compiler error if optimization is used.  This was reported for
        GCC 2.7.2.3 on selectmodule.c.  Manually compile the affected
        file without optimization to solve the problem.

DEC Ultrix: compile with GCC to avoid bugs in the native compiler,
        and pass SHELL=/bin/sh5 to Make when installing.

AIX:    A complete overhaul of the shared library support is now in
        place.  See Misc/AIX-NOTES for some notes on how it's done.
        (The optimizer bug reported at this place in previous releases
        has been worked around by a minimal code change.) If you get
        errors about pthread_* functions, during compile or during
        testing, try setting CC to a thread-safe (reentrant) compiler,
        like "cc_r".  For full C++ module support, set CC="xlC_r" (or
        CC="xlC" without thread support).

AIX 5.3: To build a 64-bit version with IBM's compiler, I used the
        following:

        export PATH=/usr/bin:/usr/vacpp/bin
        ./configure --with-gcc="xlc_r -q64" --with-cxx="xlC_r -q64" \
                    --disable-ipv6 AR="ar -X64"
        make

HP-UX:  When using threading, you may have to add -D_REENTRANT to the
        OPT variable in the top-level Makefile; reported by Pat Knight,
        this seems to make a difference (at least for HP-UX 10.20)
        even though pyconfig.h defines it. This seems unnecessary when
        using HP/UX 11 and later - threading seems to work "out of the
        box".

HP-UX ia64: When building on the ia64 (Itanium) platform using HP's
        compiler, some experience has shown that the compiler's
        optimiser produces a completely broken version of python
        (see http://bugs.python.org/814976). To work around this,
        edit the Makefile and remove -O from the OPT line.

        To build a 64-bit executable on an Itanium 2 system using HP's
        compiler, use these environment variables:

                CC=cc
                CXX=aCC
                BASECFLAGS="+DD64"
                LDFLAGS="+DD64 -lxnet"

        and call configure as:

                ./configure --without-gcc

        then *unset* the environment variables again before running
        make.  (At least one of these flags causes the build to fail
        if it remains set.)  You still have to edit the Makefile and
        remove -O from the OPT line.

HP PA-RISC 2.0: A recent bug report (http://bugs.python.org/546117)
        suggests that the C compiler in this 64-bit system has bugs
        in the optimizer that break Python.  Compiling without
        optimization solves the problems.

SCO:    The following apply to SCO 3 only; Python builds out of the box
        on SCO 5 (or so we've heard).

        1) Everything works much better if you add -U__STDC__ to the
        defs.  This is because all the SCO header files are broken.
        Anything that isn't mentioned in the C standard is
        conditionally excluded when __STDC__ is defined.

        2) Due to the U.S. export restrictions, SCO broke the crypt
        stuff out into a separate library, libcrypt_i.a so the LIBS
        needed be set to:

                LIBS=' -lsocket -lcrypt_i'

UnixWare: There are known bugs in the math library of the system, as well as
        problems in the handling of threads (calling fork in one
        thread may interrupt system calls in others). Therefore, test_math and
        tests involving threads will fail until those problems are fixed.

QNX:    Chris Herborth (chrish@qnx.com) writes:
        configure works best if you use GNU bash; a port is available on
        ftp.qnx.com in /usr/free.  I used the following process to build,
        test and install Python 1.5.x under QNX:

        1) CONFIG_SHELL=/usr/local/bin/bash CC=cc RANLIB=: \
            ./configure --verbose --without-gcc --with-libm=""

        2) edit Modules/Setup to activate everything that makes sense for
           your system... tested here at QNX with the following modules:

                array, audioop, binascii, cPickle, cStringIO, cmath,
                crypt, curses, errno, fcntl, gdbm, grp, imageop,
                _locale, math, md5, new, operator, parser, pcre,
                posix, pwd, readline, regex, reop,
                select, signal, socket, soundex, strop, struct,
                syslog, termios, time, timing, zlib, audioop, imageop

        3) make SHELL=/usr/local/bin/bash

           or, if you feel the need for speed:

           make SHELL=/usr/local/bin/bash OPT="-5 -Oil+nrt"

        4) make SHELL=/usr/local/bin/bash test

           Using GNU readline 2.2 seems to behave strangely, but I
           think that's a problem with my readline 2.2 port.  :-\

        5) make SHELL=/usr/local/bin/bash install

        If you get SIGSEGVs while running Python (I haven't yet, but
        I've only run small programs and the test cases), you're
        probably running out of stack; the default 32k could be a
        little tight.  To increase the stack size, edit the Makefile
        to read: LDFLAGS = -N 48k

BeOS:   See Misc/BeOS-NOTES for notes about compiling/installing
        Python on BeOS R3 or later.  Note that only the PowerPC
        platform is supported for R3; both PowerPC and x86 are
        supported for R4.

Cray T3E: Mark Hadfield (m.hadfield@niwa.co.nz) writes:
        Python can be built satisfactorily on a Cray T3E but based on
        my experience with the NIWA T3E (2002-05-22, version 2.2.1)
        there are a few bugs and gotchas. For more information see a
        thread on comp.lang.python in May 2002 entitled "Building
        Python on Cray T3E".

        1) Use Cray's cc and not gcc. The latter was reported not to
           work by Konrad Hinsen. It may work now, but it may not.

        2) To set sys.platform to something sensible, pass the
           following environment variable to the configure script:

             MACHDEP=unicosmk

        2) Run configure with option "--enable-unicode=ucs4".

        3) The Cray T3E does not support dynamic linking, so extension
           modules have to be built by adding (or uncommenting) lines
           in Modules/Setup. The minimum set of modules is

             posix, new, _sre, unicodedata

           On NIWA's vanilla T3E system the following have also been
           included successfully:

             _codecs, _locale, _socket, _symtable, _testcapi, _weakref
             array, binascii, cmath, cPickle, crypt, cStringIO, dbm
             errno, fcntl, grp, math, md5, operator, parser, pcre, pwd
             regex, rotor, select, struct, strop, syslog, termios
             time, timing, xreadlines

        4) Once the python executable and library have been built, make
           will execute setup.py, which will attempt to build remaining
           extensions and link them dynamically. Each of these attempts
           will fail but should not halt the make process. This is
           normal.

        5) Running "make test" uses a lot of resources and causes
           problems on our system. You might want to try running tests
           singly or in small groups.

SGI:    SGI's standard "make" utility (/bin/make or /usr/bin/make)
        does not check whether a command actually changed the file it
        is supposed to build.  This means that whenever you say "make"
        it will redo the link step.  The remedy is to use SGI's much
        smarter "smake" utility (/usr/sbin/smake), or GNU make.  If
        you set the first line of the Makefile to #!/usr/sbin/smake
        smake will be invoked by make (likewise for GNU make).

        WARNING: There are bugs in the optimizer of some versions of
        SGI's compilers that can cause bus errors or other strange
        behavior, especially on numerical operations.  To avoid this,
        try building with "make OPT=".

OS/2:   If you are running Warp3 or Warp4 and have IBM's VisualAge C/C++
        compiler installed, just change into the pc\os2vacpp directory
        and type NMAKE.  Threading and sockets are supported by default
        in the resulting binaries of PYTHON15.DLL and PYTHON.EXE.

Reliant UNIX: The thread support does not compile on Reliant UNIX, and
        there is a (minor) problem in the configure script for that
        platform as well.  This should be resolved in time for a
        future release.

MacOSX: The tests will crash on both 10.1 and 10.2 with SEGV in
        test_re and test_sre due to the small default stack size.  If
        you set the stack size to 2048 before doing a "make test" the
        failure can be avoided.  If you're using the tcsh or csh shells,
        use "limit stacksize 2048" and for the bash shell (the default
        as of OSX 10.3), use "ulimit -s 2048".

        On naked Darwin you may want to add the configure option
        "--disable-toolbox-glue" to disable the glue code for the Carbon
        interface modules. The modules themselves are currently only built
        if you add the --enable-framework option, see below.

        On a clean OSX /usr/local does not exist. Do a
        "sudo mkdir -m 775 /usr/local"
        before you do a make install. It is probably not a good idea to
        do "sudo make install" which installs everything as superuser,
        as this may later cause problems when installing distutils-based
        additions.

        Some people have reported problems building Python after using "fink"
        to install additional unix software. Disabling fink (remove all 
        references to /sw from your .profile or .login) should solve this.

        You may want to try the configure option "--enable-framework"
        which installs Python as a framework. The location can be set
        as argument to the --enable-framework option (default
        /Library/Frameworks). A framework install is probably needed if you
        want to use any Aqua-based GUI toolkit (whether Tkinter, wxPython,
        Carbon, Cocoa or anything else).

        You may also want to try the configure option "--enable-universalsdk"
        which builds Python as a universal binary with support for the 
        i386 and PPC architetures. This requires Xcode 2.1 or later to build.

        See Mac/README for more information on framework and 
        universal builds.

Cygwin: With recent (relative to the time of writing, 2001-12-19)
        Cygwin installations, there are problems with the interaction
        of dynamic linking and fork().  This manifests itself in build
        failures during the execution of setup.py.

        There are two workarounds that both enable Python (albeit
        without threading support) to build and pass all tests on
        NT/2000 (and most likely XP as well, though reports of testing
        on XP would be appreciated).

        The workarounds:

        (a) the band-aid fix is to link the _socket module statically
        rather than dynamically (which is the default).

        To do this, run "./configure --with-threads=no" including any
        other options you need (--prefix, etc.).  Then in Modules/Setup
        uncomment the lines:

        #SSL=/usr/local/ssl
        #_socket socketmodule.c \
        #       -DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \
        #       -L$(SSL)/lib -lssl -lcrypto

        and remove "local/" from the SSL variable.  Finally, just run
        "make"!

        (b) The "proper" fix is to rebase the Cygwin DLLs to prevent
        base address conflicts.  Details on how to do this can be
        found in the following mail:

           http://sources.redhat.com/ml/cygwin/2001-12/msg00894.html

        It is hoped that a version of this solution will be
        incorporated into the Cygwin distribution fairly soon.

        Two additional problems:

        (1) Threading support should still be disabled due to a known
        bug in Cygwin pthreads that causes test_threadedtempfile to
        hang.

        (2) The _curses module does not build.  This is a known
        Cygwin ncurses problem that should be resolved the next time
        that this package is released.

        On older versions of Cygwin, test_poll may hang and test_strftime
        may fail.

        The situation on 9X/Me is not accurately known at present.
        Some time ago, there were reports that the following
        regression tests failed:

            test_pwd
            test_select (hang)
            test_socket

        Due to the test_select hang on 9X/Me, one should run the
        regression test using the following:

            make TESTOPTS='-l -x test_select' test

        News regarding these platforms with more recent Cygwin
        versions would be appreciated!

Windows: When executing Python scripts on the command line using file type
        associations (i.e. starting "script.py" instead of "python script.py"),
        redirects may not work unless you set a specific registry key.  See
        the Knowledge Base article <http://support.microsoft.com/kb/321788>.


Configuring the bsddb and dbm modules
-------------------------------------

Beginning with Python version 2.3, the PyBsddb package
<http://pybsddb.sf.net/> was adopted into Python as the bsddb package,
exposing a set of package-level functions which provide
backwards-compatible behavior.  Only versions 3.3 through 4.4 of
Sleepycat's libraries provide the necessary API, so older versions
aren't supported through this interface.  The old bsddb module has
been retained as bsddb185, though it is not built by default.  Users
wishing to use it will have to tweak Modules/Setup to build it.  The
dbm module will still be built against the Sleepycat libraries if
other preferred alternatives (ndbm, gdbm) are not found.

Building the sqlite3 module
---------------------------

To build the sqlite3 module, you'll need the sqlite3 or libsqlite3
packages installed, including the header files. Many modern operating
systems distribute the headers in a separate package to the library -
often it will be the same name as the main package, but with a -dev or
-devel suffix. 

The version of pysqlite2 that's including in Python needs sqlite3 3.0.8
or later. setup.py attempts to check that it can find a correct version.

Configuring threads
-------------------

As of Python 2.0, threads are enabled by default.  If you wish to
compile without threads, or if your thread support is broken, pass the
--with-threads=no switch to configure.  Unfortunately, on some
platforms, additional compiler and/or linker options are required for
threads to work properly.  Below is a table of those options,
collected by Bill Janssen.  We would love to automate this process
more, but the information below is not enough to write a patch for the
configure.in file, so manual intervention is required.  If you patch
the configure.in file and are confident that the patch works, please
send in the patch.  (Don't bother patching the configure script itself
-- it is regenerated each time the configure.in file changes.)

Compiler switches for threads
.............................

The definition of _REENTRANT should be configured automatically, if
that does not work on your system, or if _REENTRANT is defined
incorrectly, please report that as a bug.

    OS/Compiler/threads                     Switches for use with threads
    (POSIX is draft 10, DCE is draft 4)     compile & link

    SunOS 5.{1-5}/{gcc,SunPro cc}/solaris   -mt
    SunOS 5.5/{gcc,SunPro cc}/POSIX         (nothing)
    DEC OSF/1 3.x/cc/DCE                    -threads
            (butenhof@zko.dec.com)
    Digital UNIX 4.x/cc/DCE                 -threads
            (butenhof@zko.dec.com)
    Digital UNIX 4.x/cc/POSIX               -pthread
            (butenhof@zko.dec.com)
    AIX 4.1.4/cc_r/d7                       (nothing)
            (buhrt@iquest.net)
    AIX 4.1.4/cc_r4/DCE                     (nothing)
            (buhrt@iquest.net)
    IRIX 6.2/cc/POSIX                       (nothing)
            (robertl@cwi.nl)


Linker (ld) libraries and flags for threads
...........................................

    OS/threads                          Libraries/switches for use with threads

    SunOS 5.{1-5}/solaris               -lthread
    SunOS 5.5/POSIX                     -lpthread
    DEC OSF/1 3.x/DCE                   -lpthreads -lmach -lc_r -lc
            (butenhof@zko.dec.com)
    Digital UNIX 4.x/DCE                -lpthreads -lpthread -lmach -lexc -lc
            (butenhof@zko.dec.com)
    Digital UNIX 4.x/POSIX              -lpthread -lmach -lexc -lc
            (butenhof@zko.dec.com)
    AIX 4.1.4/{draft7,DCE}              (nothing)
            (buhrt@iquest.net)
    IRIX 6.2/POSIX                      -lpthread
            (jph@emilia.engr.sgi.com)


Building a shared libpython
---------------------------

Starting with Python 2.3, the majority of the interpreter can be built
into a shared library, which can then be used by the interpreter
executable, and by applications embedding Python. To enable this feature,
configure with --enable-shared.

If you enable this feature, the same object files will be used to create
a static library.  In particular, the static library will contain object
files using position-independent code (PIC) on platforms where PIC flags
are needed for the shared library.


Configuring additional built-in modules
---------------------------------------

Starting with Python 2.1, the setup.py script at the top of the source
distribution attempts to detect which modules can be built and
automatically compiles them.  Autodetection doesn't always work, so
you can still customize the configuration by editing the Modules/Setup
file; but this should be considered a last resort.  The rest of this
section only applies if you decide to edit the Modules/Setup file.
You also need this to enable static linking of certain modules (which
is needed to enable profiling on some systems).

This file is initially copied from Setup.dist by the configure script;
if it does not exist yet, create it by copying Modules/Setup.dist
yourself (configure will never overwrite it).  Never edit Setup.dist
-- always edit Setup or Setup.local (see below).  Read the comments in
the file for information on what kind of edits are allowed.  When you
have edited Setup in the Modules directory, the interpreter will
automatically be rebuilt the next time you run make (in the toplevel
directory).

Many useful modules can be built on any Unix system, but some optional
modules can't be reliably autodetected.  Often the quickest way to
determine whether a particular module works or not is to see if it
will build: enable it in Setup, then if you get compilation or link
errors, disable it -- you're either missing support or need to adjust
the compilation and linking parameters for that module.

On SGI IRIX, there are modules that interface to many SGI specific
system libraries, e.g. the GL library and the audio hardware.  These
modules will not be built by the setup.py script.

In addition to the file Setup, you can also edit the file Setup.local.
(the makesetup script processes both).  You may find it more
convenient to edit Setup.local and leave Setup alone.  Then, when
installing a new Python version, you can copy your old Setup.local
file.


Setting the optimization/debugging options
------------------------------------------

If you want or need to change the optimization/debugging options for
the C compiler, assign to the OPT variable on the toplevel make
command; e.g. "make OPT=-g" will build a debugging version of Python
on most platforms.  The default is OPT=-O; a value for OPT in the
environment when the configure script is run overrides this default
(likewise for CC; and the initial value for LIBS is used as the base
set of libraries to link with).

When compiling with GCC, the default value of OPT will also include
the -Wall and -Wstrict-prototypes options.

Additional debugging code to help debug memory management problems can
be enabled by using the --with-pydebug option to the configure script.

For flags that change binary compatibility, use the EXTRA_CFLAGS
variable.


Profiling
---------

If you want C profiling turned on, the easiest way is to run configure
with the CC environment variable to the necessary compiler
invocation.  For example, on Linux, this works for profiling using
gprof(1):

    CC="gcc -pg" ./configure

Note that on Linux, gprof apparently does not work for shared
libraries.  The Makefile/Setup mechanism can be used to compile and
link most extension modules statically.


Coverage checking
-----------------

For C coverage checking using gcov, run "make coverage".  This will
build a Python binary with profiling activated, and a ".gcno" and
".gcda" file for every source file compiled with that option.  With
the built binary, now run the code whose coverage you want to check.
Then, you can see coverage statistics for each individual source file
by running gcov, e.g.

    gcov -o Modules zlibmodule

This will create a "zlibmodule.c.gcov" file in the current directory
containing coverage info for that source file.

This works only for source files statically compiled into the
executable; use the Makefile/Setup mechanism to compile and link
extension modules you want to coverage-check statically.


Testing
-------

To test the interpreter, type "make test" in the top-level directory.
This runs the test set twice (once with no compiled files, once with
the compiled files left by the previous test run).  The test set
produces some output.  You can generally ignore the messages about
skipped tests due to optional features which can't be imported.
If a message is printed about a failed test or a traceback or core
dump is produced, something is wrong.  On some Linux systems (those
that are not yet using glibc 6), test_strftime fails due to a
non-standard implementation of strftime() in the C library. Please
ignore this, or upgrade to glibc version 6.

By default, tests are prevented from overusing resources like disk space and
memory.  To enable these tests, run "make testall".

IMPORTANT: If the tests fail and you decide to mail a bug report,
*don't* include the output of "make test".  It is useless.  Run the
failing test manually, as follows:

        ./python Lib/test/regrtest.py -v test_whatever

(substituting the top of the source tree for '.' if you built in a
different directory).  This runs the test in verbose mode.


Installing
----------

To install the Python binary, library modules, shared library modules
(see below), include files, configuration files, and the manual page,
just type

        make install

This will install all platform-independent files in subdirectories of
the directory given with the --prefix option to configure or to the
`prefix' Make variable (default /usr/local).  All binary and other
platform-specific files will be installed in subdirectories if the
directory given by --exec-prefix or the `exec_prefix' Make variable
(defaults to the --prefix directory) is given.

If DESTDIR is set, it will be taken as the root directory of the
installation, and files will be installed into $(DESTDIR)$(prefix),
$(DESTDIR)$(exec_prefix), etc.

All subdirectories created will have Python's version number in their
name, e.g. the library modules are installed in
"/usr/local/lib/python<version>/" by default, where <version> is the
<major>.<minor> release number (e.g. "2.1").  The Python binary is
installed as "python<version>" and a hard link named "python" is
created.  The only file not installed with a version number in its
name is the manual page, installed as "/usr/local/man/man1/python.1"
by default.

If you want to install multiple versions of Python see the section below
entitled "Installing multiple versions".

The only thing you may have to install manually is the Python mode for
Emacs found in Misc/python-mode.el.  (But then again, more recent
versions of Emacs may already have it.)  Follow the instructions that
came with Emacs for installation of site-specific files.

On Mac OS X, if you have configured Python with --enable-framework, you
should use "make frameworkinstall" to do the installation. Note that this
installs the Python executable in a place that is not normally on your
PATH, you may want to set up a symlink in /usr/local/bin.


Installing multiple versions
----------------------------

On Unix and Mac systems if you intend to install multiple versions of Python
using the same installation prefix (--prefix argument to the configure
script) you must take care that your primary python executable is not
overwritten by the installation of a different version.  All files and
directories installed using "make altinstall" contain the major and minor
version and can thus live side-by-side.  "make install" also creates
${prefix}/bin/python which refers to ${prefix}/bin/pythonX.Y.  If you intend
to install multiple versions using the same prefix you must decide which
version (if any) is your "primary" version.  Install that version using
"make install".  Install all other versions using "make altinstall".

For example, if you want to install Python 2.5, 2.6 and 3.0 with 2.6 being
the primary version, you would execute "make install" in your 2.6 build
directory and "make altinstall" in the others.


Configuration options and variables
-----------------------------------

Some special cases are handled by passing options to the configure
script.

WARNING: if you rerun the configure script with different options, you
must run "make clean" before rebuilding.  Exceptions to this rule:
after changing --prefix or --exec-prefix, all you need to do is remove
Modules/getpath.o.

--with(out)-gcc: The configure script uses gcc (the GNU C compiler) if
        it finds it.  If you don't want this, or if this compiler is
        installed but broken on your platform, pass the option
        --without-gcc.  You can also pass "CC=cc" (or whatever the
        name of the proper C compiler is) in the environment, but the
        advantage of using --without-gcc is that this option is
        remembered by the config.status script for its --recheck
        option.

--prefix, --exec-prefix: If you want to install the binaries and the
        Python library somewhere else than in /usr/local/{bin,lib},
        you can pass the option --prefix=DIRECTORY; the interpreter
        binary will be installed as DIRECTORY/bin/python and the
        library files as DIRECTORY/lib/python/*.  If you pass
        --exec-prefix=DIRECTORY (as well) this overrides the
        installation prefix for architecture-dependent files (like the
        interpreter binary).  Note that --prefix=DIRECTORY also
        affects the default module search path (sys.path), when
        Modules/config.c is compiled.  Passing make the option
        prefix=DIRECTORY (and/or exec_prefix=DIRECTORY) overrides the
        prefix set at configuration time; this may be more convenient
        than re-running the configure script if you change your mind
        about the install prefix.

--with-readline: This option is no longer supported.  GNU
        readline is automatically enabled by setup.py when present.

--with-threads: On most Unix systems, you can now use multiple
        threads, and support for this is enabled by default.  To
        disable this, pass --with-threads=no.  If the library required
        for threads lives in a peculiar place, you can use
        --with-thread=DIRECTORY.  IMPORTANT: run "make clean" after
        changing (either enabling or disabling) this option, or you
        will get link errors!  Note: for DEC Unix use
        --with-dec-threads instead.

--with-sgi-dl: On SGI IRIX 4, dynamic loading of extension modules is
        supported by the "dl" library by Jack Jansen, which is
        ftp'able from ftp://ftp.cwi.nl/pub/dynload/dl-1.6.tar.Z.
        This is enabled (after you've ftp'ed and compiled the dl
        library) by passing --with-sgi-dl=DIRECTORY where DIRECTORY
        is the absolute pathname of the dl library.  (Don't bother on
        IRIX 5, it already has dynamic linking using SunOS style
        shared libraries.)  THIS OPTION IS UNSUPPORTED.

--with-dl-dld: Dynamic loading of modules is rumored to be supported
        on some other systems: VAX (Ultrix), Sun3 (SunOS 3.4), Sequent
        Symmetry (Dynix), and Atari ST.  This is done using a
        combination of the GNU dynamic loading package
        (ftp://ftp.cwi.nl/pub/dynload/dl-dld-1.1.tar.Z) and an
        emulation of the SGI dl library mentioned above (the emulation
        can be found at
        ftp://ftp.cwi.nl/pub/dynload/dld-3.2.3.tar.Z).  To
        enable this, ftp and compile both libraries, then call
        configure, passing it the option
        --with-dl-dld=DL_DIRECTORY,DLD_DIRECTORY where DL_DIRECTORY is
        the absolute pathname of the dl emulation library and
        DLD_DIRECTORY is the absolute pathname of the GNU dld library.
        (Don't bother on SunOS 4 or 5, they already have dynamic
        linking using shared libraries.)  THIS OPTION IS UNSUPPORTED.

--with-libm, --with-libc: It is possible to specify alternative
        versions for the Math library (default -lm) and the C library
        (default the empty string) using the options
        --with-libm=STRING and --with-libc=STRING, respectively.  For
        example, if your system requires that you pass -lc_s to the C
        compiler to use the shared C library, you can pass
        --with-libc=-lc_s. These libraries are passed after all other
        libraries, the C library last.

--with-libs='libs': Add 'libs' to the LIBS that the python interpreter
        is linked against.

--with-cxx-main=<compiler>: If you plan to use C++ extension modules,
        then -- on some platforms -- you need to compile python's main()
        function with the C++ compiler. With this option, make will use
        <compiler> to compile main() *and* to link the python executable.
        It is likely that the resulting executable depends on the C++
        runtime library of <compiler>. (The default is --without-cxx-main.)

        There are platforms that do not require you to build Python
        with a C++ compiler in order to use C++ extension modules.
        E.g., x86 Linux with ELF shared binaries and GCC 3.x, 4.x is such
        a platform. We recommend that you configure Python
        --without-cxx-main on those platforms because a mismatch
        between the C++ compiler version used to build Python and to
        build a C++ extension module is likely to cause a crash at
        runtime.

        The Python installation also stores the variable CXX that
        determines, e.g., the C++ compiler distutils calls by default
        to build C++ extensions. If you set CXX on the configure command
        line to any string of non-zero length, then configure won't
        change CXX. If you do not preset CXX but pass
        --with-cxx-main=<compiler>, then configure sets CXX=<compiler>.
        In all other cases, configure looks for a C++ compiler by
        some common names (c++, g++, gcc, CC, cxx, cc++, cl) and sets
        CXX to the first compiler it finds. If it does not find any
        C++ compiler, then it sets CXX="".

        Similarly, if you want to change the command used to link the
        python executable, then set LINKCC on the configure command line.


--with-pydebug:  Enable additional debugging code to help track down
        memory management problems.  This allows printing a list of all
        live objects when the interpreter terminates.

--with(out)-universal-newlines: enable reading of text files with
        foreign newline convention (default: enabled). In other words,
        any of \r, \n or \r\n is acceptable as end-of-line character.
        If enabled import and execfile will automatically accept any newline
        in files. Python code can open a file with open(file, 'U') to
        read it in universal newline mode. THIS OPTION IS UNSUPPORTED.

--with-tsc: Profile using the Pentium timestamping counter (TSC).

--with-system-ffi:  Build the _ctypes extension module using an ffi
        library installed on the system.

--with-dbmliborder=db1:db2:...:  Specify the order that backends for the
	dbm extension are checked. Valid value is a colon separated string
	with the backend names `ndbm', `gdbm' and `bdb'.

Building for multiple architectures (using the VPATH feature)
-------------------------------------------------------------

If your file system is shared between multiple architectures, it
usually is not necessary to make copies of the sources for each
architecture you want to support.  If the make program supports the
VPATH feature, you can create an empty build directory for each
architecture, and in each directory run the configure script (on the
appropriate machine with the appropriate options).  This creates the
necessary subdirectories and the Makefiles therein.  The Makefiles
contain a line VPATH=... which points to a directory containing the
actual sources.  (On SGI systems, use "smake -J1" instead of "make" if
you use VPATH -- don't try gnumake.)

For example, the following is all you need to build a minimal Python
in /usr/tmp/python (assuming ~guido/src/python is the toplevel
directory and you want to build in /usr/tmp/python):

        $ mkdir /usr/tmp/python
        $ cd /usr/tmp/python
        $ ~guido/src/python/configure
        [...]
        $ make
        [...]
        $

Note that configure copies the original Setup file to the build
directory if it finds no Setup file there.  This means that you can
edit the Setup file for each architecture independently.  For this
reason, subsequent changes to the original Setup file are not tracked
automatically, as they might overwrite local changes.  To force a copy
of a changed original Setup file, delete the target Setup file.  (The
makesetup script supports multiple input files, so if you want to be
fancy you can change the rules to create an empty Setup.local if it
doesn't exist and run it with arguments $(srcdir)/Setup Setup.local;
however this assumes that you only need to add modules.)

Also note that you can't use a workspace for VPATH and non VPATH builds. The
object files left behind by one version confuses the other.


Building on non-UNIX systems
----------------------------

For Windows (2000/NT/ME/98/95), assuming you have MS VC++ 7.1, the
project files are in PCbuild, the workspace is pcbuild.dsw.  See
PCbuild\readme.txt for detailed instructions.

For other non-Unix Windows compilers, in particular MS VC++ 6.0 and
for OS/2, enter the directory "PC" and read the file "readme.txt".

For the Mac, a separate source distribution will be made available,
for use with the CodeWarrior compiler.  If you are interested in Mac
development, join the PythonMac Special Interest Group
(http://www.python.org/sigs/pythonmac-sig/, or send email to
pythonmac-sig-request@python.org).

Of course, there are also binary distributions available for these
platforms -- see http://www.python.org/.

To port Python to a new non-UNIX system, you will have to fake the
effect of running the configure script manually (for Mac and PC, this
has already been done for you).  A good start is to copy the file
pyconfig.h.in to pyconfig.h and edit the latter to reflect the actual
configuration of your system.  Most symbols must simply be defined as
1 only if the corresponding feature is present and can be left alone
otherwise; however the *_t type symbols must be defined as some
variant of int if they need to be defined at all.

For all platforms, it's important that the build arrange to define the
preprocessor symbol NDEBUG on the compiler command line in a release
build of Python (else assert() calls remain in the code, hurting
release-build performance).  The Unix, Windows and Mac builds already
do this.


Miscellaneous issues
====================

Emacs mode
----------

There's an excellent Emacs editing mode for Python code; see the file
Misc/python-mode.el.  Originally written by the famous Tim Peters, it is now
maintained by the equally famous Barry Warsaw.  The latest version, along with
various other contributed Python-related Emacs goodies, is online at
http://launchpad.net/python-mode/.


Tkinter
-------

The setup.py script automatically configures this when it detects a
usable Tcl/Tk installation.  This requires Tcl/Tk version 8.0 or
higher.

For more Tkinter information, see the Tkinter Resource page:
http://www.python.org/topics/tkinter/

There are demos in the Demo/tkinter directory.

Note that there's a Python module called "Tkinter" (capital T) which
lives in Lib/lib-tk/Tkinter.py, and a C module called "_tkinter"
(lower case t and leading underscore) which lives in
Modules/_tkinter.c.  Demos and normal Tk applications import only the
Python Tkinter module -- only the latter imports the C _tkinter
module.  In order to find the C _tkinter module, it must be compiled
and linked into the Python interpreter -- the setup.py script does
this.  In order to find the Python Tkinter module, sys.path must be
set correctly -- normal installation takes care of this.


Distribution structure
----------------------

Most subdirectories have their own README files.  Most files have
comments.

Demo/           Demonstration scripts, modules and programs
Doc/            Documentation sources (reStructuredText)
Grammar/        Input for the parser generator
Include/        Public header files
LICENSE         Licensing information
Lib/            Python library modules
Mac/            Macintosh specific resources
Makefile.pre.in Source from which config.status creates the Makefile.pre
Misc/           Miscellaneous useful files
Modules/        Implementation of most built-in modules
Objects/        Implementation of most built-in object types
PC/             Files specific to PC ports (DOS, Windows, OS/2)
PCbuild/        Build directory for Microsoft Visual C++
Parser/         The parser and tokenizer and their input handling
Python/         The byte-compiler and interpreter
README          The file you're reading now
RISCOS/         Files specific to RISC OS port
Tools/          Some useful programs written in Python
pyconfig.h.in   Source from which pyconfig.h is created (GNU autoheader output)
configure       Configuration shell script (GNU autoconf output)
configure.in    Configuration specification (input for GNU autoconf)
install-sh      Shell script used to install files
setup.py        Python script used to build extension modules

The following files will (may) be created in the toplevel directory by
the configuration and build processes:

Makefile        Build rules
Makefile.pre    Build rules before running Modules/makesetup
buildno         Keeps track of the build number
config.cache    Cache of configuration variables
pyconfig.h      Configuration header
config.log      Log from last configure run
config.status   Status from last run of the configure script
getbuildinfo.o  Object file from Modules/getbuildinfo.c
libpython<version>.a    The library archive
python          The executable interpreter
reflog.txt      Output from running the regression suite with the -R flag 
tags, TAGS      Tags files for vi and Emacs


That's all, folks!
------------------


--Guido van Rossum (home page: http://www.python.org/~guido/)

============================================
 ``docutils/parsers/rst/include`` Directory
============================================

This directory contains standard data files intended for inclusion in
reStructuredText documents.  To access these files, use the "include"
directive with the special syntax for standard "include" data files,
angle brackets around the file name::

    .. include:: <isonum.txt>

See the documentation for the `"include" directive`__ and
`reStructuredText Standard Substitution Definition Sets`__ for
details.

__ http://docutils.sf.net/docs/ref/rst/directives.html#include
__ http://docutils.sf.net/docs/ref/rst/substitutions.html

Except where otherwise noted (default/iepngfix.htc), all files in this
directory have been released into the Public Domain.

These files are based on files from S5 1.1, released into the Public
Domain by Eric Meyer.  For further details, please see
http://www.meyerweb.com/eric/tools/s5/credits.html.

======================
Descriptor HowTo Guide
======================

:Author: Raymond Hettinger
:Contact: <python at rcn dot com>

.. Contents::

Abstract
--------

Defines descriptors, summarizes the protocol, and shows how descriptors are
called.  Examines a custom descriptor and several built-in python descriptors
including functions, properties, static methods, and class methods.  Shows how
each works by giving a pure Python equivalent and a sample application.

Learning about descriptors not only provides access to a larger toolset, it
creates a deeper understanding of how Python works and an appreciation for the
elegance of its design.


Definition and Introduction
---------------------------

In general, a descriptor is an object attribute with "binding behavior", one
whose attribute access has been overridden by methods in the descriptor
protocol.  Those methods are :meth:`__get__`, :meth:`__set__`, and
:meth:`__delete__`.  If any of those methods are defined for an object, it is
said to be a descriptor.

The default behavior for attribute access is to get, set, or delete the
attribute from an object's dictionary.  For instance, ``a.x`` has a lookup chain
starting with ``a.__dict__['x']``, then ``type(a).__dict__['x']``, and
continuing through the base classes of ``type(a)`` excluding metaclasses. If the
looked-up value is an object defining one of the descriptor methods, then Python
may override the default behavior and invoke the descriptor method instead.
Where this occurs in the precedence chain depends on which descriptor methods
were defined.  Note that descriptors are only invoked for new style objects or
classes (a class is new style if it inherits from :class:`object` or
:class:`type`).

Descriptors are a powerful, general purpose protocol.  They are the mechanism
behind properties, methods, static methods, class methods, and :func:`super()`.
They are used used throughout Python itself to implement the new style classes
introduced in version 2.2.  Descriptors simplify the underlying C-code and offer
a flexible set of new tools for everyday Python programs.


Descriptor Protocol
-------------------

``descr.__get__(self, obj, type=None) --> value``

``descr.__set__(self, obj, value) --> None``

``descr.__delete__(self, obj) --> None``

That is all there is to it.  Define any of these methods and an object is
considered a descriptor and can override default behavior upon being looked up
as an attribute.

If an object defines both :meth:`__get__` and :meth:`__set__`, it is considered
a data descriptor.  Descriptors that only define :meth:`__get__` are called
non-data descriptors (they are typically used for methods but other uses are
possible).

Data and non-data descriptors differ in how overrides are calculated with
respect to entries in an instance's dictionary.  If an instance's dictionary
has an entry with the same name as a data descriptor, the data descriptor
takes precedence.  If an instance's dictionary has an entry with the same
name as a non-data descriptor, the dictionary entry takes precedence.

To make a read-only data descriptor, define both :meth:`__get__` and
:meth:`__set__` with the :meth:`__set__` raising an :exc:`AttributeError` when
called.  Defining the :meth:`__set__` method with an exception raising
placeholder is enough to make it a data descriptor.


Invoking Descriptors
--------------------

A descriptor can be called directly by its method name.  For example,
``d.__get__(obj)``.

Alternatively, it is more common for a descriptor to be invoked automatically
upon attribute access.  For example, ``obj.d`` looks up ``d`` in the dictionary
of ``obj``.  If ``d`` defines the method :meth:`__get__`, then ``d.__get__(obj)``
is invoked according to the precedence rules listed below.

The details of invocation depend on whether ``obj`` is an object or a class.
Either way, descriptors only work for new style objects and classes.  A class is
new style if it is a subclass of :class:`object`.

For objects, the machinery is in :meth:`object.__getattribute__` which
transforms ``b.x`` into ``type(b).__dict__['x'].__get__(b, type(b))``.  The
implementation works through a precedence chain that gives data descriptors
priority over instance variables, instance variables priority over non-data
descriptors, and assigns lowest priority to :meth:`__getattr__` if provided.  The
full C implementation can be found in :cfunc:`PyObject_GenericGetAttr()` in
`Objects/object.c <http://svn.python.org/view/python/trunk/Objects/object.c?view=markup>`_\.

For classes, the machinery is in :meth:`type.__getattribute__` which transforms
``B.x`` into ``B.__dict__['x'].__get__(None, B)``.  In pure Python, it looks
like::

    def __getattribute__(self, key):
        "Emulate type_getattro() in Objects/typeobject.c"
        v = object.__getattribute__(self, key)
        if hasattr(v, '__get__'):
           return v.__get__(None, self)
        return v

The important points to remember are:

* descriptors are invoked by the :meth:`__getattribute__` method
* overriding :meth:`__getattribute__` prevents automatic descriptor calls
* :meth:`__getattribute__` is only available with new style classes and objects
* :meth:`object.__getattribute__` and :meth:`type.__getattribute__` make
  different calls to :meth:`__get__`.
* data descriptors always override instance dictionaries.
* non-data descriptors may be overridden by instance dictionaries.

The object returned by ``super()`` also has a custom :meth:`__getattribute__`
method for invoking descriptors.  The call ``super(B, obj).m()`` searches
``obj.__class__.__mro__`` for the base class ``A`` immediately following ``B``
and then returns ``A.__dict__['m'].__get__(obj, A)``.  If not a descriptor,
``m`` is returned unchanged.  If not in the dictionary, ``m`` reverts to a
search using :meth:`object.__getattribute__`.

Note, in Python 2.2, ``super(B, obj).m()`` would only invoke :meth:`__get__` if
``m`` was a data descriptor.  In Python 2.3, non-data descriptors also get
invoked unless an old-style class is involved.  The implementation details are
in :cfunc:`super_getattro()` in
`Objects/typeobject.c <http://svn.python.org/view/python/trunk/Objects/typeobject.c?view=markup>`_
and a pure Python equivalent can be found in `Guido's Tutorial`_.

.. _`Guido's Tutorial`: http://www.python.org/2.2.3/descrintro.html#cooperation

The details above show that the mechanism for descriptors is embedded in the
:meth:`__getattribute__()` methods for :class:`object`, :class:`type`, and
:func:`super`.  Classes inherit this machinery when they derive from
:class:`object` or if they have a meta-class providing similar functionality.
Likewise, classes can turn-off descriptor invocation by overriding
:meth:`__getattribute__()`.


Descriptor Example
------------------

The following code creates a class whose objects are data descriptors which
print a message for each get or set.  Overriding :meth:`__getattribute__` is
alternate approach that could do this for every attribute.  However, this
descriptor is useful for monitoring just a few chosen attributes::

    class RevealAccess(object):
        """A data descriptor that sets and returns values
           normally and prints a message logging their access.
        """

        def __init__(self, initval=None, name='var'):
            self.val = initval
            self.name = name

        def __get__(self, obj, objtype):
            print 'Retrieving', self.name
            return self.val

        def __set__(self, obj, val):
            print 'Updating' , self.name
            self.val = val

    >>> class MyClass(object):
        x = RevealAccess(10, 'var "x"')
        y = 5

    >>> m = MyClass()
    >>> m.x
    Retrieving var "x"
    10
    >>> m.x = 20
    Updating var "x"
    >>> m.x
    Retrieving var "x"
    20
    >>> m.y
    5

The protocol is simple and offers exciting possibilities.  Several use cases are
so common that they have been packaged into individual function calls.
Properties, bound and unbound methods, static methods, and class methods are all
based on the descriptor protocol.


Properties
----------

Calling :func:`property` is a succinct way of building a data descriptor that
triggers function calls upon access to an attribute.  Its signature is::

    property(fget=None, fset=None, fdel=None, doc=None) -> property attribute

The documentation shows a typical use to define a managed attribute ``x``::

    class C(object):
        def getx(self): return self.__x
        def setx(self, value): self.__x = value
        def delx(self): del self.__x
        x = property(getx, setx, delx, "I'm the 'x' property.")

To see how :func:`property` is implemented in terms of the descriptor protocol,
here is a pure Python equivalent::

    class Property(object):
        "Emulate PyProperty_Type() in Objects/descrobject.c"

        def __init__(self, fget=None, fset=None, fdel=None, doc=None):
            self.fget = fget
            self.fset = fset
            self.fdel = fdel
            self.__doc__ = doc

        def __get__(self, obj, objtype=None):
            if obj is None:
                return self
            if self.fget is None:
                raise AttributeError, "unreadable attribute"
            return self.fget(obj)

        def __set__(self, obj, value):
            if self.fset is None:
                raise AttributeError, "can't set attribute"
            self.fset(obj, value)

        def __delete__(self, obj):
            if self.fdel is None:
                raise AttributeError, "can't delete attribute"
            self.fdel(obj)

The :func:`property` builtin helps whenever a user interface has granted
attribute access and then subsequent changes require the intervention of a
method.

For instance, a spreadsheet class may grant access to a cell value through
``Cell('b10').value``. Subsequent improvements to the program require the cell
to be recalculated on every access; however, the programmer does not want to
affect existing client code accessing the attribute directly.  The solution is
to wrap access to the value attribute in a property data descriptor::

    class Cell(object):
        . . .
        def getvalue(self, obj):
            "Recalculate cell before returning value"
            self.recalc()
            return obj._value
        value = property(getvalue)


Functions and Methods
---------------------

Python's object oriented features are built upon a function based environment.
Using non-data descriptors, the two are merged seamlessly.

Class dictionaries store methods as functions.  In a class definition, methods
are written using :keyword:`def` and :keyword:`lambda`, the usual tools for
creating functions.  The only difference from regular functions is that the
first argument is reserved for the object instance.  By Python convention, the
instance reference is called *self* but may be called *this* or any other
variable name.

To support method calls, functions include the :meth:`__get__` method for
binding methods during attribute access.  This means that all functions are
non-data descriptors which return bound or unbound methods depending whether
they are invoked from an object or a class.  In pure python, it works like
this::

    class Function(object):
        . . .
        def __get__(self, obj, objtype=None):
            "Simulate func_descr_get() in Objects/funcobject.c"
            return types.MethodType(self, obj, objtype)

Running the interpreter shows how the function descriptor works in practice::

    >>> class D(object):
         def f(self, x):
              return x

    >>> d = D()
    >>> D.__dict__['f'] # Stored internally as a function
    <function f at 0x00C45070>
    >>> D.f             # Get from a class becomes an unbound method
    <unbound method D.f>
    >>> d.f             # Get from an instance becomes a bound method
    <bound method D.f of <__main__.D object at 0x00B18C90>>

The output suggests that bound and unbound methods are two different types.
While they could have been implemented that way, the actual C implemention of
:ctype:`PyMethod_Type` in
`Objects/classobject.c <http://svn.python.org/view/python/trunk/Objects/classobject.c?view=markup>`_
is a single object with two different representations depending on whether the
:attr:`im_self` field is set or is *NULL* (the C equivalent of *None*).

Likewise, the effects of calling a method object depend on the :attr:`im_self`
field. If set (meaning bound), the original function (stored in the
:attr:`im_func` field) is called as expected with the first argument set to the
instance.  If unbound, all of the arguments are passed unchanged to the original
function. The actual C implementation of :func:`instancemethod_call()` is only
slightly more complex in that it includes some type checking.


Static Methods and Class Methods
--------------------------------

Non-data descriptors provide a simple mechanism for variations on the usual
patterns of binding functions into methods.

To recap, functions have a :meth:`__get__` method so that they can be converted
to a method when accessed as attributes.  The non-data descriptor transforms a
``obj.f(*args)`` call into ``f(obj, *args)``.  Calling ``klass.f(*args)``
becomes ``f(*args)``.

This chart summarizes the binding and its two most useful variants:

      +-----------------+----------------------+------------------+
      | Transformation  | Called from an       | Called from a    |
      |                 | Object               | Class            |
      +=================+======================+==================+
      | function        | f(obj, \*args)       | f(\*args)        |
      +-----------------+----------------------+------------------+
      | staticmethod    | f(\*args)            | f(\*args)        |
      +-----------------+----------------------+------------------+
      | classmethod     | f(type(obj), \*args) | f(klass, \*args) |
      +-----------------+----------------------+------------------+

Static methods return the underlying function without changes.  Calling either
``c.f`` or ``C.f`` is the equivalent of a direct lookup into
``object.__getattribute__(c, "f")`` or ``object.__getattribute__(C, "f")``. As a
result, the function becomes identically accessible from either an object or a
class.

Good candidates for static methods are methods that do not reference the
``self`` variable.

For instance, a statistics package may include a container class for
experimental data.  The class provides normal methods for computing the average,
mean, median, and other descriptive statistics that depend on the data. However,
there may be useful functions which are conceptually related but do not depend
on the data.  For instance, ``erf(x)`` is handy conversion routine that comes up
in statistical work but does not directly depend on a particular dataset.
It can be called either from an object or the class:  ``s.erf(1.5) --> .9332`` or
``Sample.erf(1.5) --> .9332``.

Since staticmethods return the underlying function with no changes, the example
calls are unexciting::

    >>> class E(object):
         def f(x):
              print x
         f = staticmethod(f)

    >>> print E.f(3)
    3
    >>> print E().f(3)
    3

Using the non-data descriptor protocol, a pure Python version of
:func:`staticmethod` would look like this::

    class StaticMethod(object):
     "Emulate PyStaticMethod_Type() in Objects/funcobject.c"

     def __init__(self, f):
          self.f = f

     def __get__(self, obj, objtype=None):
          return self.f

Unlike static methods, class methods prepend the class reference to the
argument list before calling the function.  This format is the same
for whether the caller is an object or a class::

    >>> class E(object):
         def f(klass, x):
              return klass.__name__, x
         f = classmethod(f)

    >>> print E.f(3)
    ('E', 3)
    >>> print E().f(3)
    ('E', 3)


This behavior is useful whenever the function only needs to have a class
reference and does not care about any underlying data.  One use for classmethods
is to create alternate class constructors.  In Python 2.3, the classmethod
:func:`dict.fromkeys` creates a new dictionary from a list of keys.  The pure
Python equivalent is::

    class Dict:
        . . .
        def fromkeys(klass, iterable, value=None):
            "Emulate dict_fromkeys() in Objects/dictobject.c"
            d = klass()
            for key in iterable:
                d[key] = value
            return d
        fromkeys = classmethod(fromkeys)

Now a new dictionary of unique keys can be constructed like this::

    >>> Dict.fromkeys('abracadabra')
    {'a': None, 'r': None, 'b': None, 'c': None, 'd': None}

Using the non-data descriptor protocol, a pure Python version of
:func:`classmethod` would look like this::

    class ClassMethod(object):
         "Emulate PyClassMethod_Type() in Objects/funcobject.c"

         def __init__(self, f):
              self.f = f

         def __get__(self, obj, klass=None):
              if klass is None:
                   klass = type(obj)
              def newfunc(*args):
                   return self.f(klass, *args)
              return newfunc


Python Documentation README
~~~~~~~~~~~~~~~~~~~~~~~~~~~

This directory contains the reStructuredText (reST) sources to the Python
documentation.  You don't need to build them yourself, prebuilt versions are
available at http://docs.python.org/download/.

Documentation on the authoring Python documentation, including information about
both style and markup, is available in the "Documenting Python" chapter of the
documentation.  There's also a chapter intended to point out differences to
those familiar with the previous docs written in LaTeX.


Building the docs
=================

You need to have Python 2.4 or higher installed; the toolset used to build the
docs is written in Python.  It is called *Sphinx*, it is not included in this
tree, but maintained separately.  Also needed are the docutils, supplying the
base markup that Sphinx uses, Jinja, a templating engine, and optionally
Pygments, a code highlighter.


Using make
----------

Luckily, a Makefile has been prepared so that on Unix, provided you have
installed Python and Subversion, you can just run ::

   make html

to check out the necessary toolset in the `tools/` subdirectory and build the
HTML output files.  To view the generated HTML, point your favorite browser at
the top-level index `build/html/index.html` after running "make".

Available make targets are:

 * "html", which builds standalone HTML files for offline viewing.

 * "htmlhelp", which builds HTML files and a HTML Help project file usable to
   convert them into a single Compiled HTML (.chm) file -- these are popular
   under Microsoft Windows, but very handy on every platform.

   To create the CHM file, you need to run the Microsoft HTML Help Workshop over
   the generated project (.hhp) file.

 * "latex", which builds LaTeX source files as input to "pdflatex" to produce
   PDF documents.

 * "text", which builds a plain text file for each source file.

 * "linkcheck", which checks all external references to see whether they are
   broken, redirected or malformed, and outputs this information to stdout as
   well as a plain-text (.txt) file.

 * "changes", which builds an overview over all versionadded/versionchanged/
   deprecated items in the current version. This is meant as a help for the
   writer of the "What's New" document.

 * "coverage", which builds a coverage overview for standard library modules and
   C API.

 * "pydoc-topics", which builds a Python module containing a dictionary with
   plain text documentation for the labels defined in
   `tools/sphinxext/pyspecific.py` -- pydoc needs these to show topic and
   keyword help.

A "make update" updates the Subversion checkouts in `tools/`.


Without make
------------

You'll need to install the Sphinx package, either by checking it out via ::

   svn co http://svn.python.org/projects/external/Sphinx-0.6.5/sphinx tools/sphinx

or by installing it from PyPI.

Then, you need to install Docutils, either by checking it out via ::

   svn co http://svn.python.org/projects/external/docutils-0.6/docutils tools/docutils

or by installing it from http://docutils.sf.net/.

You also need Jinja2, either by checking it out via ::

   svn co http://svn.python.org/projects/external/Jinja-2.3.1/jinja2 tools/jinja2

or by installing it from PyPI.

You can optionally also install Pygments, either as a checkout via ::

   svn co http://svn.python.org/projects/external/Pygments-1.3.1/pygments tools/pygments

or from PyPI at http://pypi.python.org/pypi/Pygments.


Then, make an output directory, e.g. under `build/`, and run ::

   python tools/sphinx-build.py -b<builder> . build/<outputdirectory>

where `<builder>` is one of html, text, latex, or htmlhelp (for explanations see
the make targets above).


Contributing
============

Bugs in the content should be reported to the Python bug tracker at
http://bugs.python.org.

Bugs in the toolset should be reported in the Sphinx bug tracker at
http://www.bitbucket.org/birkenfeld/sphinx/issues/.

You can also send a mail to the Python Documentation Team at docs@python.org,
and we will process your request as soon as possible.

If you want to help the Documentation Team, you are always welcome.  Just send
a mail to docs@python.org.


Copyright notice
================

The Python source is copyrighted, but you can freely use and copy it
as long as you don't change or remove the copyright notice:

----------------------------------------------------------------------
Copyright (c) 2000-2008 Python Software Foundation.
All rights reserved.

Copyright (c) 2000 BeOpen.com.
All rights reserved.

Copyright (c) 1995-2000 Corporation for National Research Initiatives.
All rights reserved.

Copyright (c) 1991-1995 Stichting Mathematisch Centrum.
All rights reserved.

See the file "license.rst" for information on usage and redistribution
of this file, and for a DISCLAIMER OF ALL WARRANTIES.
----------------------------------------------------------------------

======================
Descriptor HowTo Guide
======================

:Author: Raymond Hettinger
:Contact: <python at rcn dot com>

.. Contents::

Abstract
--------

Defines descriptors, summarizes the protocol, and shows how descriptors are
called.  Examines a custom descriptor and several built-in python descriptors
including functions, properties, static methods, and class methods.  Shows how
each works by giving a pure Python equivalent and a sample application.

Learning about descriptors not only provides access to a larger toolset, it
creates a deeper understanding of how Python works and an appreciation for the
elegance of its design.


Definition and Introduction
---------------------------

In general, a descriptor is an object attribute with "binding behavior", one
whose attribute access has been overridden by methods in the descriptor
protocol.  Those methods are :meth:`__get__`, :meth:`__set__`, and
:meth:`__delete__`.  If any of those methods are defined for an object, it is
said to be a descriptor.

The default behavior for attribute access is to get, set, or delete the
attribute from an object's dictionary.  For instance, ``a.x`` has a lookup chain
starting with ``a.__dict__['x']``, then ``type(a).__dict__['x']``, and
continuing through the base classes of ``type(a)`` excluding metaclasses. If the
looked-up value is an object defining one of the descriptor methods, then Python
may override the default behavior and invoke the descriptor method instead.
Where this occurs in the precedence chain depends on which descriptor methods
were defined.  Note that descriptors are only invoked for new style objects or
classes (a class is new style if it inherits from :class:`object` or
:class:`type`).

Descriptors are a powerful, general purpose protocol.  They are the mechanism
behind properties, methods, static methods, class methods, and :func:`super()`.
They are used used throughout Python itself to implement the new style classes
introduced in version 2.2.  Descriptors simplify the underlying C-code and offer
a flexible set of new tools for everyday Python programs.


Descriptor Protocol
-------------------

``descr.__get__(self, obj, type=None) --> value``

``descr.__set__(self, obj, value) --> None``

``descr.__delete__(self, obj) --> None``

That is all there is to it.  Define any of these methods and an object is
considered a descriptor and can override default behavior upon being looked up
as an attribute.

If an object defines both :meth:`__get__` and :meth:`__set__`, it is considered
a data descriptor.  Descriptors that only define :meth:`__get__` are called
non-data descriptors (they are typically used for methods but other uses are
possible).

Data and non-data descriptors differ in how overrides are calculated with
respect to entries in an instance's dictionary.  If an instance's dictionary
has an entry with the same name as a data descriptor, the data descriptor
takes precedence.  If an instance's dictionary has an entry with the same
name as a non-data descriptor, the dictionary entry takes precedence.

To make a read-only data descriptor, define both :meth:`__get__` and
:meth:`__set__` with the :meth:`__set__` raising an :exc:`AttributeError` when
called.  Defining the :meth:`__set__` method with an exception raising
placeholder is enough to make it a data descriptor.


Invoking Descriptors
--------------------

A descriptor can be called directly by its method name.  For example,
``d.__get__(obj)``.

Alternatively, it is more common for a descriptor to be invoked automatically
upon attribute access.  For example, ``obj.d`` looks up ``d`` in the dictionary
of ``obj``.  If ``d`` defines the method :meth:`__get__`, then ``d.__get__(obj)``
is invoked according to the precedence rules listed below.

The details of invocation depend on whether ``obj`` is an object or a class.
Either way, descriptors only work for new style objects and classes.  A class is
new style if it is a subclass of :class:`object`.

For objects, the machinery is in :meth:`object.__getattribute__` which
transforms ``b.x`` into ``type(b).__dict__['x'].__get__(b, type(b))``.  The
implementation works through a precedence chain that gives data descriptors
priority over instance variables, instance variables priority over non-data
descriptors, and assigns lowest priority to :meth:`__getattr__` if provided.  The
full C implementation can be found in :cfunc:`PyObject_GenericGetAttr()` in
`Objects/object.c <http://svn.python.org/view/python/trunk/Objects/object.c?view=markup>`_\.

For classes, the machinery is in :meth:`type.__getattribute__` which transforms
``B.x`` into ``B.__dict__['x'].__get__(None, B)``.  In pure Python, it looks
like::

    def __getattribute__(self, key):
        "Emulate type_getattro() in Objects/typeobject.c"
        v = object.__getattribute__(self, key)
        if hasattr(v, '__get__'):
           return v.__get__(None, self)
        return v

The important points to remember are:

* descriptors are invoked by the :meth:`__getattribute__` method
* overriding :meth:`__getattribute__` prevents automatic descriptor calls
* :meth:`__getattribute__` is only available with new style classes and objects
* :meth:`object.__getattribute__` and :meth:`type.__getattribute__` make
  different calls to :meth:`__get__`.
* data descriptors always override instance dictionaries.
* non-data descriptors may be overridden by instance dictionaries.

The object returned by ``super()`` also has a custom :meth:`__getattribute__`
method for invoking descriptors.  The call ``super(B, obj).m()`` searches
``obj.__class__.__mro__`` for the base class ``A`` immediately following ``B``
and then returns ``A.__dict__['m'].__get__(obj, A)``.  If not a descriptor,
``m`` is returned unchanged.  If not in the dictionary, ``m`` reverts to a
search using :meth:`object.__getattribute__`.

Note, in Python 2.2, ``super(B, obj).m()`` would only invoke :meth:`__get__` if
``m`` was a data descriptor.  In Python 2.3, non-data descriptors also get
invoked unless an old-style class is involved.  The implementation details are
in :cfunc:`super_getattro()` in
`Objects/typeobject.c <http://svn.python.org/view/python/trunk/Objects/typeobject.c?view=markup>`_
and a pure Python equivalent can be found in `Guido's Tutorial`_.

.. _`Guido's Tutorial`: http://www.python.org/2.2.3/descrintro.html#cooperation

The details above show that the mechanism for descriptors is embedded in the
:meth:`__getattribute__()` methods for :class:`object`, :class:`type`, and
:func:`super`.  Classes inherit this machinery when they derive from
:class:`object` or if they have a meta-class providing similar functionality.
Likewise, classes can turn-off descriptor invocation by overriding
:meth:`__getattribute__()`.


Descriptor Example
------------------

The following code creates a class whose objects are data descriptors which
print a message for each get or set.  Overriding :meth:`__getattribute__` is
alternate approach that could do this for every attribute.  However, this
descriptor is useful for monitoring just a few chosen attributes::

    class RevealAccess(object):
        """A data descriptor that sets and returns values
           normally and prints a message logging their access.
        """

        def __init__(self, initval=None, name='var'):
            self.val = initval
            self.name = name

        def __get__(self, obj, objtype):
            print 'Retrieving', self.name
            return self.val

        def __set__(self, obj, val):
            print 'Updating' , self.name
            self.val = val

    >>> class MyClass(object):
        x = RevealAccess(10, 'var "x"')
        y = 5

    >>> m = MyClass()
    >>> m.x
    Retrieving var "x"
    10
    >>> m.x = 20
    Updating var "x"
    >>> m.x
    Retrieving var "x"
    20
    >>> m.y
    5

The protocol is simple and offers exciting possibilities.  Several use cases are
so common that they have been packaged into individual function calls.
Properties, bound and unbound methods, static methods, and class methods are all
based on the descriptor protocol.


Properties
----------

Calling :func:`property` is a succinct way of building a data descriptor that
triggers function calls upon access to an attribute.  Its signature is::

    property(fget=None, fset=None, fdel=None, doc=None) -> property attribute

The documentation shows a typical use to define a managed attribute ``x``::

    class C(object):
        def getx(self): return self.__x
        def setx(self, value): self.__x = value
        def delx(self): del self.__x
        x = property(getx, setx, delx, "I'm the 'x' property.")

To see how :func:`property` is implemented in terms of the descriptor protocol,
here is a pure Python equivalent::

    class Property(object):
        "Emulate PyProperty_Type() in Objects/descrobject.c"

        def __init__(self, fget=None, fset=None, fdel=None, doc=None):
            self.fget = fget
            self.fset = fset
            self.fdel = fdel
            self.__doc__ = doc

        def __get__(self, obj, objtype=None):
            if obj is None:
                return self
            if self.fget is None:
                raise AttributeError, "unreadable attribute"
            return self.fget(obj)

        def __set__(self, obj, value):
            if self.fset is None:
                raise AttributeError, "can't set attribute"
            self.fset(obj, value)

        def __delete__(self, obj):
            if self.fdel is None:
                raise AttributeError, "can't delete attribute"
            self.fdel(obj)

The :func:`property` builtin helps whenever a user interface has granted
attribute access and then subsequent changes require the intervention of a
method.

For instance, a spreadsheet class may grant access to a cell value through
``Cell('b10').value``. Subsequent improvements to the program require the cell
to be recalculated on every access; however, the programmer does not want to
affect existing client code accessing the attribute directly.  The solution is
to wrap access to the value attribute in a property data descriptor::

    class Cell(object):
        . . .
        def getvalue(self, obj):
            "Recalculate cell before returning value"
            self.recalc()
            return obj._value
        value = property(getvalue)


Functions and Methods
---------------------

Python's object oriented features are built upon a function based environment.
Using non-data descriptors, the two are merged seamlessly.

Class dictionaries store methods as functions.  In a class definition, methods
are written using :keyword:`def` and :keyword:`lambda`, the usual tools for
creating functions.  The only difference from regular functions is that the
first argument is reserved for the object instance.  By Python convention, the
instance reference is called *self* but may be called *this* or any other
variable name.

To support method calls, functions include the :meth:`__get__` method for
binding methods during attribute access.  This means that all functions are
non-data descriptors which return bound or unbound methods depending whether
they are invoked from an object or a class.  In pure python, it works like
this::

    class Function(object):
        . . .
        def __get__(self, obj, objtype=None):
            "Simulate func_descr_get() in Objects/funcobject.c"
            return types.MethodType(self, obj, objtype)

Running the interpreter shows how the function descriptor works in practice::

    >>> class D(object):
         def f(self, x):
              return x

    >>> d = D()
    >>> D.__dict__['f'] # Stored internally as a function
    <function f at 0x00C45070>
    >>> D.f             # Get from a class becomes an unbound method
    <unbound method D.f>
    >>> d.f             # Get from an instance becomes a bound method
    <bound method D.f of <__main__.D object at 0x00B18C90>>

The output suggests that bound and unbound methods are two different types.
While they could have been implemented that way, the actual C implemention of
:ctype:`PyMethod_Type` in
`Objects/classobject.c <http://svn.python.org/view/python/trunk/Objects/classobject.c?view=markup>`_
is a single object with two different representations depending on whether the
:attr:`im_self` field is set or is *NULL* (the C equivalent of *None*).

Likewise, the effects of calling a method object depend on the :attr:`im_self`
field. If set (meaning bound), the original function (stored in the
:attr:`im_func` field) is called as expected with the first argument set to the
instance.  If unbound, all of the arguments are passed unchanged to the original
function. The actual C implementation of :func:`instancemethod_call()` is only
slightly more complex in that it includes some type checking.


Static Methods and Class Methods
--------------------------------

Non-data descriptors provide a simple mechanism for variations on the usual
patterns of binding functions into methods.

To recap, functions have a :meth:`__get__` method so that they can be converted
to a method when accessed as attributes.  The non-data descriptor transforms a
``obj.f(*args)`` call into ``f(obj, *args)``.  Calling ``klass.f(*args)``
becomes ``f(*args)``.

This chart summarizes the binding and its two most useful variants:

      +-----------------+----------------------+------------------+
      | Transformation  | Called from an       | Called from a    |
      |                 | Object               | Class            |
      +=================+======================+==================+
      | function        | f(obj, \*args)       | f(\*args)        |
      +-----------------+----------------------+------------------+
      | staticmethod    | f(\*args)            | f(\*args)        |
      +-----------------+----------------------+------------------+
      | classmethod     | f(type(obj), \*args) | f(klass, \*args) |
      +-----------------+----------------------+------------------+

Static methods return the underlying function without changes.  Calling either
``c.f`` or ``C.f`` is the equivalent of a direct lookup into
``object.__getattribute__(c, "f")`` or ``object.__getattribute__(C, "f")``. As a
result, the function becomes identically accessible from either an object or a
class.

Good candidates for static methods are methods that do not reference the
``self`` variable.

For instance, a statistics package may include a container class for
experimental data.  The class provides normal methods for computing the average,
mean, median, and other descriptive statistics that depend on the data. However,
there may be useful functions which are conceptually related but do not depend
on the data.  For instance, ``erf(x)`` is handy conversion routine that comes up
in statistical work but does not directly depend on a particular dataset.
It can be called either from an object or the class:  ``s.erf(1.5) --> .9332`` or
``Sample.erf(1.5) --> .9332``.

Since staticmethods return the underlying function with no changes, the example
calls are unexciting::

    >>> class E(object):
         def f(x):
              print x
         f = staticmethod(f)

    >>> print E.f(3)
    3
    >>> print E().f(3)
    3

Using the non-data descriptor protocol, a pure Python version of
:func:`staticmethod` would look like this::

    class StaticMethod(object):
     "Emulate PyStaticMethod_Type() in Objects/funcobject.c"

     def __init__(self, f):
          self.f = f

     def __get__(self, obj, objtype=None):
          return self.f

Unlike static methods, class methods prepend the class reference to the
argument list before calling the function.  This format is the same
for whether the caller is an object or a class::

    >>> class E(object):
         def f(klass, x):
              return klass.__name__, x
         f = classmethod(f)

    >>> print E.f(3)
    ('E', 3)
    >>> print E().f(3)
    ('E', 3)


This behavior is useful whenever the function only needs to have a class
reference and does not care about any underlying data.  One use for classmethods
is to create alternate class constructors.  In Python 2.3, the classmethod
:func:`dict.fromkeys` creates a new dictionary from a list of keys.  The pure
Python equivalent is::

    class Dict:
        . . .
        def fromkeys(klass, iterable, value=None):
            "Emulate dict_fromkeys() in Objects/dictobject.c"
            d = klass()
            for key in iterable:
                d[key] = value
            return d
        fromkeys = classmethod(fromkeys)

Now a new dictionary of unique keys can be constructed like this::

    >>> Dict.fromkeys('abracadabra')
    {'a': None, 'r': None, 'b': None, 'c': None, 'd': None}

Using the non-data descriptor protocol, a pure Python version of
:func:`classmethod` would look like this::

    class ClassMethod(object):
         "Emulate PyClassMethod_Type() in Objects/funcobject.c"

         def __init__(self, f):
              self.f = f

         def __get__(self, obj, klass=None):
              if klass is None:
                   klass = type(obj)
              def newfunc(*args):
                   return self.f(klass, *args)
              return newfunc


Python Documentation README
~~~~~~~~~~~~~~~~~~~~~~~~~~~

This directory contains the reStructuredText (reST) sources to the Python
documentation.  You don't need to build them yourself, prebuilt versions are
available at http://docs.python.org/download/.

Documentation on the authoring Python documentation, including information about
both style and markup, is available in the "Documenting Python" chapter of the
documentation.  There's also a chapter intended to point out differences to
those familiar with the previous docs written in LaTeX.


Building the docs
=================

You need to have Python 2.4 or higher installed; the toolset used to build the
docs is written in Python.  It is called *Sphinx*, it is not included in this
tree, but maintained separately.  Also needed are the docutils, supplying the
base markup that Sphinx uses, Jinja, a templating engine, and optionally
Pygments, a code highlighter.


Using make
----------

Luckily, a Makefile has been prepared so that on Unix, provided you have
installed Python and Subversion, you can just run ::

   make html

to check out the necessary toolset in the `tools/` subdirectory and build the
HTML output files.  To view the generated HTML, point your favorite browser at
the top-level index `build/html/index.html` after running "make".

Available make targets are:

 * "html", which builds standalone HTML files for offline viewing.

 * "htmlhelp", which builds HTML files and a HTML Help project file usable to
   convert them into a single Compiled HTML (.chm) file -- these are popular
   under Microsoft Windows, but very handy on every platform.

   To create the CHM file, you need to run the Microsoft HTML Help Workshop over
   the generated project (.hhp) file.

 * "latex", which builds LaTeX source files as input to "pdflatex" to produce
   PDF documents.

 * "text", which builds a plain text file for each source file.

 * "linkcheck", which checks all external references to see whether they are
   broken, redirected or malformed, and outputs this information to stdout as
   well as a plain-text (.txt) file.

 * "changes", which builds an overview over all versionadded/versionchanged/
   deprecated items in the current version. This is meant as a help for the
   writer of the "What's New" document.

 * "coverage", which builds a coverage overview for standard library modules and
   C API.

 * "pydoc-topics", which builds a Python module containing a dictionary with
   plain text documentation for the labels defined in
   `tools/sphinxext/pyspecific.py` -- pydoc needs these to show topic and
   keyword help.

A "make update" updates the Subversion checkouts in `tools/`.


Without make
------------

You'll need to install the Sphinx package, either by checking it out via ::

   svn co http://svn.python.org/projects/external/Sphinx-0.6.5/sphinx tools/sphinx

or by installing it from PyPI.

Then, you need to install Docutils, either by checking it out via ::

   svn co http://svn.python.org/projects/external/docutils-0.6/docutils tools/docutils

or by installing it from http://docutils.sf.net/.

You also need Jinja2, either by checking it out via ::

   svn co http://svn.python.org/projects/external/Jinja-2.3.1/jinja2 tools/jinja2

or by installing it from PyPI.

You can optionally also install Pygments, either as a checkout via ::

   svn co http://svn.python.org/projects/external/Pygments-1.3.1/pygments tools/pygments

or from PyPI at http://pypi.python.org/pypi/Pygments.


Then, make an output directory, e.g. under `build/`, and run ::

   python tools/sphinx-build.py -b<builder> . build/<outputdirectory>

where `<builder>` is one of html, text, latex, or htmlhelp (for explanations see
the make targets above).


Contributing
============

Bugs in the content should be reported to the Python bug tracker at
http://bugs.python.org.

Bugs in the toolset should be reported in the Sphinx bug tracker at
http://www.bitbucket.org/birkenfeld/sphinx/issues/.

You can also send a mail to the Python Documentation Team at docs@python.org,
and we will process your request as soon as possible.

If you want to help the Documentation Team, you are always welcome.  Just send
a mail to docs@python.org.


Copyright notice
================

The Python source is copyrighted, but you can freely use and copy it
as long as you don't change or remove the copyright notice:

----------------------------------------------------------------------
Copyright (c) 2000-2008 Python Software Foundation.
All rights reserved.

Copyright (c) 2000 BeOpen.com.
All rights reserved.

Copyright (c) 1995-2000 Corporation for National Research Initiatives.
All rights reserved.

Copyright (c) 1991-1995 Stichting Mathematisch Centrum.
All rights reserved.

See the file "license.rst" for information on usage and redistribution
of this file, and for a DISCLAIMER OF ALL WARRANTIES.
----------------------------------------------------------------------

Directory structure:
    docutils       - the docutils package (downloaded from http://pypi.python.org/pypi/docutils/0.5 )
    jinja2         - the jinja2 package (downloaded from http://pypi.python.org/pypi/Jinja2)
    sphinx         - the Sphinx RST converter tool (http://pypi.python.org/pypi/Sphinx)
    PythonDocs     - CPython documentation rst (SVN pulled from http://svn.python.org/projects/python/branches/release26-maint/Doc)
    IronPythonDocs - IronPython documentation rst (same as Python docs + IronPython specific modifications)
    HtmlHelp.exe   - HTML Help Workshop installer
    

Generating documentation:
    Pre-reqs: You'll need to install Html Help Workshop before you can generate the CHM help.  This can be installed
    with the HtmlHelp.exe which is available in this directory.
    
    Then, from the root of the checkout, run `msbuild Solutions\Build.IronPython.proj /t:BuildChm`.

Updating Python Documentation:
    When updating the standard CPython documentation a new copy of the Doc folder should be pulled from CPython's
    respository (http://svn.python.org/projects/python/branches/release26-maint/Doc).  A 3-way merge should then
    be performed using PythonDocs as the base w/ IronPythonDocs and the newly pulled docs being merged.  The
    result of the merge should be saved in IronPythonDocs and the newly pulled documentation should replace the
    PythonDocs folder.
    


Files in this directory from from Bob Ippolito's py2app.

License: Any components of the py2app suite may be distributed under
the MIT or PSF open source licenses.

This is version 1.0, SVN revision 789, from 2006/01/25.
The main repository is http://svn.red-bean.com/bob/macholib/trunk/macholib/
This directory contains the Distutils package.

There's a full documentation available at:

    http://docs.python.org/distutils/

The Distutils-SIG web page is also a good starting point:

    http://www.python.org/sigs/distutils-sig/

WARNING : Distutils must remain compatible with 2.3

$Id$

IDLE is Python's Tkinter-based Integrated DeveLopment Environment.

IDLE emphasizes a lightweight, clean design with a simple user interface.
Although it is suitable for beginners, even advanced users will find that
IDLE has everything they really need to develop pure Python code.

IDLE features a multi-window text editor with multiple undo, Python colorizing,
and many other capabilities, e.g. smart indent, call tips, and autocompletion.

The editor has comprehensive search functions, including searching through
multiple files.  Class browsers and path browsers provide fast access to
code objects from a top level viewpoint without dealing with code folding.

There is a Python Shell window which features colorizing and command recall.

IDLE executes Python code in a separate process, which is restarted for each
Run (F5) initiated from an editor window.  The environment can also be 
restarted from the Shell window without restarting IDLE.

This enhancement has often been requested, and is now finally available.  The
magic "reload/import *" incantations are no longer required when editing and
testing a module two or three steps down the import chain.

(Personal firewall software may warn about the connection IDLE makes to its
subprocess using this computer's internal loopback interface.  This connection
is not visible on any external interface and no data is sent to or received
from the Internet.)

It is possible to interrupt tightly looping user code, even on Windows.

Applications which cannot support subprocesses and/or sockets can still run
IDLE in a single process.

IDLE has an integrated debugger with stepping, persistent breakpoints, and call
stack visibility.

There is a GUI configuration manager which makes it easy to select fonts,
colors, keybindings, and startup options.  This facility includes a feature
which allows the user to specify additional help sources, either locally or on
the web.

IDLE is coded in 100% pure Python, using the Tkinter GUI toolkit (Tk/Tcl)
and is cross-platform, working on Unix, Mac, and Windows.

IDLE accepts command line arguments.  Try idle -h to see the options.


If you find bugs or have suggestions, let us know about them by using the
Python Bug Tracker:

http://sourceforge.net/projects/python

Patches are always appreciated at the Python Patch Tracker, and change
requests should be posted to the RFE Tracker.

For further details and links, read the Help files and check the IDLE home
page at

http://www.python.org/idle/

There is a mail list for IDLE: idle-dev@python.org.  You can join at

http://mail.python.org/mailman/listinfo/idle-dev

Writing new tests
=================

Precaution
----------

    New tests should always use only one Tk window at once, like all the
    current tests do. This means that you have to destroy the current window
    before creating another one, and clean up after the test. The motivation
    behind this is that some tests may depend on having its window focused
    while it is running to work properly, and it may be hard to force focus
    on your window across platforms (right now only test_traversal at
    test_ttk.test_widgets.NotebookTest depends on this).


In this directory:
- py2_test_grammar.py -- test file that exercises most/all of Python 2.x's grammar.
- py3_test_grammar.py -- test file that exercises most/all of Python 3.x's grammar.
- infinite_recursion.py -- test file that causes lib2to3's faster recursive pattern matching
  scheme to fail, but passes when lib2to3 falls back to iterative pattern matching.
- fixes/ -- for use by test_refactor.py

Project
-------
adodbapi

A Python DB-API 2.0 module that makes it easy to use Microsoft ADO 
for connecting with databases and other data sources
using either CPython or IronPython.

Home page: <http://sourceforge.net/projects/adodbapi>

Features:
* 100% DB-API 2.0 compliant. 
* Includes pyunit testcases that describes how to use the module.  
* Fully implemented in Python. 
* Licensed under the LGPL license, which means that it can be used freely even in commercial programs subject to certain restrictions. 
* Supports eGenix mxDateTime, Python 2.3 datetime module and Python time module.

Prerequisites:
* C Python 2.3 or higher
 and pywin32 (Mark Hammond's python for windows extensions.)
 Note: as of 2.1.1, adodbapi is included in pywin32 versions 211 and later. 
or
 Iron Python 2.0 or higher. 

NOTE: ...........
If you do not like the new default operation of returning Numeric columns as decimal.Decimal,
you can select other options by the user defined convertion feature. 
Try:
        adodbapi.adodbapi.variantConversions[adodbapi.adNumeric] = adodbapi.adodbapi.cvtString
or:
        adodbapi.adodbapi.variantConversions[adodbapi.adNumeric] = adodbapi.adodbapi.cvtFloat
or:
	adodbapi.adodbapi.variantConversions[adodbapi.adNumeric] = write_your_own_convertion_function
............
Whats new in version 2.2.6
1. Actually works in Python 3.0 (using pywin32 212.6) after running thru 2to3
2. RESTRICTION: Python Time (as opposed to datetime.datetime, which is the default) may return
     incorrect results. To avoid this problem, do not use adodbapi.pythonTimeConverter. 
3. The python time converter test has been loosened so that it will pass in any time zone.
4. Several improvements in the test routines, including alteration of dbapi20 for Python 3.0 compatibility.
   (Some requirements of PEP249 are incompatible with Python 3.0)

Whats new in version 2.2.5
1. Exception definition cleanups for for Python 3.0 readiness [Mark Hammond]
2. Remove depreciated pythoncom.MakeTime calls (now uses pywintypes.Time)
3. Change tests to default to local SQL server. 
4. Add an access-type database file for demo use.

Whats new in version 2.2.4
1. Ready for Python3? -- refactored so that 2to3 will inject very few errors, seems to be almost runnable in Pyk3.
2. Use new function getIndexedValue() to hide differences between IronPython and pywin32.

What happened to version 2.2.3?
   It was an attempt to be Python3 ready, but done wrong, so killed off.

whats new in version 2.2.2
1. Works with Iron Python 2.0RC1 (passes all tests except BINARY columns and old python time date conversion.)
2. Passes all dbapi20 tests (All errors and warnings are now defined for the connection object.)
3. Adds predefined conversion functions cvtBuffer and cvtUnicode if you want to use them.

Whats new in version 2.2.1
1. Bugfix for v2.1 item 6: but do not correct the string length if the output column is not a string.

Whats new in version 2.2
1. Runs on Iron Python 2.0b4 with a few restrictions. It will not handle Longs or BLOB correcly, 
   and has some date/time problems (using the "time" module as opposed to "datetime").
   Bug reports have been submitted to Iron Python, which, if fixed, will remove all restrictions.
2. More agressive at making sure to retrieve Numeric and Currency colums as decimal.Decimal.
3. Has a new conversion module. To make Numerics retrieve as strings, execute:
       adodbapi.variantConversions[adodbapi.adNumeric] = adodbapi.cvtString
4. Switch to new-style classes and eliminate string exceptions.
5. Lots of cleanup in the code and the unit test.
6. More agressive at determining .rowcount after an operation.

Whats new in version 2.1.1?
1. Bugfix so nextset() will work even if a rowset is empty [ Bob Kline ]
2. Bugfix to call CoInitailize() before calling Dispatch() [ Adam Vandenberg ]

Whats new in version 2.1?
1. Use of Decimal.decimal data type for currency and numeric data. [ Cole ]
2. add optional timeout parameter to the connect method i.e.: 
      adodbapi.connect(string,timeout=nuberOfSeconds)  [thanks to: Patrik Simons]
3. improved detection of underlying transaction support [ Thomas Albrecht ]
4. fixed record set closing bug and adoRowIDtype [ Erik Rose ]
5. client-side cursoring [ Erik Rose ]
6. correct string length for qmark parameter substitution [ Jevon a.k.a. Guybrush Threepwood ]
7. try-multiple-strategy loop replaced by other logic. [ Cole ]
8. correct error code raised when next recordset not available. [ ekelund ]
9. numerous changes in unit test (including test against mySQL)

Whats new in version 2.0.1?
Added missing __init__.py file so it installs correctly.

Whats new in version 2.0?
1. Improved performance through GetRows method.
2. Flexible date conversions. 
   Supports eGenix mxExtensions, python time module and python 2.3 datetime module.
3. More exact mappings of numeric datatypes. 
4. User defined conversions of datatypes through "plug-ins".
5. Improved testcases, not dependent on Northwind data.
6. Works with Microsoft Access currency datatype.
7. Improved DB-API 2.0 compliance.
8. rowcount property works on statements Not returning records.
9. "Optional" error handling extension, see DB-API 2.0 specification.

Installation
------------
This version will be installed as part of the win32 package.

Authors (up to version 2.0.1)
-------
Henrik Ekelund, 
Jim Abrams.
Bjorn Pettersen.

Author (version 2.1 and later)
-------
Vernon Cole

License
-------
LGPL, see http://www.opensource.org/licenses/lgpl-license.php

Documentation
-------------
Start with:
http://www.python.org/topics/database/DatabaseAPI-2.0.html
read adodbapi/test/db_print.py
and look at the test cases in adodbapi/test directory. 

Mailing lists
-------------
The adodbapi mailing lists have been deactivated. Submit comments to the 
pywin32 lists.


Relase history
--------------
2.2.4   Ready for 2to3 convertion. Refactor to be more readable. Added function getIndexedValue() for IPy 2.0.
2.2.3   (withdrawn)
2.2.2   Iron Python support complete. 
2.2.1   Bugfix for string truncation
2.2     Code cleanup. added feature: "adodbapi.variantConversions[adodbapi.adNumeric] = adodbapi.cvtString"
2.1.1	Bugfix to CoIninialize() and nextset()
2.1	Python 2.4 version
2.0     See what's new above.
1.0.1   Bug fix: Null values for numeric fields. Thanks to Tim Golden. 
1.0     the first release

A Python ISAPI extension.  Contributed by Phillip Frantz, and is
Copyright 2002-2003 by Blackdog Software Pty Ltd.

See the 'samples' directory, and particularly samples\README.txt

You can find documentation in the PyWin32.chm file that comes with pywin32 - 
you can open this from Pythonwin->Help, or from the start menu.
In this directory you will find examples of ISAPI filters and extensions.

The filter loading mechanism works like this:
* IIS loads the special Python "loader" DLL.  This DLL will generally have a 
  leading underscore as part of its name.
* This loader DLL looks for a Python module, by removing the first letter of
  the DLL base name.
  
This means that an ISAPI extension module consists of 2 key files - the loader
DLL (eg, "_MyIISModule.dll", and a Python module (which for this example
would be "MyIISModule.py")

When you install an ISAPI extension, the installation code checks to see if
there is a loader DLL for your implementation file - if one does not exist, 
or the standard loader is different, it is copied and renamed accordingly.

We use this mechanism to provide the maximum separation between different
Python extensions installed on the same server - otherwise filter order and
other tricky IIS semantics would need to be replicated.  Also, each filter
gets its own thread-pool, etc.

This is a directory for tests of the PyISAPI framework.

For demos, please see the pyisapi 'samples' directory.
This directory exists so that 3rd party packages can be installed
here.  Read the source for site.py for more details.

This directory exists so that 3rd party packages can be installed
here.  Read the source for site.py for more details.

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>win32com Readme</title>
</head>
<body>
 
<p><img width="551" height="99" id="_x0000_i1025"
 src="html%5Cimage%5Cpycom_blowing.gif"
 alt="Python and COM - Blowing the others away"> </p>
    
<h1>Python COM Extensions Readme </h1>
    
<p>This is the readme for win32com. Please check out the <a
 href="html/docindex.html">win32com documentation index</a></p>
    
<p>The <a href="test/.">win32com/test directory</a> contains some interesting
 scripts (and a new <a href="test/readme.txt">readme.txt</a>). Although these
 are used for testing, they do show a variety of COM techniques.</p>

<a name="currency"><h3>Important Currency changes</h3></a>
<p>
In all builds prior to 204, a COM currency value was returned as a tuple of
integers.  Working with 2 integers to represent a currency object was a poor
choice, but the alternative was never clear.  Now Python ships with the
<a href="http://www.python.org/dev/doc/devel/lib/module-decimal.html">decimal</a>
module, the alternative has arrived!
</p>
<p>
Up until build 212, code could set <code>pythoncom.__future_currency__ = True</code>
to force use of the decimal module, with a warning issued otherwise.  In 
builds 213 and later, the decimal module is unconditionally used when
pythoncon returns you a currency value.
</p>
<p>
Python 2.3 does not ship with a decimal module.  For this reason,
win32com/decimal_23.py is supplied with pywin32.  This is a clone of the decimal
module, but will only be used when <code>import decimal</code> fails.  If you
want to use this functionality in your Python 2.3 programs, you should write
something similar to:
<pre>
    try:
        import decimal
    except ImportError:
        import win32com.decimal_23 as decimal
    val = decimal.Decimal("123.45")
</pre>
</p>

<h3>Recent Changes</h3>

<h4>Lots of internal changes on the road to py3k</h4>

<h4>win32com.axcontrol and win2con.internet</h4>
Many more interfaces for hosting AX controls and the interfaces
used by Internet Explorer.

<h4>win32com.shell</h4>
The shell interfaces have undergone a number of enhancements and changes.
A couple of methods have changed signature between the first build with shell support (200) and later builds.  
SHGetFileInfo was broken in its result handling, so had to be changed - this 
is the only function used by the samples that changed, but others not used by the samples also have changed.
These shell interfaces are now generally stable.
<h4>New win32com.taskscheduler module</h4>
Roger Upole has contributed an interface to the Windows task scheduler.  This is actually very neat, and it allows
Python to edit the task list as shown by Windows Control Panel.  Property page suppport may even appear later,
now that the win32 library has the new win32rcparser module.
<h4>ActiveX Scripting </h4>
    
<p>Python only supports "trusted" execution hosts - thus, it will no longer work
as an engine inside IE (Python itself no longer has a restricted execution environment).  
Python continues to work fine as an Active Scripting Engine in all other
applications, including Windows Scripting Host, and ASP.

<p>There is also support for Python as an ActiveX Scripting Host.</p>
    
<p>Active Debugging seems to be fully functional.</p>

<h4>Older stuff</h4>
<ul>
</li>
  <li>Unexpected exceptions in Python COM objects will generally now dump
the exception and traceback to stdout. &nbsp;This is useful for debugging
and testing - it means that in some cases there will be no need to register
an object with <span style="font-style: italic;">--debug</span> to see these
tracebacks. &nbsp;Note that COM objects used by server processes (such as
ASP) generally have no valid stdout, so will still need to use <span
 style="font-style: italic;">--debug</span> as usual.<br>
  </li>
   <li>universal gateway support has been improved - we can now work as an
Outlook Addin<br>
  </li>
  
</body>
</html>

COM Test Suite Readme
---------------------

Running the test suite:
-----------------------
* Open a command prompt
* Change to the "win32com\test" directory.
* run "testall.py".  This will perform level 1 testing.
  You may specify 1, 2, or 3 on the command line ("testutil 3")
  to execute more tests.

In general, this should just run the best it can, utilizing what is available
on the machine.  It is likely some tests will refuse to run due to objects not
being locally available - this is normal.

The win32com source tree has source code to a C++ and VB component used purely
for testing.  You may like to build and register these, particularly if you 
are doing anything related to argument/result handling.

This directory only contains tests for outstanding bugs that cause the
interpreter to segfault.  Ideally this directory should always be empty, but
sometimes it may not be easy to fix the underlying cause and the bug is deemed
too obscure to invest the effort.

Each test should fail when run from the command line:

	./python Lib/test/crashers/weakref_in_del.py

Put as much info into a docstring or comments to help determine the cause of the
failure, as well as a bugs.python.org issue number if it exists.  Particularly
note if the cause is system or environment dependent and what the variables are.

Once the crash is fixed, the test case should be moved into an appropriate test
(even if it was originally from the test suite).  This ensures the regression
doesn't happen again.  And if it does, it should be easier to track down.

This empty directory serves as destination for temporary files
created by some tests.

This directory contains test cases that are known to leak references.
The idea is that you can import these modules while in the interpreter
and call the leak function repeatedly.  This will only be helpful if
the interpreter was built in debug mode.  If the total ref count
doesn't increase, the bug has been fixed and the file should be removed
from the repository.

Note:  be careful to check for cyclic garbage.  Sometimes it may be helpful
to define the leak function like:

def leak():
    def inner_leak():
        # this is the function that leaks, but also creates cycles
    inner_leak()
    gc.collect() ; gc.collect() ; gc.collect()

Here's an example interpreter session for test_gestalt which still leaks:

>>> from test.leakers.test_gestalt import leak
[24275 refs]
>>> leak()
[28936 refs]
>>> leak()
[28938 refs]
>>> leak()
[28940 refs]
>>> 

Once the leak is fixed, the test case should be moved into an appropriate
test (even if it was originally from the test suite).  This ensures the
regression doesn't happen again.  And if it does, it should be easier
to track down.

= README

revision::	$Rev: 1 $
release::	$Release: 1.0.0 $
copyright::	copyright(c) 2006 kuwata-lab.com all rights reserved.


== Introduction

'abstract.rb' is a library which enable you to define abstract method in Ruby.

The followings are examples:

  ## example1. (shorter notation)
  require 'rubygems'   # if installed with 'gem install'
  require 'abstract'
  class Foo
    abstract_method 'arg1, arg2=""', :method1, :method2, :method3
  end
  
  ## example2. (RDoc friendly notation)
  require 'rubygems'   # if installed with 'gem install'
  require 'abstract'
  class Bar
    # ... method1 description ...
    def method1(arg1, arg2="")
      not_implemented
    end
    # ... method2 description ...
    def method2(arg1, arg2="")
      not_implemented
    end
  end


Abstract method makes your code more descriptive.
It is useful even for dynamic language such as Ruby.


== Installation


* Type 'gem install -r abstract' with root account if you have installed RubyGems.

* Or type 'ruby setup.rb' with root account if you can be root account.

* Or copy lib/abstract.rb into proper directory such as '/usr/local/lib/ruby/site_ruby'.


== License

Ruby's


== Copyright

copyright(c) 2006 kuwata-lab.com all rights reserved.

= Action Mailer -- Easy email delivery and testing

Action Mailer is a framework for designing email-service layers. These layers
are used to consolidate code for sending out forgotten passwords, welcome
wishes on signup, invoices for billing, and any other use case that requires
a written notification to either a person or another system.

Action Mailer is in essence a wrapper around Action Controller and the
Mail gem.  It provides a way to make emails using templates in the same
way that Action Controller renders views using templates.

Additionally, an Action Mailer class can be used to process incoming email,
such as allowing a weblog to accept new posts from an email (which could even
have been sent from a phone).

== Sending emails

The framework works by initializing any instance variables you want to be
available in the email template, followed by a call to +mail+ to deliver
the email.

This can be as simple as:

  class Notifier < ActionMailer::Base
    delivers_from 'system@loudthinking.com'

    def welcome(recipient)
      @recipient = recipient
      mail(:to => recipient,
           :subject => "[Signed up] Welcome #{recipient}")
    end
  end

The body of the email is created by using an Action View template (regular
ERb) that has the instance variables that are declared in the mailer action.

So the corresponding body template for the method above could look like this:

  Hello there,

  Mr. <%= @recipient %>

  Thank you for signing up!

And if the recipient was given as "david@loudthinking.com", the email
generated would look like this:

  Date: Mon, 25 Jan 2010 22:48:09 +1100
  From: system@loudthinking.com
  To: david@loudthinking.com
  Message-ID: <4b5d84f9dd6a5_7380800b81ac29578@void.loudthinking.com.mail>
  Subject: [Signed up] Welcome david@loudthinking.com
  Mime-Version: 1.0
  Content-Type: text/plain;
  	charset="US-ASCII";
  Content-Transfer-Encoding: 7bit

  Hello there,

  Mr. david@loudthinking.com

In previous version of rails you would call <tt>create_method_name</tt> and
<tt>deliver_method_name</tt>.  Rails 3.0 has a much simpler interface, you
simply call the method and optionally call +deliver+ on the return value.

Calling the method returns a Mail Message object:

  message = Notifier.welcome  # => Returns a Mail::Message object
  message.deliver             # => delivers the email

Or you can just chain the methods together like:

  Notifier.welcome.deliver    # Creates the email and sends it immediately

== Receiving emails

To receive emails, you need to implement a public instance method called <tt>receive</tt> that takes a
tmail object as its single parameter. The Action Mailer framework has a corresponding class method,
which is also called <tt>receive</tt>, that accepts a raw, unprocessed email as a string, which it then turns
into the tmail object and calls the receive instance method.

Example:

  class Mailman < ActionMailer::Base
    def receive(email)
      page = Page.find_by_address(email.to.first)
      page.emails.create(
        :subject => email.subject, :body => email.body
      )

      if email.has_attachments?
        for attachment in email.attachments
          page.attachments.create({
            :file => attachment, :description => email.subject
          })
        end
      end
    end
  end

This Mailman can be the target for Postfix or other MTAs. In Rails, you would use the runner in the
trivial case like this:

  rails runner 'Mailman.receive(STDIN.read)'

However, invoking Rails in the runner for each mail to be received is very resource intensive.  A single
instance of Rails should be run within a daemon if it is going to be utilized to process more than just
a limited number of email.

== Configuration

The Base class has the full list of configuration options. Here's an example:

  ActionMailer::Base.smtp_settings = {
    :address        => 'smtp.yourserver.com', # default: localhost
    :port           => '25',                  # default: 25
    :user_name      => 'user',
    :password       => 'pass',
    :authentication => :plain                 # :plain, :login or :cram_md5
  }


== Download and installation

The latest version of Action Mailer can be installed with Rubygems:

  % [sudo] gem install actionmailer

Source code can be downloaded as part of the Rails project on GitHub

* http://github.com/rails/rails/tree/master/actionmailer/


== License

Action Mailer is released under the MIT license.


== Support

API documentation is at

* http://api.rubyonrails.com

Bug reports and feature requests can be filed with the rest for the Ruby on Rails project here:

* https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets

= Action Pack -- From request to response

Action Pack is a framework for handling and responding to web requests. It
provides mechanisms for *routing* (mapping request URLs to actions), defining
*controllers* that implement actions, and generating responses by rendering
*views*, which are templates of various formats. In short, Action Pack
provides the view and controller layers in the MVC paradigm.

It consists of several modules:

* Action Dispatch, which parses information about the web request, handles
  routing as defined by the user, and does advanced processing related to HTTP
  such as MIME-type negotiation, decoding parameters in POST/PUT bodies,
  handling HTTP caching logic, cookies and sessions.

* Action Controller, which provides a base controller class that can be
  subclassed to implement filters and actions to handle requests. The result
  of an action is typically content generated from views.

* Action View, which handles view template lookup and rendering, and provides
  view helpers that assist when building HTML forms, Atom feeds and more.
  Template formats that Action View handles are ERb (embedded Ruby, typically
  used to inline short Ruby snippets inside HTML), XML Builder and RJS
  (dynamically generated JavaScript from Ruby code).

With the Ruby on Rails framework, users only directly interface with the
Action Controller module. Necessary Action Dispatch functionality is activated
by default and Action View rendering is implicitly triggered by Action
Controller. However, these modules are designed to function on their own and
can be used outside of Rails.

A short rundown of some of the major features:

* Actions grouped in controller as methods instead of separate command objects
  and can therefore share helper methods

    CustomersController < ActionController::Base
      def show
        @customer = find_customer
      end

      def update
        @customer = find_customer
        if @customer.update_attributes(params[:customer])
          redirect_to :action => "show"
        else
          render :action => "edit"
        end
      end

      private
        def find_customer
          Customer.find params[:id]
        end
    end

  {Learn more}[link:classes/ActionController/Base.html]


* ERb templates (static content mixed with dynamic output from ruby)

    <% for post in @posts %>
      Title: <%= post.title %>
    <% end %>

    All post titles: <%= @posts.collect{ |p| p.title }.join(", ") %>

    <% unless @person.is_client? %>
      Not for clients to see...
    <% end %>

  {Learn more}[link:classes/ActionView.html]


* "Builder" templates (great for XML content, like RSS)

    xml.rss("version" => "2.0") do
      xml.channel do
        xml.title(@feed_title)
        xml.link(@url)
        xml.description "Basecamp: Recent items"
        xml.language "en-us"
        xml.ttl "40"

        for item in @recent_items
          xml.item do
            xml.title(item_title(item))
            xml.description(item_description(item))
            xml.pubDate(item_pubDate(item))
            xml.guid(@recent_items.url(item))
            xml.link(@recent_items.url(item))
          end
        end
      end
    end

  {Learn more}[link:classes/ActionView/Base.html]


* Filters for pre- and post-processing of the response

    class WeblogController < ActionController::Base
      # filters as methods
      before_filter :authenticate, :cache, :audit

      # filter as a proc
      after_filter { |c| c.response.body = Gzip::compress(c.response.body) }

      # class filter
      after_filter LocalizeFilter

      def index
        # Before this action is run, the user will be authenticated, the cache
        # will be examined to see if a valid copy of the results already
        # exists, and the action will be logged for auditing.

        # After this action has run, the output will first be localized then
        # compressed to minimize bandwidth usage
      end

      private
        def authenticate
          # Implement the filter with full access to both request and response
        end
    end

  {Learn more}[link:classes/ActionController/Filters/ClassMethods.html]


* Helpers for forms, dates, action links, and text

    <%= text_field_tag "post", "title", "size" => 30 %>
    <%= link_to "New post", :controller => "post", :action => "new" %>
    <%= truncate(post.title, :length => 25) %>

  {Learn more}[link:classes/ActionView/Helpers.html]


* Layout sharing for template reuse

    class WeblogController < ActionController::Base
      layout "weblog_layout"

      def hello_world
      end
    end

    Layout file (called weblog_layout):
      <html><body><%= yield %></body></html>

    Template for hello_world action:
      <h1>Hello world</h1>

    Result of running hello_world action:
      <html><body><h1>Hello world</h1></body></html>

  {Learn more}[link:classes/ActionController/Layout/ClassMethods.html]


* Routing makes pretty URLs incredibly easy

    match 'clients/:client_name/:project_name/:controller/:action'

    Accessing "/clients/37signals/basecamp/project/index" calls ProjectController#index with
    { "client_name" => "37signals", "project_name" => "basecamp" } in `params`

    From that action, you can write the redirect in a number of ways:

    redirect_to(:action => "edit") =>
      /clients/37signals/basecamp/project/edit

    redirect_to(:client_name => "nextangle", :project_name => "rails") =>
      /clients/nextangle/rails/project/index

  {Learn more}[link:classes/ActionDispatch/Routing.html]


* Easy testing of both controller and rendered template through ActionController::TestCase

    class LoginControllerTest < ActionController::TestCase
      def test_failing_authenticate
        process :authenticate, :user_name => "nop", :password => ""
        assert flash.has_key?(:alert)
        assert_redirected_to :action => "index"
      end
    end

  {Learn more}[link:classes/ActionController/TestCase.html]


* Automated benchmarking and integrated logging

    Started GET "/weblog" for 127.0.0.1 at Fri May 28 00:41:55
      Processing by WeblogController#index as HTML
    Rendered weblog/index.html.erb within layouts/application (25.7ms)
    Completed 200 OK in 29.3ms

    If Active Record is used as the model, you'll have the database debugging
    as well:

    Started POST "/posts" for 127.0.0.1 at Sat Jun 19 14:04:23
      Processing by PostsController#create as HTML
      Parameters: {"post"=>{"title"=>"this is good"}}
    SQL (0.6ms) INSERT INTO posts (title) VALUES('this is good')
    Redirected to http://example.com/posts/5
    Completed 302 Found in 221ms (Views: 215ms | ActiveRecord: 0.6ms)

    You specify a logger through a class method, such as:

    ActionController::Base.logger = Logger.new("Application Log")
    ActionController::Base.logger = Log4r::Logger.new("Application Log")


* Caching at three levels of granularity (page, action, fragment)

    class WeblogController < ActionController::Base
      caches_page :show
      caches_action :account

      def show
        # the output of the method will be cached as
        # ActionController::Base.page_cache_directory + "/weblog/show/n.html"
        # and the web server will pick it up without even hitting Rails
      end

      def account
        # the output of the method will be cached in the fragment store
        # but Rails is hit to retrieve it, so filters are run
      end

      def update
        List.update(params[:list][:id], params[:list])
        expire_page   :action => "show", :id => params[:list][:id]
        expire_action :action => "account"
        redirect_to   :action => "show", :id => params[:list][:id]
      end
    end

  {Learn more}[link:classes/ActionController/Caching.html]


* Powerful debugging mechanism for local requests

    All exceptions raised on actions performed on the request of a local user
    will be presented with a tailored debugging screen that includes exception
    message, stack trace, request parameters, session contents, and the
    half-finished response.

  {Learn more}[link:classes/ActionController/Rescue.html]


== Simple example (from outside of Rails)

This example will implement a simple weblog system using inline templates and
an Active Record model. So let's build that WeblogController with just a few
methods:

  require 'action_controller'
  require 'post'

  class WeblogController < ActionController::Base
    layout "weblog/layout"

    def index
      @posts = Post.find(:all)
    end

    def show
      @post = Post.find(params[:id])
    end

    def new
      @post = Post.new
    end

    def create
      @post = Post.create(params[:post])
      redirect_to :action => "show", :id => @post.id
    end
  end

  WeblogController::Base.view_paths = [ File.dirname(__FILE__) ]
  WeblogController.process_cgi if $0 == __FILE__

The last two lines are responsible for telling ActionController where the
template files are located and actually running the controller on a new
request from the web-server (like to be Apache).

And the templates look like this:

  weblog/layout.html.erb:
    <html><body>
    <%= yield %>
    </body></html>

  weblog/index.html.erb:
    <% for post in @posts %>
      <p><%= link_to(post.title, :action => "show", :id => post.id) %></p>
    <% end %>

  weblog/show.html.erb:
    <p>
      <b><%= @post.title %></b><br/>
      <b><%= @post.content %></b>
    </p>

  weblog/new.html.erb:
    <%= form "post" %>

This simple setup will list all the posts in the system on the index page,
which is called by accessing /weblog/. It uses the form builder for the Active
Record model to make the new screen, which in turn hands everything over to
the create action (that's the default target for the form builder when given a
new model). After creating the post, it'll redirect to the show page using
an URL such as /weblog/5 (where 5 is the id of the post).


== Download and installation

The latest version of Action Pack can be installed with Rubygems:

  % [sudo] gem install actionpack

Source code can be downloaded as part of the Rails project on GitHub

* http://github.com/rails/rails/tree/master/actionpack/


== License

Action Pack is released under the MIT license.


== Support

API documentation is at

* http://api.rubyonrails.com

Bug reports and feature requests can be filed with the rest for the Ruby on Rails project here:

* https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets

= Active Model -- model interfaces for Rails

Active Model provides a known set of interfaces for usage in model classes.
They allow for Action Pack helpers to interact with non-ActiveRecord models,
for example. Active Model also helps building custom ORMs for use outside of
the Rails framework.

Prior to Rails 3.0, if a plugin or gem developer wanted to have an object
interact with Action Pack helpers, it was required to either copy chunks of
code from Rails, or monkey patch entire helpers to make them handle objects
that did not exacly conform to the Active Record interface. This would result
in code duplication and fragile applications that broke on upgrades.

Active Model solves this. You can include functionality from the following
modules:

* Add attribute magic to objects

    class Person
      include ActiveModel::AttributeMethods

      attribute_method_prefix 'clear_'
      define_attribute_methods [:name, :age]

      attr_accessor :name, :age

      def clear_attribute(attr)
        send("#{attr}=", nil)
      end
    end

    person.clear_name
    person.clear_age

  {Learn more}[link:classes/ActiveModel/AttributeMethods.html]

* Callbacks for certain operations

    class Person
      extend ActiveModel::Callbacks
      define_model_callbacks :create

      def create
        _run_create_callbacks do
          # Your create action methods here
        end
      end
    end

  This generates +before_create+, +around_create+ and +after_create+
  class methods that wrap your create method.

  {Learn more}[link:classes/ActiveModel/CallBacks.html]

* Tracking value changes

  The ActiveModel::Dirty module allows for tracking attribute changes:

    person = Person.new
    person.name # => nil
    person.changed? # => false
    person.name = 'bob'
    person.changed? # => true
    person.changed # => ['name']
    person.changes # => { 'name' => [nil, 'bob'] }
    person.name = 'robert'
    person.save
    person.previous_changes # => {'name' => ['bob, 'robert']}

  {Learn more}[link:classes/ActiveModel/Dirty.html]

* Adding +errors+ interface to objects

  Exposing error messages allows objects to interact with Action Pack
  helpers seamlessly.

    class Person

      def initialize
        @errors = ActiveModel::Errors.new(self)
      end

      attr_accessor :name
      attr_reader   :errors

      def validate!
        errors.add(:name, "can not be nil") if name == nil
      end

      def ErrorsPerson.human_attribute_name(attr, options = {})
        "Name"
      end

    end

    person.errors.full_messages
    # => ["Name Can not be nil"]

    person.errors.full_messages
    # => ["Name Can not be nil"]

  {Learn more}[link:classes/ActiveModel/Errors.html]

* Model name introspection

    class NamedPerson
      extend ActiveModel::Naming
    end

    NamedPerson.model_name        # => "NamedPerson"
    NamedPerson.model_name.human  # => "Named person"

  {Learn more}[link:classes/ActiveModel/Naming.html]

* Observer support

  ActiveModel::Observers allows your object to implement the Observer
  pattern in a Rails App and take advantage of all the standard observer
  functions.

  {Learn more}[link:classes/ActiveModel/Observer.html]

* Making objects serializable

  ActiveModel::Serialization provides a standard interface for your object
  to provide +to_json+ or +to_xml+ serialization.

    s = SerialPerson.new
    s.serializable_hash   # => {"name"=>nil}
    s.to_json             # => "{\"name\":null}"
    s.to_xml              # => "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<serial-person...

  {Learn more}[link:classes/ActiveModel/Serialization.html]

* Internationalization (i18n) support

    class Person
      extend ActiveModel::Translation
    end

    Person.human_attribute_name('my_attribute')
    # => "My attribute"

  {Learn more}[link:classes/ActiveModel/Translation.html]

* Validation support

   class Person
     include ActiveModel::Validations

     attr_accessor :first_name, :last_name

     validates_each :first_name, :last_name do |record, attr, value|
       record.errors.add attr, 'starts with z.' if value.to_s[0] == ?z
     end
   end

   person = Person.new
   person.first_name = 'zoolander'
   person.valid?  # => false

  {Learn more}[link:classes/ActiveModel/Validations.html]

* Custom validators

   class Person
     include ActiveModel::Validations
     validates_with HasNameValidator
     attr_accessor :name
   end

   class HasNameValidator < ActiveModel::Validator
     def validate(record)
      record.errors[:name] = "must exist" if record.name.blank?
     end
   end

   p = ValidatorPerson.new
   p.valid?                  # =>  false
   p.errors.full_messages    # => ["Name must exist"]
   p.name = "Bob"
   p.valid?                  # =>  true

  {Learn more}[link:classes/ActiveModel/Validator.html]

= Active Record -- Object-relational mapping put on rails

Active Record connects classes to relational database tables to establish an
almost zero-configuration persistence layer for applications. The library
provides a base class that, when subclassed, sets up a mapping between the new
class and an existing table in the database. In context of an application,
these classes are commonly referred to as *models*. Models can also be
connected to other models; this is done by defining *associations*.

Active Record relies heavily on naming in that it uses class and association
names to establish mappings between respective database tables and foreign key
columns. Although these mappings can be defined explicitly, it's recommended
to follow naming conventions, especially when getting started with the
library.

A short rundown of some of the major features:

* Automated mapping between classes and tables, attributes and columns.

   class Product < ActiveRecord::Base
   end

   The Product class is automatically mapped to the table named "products",
   which might look like this:

   CREATE TABLE products (
     id int(11) NOT NULL auto_increment,
     name varchar(255),
     PRIMARY KEY  (id)
   );

   This would also define the following accessors: `Product#name` and
   `Product#name=(new_name)`

  {Learn more}[link:classes/ActiveRecord/Base.html]


* Associations between objects defined by simple class methods.

   class Firm < ActiveRecord::Base
     has_many   :clients
     has_one    :account
     belongs_to :conglomerate
   end

  {Learn more}[link:classes/ActiveRecord/Associations/ClassMethods.html]


* Aggregations of value objects.

   class Account < ActiveRecord::Base
     composed_of :balance, :class_name => "Money",
                 :mapping => %w(balance amount)
     composed_of :address,
                 :mapping => [%w(address_street street), %w(address_city city)]
   end

  {Learn more}[link:classes/ActiveRecord/Aggregations/ClassMethods.html]


* Validation rules that can differ for new or existing objects.

    class Account < ActiveRecord::Base
      validates_presence_of     :subdomain, :name, :email_address, :password
      validates_uniqueness_of   :subdomain
      validates_acceptance_of   :terms_of_service, :on => :create
      validates_confirmation_of :password, :email_address, :on => :create
    end

  {Learn more}[link:classes/ActiveRecord/Validations.html]


* Callbacks available for the entire life cycle (instantiation, saving, destroying, validating, etc.)

   class Person < ActiveRecord::Base
     before_destroy :invalidate_payment_plan
     # the `invalidate_payment_plan` method gets called just before Person#destroy
   end

  {Learn more}[link:classes/ActiveRecord/Callbacks.html]


* Observers that react to changes in a model

   class CommentObserver < ActiveRecord::Observer
     def after_create(comment) # is called just after Comment#save
       Notifications.deliver_new_comment("david@loudthinking.com", comment)
     end
   end

  {Learn more}[link:classes/ActiveRecord/Observer.html]


* Inheritance hierarchies

   class Company < ActiveRecord::Base; end
   class Firm < Company; end
   class Client < Company; end
   class PriorityClient < Client; end

  {Learn more}[link:classes/ActiveRecord/Base.html]


* Transactions

    # Database transaction
    Account.transaction do
      david.withdrawal(100)
      mary.deposit(100)
    end

  {Learn more}[link:classes/ActiveRecord/Transactions/ClassMethods.html]


* Reflections on columns, associations, and aggregations

    reflection = Firm.reflect_on_association(:clients)
    reflection.klass # => Client (class)
    Firm.columns # Returns an array of column descriptors for the firms table

  {Learn more}[link:classes/ActiveRecord/Reflection/ClassMethods.html]


* Database abstraction through simple adapters

    # connect to SQLite3
    ActiveRecord::Base.establish_connection(:adapter => "sqlite3", :database => "dbfile.sqlite3")

    # connect to MySQL with authentication
    ActiveRecord::Base.establish_connection(
      :adapter  => "mysql",
      :host     => "localhost",
      :username => "me",
      :password => "secret",
      :database => "activerecord"
    )

  {Learn more}[link:classes/ActiveRecord/Base.html] and read about the built-in support for
  MySQL[link:classes/ActiveRecord/ConnectionAdapters/MysqlAdapter.html],
  PostgreSQL[link:classes/ActiveRecord/ConnectionAdapters/PostgreSQLAdapter.html], and
  SQLite3[link:classes/ActiveRecord/ConnectionAdapters/SQLite3Adapter.html].


* Logging support for Log4r[http://log4r.sourceforge.net] and Logger[http://www.ruby-doc.org/stdlib/libdoc/logger/rdoc]

    ActiveRecord::Base.logger = Logger.new(STDOUT)
    ActiveRecord::Base.logger = Log4r::Logger.new("Application Log")


* Database agnostic schema management with Migrations

    class AddSystemSettings < ActiveRecord::Migration
      def self.up
        create_table :system_settings do |t|
          t.string  :name
          t.string  :label
          t.text    :value
          t.string  :type
          t.integer :position
        end

        SystemSetting.create :name => "notice", :label => "Use notice?", :value => 1
      end

      def self.down
        drop_table :system_settings
      end
    end

  {Learn more}[link:classes/ActiveRecord/Migration.html]


== Philosophy

Active Record is an implementation of the object-relational mapping (ORM)
pattern[http://www.martinfowler.com/eaaCatalog/activeRecord.html] by the same
name described by Martin Fowler:

  "An object that wraps a row in a database table or view,
  encapsulates the database access, and adds domain logic on that data."

Active Record attempts to provide a coherent wrapper as a solution for the inconvenience that is
object-relational mapping. The prime directive for this mapping has been to minimize
the amount of code needed to build a real-world domain model. This is made possible
by relying on a number of conventions that make it easy for Active Record to infer
complex relations and structures from a minimal amount of explicit direction.

Convention over Configuration:
* No XML-files!
* Lots of reflection and run-time extension
* Magic is not inherently a bad word

Admit the Database:
* Lets you drop down to SQL for odd cases and performance
* Doesn't attempt to duplicate or replace data definitions


== Download and installation

The latest version of Active Record can be installed with Rubygems:

  % [sudo] gem install activerecord

Source code can be downloaded as part of the Rails project on GitHub

* http://github.com/rails/rails/tree/master/activerecord/


== License

Active Record is released under the MIT license.


== Support

API documentation is at

* http://api.rubyonrails.com

Bug reports and feature requests can be filed with the rest for the Ruby on Rails project here:

* https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets


== SQL Server 2005 and 2008 Adapter For ActiveRecord

The SQL Server adapter for ActiveRecord.


== What's New

* Version 3.x now supports rails 3!


==== Testing Rake Tasks Support

This is a long story, but if you are not working with a legacy database and you can trust your schema.rb to setup you local development or test database, then we have adapter level support for rails :db rake tasks. Please read this wiki page for full details.

http://wiki.github.com/rails-sqlserver/activerecord-sqlserver-adapter/rails-db-rake-tasks


==== Date/Time Data Type Hinting

SQL Server 2005 does not include a native data type for just 'date' or 'time', it only has 'datetime'. To pass the ActiveRecord tests we implemented two simple class methods that can teach your models to coerce column information to be cast correctly. Simply pass a list of symbols to either the <tt>coerce_sqlserver_date</tt> or <tt>coerce_sqlserver_time</tt> methods that correspond to 'datetime' columns that need to be cast correctly.

  class Topic < ActiveRecord::Base
    coerce_sqlserver_date :last_read
    coerce_sqlserver_time :bonus_time
  end

This implementation has some limitations. To date we can only coerce date/time types for models that conform to the expected ActiveRecord class to table naming conventions. So a table of 'foo_bar_widgets' will look for coerced column types in the FooBarWidget class.


==== Executing Stored Procedures

Every class that sub classes ActiveRecord::Base will now have an execute_procedure class method to use. This method takes the name of the stored procedure which can be a string or symbol and any number of variables to pass to the procedure. Arguments will automatically be quoted per the connection's standards as normal. For example.

  Account.execute_procedure :update_totals, 'admin', nil, true


==== Native Data Type Support

Currently the following custom data types have been tested for schema definitions.

* char
* nchar
* nvarchar
* ntext
* varchar(max)
* nvarchar(max)

For example:

  create_table :sql_server_custom_types, :force => true do |t|
    t.column :ten_code,       :char,      :limit => 10
    t.column :ten_code_utf8,  :nchar,     :limit => 10
    t.column :title_utf8,     :nvarchar
    t.column :body,           :varchar_max    # Creates varchar(max)
    t.column :body_utf8,      :ntext
    t.column :body2_utf8,     :nvarchar_max   # Creates nvarchar(max)
  end

Manually creating a varchar(max) is not necessary since this is the default type created when specifying a :text field. As time goes on we will be testing other SQL Server specific data types are handled correctly when created in a migration.


==== Native Text/String/Binary Data Type Accessor

To pass the ActiveRecord tests we had to implement an class accessor for the native type created for :text columns. By default any :text column created by migrations will create a 'varchar(max)' data type. This type can be queried using the SQL = operator and has plenty of storage space which is why we made it the default. If for some reason you want to change the data type created during migrations you can configure this line to your liking in a config/initializers file.

  ActiveRecord::ConnectionAdapters::SQLServerAdapter.native_text_database_type = 'varchar(8000)'

Also, there is a class attribute setter for the native string database type. This is the same for all SQL Server versions, 'varchar'. However it can be used instead of the #enable_default_unicode_types below for finer grain control over which types you want unicode safe when adding or changing the schema.

  ActiveRecord::ConnectionAdapters::SQLServerAdapter.native_string_database_type = 'nvarchar'

By default any :binary column created by migrations will create a 'varbinary(max)' data type. This too can be set using an initializer.

  ActiveRecord::ConnectionAdapters::SQLServerAdapter.native_binary_database_type = 'image'


====  Setting Unicode Types As Default

By default the adapter will use non-unicode safe data types for :string and :text types when defining/changing the schema. If you choose, you can set the following class attribute in a config/initializers file that will change this behavior. When set to true it has the equivalent meaning as the two lower items. These examples show detail level alternatives to achieve similar effects.
  
  ActiveRecord::ConnectionAdapters::SQLServerAdapter.enable_default_unicode_types = true
  
  ActiveRecord::ConnectionAdapters::SQLServerAdapter.native_text_database_type = 'nvarchar(max)'
  ActiveRecord::ConnectionAdapters::SQLServerAdapter.native_string_database_type = 'nvarchar'

It is important to remember that unicode types in SQL Server have approximately half the storage capacity as their counter parts. So where a normal string would max out at (8000) a unicode string will top off at (4000).


====  Schema Information Logging

By default all queries to the INFORMATION_SCHEMA table is silenced. If you think logging these queries are useful, you can enable it by adding this like to a initializer file.

  ActiveRecord::ConnectionAdapters::SQLServerAdapter.log_info_schema_queries = true


==== Auto Connecting

By default the adapter will auto connect to lost DB connections. For every query it will retry at intervals of 2, 4, 8, 16 and 32 seconds. During each retry it will callback out to ActiveRecord::Base.did_retry_sqlserver_connection(connection,count). When all retries fail, it will callback to ActiveRecord::Base.did_lose_sqlserver_connection(connection). Both implementations of these methods are to write to the rails logger, however, they make great override points for notifications like Hoptoad. If you want to disable automatic reconnections use the following in an initializer.

  ActiveRecord::ConnectionAdapters::SQLServerAdapter.auto_connect = false


== Versions

It is our goal to match the adapter version with each version of rails. However we will track our own tiny version independent of ActiveRecord. For example, an adapter version of 2.3.x will work on any 2.3.x version of ActiveRecord. Version 3.x will track ActiveRecord 3. This convention will be used in both the Git tags as well as the gems versioning.


== Installation

You will need Ruby ODBC. If you are using the adapter under 1.9, then you need at least ruby-odbc version 0.99992. ODBC is the preferred mode, however if you are using IronRuby you can use the ADONET connection mode which uses native System.Data connection. Other connection modes may be supported, possibly a straight FreeTDS layer. The sky is the limit for optional transports. If you are interested in helping, open a ticket and submit a patch. Or start a conversation on the Google Group.

  $ gem install activerecord-sqlserver-adapter

Optionally configure your gem dependencies in your Gemfile.

  gem 'activerecord-sqlserver-adapter', '3.x.xx'

If you have any troubles installing the lower level libraries for the adapter, please consult the wiki pages for various platform installation guides. Tons of good info can be found and we ask that you contribute too!

http://wiki.github.com/rails-sqlserver/activerecord-sqlserver-adapter/platform-installation



== IronRuby ADONET Mode

A few details on this implementation. All that is needed in your database.yml configuration file is "mode: adonet" vs "odbc" and if you are running IronRuby, the connection will be native. You can also specify an "integrated_security: true" option in your configuration, remember to remove the username/password options too. To use this adapter, you will not need need ANY DBI middle layer or special extension gems to the adapter. 

This adapter is opinionated in regards to IronRuby on types going in and out of the DB. For example strings will be String, not System::String and DateTime vs System::Datetime. There are many more examples but the rule of thumb is that the types will be simple types that correlate to a standard Ruby implementation. We enforce this basic rule because it is necessary to pass the tests and let the framework do its job. We recommend sticking to native Ruby types in your application code too.

The adapter establishes a System::Data::SqlClient connection that has both MultipleActiveResultSets (MARS) and Pooling turned off. There are good reasons for this one because the connection would not work otherwise for all the code issued by ActiveRecord. Remember too that ActiveRecord has it's own connection pooling and these underlying features like MARS/Pooling work against the adapter code.

Currently IronRuby is passing most of the ActiveRecord and Adapter tests. Here is a list of the ones remaining. Some are in the adapter's realm and some are in Marshaling area of IronRuby's core to fix. Feel like helping knock these out? Submit a patch to github issues.

http://gist.github.com/381101



== Contributing

If youd like to contribute a feature or bugfix, thanks! To make sure your fix/feature has a high chance of being added, please read the following guidelines. First, ask on the Google list, IRC, or post a ticket on github issues. Second, make sure there are tests! We will not accept any patch that is not tested. Please read the RUNNING_UNIT_TESTS file for the details of how to run the unit tests.

* Github: http://github.com/rails-sqlserver/activerecord-sqlserver-adapter
* Google Group: http://groups.google.com/group/rails-sqlserver-adapter
* IRC Room: #rails-sqlserver on irc.freenode.net



== Credits & Contributions

Many many people have contributed. If you do not see your name here and it should be let us know. Also, many thanks go out to those that have pledged financial contributions.

* Ken Collins
* Murray Steele
* Shawn Balestracci
* Joe Rafaniello
* Tom Ward



== License

Copyright  2008-2010. It is free software, and may be redistributed under the terms specified in the MIT-LICENSE file.


= Active Resource

Active Resource (ARes) connects business objects and Representational State Transfer (REST)
web services.  It implements object-relational mapping for REST web services to provide transparent
proxying capabilities between a client (ActiveResource) and a RESTful service (which is provided by Simply RESTful routing
in ActionController::Resources).

== Philosophy

Active Resource attempts to provide a coherent wrapper object-relational mapping for REST
web services. It follows the same philosophy as Active Record, in that one of its prime aims
is to reduce the amount of code needed to map to these resources.  This is made possible
by relying on a number of code- and protocol-based conventions that make it easy for Active Resource
to infer complex relations and structures.  These conventions are outlined in detail in the documentation
for ActiveResource::Base.

== Overview

Model classes are mapped to remote REST resources by Active Resource much the same way Active Record maps model classes to database
tables.  When a request is made to a remote resource, a REST XML request is generated, transmitted, and the result
received and serialized into a usable Ruby object.

=== Configuration and Usage

Putting Active Resource to use is very similar to Active Record.  It's as simple as creating a model class
that inherits from ActiveResource::Base and providing a <tt>site</tt> class variable to it:

   class Person < ActiveResource::Base
     self.site = "http://api.people.com:3000/"
   end

Now the Person class is REST enabled and can invoke REST services very similarly to how Active Record invokes
life cycle methods that operate against a persistent store.

   # Find a person with id = 1
   ryan = Person.find(1)
   Person.exists?(1)  # => true

As you can see, the methods are quite similar to Active Record's methods for dealing with database
records.  But rather than dealing directly with a database record, you're dealing with HTTP resources (which may or may not be database records).

==== Protocol

Active Resource is built on a standard XML format for requesting and submitting resources over HTTP.  It mirrors the RESTful routing
built into Action Controller but will also work with any other REST service that properly implements the protocol.
REST uses HTTP, but unlike "typical" web applications, it makes use of all the verbs available in the HTTP specification:

* GET requests are used for finding and retrieving resources.
* POST requests are used to create new resources.
* PUT requests are used to update existing resources.
* DELETE requests are used to delete resources.

For more information on how this protocol works with Active Resource, see the ActiveResource::Base documentation;
for more general information on REST web services, see the article here[http://en.wikipedia.org/wiki/Representational_State_Transfer].

==== Find

Find requests use the GET method and expect the XML form of whatever resource/resources is/are being requested.  So,
for a request for a single element, the XML of that item is expected in response:

   # Expects a response of
   #
   # <person><id type="integer">1</id><attribute1>value1</attribute1><attribute2>..</attribute2></person>
   #
   # for GET http://api.people.com:3000/people/1.xml
   #
   ryan = Person.find(1)

The XML document that is received is used to build a new object of type Person, with each
XML element becoming an attribute on the object.

   ryan.is_a? Person  # => true
   ryan.attribute1  # => 'value1'

Any complex element (one that contains other elements) becomes its own object:

   # With this response:
   #
   # <person><id>1</id><attribute1>value1</attribute1><complex><attribute2>value2</attribute2></complex></person>
   #
   # for GET http://api.people.com:3000/people/1.xml
   #
   ryan = Person.find(1)
   ryan.complex  # => <Person::Complex::xxxxx>
   ryan.complex.attribute2  # => 'value2'

Collections can also be requested in a similar fashion

   # Expects a response of
   #
   # <people type="array">
   #  <person><id type="integer">1</id><first>Ryan</first></person>
   #  <person><id type="integer">2</id><first>Jim</first></person>
   # </people>
   #
   # for GET http://api.people.com:3000/people.xml
   #
   people = Person.find(:all)
   people.first  # => <Person::xxx 'first' => 'Ryan' ...>
   people.last  # => <Person::xxx 'first' => 'Jim' ...>

==== Create

Creating a new resource submits the XML form of the resource as the body of the request and expects
a 'Location' header in the response with the RESTful URL location of the newly created resource.  The
id of the newly created resource is parsed out of the Location response header and automatically set
as the id of the ARes object.

  # <person><first>Ryan</first></person>
  #
  # is submitted as the body on
  #
  # POST http://api.people.com:3000/people.xml
  #
  # when save is called on a new Person object.  An empty response is
  # is expected with a 'Location' header value:
  #
  # Response (201): Location: http://api.people.com:3000/people/2
  #
  ryan = Person.new(:first => 'Ryan')
  ryan.new?  # => true
  ryan.save  # => true
  ryan.new?  # => false
  ryan.id    # => 2

==== Update

'save' is also used to update an existing resource - and follows the same protocol as creating a resource
with the exception that no response headers are needed - just an empty response when the update on the
server side was successful.

  # <person><first>Ryan</first></person>
  #
  # is submitted as the body on
  #
  # PUT http://api.people.com:3000/people/1.xml
  #
  # when save is called on an existing Person object.  An empty response is
  # is expected with code (204)
  #
  ryan = Person.find(1)
  ryan.first # => 'Ryan'
  ryan.first = 'Rizzle'
  ryan.save  # => true

==== Delete

Destruction of a resource can be invoked as a class and instance method of the resource.

  # A request is made to
  #
  # DELETE http://api.people.com:3000/people/1.xml
  #
  # for both of these forms.  An empty response with
  # is expected with response code (200)
  #
  ryan = Person.find(1)
  ryan.destroy  # => true
  ryan.exists?  # => false
  Person.delete(2)  # => true
  Person.exists?(2) # => false


You can find more usage information in the ActiveResource::Base documentation.


= Active Support -- Utility classes and Ruby extensions from Rails

Active Support is a collection of utility classes and standard library
extensions that were found useful for the Rails framework. These additions
reside in this package so they can be loaded as needed in Ruby projects
outside of Rails.


== Download and installation

The latest version of Active Support can be installed with Rubygems:

  % [sudo] gem install activesupport

Source code can be downloaded as part of the Rails project on GitHub

* http://github.com/rails/rails/tree/master/activesupport/


== License

Active Support is released under the MIT license.


== Support

API documentation is at

* http://api.rubyonrails.com

Bug reports and feature requests can be filed with the rest for the Ruby on Rails project here:

* https://rails.lighthouseapp.com/projects/8994-ruby-on-rails/tickets

## Abstract ##

Arel is a Relational Algebra for Ruby. It 1) simplifies the generation complex of SQL queries and it 2) adapts to various RDBMS systems. It is intended to be a framework framework; that is, you can build your own ORM with it, focusing on innovative object and collection modeling as opposed to database compatibility and query generation.

## Status ##

For the moment, Arel uses ActiveRecord's connection adapters to connect to the various engines, connection pooling, perform quoting, and do type conversion. On the horizon is the use of DataObjects instead.

The long term goal, following both LINQ and DataMapper, is to have Arel adapt to engines beyond RDBMS, including XML, IMAP, YAML, etc.

## A Gentle Introduction ##

Generating a query with ARel is simple. For example, in order to produce

    SELECT * FROM users

you construct a table relation and convert it to sql:

    users = Table(:users)
    users.to_sql

In fact, you will probably never call `#to_sql`. Rather, you'll work with data from the table directly. You can iterate through all rows in the `users` table like this:

    users.each { |user| ... }

In other words, Arel relations implement Ruby's Enumerable interface. Let's have a look at a concrete example:

    users.first # => { users[:id] => 1, users[:name] => 'bob' }

As you can see, Arel converts the rows from the database into a hash, the values of which are sublimated to the appropriate Ruby primitive (integers, strings, and so forth).

### More Sophisticated <strike>Queries</strike> Relations ###

Here is a whirlwind tour through the most common relational operators. These will probably cover 80% of all interaction with the database.

First is the 'restriction' operator, `where`:

    users.where(users[:name].eq('amy'))
    # => SELECT * FROM users WHERE users.name = 'amy'

What would, in SQL, be part of the `SELECT` clause is called in Arel a `projection`:

    users.project(users[:id]) # => SELECT users.id FROM users

Joins resemble SQL strongly:

    users.join(photos).on(users[:id].eq(photos[:user_id]))
    # => SELECT * FROM users INNER JOIN photos ON users.id = photos.user_id

What are called `LIMIT` and `OFFSET` in SQL are called `take` and `skip` in Arel:

    users.take(5) # => SELECT * FROM users LIMIT 5
    users.skip(4) # => SELECT * FROM users OFFSET 4

`GROUP BY` is called `group`:

    users.group(users[:name]) # => SELECT * FROM users GROUP BY name

The best property of the Relational Algebra is its "composability", or closure under all operations. For example, to select AND project, just "chain" the method invocations:

    users                                 \
      .where(users[:name].eq('amy'))      \
      .project(users[:id])                \
    # => SELECT users.id FROM users WHERE users.name = 'amy'

All operators are chainable in this way, and they are chainable any number of times, in any order.

    users.where(users[:name].eq('bob')).where(users[:age].lt(25))

Of course, many of the operators take multiple arguments, so the last example can be written more tersely:

    users.where(users[:name].eq('bob'), users[:age].lt(25))

The `OR` operator is not yet supported. It will work like this:

    users.where(users[:name].eq('bob').or(users[:age].lt(25)))

The `AND` operator will behave similarly.

Finally, most operations take a block form. For example:

    Table(:users)                    \
      .where   { |u| u[:id].eq(1) } \
      .project { |u| u[:id] }

This provides a (sometimes) convenient alternative syntax.

### The Crazy Features ###

The examples above are fairly simple and other libraries match or come close to matching the expressiveness of Arel (e.g., `Sequel` in Ruby).

#### Complex Joins ####

Where Arel really shines in its ability to handle complex joins and aggregations. As a first example, let's consider an "adjacency list", a tree represented in a table. Suppose we have a table `comments`, representing a threaded discussion:

    comments = Table(:comments)

And this table has the following attributes:

    comments.attributes # => [comments[:id], comments[:body], comments[:parent_id]]

The `parent_id` column is a foreign key from the `comments` table to itself. Now, joining a table to itself requires aliasing in SQL. In fact, you may alias in Arel as well:

    replies = comments.alias
    comments_with_replies = \
      comments.join(replies).on(replies[:parent_id].eq(comments[:id]))
    # => SELECT * FROM comments INNER JOIN comments AS comments_2 WHERE comments_2.parent_id = comments.id

The call to `#alias` is actually optional: Arel will always produce a unique name for every table joined in the relation, and it will always do so deterministically to exploit query caching. Explicit aliasing is more common, however. When you want to extract specific slices of data, aliased tables are a necessity. For example to get just certain columns from the row, treat a row like a hash:

    comments_with_replies.first[replies[:body]]

This will return the first comment's reply's body.

If you don't need to extract the data later (for example, you're simply doing a join to find comments that have replies, you don't care what the content of the replies are), the block form may be preferable:

    comments.join(comments) { |comments, replies| replies[:parent_id].eq(comments[:id]) }
    # => SELECT * FROM comments INNER JOIN comments AS comments_2 WHERE comments_2.parent_id = comments.id

Note that you do NOT want to do something like:

    comments.join(comments, comments[:parent_id].eq(comments[:id]))
    # => SELECT * FROM comments INNER JOIN comments AS comments_2 WHERE comments.parent_id = comments.id

This does NOT have the same meaning as the previous query, since the comments[:parent_id] reference is effectively ambiguous.

#### Complex Aggregations ####

My personal favorite feature of Arel, certainly the most difficult to implement, and possibly only of marginal value, is **closure under joining even in the presence of aggregations**. This is a feature where the Relational Algebra is fundamentally easier to use than SQL. Think of this as a preview of the kind of radical functionality that is to come, stuff no other "ORM" is doing.

The easiest way to introduce this is in SQL. Your task is to get all users and the **count** of their associated photos. Let's start from the inside out:

    SELECT count(*)
    FROM photos
    GROUP BY user_id

Now, we'd like to join this with the user table. Naively, you might try to do this:

    SELECT users.*, count(photos.id)
    FROM users
    LEFT OUTER JOIN photos
      ON users.id = photos.user_id
    GROUP BY photos.user_id

Of course, this has a slightly different meaning than our intended query. This is actually a fairly advanced topic in SQL so let's see why this doesn't work *step by step*. Suppose we have these records in our `users` table:

    mysql> select * from users;
    +------+--------+
    | id   | name   |
    +------+--------+
    |    1 | hai    |
    |    2 | bai    |
    |    3 | dumpty |
    +------+--------+

And these in the photos table:

    mysql> select * from photos;
    +------+---------+-----------+
    | id   | user_id | camera_id |
    +------+---------+-----------+
    |    1 |       1 |         1 |
    |    2 |       1 |         1 |
    |    3 |       1 |         1 |
    +------+---------+-----------+

If we perform the above, incorrect query, we get the following:

    mysql> select users.*, count(photos.id) from users left outer join photos on users.id = photos.user_id limit 3 group by user_id;
    +------+------+------------------+
    | id   | name | count(photos.id) |
    +------+------+------------------+
    |    2 | bai  |                0 |
    |    1 | hai  |                3 |
    +------+------+------------------+

As you can see, we're completely missing data for user with id 3. `dumpty` has no photos, neither does `bai`. But strangely `bai` appeared and `dumpty` didn't! The reason is that the `GROUP BY` clause is aggregating on both tables, not just the `photos` table. All users without photos have a `photos.id` of `null` (thanks to the left outer join). These are rolled up together and an arbitrary user wins. In this case, `bai` not `dumpty`.

    SELECT users.*, photos_aggregation.cnt
    FROM users
    LEFT OUTER JOIN (SELECT user_id, count(*) as cnt FROM photos GROUP BY user_id) AS photos_aggregation
      ON photos_aggregation.user_id = users.id

## ActiveRecord Adapter Support

Arel provides built-in support for the following ActiveRecord DB adapters:

* IBM DB
* MySQL
* Oracle
* PostgreSQL
* SQLite

You can add support for other adapters by defining a SQL compiler at the appropriate place.  Here's an example: let's say
you've got a YourSQL adapter.  Create a file at `yoursql/arel_compiler.rb` somewhere on the load path (presumably in
the YourSQL adapter gem).  The contents of that file can be as simple as:

    module Arel
      module SqlCompiler
        class YourSQLCompiler < GenericCompiler
        end
      end
    end

Override any methods as necessary.  See examples at
[lib/arel/engines/sql/compilers](http://github.com/rails/arel/tree/master/lib/arel/engines/sql/compilers/).

= Project: Builder

== Goal

Provide a simple way to create XML markup and data structures.

== Classes

Builder::XmlMarkup:: Generate XML markup notiation
Builder::XmlEvents:: Generate XML events (i.e. SAX-like)

<b>Notes</b>:: 

* An <tt>Builder::XmlTree</tt> class to generate XML tree
  (i.e. DOM-like) structures is also planned, but not yet implemented.
  Also, the events builder is currently lagging the markup builder in
  features.

== Usage

  require 'rubygems'	
  require_gem 'builder', '~> 2.0'

  builder = Builder::XmlMarkup.new
  xml = builder.person { |b| b.name("Jim"); b.phone("555-1234") }
  xml #=> <person><name>Jim</name><phone>555-1234</phone></person>

or

  require 'rubygems'	
  require_gem 'builder'

  builder = Builder::XmlMarkup.new(:target=>STDOUT, :indent=>2)
  builder.person { |b| b.name("Jim"); b.phone("555-1234") }
  #
  # Prints:
  # <person>
  #   <name>Jim</name>
  #   <phone>555-1234</phone>
  # </person>

== Compatibility

=== Version 2.0.0 Compatibility Changes

Version 2.0.0 introduces automatically escaped attribute values for
the first time.  Versions prior to 2.0.0 did not insert escape
characters into attribute values in the XML markup.  This allowed
attribute values to explicitly reference entities, which was
occasionally used by a small number of developers.  Since strings
could always be explicitly escaped by hand, this was not a major
restriction in functionality.

However, it did suprise most users of builder.  Since the body text is
normally escaped, everybody expected the attribute values to be
escaped as well.  Escaped attribute values were the number one support
request on the 1.x Builder series.

Starting with Builder version 2.0.0, all attribute values expressed as
strings will be processed and the appropriate characters will be
escaped (e.g. "&" will be tranlated to "&amp;").  Attribute values
that are expressed as Symbol values will not be processed for escaped
characters and will be unchanged in output. (Yes, this probably counts
as Symbol abuse, but the convention is convenient and flexible).

Example:

  xml = Builder::XmlMarkup.new
  xml.sample(:escaped=>"This&That", :unescaped=>:"Here&amp;There")
  xml.target!  =>
    <sample escaped="This&amp;That" unescaped="Here&amp;There"/>

=== Version 1.0.0 Compatibility Changes

Version 1.0.0 introduces some changes that are not backwards
compatible with earlier releases of builder.  The main areas of
incompatibility are:

* Keyword based arguments to +new+ (rather than positional based).  It
  was found that a developer would often like to specify indentation
  without providing an explicit target, or specify a target without
  indentation.  Keyword based arguments handle this situation nicely.

* Builder must now be an explicit target for markup tags.  Instead of
  writing

    xml_markup = Builder::XmlMarkup.new
    xml_markup.div { strong("text") }

  you need to write

    xml_markup = Builder::XmlMarkup.new
    xml_markup.div { xml_markup.strong("text") }

* The builder object is passed as a parameter to all nested markup
  blocks.  This allows you to create a short alias for the builder
  object that can be used within the block.  For example, the previous
  example can be written as:

    xml_markup = Builder::XmlMarkup.new
    xml_markup.div { |xml| xml.strong("text") }

* If you have both a pre-1.0 and a post-1.0 gem of builder installed,
  you can choose which version to use through the RubyGems
  +require_gem+ facility.

    require_gem 'builder', "~> 0.0"   # Gets the old version
    require_gem 'builder', "~> 1.0"   # Gets the new version

== Features

* XML Comments are supported ...

    xml_markup.comment! "This is a comment"
      #=>  <!-- This is a comment -->

* XML processing instructions are supported ...

    xml_markup.instruct! :xml, :version=>"1.0", :encoding=>"UTF-8"
      #=>  <?xml version="1.0" encoding="UTF-8"?>
   
  If the processing instruction is omitted, it defaults to "xml".
  When the processing instruction is "xml", the defaults attributes
  are:
  
  <b>version</b>:: 1.0
  <b>encoding</b>:: "UTF-8"

* XML entity declarations are now supported to a small degree.

    xml_markup.declare! :DOCTYPE, :chapter, :SYSTEM, "../dtds/chapter.dtd"
      #=>  <!DOCTYPE chapter SYSTEM "../dtds/chapter.dtd">

  The parameters to a declare! method must be either symbols or
  strings. Symbols are inserted without quotes, and strings are
  inserted with double quotes.  Attribute-like arguments in hashes are
  not allowed.

  If you need to have an argument to declare! be inserted without
  quotes, but the arguement does not conform to the typical Ruby
  syntax for symbols, then use the :"string" form to specify a symbol.

  For example:

    xml_markup.declare! :ELEMENT, :chapter, :"(title,para+)"
      #=>  <!ELEMENT chapter (title,para+)>

  Nested entity declarations are allowed.  For example:

    @xml_markup.declare! :DOCTYPE, :chapter do |x|
      x.declare! :ELEMENT, :chapter, :"(title,para+)"
      x.declare! :ELEMENT, :title, :"(#PCDATA)"
      x.declare! :ELEMENT, :para, :"(#PCDATA)"
    end

    #=>

    <!DOCTYPE chapter [
      <!ELEMENT chapter (title,para+)>
      <!ELEMENT title (#PCDATA)>
      <!ELEMENT para (#PCDATA)>
    ]>

* Some support for XML namespaces is now available.  If the first
  argument to a tag call is a symbol, it will be joined to the tag to
  produce a namespace:tag combination.  It is easier to show this than
  describe it.

   xml.SOAP :Envelope do ... end

  Just put a space before the colon in a namespace to produce the
  right form for builder (e.g. "<tt>SOAP:Envelope</tt>" =>
  "<tt>xml.SOAP :Envelope</tt>")

* String attribute values are <em>now</em> escaped by default by
  Builder (<b>NOTE:</b> this is _new_ behavior as of version 2.0).

  However, occasionally you need to use entities in attribute values.
  Using a symbols (rather than a string) for an attribute value will
  cause Builder to not run its quoting/escaping algorithm on that
  particular value.

  (<b>Note:</b> The +escape_attrs+ option for builder is now
  obsolete).

  Example:

    xml = Builder::XmlMarkup.new
    xml.sample(:escaped=>"This&That", :unescaped=>:"Here&amp;There")
    xml.target!  =>
      <sample escaped="This&amp;That" unescaped="Here&amp;There"/>

* UTF-8 Support

  Builder correctly translates UTF-8 characters into valid XML.  (New
  in version 2.0.0).  Thanks to Sam Ruby for the translation code.

  Example:

    xml = Builder::Markup.new
    xml.sample("Itrntinl")
    xml.target!  =>
      "<sample>I&#241;t&#235;rn&#226;ti&#244;n&#224;l</sample>"

== Contact

Author::     Jim Weirich
Email::      jim@weirichhouse.org
Home Page::  http://onestepback.org
License::    MIT Licence (http://www.opensource.org/licenses/mit-license.html)

## 1.0.0.rc.5

Features:

  - Make the Capistrano task more concise.

Bugfixes:

  - Fix a regression with determining whether or not to use sudo
  - Allow using the --gemfile flag with the --deployment flag

## 1.0.0.rc.4

Features:

  - `bundle gem NAME` command to generate a new gem with Gemfile
  - Bundle config file location can be specified by BUNDLE_APP_CONFIG
  - Add --frozen to disable updating the Gemfile.lock at runtime
    (default with --deployment)
  - Basic Capistrano task now added as 'bundler/capistrano'

Bugfixes:

  - Multiple bundler process no longer share a tmp directory
  - `bundle update GEM` always updates dependencies of GEM as well
  - Deleting the cache directory no longer causes errors
  - Moving the bundle after installation no longer causes git errors
  - Bundle path is now correctly remembered on a read-only filesystem
  - Gem binaries are installed to Gem.bindir, not #{Gem.dir}/bin
  - Fetch gems from vendor/cache, even without --local
  - Sort lockfile by platform as well as spec

## 1.0.0.rc.3 (August 3, 2010)

Features:

  - Deprecate --production flag for --deployment, since the former
    was causing confusion with the :production group
  - Add --gemfile option to `bundle check`
  - Reduce memory usage of `bundle install` by 2-4x
  - Improve message from `bundle check` under various conditions
  - Better error when a changed Gemfile conflicts with Gemfile.lock

Bugfixes:

  - Create bin/ directory if it is missing, then install binstubs
  - Error nicely on the edge case of a pinned gem with no spec
  - Do not require gems for other platforms
  - Update git sources along with the gems they contain

## 1.0.0.rc.2 (July 29, 2010)

  - `bundle install path` was causing confusion, so we now print
    a clarifying warning. The preferred way to install to a path
    (which will not print the warning) is
    `bundle install --path path/to/install`.
  - `bundle install --system` installs to the default system
    location ($BUNDLE_PATH or $GEM_HOME) even if you previously
    used `bundle install --path`
  - completely remove `--disable-shared-gems`. If you install to
    system, you will not be isolated, while if you install to
    another path, you will be isolated from gems installed to
    the system. This was mostly an internal option whose naming
    and semantics were extremely confusing.
  - Add a `--production` option to `bundle install`:
    - by default, installs to `vendor/bundle`. This can be
      overridden with the `--path` option
    - uses `--local` if `vendor/cache` is found. This will
      guarantee that Bundler does not attempt to connect to
      Rubygems and will use the gems cached in `vendor/cache`
      instead
    - Raises an exception if a Gemfile.lock is not found
    - Raises an exception if you modify your Gemfile in development
      but do not check in an updated Gemfile.lock
  - Fixes a bug where switching a source from Rubygems to git
    would always say "the git source is not checked out" when
    running `bundle install`

NOTE: We received several reports of "the git source has not
been checked out. Please run bundle install". As far as we
can tell, these problems have two possible causes:

1. `bundle install ~/.bundle` in one user, but actually running
   the application as another user. Never install gems to a
   directory scoped to a user (`~` or `$HOME`) in deployment.
2. A bug that happened when changing a gem to a git source.

To mitigate several common causes of `(1)`, please use the
new `--production` flag. This flag is simply a roll-up of
the best practices we have been encouraging people to use
for deployment.

If you want to share gems across deployments, and you use
Capistrano, symlink release_path/current/vendor/bundle to
release_path/shared/bundled_gems. This will keep deployments
snappy while maintaining the benefits of clean, deploy-time
isolation.

## 1.0.0.rc.1 (July 26, 2010)

  - Fixed a bug with `bundle install` on multiple machines and git

## 1.0.0.beta.10 (July 25, 2010)

  - Last release before 1.0.0.rc.1
  - Added :mri as a valid platform (platforms :mri { gem "ruby-debug" })
  - Fix `bundle install` immediately after modifying the :submodule option
  - Don't write to Gemfile.lock if nothing has changed, fixing situations
    where bundle install was run with a different user than the app
    itself
  - Fix a bug where other platforms were being wiped on `bundle update`
  - Don't ask for root password on `bundle install` if not needed
  - Avoid setting `$GEM_HOME` where not needed
  - First solid pass of `bundle config`
  - Add build options
    - `bundle config build.mysql --with-mysql-config=/path/to/config`

## 1.0.0.beta.9 (July 21, 2010)

  - Fix install failure when switching from a path to git source
  - Fix `bundle exec bundle *` in a bundle with --disable-shared-gems
  - Fix `bundle *` from inside a bundle with --disable-shared-gem
  - Shim Gem.refresh. This is used by Unicorn
  - Fix install failure when a path's dependencies changed

## 1.0.0.beta.8 (July 20, 2010)

  - Fix a Beta 7 bug involving Ruby 1.9

## 1.0.0.beta.7 (July 20, 2010, yanked)

  - Running `bundle install` twice in a row with a git source always crashed

## 1.0.0.beta.6 (July 20, 2010, yanked)

  - Create executables with bundle install --binstubs
  - You can customize the location (default is app/bin) with --binstubs other/location
  - Fix a bug where the Gemfile.lock would be deleted even if the update was exited
  - Fix a bug where cached gems for other platforms were sometimes deleted
  - Clean up output when nothing was deleted from cache (it previously said
    "Removing outdated gems ...")
  - Improve performance of bundle install if the git gem was already checked out,
    and the revision being used already exists locally
  - Fix bundle show bundler in some cases
  - Fix bugs with bundle update
  - Don't ever run git commands at runtime (fixes a number of common passenger issues)
  - Fixes an obscure bug where switching the source of a gem could fail to correctly
    change the source of its dependencies
  - Support multiple version dependencies in the Gemfile
    (gem "rails", ">= 3.0.0.beta1", "<= 3.0.0")
  - Raise an exception for ambiguous uses of multiple declarations of the same gem
    (for instance, with different versions or sources).
  - Fix cases where the same dependency appeared several times in the Gemfile.lock
  - Fix a bug where require errors were being swallowed during Bundler.require

## BACKFILL COMING

## 1.0.0.beta.1

  - No `bundle lock` command. Locking happens automatically on install or update
  - No .bundle/environment.rb. Require 'bundler/setup' instead.
  - $BUNDLE_HOME defaults to $GEM_HOME instead of ~/.bundle
  - Remove lockfiles generated by 0.9

## 0.9.26

Features:

  - error nicely on incompatible 0.10 lockfiles

## 0.9.25 (May 3, 2010)

Bugfixes:

  - explicitly coerce Pathname objects to Strings for Ruby 1.9
  - fix some newline weirdness in output from install command

## 0.9.24 (April 22, 2010)

Features:

  - fetch submodules for git sources
  - limit the bundled version of bundler to the same as the one installing
  - force relative paths in git gemspecs to avoid raising Gem::NameTooLong
  - serialize GemCache sources correctly, so locking works
  - raise Bundler::GemNotFound instead of calling exit! inside library code
  - Rubygems 1.3.5 compatibility for the adventurous, not supported by me :)

Bugfixes:

  - don't try to regenerate environment.rb if it is read-only
  - prune outdated gems with the platform "ruby"
  - prune cache without errors when there are directories or non-gem files
  - don't re-write environment.rb if running after it has been loaded
  - do not monkeypatch Specification#load_paths twice when inside a bundle

## 0.9.23 (April 20, 2010)

Bugfixes:

  - cache command no longer prunes gems created by an older rubygems version
  - cache command no longer prunes gems that are for other platforms

## 0.9.22 (April 20, 2010)

Features:

  - cache command now prunes stale .gem files from vendor/cache
  - init --gemspec command now generates development dependencies
  - handle Polyglot's changes to Kernel#require with Bundler::ENV_LOADED (#287)
  - remove .gem files generated after installing a gem from a :path (#286)
  - improve install/lock messaging (#284)

Bugfixes:

  - ignore cached gems that are for another platform (#288)
  - install Windows gems that have no architecture set, like rcov (#277)
  - exec command while locked now includes the bundler lib in $LOAD_PATH (#293)
  - fix the `rake install` task
  - add GemspecError so it can be raised without (further) error (#292)
  - create a parent directory before cloning for git 1.5 compatibility (#285)

## 0.9.21 (April 16, 2010)

Bugfixes:

  - don't raise 'omg wtf' when lockfile is outdated

## 0.9.20 (April 15, 2010)

Features:

  - load YAML format gemspecs
  - no backtraces when calling Bundler.setup if gems are missing
  - no backtraces when trying to exec a file without the executable bit

Bugfixes:

  - fix infinite recursion in Bundler.setup after loading a bundled Bundler gem
  - request install instead of lock when env.rb is out of sync with Gemfile.lock

## 0.9.19 (April 12, 2010)

Features:

  - suggest `bundle install --relock` when the Gemfile has changed (#272)
  - source support for Rubygems servers without prerelease gem indexes (#262)

Bugfixes:

  - don't set up all groups every time Bundler.setup is called while locked (#263)
  - fix #full_gem_path for git gems while locked (#268)
  - eval gemspecs at the top level, not inside the Bundler class (#269)


## 0.9.18 (April 8, 2010)

Features:

  - console command that runs irb with bundle (and optional group) already loaded

Bugfixes:

  - Bundler.setup now fully disables system gems, even when unlocked (#266, #246)
    - fixes Yard, which found plugins in Gem.source_index that it could not load
    - makes behaviour of `Bundler.require` consistent between locked and unlocked loads

## 0.9.17 (April 7, 2010)

Features:

  - Bundler.require now calls Bundler.setup automatically
  - Gem::Specification#add_bundler_dependencies added for gemspecs

Bugfixes:

  - Gem paths are not longer duplicated while loading bundler
  - exec no longer duplicates RUBYOPT if it is already set correctly

## 0.9.16 (April 3, 2010)

Features:

  - exit gracefully on INT signal
  - resolver output now indicates whether remote sources were checked
  - print error instead of backtrace when exec cannot find a binary (#241)

Bugfixes:

  - show, check, and open commands work again while locked (oops)
  - show command for git gems
    - outputs branch names other than master
    - gets the correct sha from the checkout
    - doesn't print sha twice if :ref is set
  - report errors from bundler/setup.rb without backtraces (#243)
  - fix Gem::Spec#git_version to not error on unloaded specs
  - improve deprecation, Gemfile, and command error messages (#242)

## 0.9.15 (April 1, 2010)

Features:

  - use the env_file if possible instead of doing a runtime resolve
     - huge speedup when calling Bundler.setup while locked
     - ensures bundle exec is fast while locked
     - regenerates env_file if it was generated by an older version
  - update cached/packed gems when you update gems via bundle install

Bugfixes:

  - prep for Rubygems 1.3.7 changes
  - install command now pulls git branches correctly (#211)
  - raise errors on invalid options in the Gemfile

## 0.9.14 (March 30, 2010)

Features:

  - install command output vastly improved
    - installation message now accurate, with 'using' and 'installing'
    - bundler gems no longer listed as 'system gems'
  - show command output now includes sha and branch name for git gems
  - init command now takes --gemspec option for bootstrapping gem Gemfiles
  - Bundler.with_clean_env for shelling out to ruby scripts
  - show command now aliased as 'list'
  - VISUAL env var respected for GUI editors

Bugfixes:

  - exec command now finds binaries from gems with no gemspec
  - note source of Gemfile resolver errors
  - don't blow up if git urls are changed

## 0.9.13 (March 23, 2010)

Bugfixes:

  - exec command now finds binaries from gems installed via :path
  - gem dependencies are pulled in even if their type is nil
  - paths with spaces have double-quotes to work on Windows
  - set GEM_PATH in environment.rb so generators work with Rails 2

## 0.9.12 (March 17, 2010)

  - refactoring, internal cleanup, more solid specs

Features:

  - check command takes a --without option
  - check command exits 1 if the check fails

Bugfixes:

  - perform a topological sort on resolved gems (#191)
  - gems from git work even when paths or repos have spaces (#196)
  - Specification#loaded_from returns a String, like Gem::Specification (#197)
  - specs eval from inside the gem directory, even when locked
  - virtual gemspecs are now saved in environment.rb for use when loading
  - unify the Installer's local index and the runtime index (#204)

## 0.9.11 (March 9, 2010)

  - added roadmap with future development plans

Features:

  - install command can take the path to the gemfile with --gemfile (#125)
  - unknown command line options are now rejected (#163)
  - exec command hugely sped up while locked (#177)
  - show command prints the install path if you pass it a gem name (#148)
  - open command edits an installed gem with $EDITOR (#148)
  - Gemfile allows assigning an array of groups to a gem (#114)
  - Gemfile allows :tag option on :git sources
  - improve backtraces when a gemspec is invalid
  - improve performance by installing gems from the cache if present

Bugfixes:

  - normalize parameters to Bundler.require (#153)
  - check now checks installed gems rather than cached gems (#162)
  - don't update the gem index when installing after locking (#169)
  - bundle parenthesises arguments for 1.8.6 (#179)
  - gems can now be assigned to multiple groups without problems (#135)
  - fix the warning when building extensions for a gem from git with Rubygems 1.3.6
  - fix a Dependency.to_yaml error due to accidentally including sources and groups
  - don't reinstall packed gems
  - fix gems with git sources that are private repositories

## 0.9.10 (March 1, 2010)

  - depends on Rubygems 1.3.6

Bugfixes:

  - support locking after install --without
  - don't reinstall gems from the cache if they're already in the bundle
  - fixes for Ruby 1.8.7 and 1.9

## 0.9.9 (February 25, 2010)

Bugfixes:

  - don't die if GEM_HOME is an empty string
  - fixes for Ruby 1.8.6 and 1.9

## 0.9.8 (February 23, 2010)

Features:

  - pack command which both caches and locks
  - descriptive error if a cached gem is missing
  - remember the --without option after installing
  - expand paths given in the Gemfile via the :path option
  - add block syntax to the git and group options in the Gemfile
  - support gems with extensions that don't admit they depend on rake
  - generate gems using gem build gemspec so git gems can have native extensions
  - print a useful warning if building a gem fails
  - allow manual configuration via BUNDLE_PATH

Bugfixes:

  - eval gemspecs in the gem directory so relative paths work
  - make default spec for git sources valid
  - don't reinstall gems that are already packed

## 0.9.7 (February 17, 2010)

Bugfixes:

  - don't say that a gem from an excluded group is "installing"
  - improve crippling rubygems in locked scenarios

## 0.9.6 (February 16, 2010)

Features:

  - allow String group names
  - a number of improvements in the documentation and error messages

Bugfixes:

  - set SourceIndex#spec_dirs to solve a problem involving Rails 2.3 in unlocked mode
  - ensure Rubygems is fully loaded in Ruby 1.9 before patching it
  - fix `bundle install` for a locked app without a .bundle directory
  - require gems in the order that the resolver determines
  - make the tests platform agnostic so we can confirm that they're green on JRuby
  - fixes for Ruby 1.9

## 0.9.5 (Feburary 12, 2010)

Features:

  - added support for :path => "relative/path"
  - added support for older versions of git
  - added `bundle install --disable-shared-gems`
  - Bundler.require fails silently if a library does not have a file on the load path with its name
  - Basic support for multiple rubies by namespacing the default bundle path using the version and engine

Bugfixes:

  - if the bundle is locked and .bundle/environment.rb is not present when Bundler.setup is called, generate it
  - same if it's not present with `bundle check`
  - same if it's not present with `bundle install`

### Note: the master branch is currently unstable while 1.0 is in beta.<br>The current stable version of bundler is in the branch named `v0.9`.

## Bundler : A gem to bundle gems

Bundler is a tool that manages gem dependencies for your ruby application. It
takes a gem manifest file and is able to fetch, download, and install the gems
and all child dependencies specified in this manifest. It can manage any update
to the gem manifest file and update the bundle's gems accordingly. It also lets
you run any ruby code in context of the bundle's gem environment.

## Installation and usage

See [gembundler.com](http://gembundler.com) for up-to-date installation and usage instructions

## Gem dependency resolution

One of the most important things that the bundler does is do a
dependency resolution on the full list of gems that you specify, all
at once. This differs from the one-at-a-time dependency resolution that
Rubygems does, which can result in the following problem:

    # On my system:
    #   activesupport 3.0.pre
    #   activesupport 2.3.4
    #   activemerchant 1.4.2
    #   rails 2.3.4
    #
    # activemerchant 1.4.2 depends on activesupport >= 2.3.2

    gem "activemerchant", "1.4.2"
    # results in activating activemerchant, as well as
    # activesupport 3.0.pre, since it is >= 2.3.2

    gem "rails", "2.3.4"
    # results in:
    #   can't activate activesupport (= 2.3.4, runtime)
    #   for ["rails-2.3.4"], already activated
    #   activesupport-3.0.pre for ["activemerchant-1.4.2"]

This is because activemerchant has a broader dependency, which results
in the activation of a version of activesupport that does not satisfy
a more narrow dependency.

Bundler solves this problem by evaluating all dependencies at once,
so it can detect that all gems *together* require activesupport "2.3.4".

## Upgrading from Bundler 0.8 to 0.9 and above

Upgrading to Bundler 0.9 from Bundler 0.8 requires upgrading several
API calls in your Gemfile, and some workarounds if you are using Rails 2.3.

### Gemfile Removals

Bundler 0.9 removes the following Bundler 0.8 Gemfile APIs:

1. `disable_system_gems`: This is now the default (and only) option
   for bundler. Bundler uses the system gems you have specified
   in the Gemfile, and only the system gems you have specified
   (and their dependencies)
2. `disable_rubygems`: This is no longer supported. We are looking
   into ways to get the fastest performance out of each supported
   scenario, and we will make speed the default where possible.
3. `clear_sources`: Bundler now defaults to an empty source
   list. If you want to include Rubygems, you can add the source
   via source "http://gemcutter.org". If you use bundle init, this
   source will be automatically added for you in the generated
   Gemfile
4. `bundle_path`: You can specify this setting when installing
   via `bundle install /path/to/bundle`. Bundler will remember
   where you installed the dependencies to on a particular
   machine for future installs, loads, setups, etc.
5. `bin_path`: Bundler no longer generates binaries in the root
   of your app. You should use `bundle exec` to execute binaries
   in the current context.

### Gemfile Changes

Bundler 0.9 changes the following Bundler 0.8 Gemfile APIs:

1. Bundler 0.8 supported :only and :except as APIs for describing
   groups of gems. Bundler 0.9 supports a single `group` method,
   which you can use to group gems together. See the above "Group"
   section for more information.

   This means that `gem "foo", :only => :production` becomes
   `gem "foo", :group => :production`, and
   `only :production { gem "foo" }` becomes
   `group :production { gem "foo" }`

   The short version is: group your gems together logically, and
   use the available commands to make use of the groups you've
   created.

2. `:require_as` becomes `:require`

3. `:vendored_at` is fully removed; you should use `:path`

### API Changes

1. `Bundler.require_env(:environment)` becomes
   `Bundler.require(:multiple, :groups)`. You must
   now specify the default group (the default group is the
   group made up of the gems not assigned to any group)
   explicitly. So `Bundler.require_env(:test)` becomes
   `Bundler.require(:default, :test)`

2. `require 'vendor/gems/environment'`: In unlocked
   mode, where using system gems, this becomes
   `Bundler.setup(:multiple, :groups)`. If you don't
   specify any groups, this puts all groups on the load
   path. In locked, mode, it becomes `require '.bundle/environment'`

## More information

### Development

For information about future plans and changes that will happen between now and bundler 1.0, see the [ROADMAP](http://github.com/carlhuda/bundler/blob/master/ROADMAP.md). To see what has changed in each version of bundler, starting with 0.9.5, see the [CHANGELOG](http://github.com/carlhuda/bundler/blob/master/CHANGELOG.md).

### Deploying to memory-constrained servers

When deploying to a server that is memory-constrained, like Dreamhost, you should run `bundle package` on your local development machine, and then check in the resulting `Gemfile.lock` file and `vendor/cache` directory. The lockfile and cached gems will mean bundler can just install the gems immediately, without contacting any gem servers or using a lot of memory to resolve the dependency tree. On the server, you only need to run `bundle install` after you update your deployed code.

### Other questions

Any remaining questions may be asked via IRC in [#bundler](irc://irc.freenode.net/bundler) on Freenode, or via email on the [Bundler mailing list](http://groups.google.com/group/ruby-bundler).

## Reporting bugs

Before reporting a bug, try these troubleshooting steps:

    rm -rf ~/.bundle/ ~/.gem/ .bundle/ Gemfile.lock
    bundle install

If you are still having problems, please report bugs to the github issue tracker for the project, located at [http://github.com/carlhuda/bundler/issues/](http://github.com/carlhuda/bundler/issues/).

The best possible scenario is a ticket with a fix for the bug and a test for the fix. If that's not possible, instructions to reproduce the issue are vitally important. If you're not sure exactly how to reproduce the issue that you are seeing, create a gist of the following information and include it in your ticket:

  - What version of bundler you are using
  - What version of Ruby you are using
  - Whether you are using RVM, and if so what version
  - Your Gemfile
  - Your Gemfile.lock
  - If you are on 0.9, whether you have locked or not
  - If you are on 1.0, the result of `bundle config`
  - The command you ran to generate exception(s)
  - The exception backtrace(s)

If you are using Rails 2.3, please also include:

  - Your boot.rb file
  - Your preinitializer.rb file
  - Your environment.rb file

# 1.0

  - No breaking changes to the Gemfile are expected
  - We expect to modify the format of Gemfile.lock.
    - This should be the final change
    - This means you will not be able to upgrade a locked app
      directly from 0.9 to 1.0.
  - Bundler will automatically generate Gemfile.lock when any
    resolve is successful.
    - This means the bundle lock command will no longer be needed.
  - Bundler will conservatively update Gemfile.lock from the
    last successful resolve if the Gemfile has been modified since
    the last use of bundler.
    - This means that adding a new gem to the Gemfile that does not
      conflict with existing gems will not force an update of other
      gems.
    - This also means that we will not force an update to previously
      resolved dependencies as long as they are compatible with some
      valid version of the new dependency.
    - When removing a gem, bundle install will simply remove it, without
      recalculating all dependencies.
  - We will be adding `bundle update` for the case where you -do-
    wish to re-resolve all dependencies and update everything to the
    latest version.
    - bundle update will also take a gem name, if you want to force
      an update to just a single gem (and its dependencies).
  - There will be a way to install dependencies that require build options
  - We will add groups that are opt-in at install-time, rather than opt-out.
  - We will reduce open bug count to 0 for the final 1.0 release.
  - Some additional features that require more thought. For details,
    see http://github.com/carlhuda/bundler/issues/labels/1.0

# 1.1

  - Stop upgrading 0.9 lockfiles
  - Delete vestigial gems installed into ~/.bundle/ by 0.9
## Bundler TODO list

  - Cache Git repositories
  - Build options
  - A gem shit list
  - Interactive mode for bundle (install) to work out conflicts
  - bundle irb / bundle ruby / bundle [whatever] -> bundle exec
  - Generate a bundle stub into the application
  - bundle install --production
    - (recommend symlinking vendor/bundle to a shared location for perf)
    - defaults to bundle install vendor/bundle --disable-shared-gems
    - if vendor/cache exists, defaults to --local
    - disallow modifications to Gemfile.lock

<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: README.txt</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>README.txt</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>README.txt
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jun 27 16:10:14 +0900 2010</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>README</h1>
<table>
<tr><td valign="top">release:</td><td>2.6.6

</td></tr>
<tr><td valign="top">copyright:</td><td>copyright(c) 2006-2010 kuwata-lab.com all rights reserved.

</td></tr>
</table>
<h2>About <a href="../classes/Erubis.html">Erubis</a></h2>
<p>
<a href="../classes/Erubis.html">Erubis</a> is an implementation of eRuby.
It has the following features.
</p>
<ul>
<li>Very fast, almost three times faster than <a
href="../classes/ERB.html">ERB</a> and even 10% faster than eruby

</li>
<li>Multi-language support (Ruby/PHP/C/Java/Scheme/Perl/Javascript)

</li>
<li>Auto escaping support

</li>
<li>Auto trimming spaces around &#8217;&lt;% %&gt;&#8217;

</li>
<li>Embedded pattern changeable (default &#8217;&lt;% %&gt;&#8217;)

</li>
<li>Enable to handle Processing Instructions (PI) as embedded pattern (ex.
&#8217;&lt;?rb &#8230; ?&gt;&#8217;)

</li>
<li>Context object available and easy to combine eRuby template with YAML
datafile

</li>
<li>Print statement available

</li>
<li>Easy to extend and customize in subclass

</li>
<li>Ruby on Rails support

</li>
</ul>
<p>
<a href="../classes/Erubis.html">Erubis</a> is implemented in pure Ruby. It
requires Ruby 1.8 or higher. <a href="../classes/Erubis.html">Erubis</a>
now supports Ruby 1.9.
</p>
<p>
See doc/users-guide.html for details.
</p>
<h2>Installation</h2>
<ul>
<li>If you have installed RubyGems, just type <tt>gem install erubis</tt>.

<pre>
  $ sudo gem install erubis
</pre>
</li>
<li>Else install <a href="http://rubyforge.org/projects/abstract/">abstract</a>
at first, and download erubis_X.X.X.tar.bz2 and install it by setup.rb.

<pre>
  $ tar xjf abstract_X.X.X.tar.bz2
  $ cd abstract_X.X.X/
  $ sudo ruby setup.rb
  $ cd ..
  $ tar xjf erubis_X.X.X.tar.bz2
  $ cd erubis_X.X.X/
  $ sudo ruby setup.rb
</pre>
</li>
<li>(Optional) It is able to merge &#8216;lib/**/*.rb&#8217; into
&#8216;bin/erubis&#8217; by &#8216;contrib/inline-require&#8217; script.

<pre>
  $ tar xjf erubis_X.X.X.tar.bz2
  $ cd erubis_X.X.X/
  $ cp /tmp/abstract_X.X.X/lib/abstract.rb lib
  $ unset RUBYLIB
  $ contrib/inline-require -I lib bin/erubis &gt; contrib/erubis
</pre>
</li>
</ul>
<h2>Ruby on Rails Support</h2>
<p>
<a href="../classes/Erubis.html">Erubis</a> supports Ruby on Rails. All you
have to do is to add the following code into your
&#8216;config/environment.rb&#8217; and restart web server.
</p>
<pre>
     require 'erubis/helpers/rails_helper'
     #Erubis::Helpers::RailsHelper.engine_class = Erubis::Eruby
     #Erubis::Helpers::RailsHelper.init_properties = {}
     #Erubis::Helpers::RailsHelper.show_src = nil
</pre>
<p>
If Erubis::Helpers::RailsHelper.show_src is ture, <a
href="../classes/Erubis.html">Erubis</a> prints converted Ruby code into
log file (&#8216;log/development.log&#8217; or so). It is useful for debug.
</p>
<h2>Exploring Guide</h2>
<p>
If you are exploring Eruby, see the following class at first.
</p>
<ul>
<li><a href="../classes/Erubis/TinyEruby.html">Erubis::TinyEruby</a>
(erubis/tiny.rb) &#8212; the most simple eRuby implementation.

</li>
<li><a href="../classes/Erubis/Engine.html">Erubis::Engine</a>
(erubis/engine.rb) &#8212; base class of Eruby, Ephp, Ejava, and so on.

</li>
<li><a href="../classes/Erubis/Eruby.html">Erubis::Eruby</a>
(erubis/engine/eruby.rb) &#8212; engine class for eRuby.

</li>
<li><a href="../classes/Erubis/Converter.html">Erubis::Converter</a>
(erubis/converter.rb) &#8212; convert eRuby script into Ruby code.

</li>
</ul>
<h2>Benchmark</h2>
<p>
&#8216;benchmark/erubybenchmark.rb&#8217; is a benchmark script of <a
href="../classes/Erubis.html">Erubis</a>. Try &#8216;ruby
erubybenchmark.rb&#8217; in benchmark directory.
</p>
<h2>License</h2>
<p>
MIT License
</p>
<h2>Author</h2>
<p>
makoto kuwata &lt;kwa(at)kuwata-lab.com&gt;
</p>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>
= README

release::	2.6.6
copyright::	copyright(c) 2006-2010 kuwata-lab.com all rights reserved.



== About Erubis

Erubis is an implementation of eRuby. It has the following features.
* Very fast, almost three times faster than ERB and even 10% faster than eruby
* Multi-language support (Ruby/PHP/C/Java/Scheme/Perl/Javascript)
* Auto escaping support
* Auto trimming spaces around '<% %>'
* Embedded pattern changeable (default '<% %>')
* Enable to handle Processing Instructions (PI) as embedded pattern (ex. '<?rb ... ?>')
* Context object available and easy to combine eRuby template with YAML datafile
* Print statement available
* Easy to extend and customize in subclass
* Ruby on Rails support

Erubis is implemented in pure Ruby.  It requires Ruby 1.8 or higher.
Erubis now supports Ruby 1.9.

See doc/users-guide.html for details.



== Installation

* If you have installed RubyGems, just type <tt>gem install erubis</tt>.

    $ sudo gem install erubis

* Else install abstract[http://rubyforge.org/projects/abstract/] at first,
  and download erubis_X.X.X.tar.bz2 and install it by setup.rb.

    $ tar xjf abstract_X.X.X.tar.bz2
    $ cd abstract_X.X.X/
    $ sudo ruby setup.rb
    $ cd ..
    $ tar xjf erubis_X.X.X.tar.bz2
    $ cd erubis_X.X.X/
    $ sudo ruby setup.rb

* (Optional) It is able to merge 'lib/**/*.rb' into 'bin/erubis' by
  'contrib/inline-require' script.

    $ tar xjf erubis_X.X.X.tar.bz2
    $ cd erubis_X.X.X/
    $ cp /tmp/abstract_X.X.X/lib/abstract.rb lib
    $ unset RUBYLIB
    $ contrib/inline-require -I lib bin/erubis > contrib/erubis



== Ruby on Rails Support

Erubis supports Ruby on Rails.
All you have to do is to add the following code into your 'config/environment.rb'
and restart web server.

     require 'erubis/helpers/rails_helper'
     #Erubis::Helpers::RailsHelper.engine_class = Erubis::Eruby
     #Erubis::Helpers::RailsHelper.init_properties = {}
     #Erubis::Helpers::RailsHelper.show_src = nil

If Erubis::Helpers::RailsHelper.show_src is ture, Erubis prints converted Ruby code
into log file ('log/development.log' or so).  It is useful for debug.



== Exploring Guide

If you are exploring Eruby, see the following class at first.
* Erubis::TinyEruby (erubis/tiny.rb) --
  the most simple eRuby implementation.
* Erubis::Engine (erubis/engine.rb) --
  base class of Eruby, Ephp, Ejava, and so on.
* Erubis::Eruby (erubis/engine/eruby.rb) --
  engine class for eRuby.
* Erubis::Converter (erubis/converter.rb) --
  convert eRuby script into Ruby code.



== Benchmark

'benchmark/erubybenchmark.rb' is a benchmark script of Erubis.
Try 'ruby erubybenchmark.rb' in benchmark directory.



== License

MIT License



== Author

makoto kuwata <kwa(at)kuwata-lab.com>

#!/usr/bin/env ruby

#---
# Copyright 2003, 2004, 2005, 2006, 2007 by Jim Weirich (jim@weirichhouse.org).
# All rights reserved.

# Permission is granted for use, copying, modification, distribution,
# and distribution of modified versions of this work as long as the
# above copyright notice is included.
#+++

require 'test/unit'
require 'flexmock'

class TemperatureSampler
  def initialize(sensor)
    @sensor = sensor
  end

  def average_temp
    total = (0...3).collect { @sensor.read_temperature }.inject { |i, s| i + s }
    total / 3.0
  end
end

class TestTemperatureSampler < Test::Unit::TestCase
  include FlexMock::TestCase

  def test_tempurature_sampler
    readings = [10, 12, 14]
    mock_sensor = flexmock("sensor")
    mock_sensor.should_receive(:read_temperature).and_return { readings.shift }
    sampler = TemperatureSampler.new(mock_sensor)
    assert_equal 12, sampler.average_temp
  end
end

class TestExamplesFromReadme < Test::Unit::TestCase
  include FlexMock::TestCase

  def test_simple_return_values
    m = flexmock(:pi => 3.1416, :e => 2.71)
    assert_equal 3.1416, m.pi
    assert_equal 2.71, m.e
  end

  def test_returning_an_undefined_value
    m = flexmock("mock")
    m.should_receive(:foo).and_return_undefined
    m.foo.bar.baz
  end
  
  def test_db
    db = flexmock('db')
    db.should_receive(:query).and_return([1,2,3])
    db.should_receive(:update).with(5).and_return(nil).once
    # test code here
    assert_equal [1, 2, 3], db.query
    db.update(5)
  end

  def test_query_and_update
    db = flexmock('db')
    db.should_receive(:query).and_return([1,2,3]).ordered
    db.should_receive(:update).and_return(nil).ordered
    # test code here
    assert_equal [1,2,3], db.query
    assert_nil db.update
  end

  def test_ordered_queries
    db = flexmock('db')
    db.should_receive(:startup).once.ordered
    db.should_receive(:query).with("GOOG").and_return(12.3).
      once.ordered(:queries)
    db.should_receive(:query).with("APPL").and_return(10.0).
      once.ordered(:queries)
    db.should_receive(:query).with(/^....$/).and_return(3.3).
      at_least.once.ordered(:queries)
    db.should_receive(:finish).once.ordered
    # test code here
    db.startup
    assert_equal 3.3,  db.query("WXYZ")
    assert_equal 10.0, db.query("APPL")
    assert_equal 12.3, db.query("GOOG")
    db.finish
  end
  
  def test_ordered_queries_in_record_mode
    db = flexmock('db')
    db.should_expect do |rec|
      rec.startup.once.ordered
      rec.query("GOOG") { 12.3 }.once.ordered(:queries)
      rec.query("APPL") { 10.0 }.once.ordered(:queries)
      rec.query(/^....$/) { 3.3 }.at_least.once.ordered(:queries)
      rec.finish.once.ordered
    end
    # test code here using +db+.
    db.startup
    assert_equal 10.0, db.query("APPL")
    assert_equal 12.3, db.query("GOOG")
    assert_equal 3.3,  db.query("WXYZ")
    db.finish
  end

  def test_build_xml
    builder = flexmock('builder')
    builder.should_expect do |rec|
      rec.should_be_strict
      known_good_way_to_build_xml(rec)  # record the messages
    end
    new_way_to_build_xml(builder)       # compare to new way
  end

  def known_good_way_to_build_xml(rec)
    rec.one
    rec.two
  end

  def new_way_to_build_xml(rec)
    [:one, :two].each do |sym| rec.send(sym) end
  end

  def test_multiple_gets
    file = flexmock('file')
    file.should_receive(:gets).with_no_args.
      and_return("line 1\n", "line 2\n")
    # test code here
    assert_equal "line 1\n", file.gets
    assert_equal "line 2\n", file.gets
  end

  def test_an_important_message
    m = flexmock('m')
    m.should_receive(:an_important_message).and_return(1).once
    m.should_ignore_missing
    # test code here
    m.an_important_message
    m.unknown_message.bar.baz
  end

  class QuoteService
  end
  class Portfolio
    def value
      QuoteService.new.quote
    end
  end
  
  def test_portfolio_value
    flexmock(QuoteService).new_instances do |m|
      m.should_receive(:quote).and_return(100)
    end
    port = Portfolio.new
    value = port.value     # Portfolio calls QuoteService.quote
    assert_equal 100, value
  end
end

h1. Ruby I18n

Ruby Internationalization and localization solution.

Features:

* translation and localization
* interpolation of values to translations (Ruby 1.9 compatible syntax)
* pluralization (CLDR compatible)
* customizable transliteration to ASCII
* flexible defaults
* bulk lookup
* lambdas as translation data
* custom key/scope separator
* custom exception handlers
* extensible architecture with a swappable backend

Pluggable features:

* Cache
* Pluralization: lambda pluralizers stored as translation data
* Locale fallbacks, RFC4647 compliant (optionally: RFC4646 locale validation)
* Gettext support
* Translation metadata

Alternative backends:

* Chain
* ActiveRecord (optionally: ActiveRecord::Missing and ActiveRecord::StoreProcs)
* KeyValue (uses active_support/json and cannot store procs)

For more information and lots of resources see: "http://rails-i18n.org/wiki":http://rails-i18n.org/wiki

h2. Installation

gem install i18n

h3. Installation on Rails < 2.3.5 (deprecated)

Up to version 2.3.4 Rails will not accept i18n gems > 0.1.3. There is an unpacked
gem inside of active_support/lib/vendor which gets loaded unless gem 'i18n', '~> 0.1.3'.
This requirement is relaxed in "6da03653":http://github.com/rails/rails/commit/6da03653

The new i18n gem can be loaded from vendor/plugins like this:

  def reload_i18n!
    raise "Move to i18n version 0.2.0 or greater" if Rails.version > "2.3.4"

    $:.grep(/i18n/).each { |path| $:.delete(path) }
    I18n::Backend.send :remove_const, "Simple"
    $: << Rails.root.join('vendor', 'plugins', 'i18n', 'lib').to_s
  end

Then you can `reload_i18n!` inside an i18n initializer.

h2. Tests

You can run tests both with

* `rake test` or just `rake`
* run any test file directly, e.g. `ruby test/api/simple_test.rb`
* run all tests with `ruby test/all.rb`

The structure of the test suite is a bit unusual as it uses modules to reuse
particular tests in different test cases.

The reason for this is that we need to enforce the I18n API across various
combinations of extensions. E.g. the Simple backend alone needs to support
the same API as any combination of feature and/or optimization modules included
to the Simple backend. We test this by reusing the same API defition (implemented
as test methods) in test cases with different setups.

You can find the test cases that enforce the API in test/api. And you can find
the API definition test methods in test/api/tests.

All other test cases (e.g. as defined in test/backend, test/core\_ext) etc.
follow the usual test setup and should be easy to grok.

h2. Authors

* "Sven Fuchs":http://www.artweb-design.de
* "Joshua Harvey":http://www.workingwithrails.com/person/759-joshua-harvey
* "Stephan Soller":http://www.arkanis-development.de
* "Saimon Moore":http://saimonmoore.net
* "Matt Aimonetti":http://railsontherun.com

h2. Contributors

http://github.com/svenfuchs/i18n/contributors

h2. License

MIT License. See the included MIT-LICENSE file.

# encoding: utf-8
# 
# 
# 
module Mail
  class ContentDescriptionField < UnstructuredField
    
    FIELD_NAME = 'content-description'
    CAPITALIZED_FIELD = 'Content-Description'
    
    def initialize(value = nil, charset = 'utf-8')
      self.charset = charset
      super(CAPITALIZED_FIELD, strip_field(FIELD_NAME, value), charset)
      self.parse
      self
    end
    
  end
end

!RBIX
0
x
M
1
n
n
x
10
__script__
i
28
99
7
0
65
49
1
2
13
99
12
7
2
12
7
3
12
65
12
49
4
4
15
49
2
0
15
2
11
I
6
I
0
I
0
I
0
n
p
5
x
4
Mail
x
11
open_module
x
15
__module_init__
M
1
n
n
x
4
Mail
i
31
5
66
99
7
0
45
1
2
65
49
3
3
13
99
12
7
4
12
7
5
12
65
12
49
6
4
15
49
4
0
11
I
6
I
0
I
0
I
0
n
p
7
x
23
ContentDescriptionField
x
17
UnstructuredField
n
x
10
open_class
x
14
__class_init__
M
1
n
n
x
23
ContentDescriptionField
i
36
5
66
65
7
0
7
1
64
49
2
2
15
65
7
3
7
4
64
49
2
2
15
99
7
5
7
6
65
67
49
7
0
49
8
4
11
I
5
I
0
I
0
I
0
n
p
9
x
10
FIELD_NAME
s
19
content-description
x
9
const_set
x
17
CAPITALIZED_FIELD
s
19
Content-Description
x
10
initialize
M
1
n
n
x
10
initialize
i
57
23
0
10
8
1
19
0
15
23
1
10
18
7
0
64
19
1
15
5
20
1
13
18
2
47
49
1
1
15
15
45
2
3
5
45
4
5
20
0
47
49
6
2
20
1
54
52
7
3
15
5
49
8
0
15
5
11
I
6
I
2
I
0
I
2
n
p
9
s
5
utf-8
x
8
charset=
x
17
CAPITALIZED_FIELD
n
x
10
FIELD_NAME
n
x
11
strip_field
x
10
initialize
x
5
parse
p
13
I
0
I
b
I
12
I
13
I
13
I
c
I
1e
I
d
I
32
I
e
I
37
I
f
I
39
x
76
/Users/mikel/ruby_programs/mail/lib/mail/fields/content_description_field.rb
p
2
x
5
value
x
7
charset
x
17
method_visibility
x
15
add_defn_method
p
7
I
2
I
8
I
c
I
9
I
16
I
b
I
24
x
76
/Users/mikel/ruby_programs/mail/lib/mail/fields/content_description_field.rb
p
0
x
13
attach_method
p
3
I
2
I
6
I
1f
x
76
/Users/mikel/ruby_programs/mail/lib/mail/fields/content_description_field.rb
p
0
x
13
attach_method
p
3
I
0
I
5
I
1c
x
76
/Users/mikel/ruby_programs/mail/lib/mail/fields/content_description_field.rb
p
0

= README: Mime::Types for Ruby
This library allows for the identification of a file's likely MIME content
type. This is release 1.16. The identification of MIME content type is based
on a file's filename extensions.

MIME::Types for Ruby originally based on and synchronized with MIME::Types
for Perl by Mark Overmeer, copyright 2001 - 2009. As of version 1.15, the
data format for the MIME::Type list has changed and the synchronization will
no longer happen.

Homepage::  http://mime-types.rubyforge.org/
Copyright:: 2002 - 2009, Austin Ziegler
            Based in part on prior work copyright Mark Overmeer

== Licensing
MIME::Types is available under three disjunctive licences, as detailed in the
Licence.txt file.

== Copyright
  MIME::Types
  A Ruby implementation of a MIME Types information library. Based in spirit
  on the Perl MIME::Types information library by Mark Overmeer.
  http://rubyforge.org/projects/mime-types/

  Licensed under the Ruby disjunctive licence with the GNU GPL or the Perl
  Artistic licence. See Licence.txt for more information.

  Copyright 2003 - 2009 Austin Ziegler

= Mocha

Mocha is a library for mocking and stubbing using a syntax like that of JMock[http://www.jmock.org].

It can be used with many testing frameworks e.g. Test::Unit[http://www.ruby-doc.org/core/classes/Test/Unit.html], RSpec[http://rspec.info/], test/spec[http://chneukirchen.org/repos/testspec/README], expectations[http://expectations.rubyforge.org/], Dust[http://dust.rubyforge.org/], MiniTest[http://rubyforge.org/projects/bfts] and even JtestR[http://jtestr.codehaus.org/].

Mocha provides a unified, simple and readable syntax for both traditional mocking and partial mocking.

Mocha was harvested from projects at Reevoo[http://www.reevoo.com] by me (James[http://blog.floehopper.org]) and my (then) colleagues Ben[http://www.techbelly.com/], Chris[http://chrisroos.co.uk] and Paul[http://po-ru.com].

== Download and Installation

Install the gem with the following command...

  $ gem install mocha

Or install the Rails[http://www.rubyonrails.org] plugin...

  $ script/plugin install git://github.com/floehopper/mocha.git

Note that versions 0.9.6 & 0.9.7 of the Rails plugin were broken. As of version 0.9.8, you need to explicitly load Mocha after the test framework e.g. by adding "require 'mocha'" at the bottom of test/test_helper.rb.

Or download Mocha...

  http://rubyforge.org/frs/?group_id=1917

== Examples

* Quick Start - {Usage Examples}[link:examples/misc.html]
* Traditional mocking - {Star Trek Example}[link:examples/mocha.html]
* Setting expectations on real classes - {Order Example}[link:examples/stubba.html]
* More examples on {Floehopper's Blog}[http://blog.floehopper.org]
* {Mailing List Archives}[http://groups.google.com/group/mocha-developer]

== License

Copyright Revieworld Ltd. 2006

You may use, copy and redistribute this library under the same terms as {Ruby itself}[http://www.ruby-lang.org/en/LICENSE.txt] or under the {MIT license}[http://mocha.rubyforge.org/files/MIT-LICENSE.html].
= polyglot

* http://polyglot.rubyforge.org

== DESCRIPTION:

Author:	    Clifford Heath, 2007

The Polyglot library allows a Ruby module to register a loader
for the file type associated with a filename extension, and it
augments 'require' to find and load matching files.

This supports the creation of DSLs having a syntax that is most
appropriate to their purpose, instead of abusing the Ruby syntax.

Files are sought using the normal Ruby search path.

== EXAMPLE:

In file rubyglot.rb, define and register a file type handler:

    require 'polyglot'

    class RubyglotLoader
      def self.load(filename, options = nil, &block)
	File.open(filename) {|file|
	  # Load the contents of file as Ruby code:
	  # Implement your parser here instead!
	  Kernel.eval(file.read)
	}
      end
    end

    Polyglot.register("rgl", RubyglotLoader)

In file test.rb:

    require 'rubyglot'	# Create my file type handler
    require 'hello'	# Can add extra options or even a block here
    puts "Ready to go"
    Hello.new

In file hello.rgl (this simple example uses Ruby code):

    puts "Initializing"
    class Hello
      def initialize()
	puts "Hello, world\n"
      end
    end

Run:

    $ ruby test.rb
    Initializing
    Ready to go
    Hello, world
    $

== INSTALL:

sudo gem install polyglot

== LICENSE:

(The MIT License)

Copyright (c) 2007 Clifford Heath

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

= Rack, a modular Ruby webserver interface

Rack provides a minimal, modular and adaptable interface for developing
web applications in Ruby.  By wrapping HTTP requests and responses in
the simplest way possible, it unifies and distills the API for web
servers, web frameworks, and software in between (the so-called
middleware) into a single method call.

The exact details of this are described in the Rack specification,
which all Rack applications should conform to.

== Supported web servers

The included *handlers* connect all kinds of web servers to Rack:
* Mongrel
* EventedMongrel
* SwiftipliedMongrel
* WEBrick
* FCGI
* CGI
* SCGI
* LiteSpeed
* Thin

These web servers include Rack handlers in their distributions:
* Ebb
* Fuzed
* Glassfish v3
* Phusion Passenger (which is mod_rack for Apache and for nginx)
* Rainbows!
* Unicorn
* Zbatery

Any valid Rack app will run the same on all these handlers, without
changing anything.

== Supported web frameworks

These frameworks include Rack adapters in their distributions:
* Camping
* Coset
* Halcyon
* Mack
* Maveric
* Merb
* Racktools::SimpleApplication
* Ramaze
* Ruby on Rails
* Rum
* Sinatra
* Sin
* Vintage
* Waves
* Wee
* ... and many others.

Current links to these projects can be found at
http://wiki.ramaze.net/Home#other-frameworks

== Available middleware

Between the server and the framework, Rack can be customized to your
applications needs using middleware, for example:
* Rack::URLMap, to route to multiple applications inside the same process.
* Rack::CommonLogger, for creating Apache-style logfiles.
* Rack::ShowException, for catching unhandled exceptions and
  presenting them in a nice and helpful way with clickable backtrace.
* Rack::File, for serving static files.
* ...many others!

All these components use the same interface, which is described in
detail in the Rack specification.  These optional components can be
used in any way you wish.

== Convenience

If you want to develop outside of existing frameworks, implement your
own ones, or develop middleware, Rack provides many helpers to create
Rack applications quickly and without doing the same web stuff all
over:
* Rack::Request, which also provides query string parsing and
  multipart handling.
* Rack::Response, for convenient generation of HTTP replies and
  cookie handling.
* Rack::MockRequest and Rack::MockResponse for efficient and quick
  testing of Rack application without real HTTP round-trips.

== rack-contrib

The plethora of useful middleware created the need for a project that
collects fresh Rack middleware.  rack-contrib includes a variety of
add-on components for Rack and it is easy to contribute new modules.

* http://github.com/rack/rack-contrib

== rackup

rackup is a useful tool for running Rack applications, which uses the
Rack::Builder DSL to configure middleware and build up applications
easily.

rackup automatically figures out the environment it is run in, and
runs your application as FastCGI, CGI, or standalone with Mongrel or
WEBrick---all from the same configuration.

== Quick start

Try the lobster!

Either with the embedded WEBrick starter:

    ruby -Ilib lib/rack/lobster.rb

Or with rackup:

    bin/rackup -Ilib example/lobster.ru

By default, the lobster is found at http://localhost:9292.

== Installing with RubyGems

A Gem of Rack is available at gemcutter.org.  You can install it with:

    gem install rack

I also provide a local mirror of the gems (and development snapshots)
at my site:

    gem install rack --source http://chneukirchen.org/releases/gems/

== Running the tests

Testing Rack requires the bacon testing framework:

    gem install bacon

There are two rake-based test tasks:

    rake test       tests all the fast tests (no Handlers or Adapters)
    rake fulltest   runs all the tests

The fast testsuite has no dependencies outside of the core Ruby
installation and bacon.

To run the test suite completely, you need:

  * fcgi
  * memcache-client
  * mongrel
  * thin

The full set of tests test FCGI access with lighttpd (on port
9203) so you will need lighttpd installed as well as the FCGI
libraries and the fcgi gem:

Download and install lighttpd:

    http://www.lighttpd.net/download

Installing the FCGI libraries:

    curl -O http://www.fastcgi.com/dist/fcgi-2.4.0.tar.gz
    tar xzvf fcgi-2.4.0.tar.gz
    cd fcgi-2.4.0
    ./configure --prefix=/usr/local
    make
    sudo make install
    cd ..

Installing the Ruby fcgi gem:

    gem install fcgi

Furthermore, to test Memcache sessions, you need memcached (will be
run on port 11211) and memcache-client installed.

== History

* March 3rd, 2007: First public release 0.1.

* May 16th, 2007: Second public release 0.2.
  * HTTP Basic authentication.
  * Cookie Sessions.
  * Static file handler.
  * Improved Rack::Request.
  * Improved Rack::Response.
  * Added Rack::ShowStatus, for better default error messages.
  * Bug fixes in the Camping adapter.
  * Removed Rails adapter, was too alpha.

* February 26th, 2008: Third public release 0.3.
  * LiteSpeed handler, by Adrian Madrid.
  * SCGI handler, by Jeremy Evans.
  * Pool sessions, by blink.
  * OpenID authentication, by blink.
  * :Port and :File options for opening FastCGI sockets, by blink.
  * Last-Modified HTTP header for Rack::File, by blink.
  * Rack::Builder#use now accepts blocks, by Corey Jewett.
    (See example/protectedlobster.ru)
  * HTTP status 201 can contain a Content-Type and a body now.
  * Many bugfixes, especially related to Cookie handling.

* August 21st, 2008: Fourth public release 0.4.
  * New middleware, Rack::Deflater, by Christoffer Sawicki.
  * OpenID authentication now needs ruby-openid 2.
  * New Memcache sessions, by blink.
  * Explicit EventedMongrel handler, by Joshua Peek <josh@joshpeek.com>
  * Rack::Reloader is not loaded in rackup development mode.
  * rackup can daemonize with -D.
  * Many bugfixes, especially for pool sessions, URLMap, thread safety
    and tempfile handling.
  * Improved tests.
  * Rack moved to Git.

* January 6th, 2009: Fifth public release 0.9.
  * Rack is now managed by the Rack Core Team.
  * Rack::Lint is stricter and follows the HTTP RFCs more closely.
  * Added ConditionalGet middleware.
  * Added ContentLength middleware.
  * Added Deflater middleware.
  * Added Head middleware.
  * Added MethodOverride middleware.
  * Rack::Mime now provides popular MIME-types and their extension.
  * Mongrel Header now streams.
  * Added Thin handler.
  * Official support for swiftiplied Mongrel.
  * Secure cookies.
  * Made HeaderHash case-preserving.
  * Many bugfixes and small improvements.

* January 9th, 2009: Sixth public release 0.9.1.
  * Fix directory traversal exploits in Rack::File and Rack::Directory.

* April 25th, 2009: Seventh public release 1.0.0.
  * SPEC change: Rack::VERSION has been pushed to [1,0].
  * SPEC change: header values must be Strings now, split on "\n".
  * SPEC change: Content-Length can be missing, in this case chunked transfer
    encoding is used.
  * SPEC change: rack.input must be rewindable and support reading into
    a buffer, wrap with Rack::RewindableInput if it isn't.
  * SPEC change: rack.session is now specified.
  * SPEC change: Bodies can now additionally respond to #to_path with
    a filename to be served.
  * NOTE: String bodies break in 1.9, use an Array consisting of a
    single String instead.
  * New middleware Rack::Lock.
  * New middleware Rack::ContentType.
  * Rack::Reloader has been rewritten.
  * Major update to Rack::Auth::OpenID.
  * Support for nested parameter parsing in Rack::Response.
  * Support for redirects in Rack::Response.
  * HttpOnly cookie support in Rack::Response.
  * The Rakefile has been rewritten.
  * Many bugfixes and small improvements.

* October 18th, 2009: Eighth public release 1.0.1.
  * Bump remainder of rack.versions.
  * Support the pure Ruby FCGI implementation.
  * Fix for form names containing "=": split first then unescape components
  * Fixes the handling of the filename parameter with semicolons in names.
  * Add anchor to nested params parsing regexp to prevent stack overflows
  * Use more compatible gzip write api instead of "<<".
  * Make sure that Reloader doesn't break when executed via ruby -e
  * Make sure WEBrick respects the :Host option
  * Many Ruby 1.9 fixes.

* January 3rd, 2010: Ninth public release 1.1.0.
  * Moved Auth::OpenID to rack-contrib.
  * SPEC change that relaxes Lint slightly to allow subclasses of the
    required types
  * SPEC change to document rack.input binary mode in greator detail
  * SPEC define optional rack.logger specification
  * File servers support X-Cascade header
  * Imported Config middleware
  * Imported ETag middleware
  * Imported Runtime middleware
  * Imported Sendfile middleware
  * New Logger and NullLogger middlewares
  * Added mime type for .ogv and .manifest.
  * Don't squeeze PATH_INFO slashes
  * Use Content-Type to determine POST params parsing
  * Update Rack::Utils::HTTP_STATUS_CODES hash
  * Add status code lookup utility
  * Response should call #to_i on the status
  * Add Request#user_agent
  * Request#host knows about forwared host
  * Return an empty string for Request#host if HTTP_HOST and
    SERVER_NAME are both missing
  * Allow MockRequest to accept hash params
  * Optimizations to HeaderHash
  * Refactored rackup into Rack::Server
  * Added Utils.build_nested_query to complement Utils.parse_nested_query
  * Added Utils::Multipart.build_multipart to complement
    Utils::Multipart.parse_multipart
  * Extracted set and delete cookie helpers into Utils so they can be
    used outside Response
  * Extract parse_query and parse_multipart in Request so subclasses
    can change their behavior
  * Enforce binary encoding in RewindableInput
  * Set correct external_encoding for handlers that don't use RewindableInput

* June 13th, 2010: Tenth public release 1.2.0.
  * Removed Camping adapter: Camping 2.0 supports Rack as-is
  * Removed parsing of quoted values
  * Add Request.trace? and Request.options?
  * Add mime-type for .webm and .htc
  * Fix HTTP_X_FORWARDED_FOR
  * Various multipart fixes
  * Switch test suite to bacon

* June 15th, 2010: Eleventh public release 1.2.1.
  * Make CGI handler rewindable
  * Rename spec/ to test/ to not conflict with SPEC on lesser
    operating systems

== Contact

Please post bugs, suggestions and patches to
the bug tracker at <http://github.com/rack/rack/issues>.

Mailing list archives are available at
<http://groups.google.com/group/rack-devel>.

Git repository (send Git patches to the mailing list):
* http://github.com/rack/rack
* http://git.vuxu.org/cgi-bin/gitweb.cgi?p=rack-github.git

You are also welcome to join the #rack channel on irc.freenode.net.

== Thanks

The Rack Core Team, consisting of

* Christian Neukirchen (chneukirchen)
* James Tucker (raggi)
* Josh Peek (josh)
* Michael Fellinger (manveru)
* Ryan Tomayko (rtomayko)
* Scytrin dai Kinthra (scytrin)

would like to thank:

* Adrian Madrid, for the LiteSpeed handler.
* Christoffer Sawicki, for the first Rails adapter and Rack::Deflater.
* Tim Fletcher, for the HTTP authentication code.
* Luc Heinrich for the Cookie sessions, the static file handler and bugfixes.
* Armin Ronacher, for the logo and racktools.
* Alex Beregszaszi, Alexander Kahn, Anil Wadghule, Aredridel, Ben
  Alpert, Dan Kubb, Daniel Roethlisberger, Matt Todd, Tom Robinson,
  Phil Hagelberg, S. Brent Faulkner, Bosko Milekic, Daniel Rodrguez
  Troitio, Genki Takiuchi, Geoffrey Grosenbach, Julien Sanchez, Kamal
  Fariz Mahyuddin, Masayoshi Takahashi, Patrick Aljordm, Mig, Kazuhiro
  Nishiyama, Jon Bardin, Konstantin Haase, Larry Siden, Matias
  Korhonen, Sam Ruby, Simon Chiang, Tim Connor, Timur Batyrshin, and
  Zach Brock for bug fixing and other improvements.
* Eric Wong, Hongli Lai, Jeremy Kemper for their continuous support
  and API improvements.
* Yehuda Katz and Carl Lerche for refactoring rackup.
* Brian Candler, for Rack::ContentType.
* Graham Batty, for improved handler loading.
* Stephen Bannasch, for bug reports and documentation.
* Gary Wright, for proposing a better Rack::Response interface.
* Jonathan Buch, for improvements regarding Rack::Response.
* Armin Rhrl, for tracking down bugs in the Cookie generator.
* Alexander Kellett for testing the Gem and reviewing the announcement.
* Marcus Rckert, for help with configuring and debugging lighttpd.
* The WSGI team for the well-done and documented work they've done and
  Rack builds up on.
* All bug reporters and patch contributers not mentioned above.

== Copyright

Copyright (C) 2007, 2008, 2009, 2010 Christian Neukirchen <http://purl.org/net/chneukirchen>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to
deal in the Software without restriction, including without limitation the
rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

== Links

Rack:: <http://rack.rubyforge.org/>
Rack's Rubyforge project:: <http://rubyforge.org/projects/rack>
Official Rack repositories:: <http://github.com/rack>
Rack Lighthouse Bug Tracking:: <http://rack.lighthouseapp.com/>
rack-devel mailing list:: <http://groups.google.com/group/rack-devel>

Christian Neukirchen:: <http://chneukirchen.org/>


= Rack::Mount

A stackable dynamic tree based Rack router.

Rack::Mount supports Rack's +X-Cascade+ convention to continue trying routes if the response returns +pass+. This allows multiple routes to be nested or stacked on top of each other. Since the application endpoint can trigger the router to continue matching, middleware can be used to add arbitrary conditions to any route. This allows you to route based on other request attributes, session information, or even data dynamically pulled from a database.

=== Usage

Rack::Mount provides a plugin API to build custom DSLs on top of.

The API is extremely minimal and only 3 methods are exposed as the public API.

<tt>Rack::Mount::RouteSet#add_route</tt>:: builder method for adding routes to the set
<tt>Rack::Mount::RouteSet#call</tt>:: Rack compatible recognition and dispatching method
<tt>Rack::Mount::RouteSet#generate</tt>:: generates a route condition from identifiers or significant keys

=== Example

  require 'rack/mount'

  Routes = Rack::Mount::RouteSet.new do |set|
    # add_route takes a rack application and conditions to match with
    #
    # valid conditions methods are any method on Rack::Request
    # the values to match against may be strings or regexps
    #
    # See Rack::Mount::RouteSet#add_route for more options.
    set.add_route FooApp, { :request_method => 'GET', :path_info => %r{^/foo$} }, {}, :foo
  end

  # The route set itself is a simple rack app you mount
  run Routes


  # generate path for route named "foo"
  Routes.generate(:path_info, :foo) #=> "/foo"

Replaced the plain DocBook XSL admonition icons with Jimmac's DocBook
icons (http://jimmac.musichall.cz/ikony.php3). I dropped transparency
from the Jimmac icons to get round MS IE and FOP PNG incompatibilies.

Stuart Rackham

Use this README file to introduce your application and point to useful places in the API for learning more.
Run "rake doc:app" to generate API documentation for your models, controllers, helpers, and libraries.

== Welcome to Rails

Rails is a web-application framework that includes everything needed to create
database-backed web applications according to the Model-View-Control pattern.

This pattern splits the view (also called the presentation) into "dumb"
templates that are primarily responsible for inserting pre-built data in between
HTML tags. The model contains the "smart" domain objects (such as Account,
Product, Person, Post) that holds all the business logic and knows how to
persist themselves to a database. The controller handles the incoming requests
(such as Save New Account, Update Product, Show Post) by manipulating the model
and directing data to the view.

In Rails, the model is handled by what's called an object-relational mapping
layer entitled Active Record. This layer allows you to present the data from
database rows as objects and embellish these data objects with business logic
methods. You can read more about Active Record in
link:files/vendor/rails/activerecord/README.html.

The controller and view are handled by the Action Pack, which handles both
layers by its two parts: Action View and Action Controller. These two layers
are bundled in a single package due to their heavy interdependence. This is
unlike the relationship between the Active Record and Action Pack that is much
more separate. Each of these packages can be used independently outside of
Rails. You can read more about Action Pack in
link:files/vendor/rails/actionpack/README.html.


== Getting Started

1. At the command prompt, create a new Rails application:
       <tt>rails new myapp</tt> (where <tt>myapp</tt> is the application name)

2. Change directory to <tt>myapp</tt> and start the web server:
       <tt>cd myapp; rails server</tt> (run with --help for options)

3. Go to http://localhost:3000/ and you'll see:
       "Welcome aboard: You're riding Ruby on Rails!"

4. Follow the guidelines to start developing your application. You can find
the following resources handy:

* The Getting Started Guide: http://guides.rubyonrails.org/getting_started.html
* Ruby on Rails Tutorial Book: http://www.railstutorial.org/


== Debugging Rails

Sometimes your application goes wrong. Fortunately there are a lot of tools that
will help you debug it and get it back on the rails.

First area to check is the application log files. Have "tail -f" commands
running on the server.log and development.log. Rails will automatically display
debugging and runtime information to these files. Debugging info will also be
shown in the browser on requests from 127.0.0.1.

You can also log your own messages directly into the log file from your code
using the Ruby logger class from inside your controllers. Example:

  class WeblogController < ActionController::Base
    def destroy
      @weblog = Weblog.find(params[:id])
      @weblog.destroy
      logger.info("#{Time.now} Destroyed Weblog ID ##{@weblog.id}!")
    end
  end

The result will be a message in your log file along the lines of:

  Mon Oct 08 14:22:29 +1000 2007 Destroyed Weblog ID #1!

More information on how to use the logger is at http://www.ruby-doc.org/core/

Also, Ruby documentation can be found at http://www.ruby-lang.org/. There are
several books available online as well:

* Programming Ruby: http://www.ruby-doc.org/docs/ProgrammingRuby/ (Pickaxe)
* Learn to Program: http://pine.fm/LearnToProgram/ (a beginners guide)

These two books will bring you up to speed on the Ruby language and also on
programming in general.


== Debugger

Debugger support is available through the debugger command when you start your
Mongrel or WEBrick server with --debugger. This means that you can break out of
execution at any point in the code, investigate and change the model, and then,
resume execution! You need to install ruby-debug to run the server in debugging
mode. With gems, use <tt>sudo gem install ruby-debug</tt>. Example:

  class WeblogController < ActionController::Base
    def index
      @posts = Post.find(:all)
      debugger
    end
  end

So the controller will accept the action, run the first line, then present you
with a IRB prompt in the server window. Here you can do things like:

  >> @posts.inspect
  => "[#<Post:0x14a6be8
          @attributes={"title"=>nil, "body"=>nil, "id"=>"1"}>,
       #<Post:0x14a6620
          @attributes={"title"=>"Rails", "body"=>"Only ten..", "id"=>"2"}>]"
  >> @posts.first.title = "hello from a debugger"
  => "hello from a debugger"

...and even better, you can examine how your runtime objects actually work:

  >> f = @posts.first
  => #<Post:0x13630c4 @attributes={"title"=>nil, "body"=>nil, "id"=>"1"}>
  >> f.
  Display all 152 possibilities? (y or n)

Finally, when you're ready to resume execution, you can enter "cont".


== Console

The console is a Ruby shell, which allows you to interact with your
application's domain model. Here you'll have all parts of the application
configured, just like it is when the application is running. You can inspect
domain models, change values, and save to the database. Starting the script
without arguments will launch it in the development environment.

To start the console, run <tt>rails console</tt> from the application
directory.

Options:

* Passing the <tt>-s, --sandbox</tt> argument will rollback any modifications
  made to the database.
* Passing an environment name as an argument will load the corresponding
  environment. Example: <tt>rails console production</tt>.

To reload your controllers and models after launching the console run
<tt>reload!</tt>

More information about irb can be found at:
link:http://www.rubycentral.com/pickaxe/irb.html


== dbconsole

You can go to the command line of your database directly through <tt>rails
dbconsole</tt>. You would be connected to the database with the credentials
defined in database.yml. Starting the script without arguments will connect you
to the development database. Passing an argument will connect you to a different
database, like <tt>rails dbconsole production</tt>. Currently works for MySQL,
PostgreSQL and SQLite 3.

== Description of Contents

The default directory structure of a generated Ruby on Rails application:

  |-- app
  |   |-- controllers
  |   |-- helpers
  |   |-- models
  |   `-- views
  |       `-- layouts
  |-- config
  |   |-- environments
  |   |-- initializers
  |   `-- locales
  |-- db
  |-- doc
  |-- lib
  |   `-- tasks
  |-- log
  |-- public
  |   |-- images
  |   |-- javascripts
  |   `-- stylesheets
  |-- script
  |   `-- performance
  |-- test
  |   |-- fixtures
  |   |-- functional
  |   |-- integration
  |   |-- performance
  |   `-- unit
  |-- tmp
  |   |-- cache
  |   |-- pids
  |   |-- sessions
  |   `-- sockets
  `-- vendor
      `-- plugins

app
  Holds all the code that's specific to this particular application.

app/controllers
  Holds controllers that should be named like weblogs_controller.rb for
  automated URL mapping. All controllers should descend from
  ApplicationController which itself descends from ActionController::Base.

app/models
  Holds models that should be named like post.rb. Models descend from
  ActiveRecord::Base by default.

app/views
  Holds the template files for the view that should be named like
  weblogs/index.html.erb for the WeblogsController#index action. All views use
  eRuby syntax by default.

app/views/layouts
  Holds the template files for layouts to be used with views. This models the
  common header/footer method of wrapping views. In your views, define a layout
  using the <tt>layout :default</tt> and create a file named default.html.erb.
  Inside default.html.erb, call <% yield %> to render the view using this
  layout.

app/helpers
  Holds view helpers that should be named like weblogs_helper.rb. These are
  generated for you automatically when using generators for controllers.
  Helpers can be used to wrap functionality for your views into methods.

config
  Configuration files for the Rails environment, the routing map, the database,
  and other dependencies.

db
  Contains the database schema in schema.rb. db/migrate contains all the
  sequence of Migrations for your schema.

doc
  This directory is where your application documentation will be stored when
  generated using <tt>rake doc:app</tt>

lib
  Application specific libraries. Basically, any kind of custom code that
  doesn't belong under controllers, models, or helpers. This directory is in
  the load path.

public
  The directory available for the web server. Contains subdirectories for
  images, stylesheets, and javascripts. Also contains the dispatchers and the
  default HTML files. This should be set as the DOCUMENT_ROOT of your web
  server.

script
  Helper scripts for automation and generation.

test
  Unit and functional tests along with fixtures. When using the rails generate
  command, template test files will be generated for you and placed in this
  directory.

vendor
  External libraries that the application depends on. Also includes the plugins
  subdirectory. If the app has frozen rails, those gems also go here, under
  vendor/rails/. This directory is in the load path.

<%= class_name %>
<%= "=" * class_name.size %>

Introduction goes here.


Example
=======

Example goes here.


Copyright (c) <%= Date.today.year %> [name of plugin creator], released under the MIT license

= Railties -- Gluing the Engine to the Rails

Railties is responsible to glue all frameworks together. Overall, it:

* handles all the bootstrapping process for a Rails application;

* manager rails command line interface;

* provides Rails generators core;


== Download

The latest version of Railties can be installed with Rubygems:

* gem install railties

Documentation can be found at

* http://api.rubyonrails.org


== License

Railties is released under the MIT license.

= RAKE -- Ruby Make 

Supporting Rake version: 0.8.6

This package contains Rake, a simple ruby build program with
capabilities similar to make.

Rake has the following features:

* Rakefiles (rake's version of Makefiles) are completely defined in
  standard Ruby syntax.  No XML files to edit.  No quirky Makefile
  syntax to worry about (is that a tab or a space?)

* Users can specify tasks with prerequisites.

* Rake supports rule patterns to synthesize implicit tasks.

* Flexible FileLists that act like arrays but know about manipulating
  file names and paths.

* A library of prepackaged tasks to make building rakefiles easier. For example,
  tasks for building tarballs, gems and RDoc output are provided.

* Supports parallel execution of tasks.


== Installation

=== Gem Installation

Download and install  rake with the following.

   gem install rake

=== Normal Installation

You can download the source tarball of the latest version of Rake from

* http://rubyforge.org/project/showfiles.php?group_id=50

Extract the tarball and run

  % ruby install.rb

from its distribution directory.

== Usage

=== Simple Example

First, you must write a "Rakefile" file which contains the build rules. Here's
a simple example:

  task :default => [:test]
  
  task :test do
    ruby "test/unittest.rb"
  end

This Rakefile has two tasks:

* A task named "test", which - upon invocation - will run a unit test file in
  Ruby.
* A task named "default". This task does nothing by itself, but it has exactly
  one dependency, namely the "test" task. Invoking the "default" task will
  cause Rake to invoke the "test" task as well.

Running the "rake" command without any options will cause it to run the
"default" task in the Rakefile:

  % ls
  Rakefile     test/
  % rake
  (in /home/some_user/Projects/rake)
  ruby test/unittest.rb
  ....unit test output here...

Type "rake --help" for all available options.


=== More Information

* For details on Rake's command-line invocation, read
  doc/command_line_usage.rdoc[http://rake.rubyforge.org/files/doc/command_line_usage_rdoc.html]
* For details on writing Rakefiles, see
  doc/rakefile.rdoc[http://rake.rubyforge.org/files/doc/rakefile_rdoc.html].
* For the original announcement of Rake, see
  doc/rational.rdoc[http://rake.rubyforge.org/files/doc/rational_rdoc.html].
* For a glossary of terms, see
  doc/glossary.rdoc[http://rake.rubyforge.org/files/doc/glossary_rdoc.html].


== Development

=== Source Repository

Rake is currently hosted at github. The github web page is
http://github.com/jimweirich/rake. The public git clone URL is

* git://github.com/jimweirich/rake.git

=== Running the Rake Test Suite

If you wish to run the unit and functional tests that come with Rake:

* Install the 'session' gem in order to run the functional tests.
* CD into the top project directory of rake.
* Type one of the following:

     rake                  # If you have a version of rake installed
     ruby -Ilib bin/rake   # If you do not have a version of rake installed.

=== Issues and Bug Reports

Bugs, features requests and other issues can be logged at

* http://onestepback.org/redmine/projects/show/rake

You will need an account to before you can post issues.  Register at
http://onestepback.org/redmine/account/register.  Or you can send me
an email (at jim dot weirich at gmail dot com)


== Online Resources

=== Rake References

* Rake Documentation Home: http://docs.rubyrake.org
* Rake Project Page: http://rubyforge.org/projects/rake
* Rake API Documents: http://rake.rubyforge.org
* Rake Source Code Repo:  http://github.com/jimweirich/rake
* Rake Git Repo Clone URL: git://github.com/jimweirich/rake.git

=== Presentations and Articles about Rake

* Jim Weirich's 2003 RubyConf presentation: http://onestepback.org/articles/buildingwithrake/
* Martin Fowler's article on Rake: http://martinfowler.com/articles/rake.html

== Other Make Reinvisionings ...

Rake is a late entry in the make replacement field.  Here are links to
other projects with similar (and not so similar) goals.

* http://directory.fsf.org/bras.html -- Bras, one of earliest
  implementations of "make in a scripting language".
* http://www.a-a-p.org -- Make in Python
* http://www.aromatic.com/tools/jam.txt -- JAM, Java Automated Make
* http://ant.apache.org -- The Ant project
* http://ppt.perl.org/commands/make/index.html -- Make from the Perl
  Power Tools implementation.
* http://search.cpan.org/search?query=PerlBuildSystem -- The Perl Build System
* http://make.rubyforge.org -- Rant, another Ruby make tool.

== Credits

[<b>Ryan Dlugosz</b>] For the initial conversation that sparked Rake.

[<b>nobu.nokada@softhome.net</b>] For the initial patch for rule support.

[<b>Tilman Sauerbeck <tilman@code-monkey.de></b>] For the recursive rule patch.

== License

Rake is available under an MIT-style license.

:include: MIT-LICENSE

== Support

The Rake homepage is http://rake.rubyforge.org.  You can find the Rake
RubyForge page at http://rubyforge.org/projects/rake.

Feel free to submit commits or feature requests.  If you send a patch,
remember to update the corresponding unit tests.  If fact, I prefer
new feature to be submitted in the form of new unit tests.

For other information, feel free to ask on the ruby-talk mailing list
(which is mirrored to comp.lang.ruby) or contact
jim dot weirich at gmail.com.

---

= Other stuff

Author::   Jim Weirich <jim.weirich@gmail.com>
Requires:: Ruby 1.8.0 or later
License::  Copyright 2003-2008 by Jim Weirich.
           Released under an MIT-style license.  See the LICENSE file
           included in the distribution.

== Warranty

This software is provided "as is" and without any express or
implied warranties, including, without limitation, the implied
warranties of merchantibility and fitness for a particular
purpose.

= Shoulda - Making tests easy on the fingers and eyes

Shoulda makes it easy to write elegant, understandable, and maintainable tests. Shoulda consists of matchers, test helpers, and assertions. It's fully compatible with your existing tests in Test::Unit or RSpec, and requires no retooling to use.

Matchers:: Test::Unit- and RSpec-compatible one-liners that test common Rails functionality.
           These tests would otherwise be much longer, more complex, and error-prone.
Helpers:: #context and #should give you RSpec like test blocks in Test::Unit.
          In addition, you get nested contexts and a much more readable syntax.
Assertions:: Many common Rails testing idioms have been distilled into a set of useful assertions.

= Usage

=== ActiveRecord Tests (Shoulda::ActiveRecord::Matchers)

Test your ActiveRecord associations and validations with these powerful matchers:

  class PostTest < Test::Unit::TestCase
    should belong_to(:user)
    should have_many(:tags).through(:taggings)

    should validate_uniqueness_of(:title)
    should validate_presence_of(:body).with_message(/wtf/)
    should validate_presence_of(:title)
    should validate_numericality_of(:user_id)
  end

  class UserTest < Test::Unit::TestCase
    should have_many(:posts)

    should_not allow_value("blah").for(:email)
    should_not allow_value("b lah").for(:email)
    should allow_value("a@b.com").for(:email)
    should allow_value("asdf@asdf.com").for(:email)
    should ensure_inclusion_of(:email).in_range(1..100)
    should ensure_inclusion_of(:age).in_range(1..100)
    should_not allow_mass_assignment_of(:password)
  end

Makes TDD so much easier.

=== Controller Tests (Shoulda::Controller::Matchers)

Matchers to test the most common controller patterns...

  class PostsControllerTest < ActionController::TestCase
    context "on GET to :show for first record" do
      setup do
        get :show, :id => 1
      end

      should assign_to(:user)
      should respond_with(:success)
      should render_template(:show)
      should_not set_the_flash

      should "do something else really cool" do
        assert_equal 1, assigns(:user).id
      end
    end
  end

=== Context Helpers (Shoulda::Context)

Stop killing your fingers with all of those underscores...  Name your tests with plain sentences!

  class UserTest < Test::Unit::TestCase
    context "A User instance" do
      setup do
        @user = User.find(:first)
      end

      should "return its full name" do
        assert_equal 'John Doe', @user.full_name
      end

      context "with a profile" do
        setup do
          @user.profile = Profile.find(:first)
        end

        should "return true when sent #has_profile?" do
          assert @user.has_profile?
        end
      end
    end
  end

Produces the following test methods:

  "test: A User instance should return its full name."
  "test: A User instance with a profile should return true when sent #has_profile?."

So readable!

=== Helpful Assertions (Shoulda::Assertions)

More to come here, but have fun with what's there.

  assert_same_elements([:a, :b, :c], [:c, :a, :b])
  assert_contains(['a', '1'], /\d/)
  assert_contains(['a', '1'], 'a')

= Rails Installation (Test::Unit)

Specify the gem dependency in your config/environment.rb file:

  Rails::Initializer.run do |config|
    config.gem "shoulda", :lib => "shoulda"
  end

Then:

  $ rake gems:install
  $ rake gems:unpack

= Rails Installation (RSpec)

If you're using Shoulda with RSpec, we recommend that you add config.gem lines
for RSpec and Shoulda in your config/environment/test.rb file, but do not ask
Rails to load the RSpec and Shoulda libraries:

  config.gem 'rspec',       :lib => false
  config.gem 'rspec-rails', :lib => false
  config.gem 'shoulda',     :lib => false

Then require shoulda from your spec/spec_helper.rb file, before Spec::Runner is
configured:

  # requires for RSpec
  require 'shoulda'
  Spec::Runner.configure do |config|
  # ...

You should not need to require anything besides the top-level shoulda library.

= Rails 3 Installation (RSpec)

With Rails 3 and Bundler, requiring Shoulda is as easy as adding it to your Gemfile:

  group :test do
    gem "shoulda"
    gem "rspec-rails", "2.0.0.beta.12"
  end

Shoulda will automatically include matchers into the appropriate example
groups.

= Credits

Shoulda is maintained and funded by {thougthbot}[http://thoughtbot.com/community]

= License

Shoulda is Copyright  2006-2010 Tammer Saleh, Thoughtbot. It is free software, and may be redistributed under the terms specified in the MIT-LICENSE file.

== Welcome to Rails

Rails is a web-application framework that includes everything needed to create 
database-backed web applications according to the Model-View-Control pattern. 

This pattern splits the view (also called the presentation) into "dumb" templates
that are primarily responsible for inserting pre-built data in between HTML tags.
The model contains the "smart" domain objects (such as Account, Product, Person,
Post) that holds all the business logic and knows how to persist themselves to
a database. The controller handles the incoming requests (such as Save New Account,
Update Product, Show Post) by manipulating the model and directing data to the view.

In Rails, the model is handled by what's called an object-relational mapping
layer entitled Active Record. This layer allows you to present the data from
database rows as objects and embellish these data objects with business logic
methods. You can read more about Active Record in
link:files/vendor/rails/activerecord/README.html.

The controller and view are handled by the Action Pack, which handles both
layers by its two parts: Action View and Action Controller. These two layers
are bundled in a single package due to their heavy interdependence. This is
unlike the relationship between the Active Record and Action Pack that is much
more separate. Each of these packages can be used independently outside of
Rails.  You can read more about Action Pack in
link:files/vendor/rails/actionpack/README.html.


== Getting Started

1. At the command prompt, start a new Rails application using the <tt>rails</tt> command
   and your application name. Ex: rails myapp
2. Change directory into myapp and start the web server: <tt>rails server</tt> (run with --help for options)
3. Go to http://localhost:3000/ and get "Welcome aboard: You're riding the Rails!"
4. Follow the guidelines to start developing your application


== Web Servers

By default, Rails will try to use Mongrel if it's installed when started with <tt>rails server</tt>, otherwise
Rails will use WEBrick, the webserver that ships with Ruby. But you can also use Rails
with a variety of other web servers.

Mongrel is a Ruby-based webserver with a C component (which requires compilation) that is
suitable for development and deployment of Rails applications. If you have Ruby Gems installed,
getting up and running with mongrel is as easy as: <tt>gem install mongrel</tt>.
More info at: http://mongrel.rubyforge.org

Say other Ruby web servers like Thin and Ebb or regular web servers like Apache or LiteSpeed or
Lighttpd or IIS. The Ruby web servers are run through Rack and the latter can either be setup to use
FCGI or proxy to a pack of Mongrels/Thin/Ebb servers.

== Apache .htaccess example for FCGI/CGI

# General Apache options
AddHandler fastcgi-script .fcgi
AddHandler cgi-script .cgi
Options +FollowSymLinks +ExecCGI

# If you don't want Rails to look in certain directories,
# use the following rewrite rules so that Apache won't rewrite certain requests
# 
# Example:
#   RewriteCond %{REQUEST_URI} ^/notrails.*
#   RewriteRule .* - [L]

# Redirect all requests not available on the filesystem to Rails
# By default the cgi dispatcher is used which is very slow
# 
# For better performance replace the dispatcher with the fastcgi one
#
# Example:
#   RewriteRule ^(.*)$ dispatch.fcgi [QSA,L]
RewriteEngine On

# If your Rails application is accessed via an Alias directive,
# then you MUST also set the RewriteBase in this htaccess file.
#
# Example:
#   Alias /myrailsapp /path/to/myrailsapp/public
#   RewriteBase /myrailsapp

RewriteRule ^$ index.html [QSA]
RewriteRule ^([^.]+)$ $1.html [QSA]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ dispatch.cgi [QSA,L]

# In case Rails experiences terminal errors
# Instead of displaying this message you can supply a file here which will be rendered instead
# 
# Example:
#   ErrorDocument 500 /500.html

ErrorDocument 500 "<h2>Application error</h2>Rails application failed to start properly"


== Debugging Rails

Sometimes your application goes wrong.  Fortunately there are a lot of tools that
will help you debug it and get it back on the rails.

First area to check is the application log files.  Have "tail -f" commands running
on the server.log and development.log. Rails will automatically display debugging
and runtime information to these files. Debugging info will also be shown in the
browser on requests from 127.0.0.1.

You can also log your own messages directly into the log file from your code using
the Ruby logger class from inside your controllers. Example:

  class WeblogController < ActionController::Base
    def destroy
      @weblog = Weblog.find(params[:id])
      @weblog.destroy
      logger.info("#{Time.now} Destroyed Weblog ID ##{@weblog.id}!")
    end
  end

The result will be a message in your log file along the lines of:

  Mon Oct 08 14:22:29 +1000 2007 Destroyed Weblog ID #1

More information on how to use the logger is at http://www.ruby-doc.org/core/

Also, Ruby documentation can be found at http://www.ruby-lang.org/ including:

* The Learning Ruby (Pickaxe) Book: http://www.ruby-doc.org/docs/ProgrammingRuby/
* Learn to Program: http://pine.fm/LearnToProgram/  (a beginners guide)

These two online (and free) books will bring you up to speed on the Ruby language
and also on programming in general.


== Debugger

Debugger support is available through the debugger command when you start your Mongrel or
Webrick server with --debugger. This means that you can break out of execution at any point
in the code, investigate and change the model, AND then resume execution! 
You need to install ruby-debug to run the server in debugging mode. With gems, use 'gem install ruby-debug'
Example:

  class WeblogController < ActionController::Base
    def index
      @posts = Post.find(:all)
      debugger
    end
  end

So the controller will accept the action, run the first line, then present you
with a IRB prompt in the server window. Here you can do things like:

  >> @posts.inspect
  => "[#<Post:0x14a6be8 @attributes={\"title\"=>nil, \"body\"=>nil, \"id\"=>\"1\"}>,
       #<Post:0x14a6620 @attributes={\"title\"=>\"Rails you know!\", \"body\"=>\"Only ten..\", \"id\"=>\"2\"}>]"
  >> @posts.first.title = "hello from a debugger"
  => "hello from a debugger"

...and even better is that you can examine how your runtime objects actually work:

  >> f = @posts.first
  => #<Post:0x13630c4 @attributes={"title"=>nil, "body"=>nil, "id"=>"1"}>
  >> f.
  Display all 152 possibilities? (y or n)

Finally, when you're ready to resume execution, you enter "cont"


== Console

You can interact with the domain model by starting the console through <tt>rails console</tt>.
Here you'll have all parts of the application configured, just like it is when the
application is running. You can inspect domain models, change values, and save to the
database. Starting the script without arguments will launch it in the development environment.
Passing an argument will specify a different environment, like <tt>rails console production</tt>.

To reload your controllers and models after launching the console run <tt>reload!</tt>

== dbconsole

You can go to the command line of your database directly through <tt>rails dbconsole</tt>.
You would be connected to the database with the credentials defined in database.yml.
Starting the script without arguments will connect you to the development database. Passing an
argument will connect you to a different database, like <tt>rails dbconsole production</tt>.
Currently works for mysql, postgresql and sqlite.

== Description of Contents

app
  Holds all the code that's specific to this particular application.

app/controllers
  Holds controllers that should be named like weblogs_controller.rb for
  automated URL mapping. All controllers should descend from ApplicationController
  which itself descends from ActionController::Base.

app/models
  Holds models that should be named like post.rb.
  Most models will descend from ActiveRecord::Base.

app/views
  Holds the template files for the view that should be named like
  weblogs/index.html.erb for the WeblogsController#index action. All views use eRuby
  syntax.

app/views/layouts
  Holds the template files for layouts to be used with views. This models the common
  header/footer method of wrapping views. In your views, define a layout using the
  <tt>layout :default</tt> and create a file named default.html.erb. Inside default.html.erb,
  call <% yield %> to render the view using this layout.

app/helpers
  Holds view helpers that should be named like weblogs_helper.rb. These are generated
  for you automatically when using rails generate for controllers. Helpers can be used to
  wrap functionality for your views into methods.

config
  Configuration files for the Rails environment, the routing map, the database, and other dependencies.

db
  Contains the database schema in schema.rb.  db/migrate contains all
  the sequence of Migrations for your schema.

doc
  This directory is where your application documentation will be stored when generated
  using <tt>rake doc:app</tt>

lib
  Application specific libraries. Basically, any kind of custom code that doesn't
  belong under controllers, models, or helpers. This directory is in the load path.

public
  The directory available for the web server. Contains subdirectories for images, stylesheets,
  and javascripts. Also contains the dispatchers and the default HTML files. This should be
  set as the DOCUMENT_ROOT of your web server.

script
  Helper scripts for automation and generation.

test
  Unit and functional tests along with fixtures. When using the rails generate command, template
  test files will be generated for you and placed in this directory.

vendor
  External libraries that the application depends on. Also includes the plugins subdirectory.
  If the app has frozen rails, those gems also go here, under vendor/rails/.
  This directory is in the load path.

The Shoulda test suite (in particular - the tests that test shoulda)

Quick overview:

The test directory contains the following files and subdirectories:

* rails_root - contains the stripped down rails application that the tests run against.  The rails root contains:
** the models, controllers, and views defined under app/
** the test.rb environment file
** a migration file for each model
** a shoulda initializer that simulates loading the plugin but without relying on vendor/plugins
* fixtures - contain the sample DB data for each model
* functional - controller tests for each of the controllers under rails_root/app
* unit - model tests for each of the models under rails_root/app
* other - tests for the shoulda contexts, should statements, and assertions
* test_helper.rb - responsible for initializing the test environment
** sets the rails_env to test
** sets the rails_root
** runs all the migrations against the in-memory sqlite3 db
** adds some magic to load the right fixture files

In order to add a new model (or controller) to the test suite:

* add that model to rails_root/app/models
* add a migration for that model
* add a fixture file
* add a test for that file under test/units

Dependencies:

* Rails gem installed in the host system
* A working sqlite3 installation.

If you have problems running these tests, please notify the mailing list:  shoulda@googlegroups.com

- Tammer Saleh <tsaleh@thoughtbot.com>

= test/spec, a BDD interface for Test::Unit

Copyright (C) 2006, 2007, 2008, 2009  Christian Neukirchen <mailto:chneukirchen@gmail.com>


== What is test/spec?

test/spec layers an RSpec-inspired interface on top of Test::Unit, so
you can mix TDD and BDD (Behavior-Driven Development).

test/spec is a clean-room implementation that maps most kinds of
Test::Unit assertions to a `should'-like syntax.

Consider this Test::Unit test case:

    class TestFoo < Test::Unit::TestCase
      def test_should_bar
        assert_equal 5, 2 + 3
      end
    end
    
In test/spec, it looks like this:
    
    require 'test/spec'
    
    context "Foo" do
      specify "should bar" do
        (2 + 3).should.equal 5
      end
    end

Since test/spec 0.4, you can also use the new RSpec 1.0 style:
    
    require 'test/spec'
    
    describe "Foo" do
      it "should bar" do
        (2 + 3).should.equal 5
      end
    end

test/spec does not include a mocking/stubbing-framework; use whichever
you like to.  test/spec has been tested successfully with FlexMock and
Mocha.

test/spec has no dependencies outside Ruby 1.8.


== Mixing test/spec and test/unit

test/spec and Test::Unit contexts/test cases can be intermixed freely,
run in the same test and live in the same files.  You can just add them
to your Rake::TestTask, too.  test/spec allows you to leverage your
full existing Test::Unit infrastructure.

test/spec does not change Test::Unit with the exception of
monkey-patching Test::Unit::TestSuite to order the test cases before
running them.  (This should not do any harm, but if you know a way
around it, please tell me.)

test/spec adds seven global methods, Object#should, Kernel.context,
Kernel.xcontext, Kernel.shared_context, Kernel.describe,
Kernel.xdescribe, and Kernel.describe_shared.  The Kernel methods are
private.

You can use <tt>assert_*</tt> freely in specify-blocks; Object#should
works in plain Test::Unit test cases, too, but they will not be counted.


== Wrapped assertions

+assert_equal+:: <tt>should.equal</tt>, <tt>should ==</tt>
+assert_not_equal+:: <tt>should.not.equal</tt>, <tt>should.not ==</tt>
+assert_same+:: <tt>should.be</tt>
+assert_not_same+:: <tt>should.not.be</tt>
+assert_nil+:: <tt>should.be.nil</tt>
+assert_not_nil+:: <tt>should.not.be.nil</tt>
+assert_in_delta+:: <tt>should.be.close</tt>
+assert_match+:: <tt>should.match</tt>, <tt>should =~</tt>
+assert_no_match+:: <tt>should.not.match</tt>, <tt>should.not =~</tt>

+assert_instance_of+:: <tt>should.be.an.instance_of</tt>
+assert_kind_of+:: <tt>should.be.a.kind_of</tt>
+assert_respond_to+:: <tt>should.respond_to</tt>
+assert_raise+:: <tt>should.raise</tt>
+assert_nothing_raised+:: <tt>should.not.raise</tt>
+assert_throws+:: <tt>should.throw</tt>
+assert_nothing_thrown+:: <tt>should.not.throw</tt>

+assert_block+:: <tt>should.satisfy</tt>

(+a+, +an+ and +be+ without arguments are optional and no-ops.)


== Additional assertions

These assertions are not included in Test::Unit, but have been added
to test/spec for convenience:

* <tt>should.not.satisfy</tt>
* <tt>should.include</tt>
* <tt>a.should.</tt>_predicate_ (works like <tt>assert
  a.</tt>_predicate_<tt>?</tt>)
* <tt>a.should.be </tt>_operator_ (where _operator_ is one of <tt>></tt>, <tt>>=</tt>, <tt><</tt>, <tt><=</tt> or <tt>===</tt>)
* <tt>should.output</tt> (require test/spec/should-output)

If you write an useful general-purpose assertion, I'd like to hear of
it and may add it to the test/spec distribution.


== Messaging/Blaming

With more complex assertions, it may be helpful to provide a message
to show if the assertion has failed.  This can be done with the
Should#blaming or Should#messaging methods:

    RUBY_VERSION.should.messaging("Ruby too old.").be > "1.8.4"

    (1 + 1).should.blaming("weird math").not.equal 11


== Custom shoulds ("Matchers")

To capture recurring patterns in parts of your specifications, you can
define custom "shoulds" (RSpec calls them "matchers") in your
contexts, or include modules of them:

    context "Numbers"
      class EqualString < Test::Spec::CustomShould
        def matches?(other)
          object == other.to_s
        end
      end
    
      def equal_string(str)
        EqualString.new(str)
      end
    
      specify "should have to_s"
        42.should equal_string("42")
      end
    end

Alternatively, your implementation can define
CustomShould#assumptions, where you can use test/spec assertions
instead of Boolean predicates:

    class EqualString < Test::Spec::CustomShould
      def assumptions(other)
        object.should.equal other.to_s
      end
    end

A CustomShould by default takes one argument, which is placed in
self.object for your convenience.

You can CustomShould#failure_message to provide a better error
message.


== SpecDox and RDox

test/spec adds two additional test runners to Test::Unit, based on the
console runner but with a different output format.

SpecDox, run with <tt>--runner=specdox</tt> (or <tt>-rs</tt>) looks
like RSpec's output:

    should.output
    - works for print
    - works for puts
    - works with readline

RDox, run with <tt>--runner=rdox</tt> (or <tt>-rr</tt>) can be
included for RDoc documentation (e.g. see SPECS):

    == should.output
    * works for print
    * works for puts
    * works with readline

SpecDox and RDox work for Test::Unit too:

    $ ruby -r test/spec test/testunit/test_testresult.rb -rs
    
    Test::Unit::TC_TestResult
    - fault notification
    - passed?
    - result changed notification
    
    Finished in 0.106647 seconds.
    
    3 specifications (30 requirements), 0 failures

Since version 0.4, SpecDox and RDox also notice and count empty
specifications.


== Disabled specifications

Akin to the usual Test::Unit practice, tests quickly can be disabled
by replacing +specify+ with +xspecify+ (or +it+ with +xit+).
test/spec will count the disabled tests when you run it with SpecDox
or RDox.

When you use xspecify/xit, you also can drop the block.  This is
useful for writing specifications that you haven't yet started
implementing.

Complete contexts can be disabled by using +xcontext+/+xdescribe+.


== Setup/Teardown

Setup/Teardown methods are run in this order:

  * before(:all) in order of definition
  * before(:each)/setup in order of definition
  * specify
  * after(:each)/setup in order of definition
  * before(:each)/setup in order of definition
  * specify
  * after(:each)/setup in order of definition
  * ...
  * after(:all) in order of definition

Please note that before(:all) and after(:all) are run in their own
instance, so all instance variables they set are lost(!) and not
visible to other specifications.  They are e.g. useful for setting up
database connections or starting servers.


== Shared contexts

Since version 0.9, you can define shared contexts in test/spec using
shared_context/describe_shared.  These contexts are not executed on
their own, but can be included with it_should_behave_like/behaves_like
in other contexts.  You can use shared contexts to structure suites
with many recurring specifications.


== specrb

Since version 0.2, test/spec features a standalone test runner called
specrb.  specrb is like an extended version of testrb, Test::Unit's
test runner, but has additional options.  It can be used for
plain Test::Unit suites, too.

    $ specrb -a -s -n should.output
    
    should.output
    - works for print
    - works for puts
    - works with readline
    
    Finished in 0.162571 seconds.
    
    3 specifications (6 requirements), 0 failures

Run <tt>specrb --help</tt> for the usage.


== test/spec on Rails

If you want to specify your Rails applications, you can use the third-party
plugin "test/spec on Rails", which can be found at:

  http://svn.techno-weenie.net/projects/plugins/test_spec_on_rails/

It features testing of model validation, redirection, output, HTTP
status, template rendering and URL generation.


== Installing with RubyGems

Since version 0.3, a Gem of test/spec is available.  You can install with:

    gem install test-spec

I also provide a local mirror of the gems (and development snapshots)
at my site:

    gem install test-spec --source http://chneukirchen.org/releases/gems


== History

* September 29th, 2006: First public release 0.1.

* October 18th, 2006: Second public release 0.2.
  * Better, module-based implementation
  * Official support for FlexMock and Mocha
  * More robust Should#output
  * Should#_operator_
  * Nested contexts
  * Standalone test/spec runner, specrb

* January 24th, 2007: Third public release 0.3.
  * should.be_close, should.be_an_instance_of, should.be_a_kind_of,
    and should.be_nil have been deprecated.  Use the dot-variants of
    them.  These assertions will be removed in 1.0.
  * specrb -a now includes -Ilib by default for easier out-of-the-box
    testing.
  * Added custom shoulds.
  * Added messaging/blaming.
  * Added disabling of specifications.
  * Small bug fixes.
  * Gem available.

* June 29th, 2007: Fourth public release 0.4.
  * Support for Ruby 1.8.6.
  * Support describe/it/before/after RSpec 1.0 syntax.
  * Allow should.raise { code_that_raises }
  * Add xcontext to disable complete contexts.
  * Backtraces are cleaner now.
  * Mention test/spec on Rails.
  * Fix small Gem bugs.
  * Fix bug related to counting negated assertions.
  * Fix bug in specrb.
  * Allow empty xspecifys.
  * Make SpecDox and RDox count empty specifications.
  * Allow Kernel#context to take a superclass.

* July 2nd, 2008: Fifth public release 0.9.
  * Allow should.<predicate>? as well as should.<predicate>.
  * Add shared contexts.
  * Nested contexts now run the
    setups/teardowns/before(:all)/after(:all) of their parents.

* February 1st, 2009: Sixth public release 0.10.
  * Support for Ruby 1.9.  Now requires the test-spec gem.


== Contact

Please mail bugs, suggestions and patches to
<mailto:chneukirchen@gmail.com>.

Darcs repository ("darcs send" is welcome for patches):
http://chneukirchen.org/repos/testspec


== Thanks to

* Eero Saynatkari for writing <tt>should.output</tt>.
* Tuxie for writing test/spec on Rails.
* Brian Donovan for allowing alternative superclasses.
* Xavier Shay for implementing nested setups/teardowns.
* Chris Wanstrath for <tt>should.raise</tt> with a block and <tt>xcontext</tt>.
* Jean-Michel Garnier for packaging the first gem.
* Mikko Lehtonen, Jan Wikholm, Matt Mower and Michael Fellinger for
  testing the gem.
* Chris McGrath for reporting a bug.
* Thomas Fuchs for script.aculo.us BDD testing which convinced me.
* Dave Astels for BDD.
* The RSpec team for API inspiration.
* Nathaniel Talbott for Test::Unit.


== Copying

Copyright (C) 2006, 2007, 2008, 2009  Christian Neukirchen <http://purl.org/net/chneukirchen>

test/spec is licensed under the same terms as Ruby itself.

Please mail bugs, feature requests or patches to the mail addresses
found above or use IRC[irc://freenode.net/#ruby-lang] to contact the
developer.


== Links

Behavior-Driven Development:: <http://behaviour-driven.org/>
RSpec:: <http://rspec.rubyforge.org/>
script.aculo.us testing:: <http://mir.aculo.us/articles/2006/08/29/bdd-style-javascript-testing>

FlexMock:: <http://onestepback.org/software/flexmock/>
Mocha:: <http://mocha.rubyforge.org/>

Christian Neukirchen:: <http://chneukirchen.org/>


= Test::Unit 2.x

* http://rubyforge.org/projects/test-unit/

== DESCRIPTION

Test::Unit 2.x - Improved version of Test::Unit bundled in
Ruby 1.8.x.

Ruby 1.9.x bundles minitest not Test::Unit. Test::Unit
bundled in Ruby 1.8.x had not been improved but unbundled
Test::Unit (Test::Unit 2.x) will be improved actively.

== FEATURES

* Test::Unit 1.2.3 is the original Test::Unit, taken
  straight from the ruby distribution. It is being
  distributed as a gem to allow tool builders to use it as a
  stand-alone package. (The test framework in ruby is going
  to radically change very soon).

* Test::Unit 2.x will be improved actively and may break
  compatiblity with Test::Unit 1.2.3. (We will not hope it
  if it isn't needed.)

* Some features exist as separated gems like GUI test
  runner. (Tk, GTK+ and Fox) test-unit-full gem package
  provides for installing all Test::Unit related gems
  easily.

== INSTALL

  % sudo gem install test-unit

If you want to use full Test::Unit features:

  % sudo gem install test-unit-full

== LICENSE

(The Ruby License)

This software is distributed under the same terms as ruby.

Exception: lib/test/unit/diff.rb is a dual license of the
Ruby license and PSF license.

== AUTHORS

=== Active

* Kouhei Sutou: The current maintainer

=== Inactive

* Nathaniel Talbott: The original author
* Ryan Davis: The second maintainer

=== Images

* Mayu & Co.: kinotan icons: http://cocooooooon.com/kinotan/

== Thanks

* Daniel Berger: Suggestions and bug reports.
* Designing Patterns: Suggestions.
* Erik Hollensbe: Suggestions and bug reports.
* Bill Lear: A suggestion.
* Diego Petten: A bug report.
* Angelo Lakra: A bug report.
* Mike Pomraning: A bug report.
* David MARCHALAND: Suggestions and bug reports.
* Andrew Grimm: A bug report.
* Champak Ch: A bug report.
* Florian Frank: A bug report.

Text::Format 1.0.0
==================
Text::Format is provides the ability to nicely format fixed-width text with
knowledge of the writeable space (number of columns), margins, and indentation
settings. Text::Format can work with either TeX::Hyphen or Text::Hyphen to
hyphenate words when formatting.

This is release 1.0, containing both feature enhancements and bug fixes over
the previous version, 0.64.

Text::Format is originally based on the Perl library of the same name by Gbor
Egressy. It is copyright 2002 - 2005 by Austin Ziegler and is licenced under
Ruby's licence. It is also available under the Perl Artistic licence.

Text::Hyphen README
===================

Text::Hyphen will properly hyphenate various words according to the rules of
the language the word is written in. The algorithm is based on that of the TeX
typesetting system by Donald E. Knuth. This is originally based on the Perl
implementation of TeX::Hyphen[1] and the Ruby port TeX::Hyphen[2]. The
language hyphenation pattern files are based on the sources available from
CTAN[3] as of 2004.12.19 and have been translated by Austin Ziegler.

This release is 1.0, the initial release of Text::Hyphen, representing a
significant improvement over its predecessor, TeX::Hyphen.

    require 'text/hyphen'
    hh = Text::Hyphen.new(:language => 'en_us', :left => 2, :right => 2)
      # Defaults to the above
    hh = TeX::Hyphen.new
    
    word = "representation"
    points = hyp.hyphenate(word)  #=> [3, 5, 8, 10]
    puts hyp.visualize(word)      #=> rep-re-sen-ta-tion

Text::Hyphen is truly multilingual in nature[4]. As an example, consider the
difference between the following:

    require 'text/hyphen'
      # Using left and right minimum values of 0 ensures that you will see all
      # possible hyphenation points, not just those that meet the minimum
      # width requirements.
    en = Text::Hyphen.new(:left => 0, :right => 0)
    fr = Text::Hyphen.new(:language = "fr", :left => 0, :right => 0)

    puts en.visualise("organiser")      #=> or-gan-iser
    puts fr.visualise("organiser")      #=> or-ga-ni-ser

As you can see, the hyphenation is distinct between the two hyphenators.
Additional improvements over TeX::Hyphen include thread safety (except for
debug control) and support for UTF-8.

It is very important to read the LICENCE file and each language file desired,
as some languages may be held under a more strict licence than that granted by
LICENCE.

Copyright
=========
# Copyright 2004 Austin Ziegler <text-hyphen@halostatue.ca>
# See the LICENCE file for more information.

[1] <http://search.cpan.org/author/JANPAZ/TeX-Hyphen-0.140/lib/TeX/Hyphen.pm>
    Maintained by Jan Pazdziora.
[2] Available at <http://rubyforge.org/projects/text-format>.
[3] <http://www.ctan.org>
[4] There are some bugs and design decisions in the original Perl
    implementation of TeX::Hyphen that make it unsuitable for most
    multilingual implementations that carried over to the Ruby port of
    TeX::Hyphen.

# Thor 

## Description

Thor is a simple and efficient tool for building self-documenting command line utilities.  It removes the pain of parsing command line options, writing "USAGE:" banners, and can also be used as an alternative to the [Rake](http://github.com/jimweirich/rake) build tool.  The syntax is Rake-like, so it should be familiar to most Rake users. 

## Installation

$ gem install thor

or

$ gem install wycats-thor -s http://gems.github.com

## Usage

Map options to a class.  Simply create a class with the appropriate annotations
and have options automatically map to functions and parameters.  

Example:

    class App < Thor                                                 # [1]
      map "-L" => :list                                              # [2]
      
      desc "install APP_NAME", "install one of the available apps"   # [3]
      method_options :force => :boolean, :alias => :string           # [4]
      def install(name)
        user_alias = options[:alias]
        if options.force?
          # do something
        end
        # other code
      end
      
      desc "list [SEARCH]", "list all of the available apps, limited by SEARCH"
      def list(search="")
        # list everything
      end
    end

Thor automatically maps commands as such: 

    thor app:install myname --force

That gets converted to:

    App.new.install("myname")
    # with {'force' => true} as options hash

1. Inherit from Thor to turn a class into an option mapper.  
2. Map additional non-valid identifiers to specific methods.  In this case, convert -L to :list
3. Describe the method immediately below.  The first parameter is the usage information, and the second parameter is the description.  
4. Provide any additional options that will be available the instance method options.  

## Types for <tt>method_options</tt>

* :boolean - is parsed as <tt>--option</tt> or <tt>--option=true</tt>
* :string  - is parsed as <tt>--option=VALUE</tt>
* :numeric - is parsed as <tt>--option=N</tt>
* :array   - is parsed as <tt>--option=one two three</tt>
* :hash    - is parsed as <tt>--option=name:string age:integer</tt>

Besides, method_option allows a default value to be given.  Examples:

    method_options :force => false
    #=> Creates a boolean option with default value false

    method_options :alias => "bar"
    #=> Creates a string option with default value "bar"

    method_options :threshold => 3.0
    #=> Creates a numeric option with default value 3.0

You can also supply <tt>:option => :required</tt> to mark an option as required.  The
type is assumed to be string.  If you want a required hash with default values
as option, you can use <tt>method_option</tt> which uses a more declarative style:

    method_option :attributes, :type => :hash, :default => {}, :required => true

All arguments can be set to nil (except required arguments), by suppling a no or
skip variant.  For example: 

    thor app name --no-attributes

In previous versions, aliases for options were created automatically, but now
they should be explicit.  You can supply aliases in both short and declarative
styles:

    method_options %w( force -f ) => :boolean

Or:

    method_option :force, :type => :boolean, :aliases => "-f"

You can supply as many aliases as you want.

NOTE: Type :optional available in Thor 0.9.0 was deprecated. Use :string or :boolean instead.

## Namespaces

By default, your Thor tasks are invoked using Ruby namespace.  In the example
above, tasks are invoked as:

    thor app:install name --force

However, you could namespace your class as:

    module Sinatra
      class App < Thor
        # tasks
      end
    end

And then you should invoke your tasks as:

    thor sinatra:app:install name --force

If desired, you can change the namespace:

    module Sinatra
      class App < Thor
        namespace :myapp
        # tasks
      end
    end

And then your tasks should be invoked as:

    thor myapp:install name --force

## Invocations

Thor comes with a invocation-dependency system as well, which allows a task to be invoked only once.  For example:

    class Counter < Thor
      desc "one", "Prints 1, 2, 3"
      def one
        puts 1
        invoke :two
        invoke :three
      end
      
      desc "two", "Prints 2, 3"
      def two
        puts 2
        invoke :three
      end
      
      desc "three", "Prints 3"
      def three
        puts 3
      end
    end

When invoking the task one:

    thor counter:one

The output is "1 2 3", which means that the three task was invoked only once.  
You can even invoke tasks from another class, so be sure to check the
[documentation](http://rdoc.info/rdoc/wycats/thor/blob/f939a3e8a854616784cac1dcff04ef4f3ee5f7ff/Thor.html).

## Thor::Group

Thor has a special class called Thor::Group.  The main difference to Thor class
is that it invokes all tasks at once.  The example above could be rewritten in
Thor::Group as this:

    class Counter < Thor::Group
      desc "Prints 1, 2, 3"
      
      def one
        puts 1
      end
     
      def two
        puts 2
      end
      
      def three
        puts 3
      end
    end

When invoked:

    thor counter

It prints "1 2 3" as well.  Notice you should describe (using the method <tt>desc</tt>)
only the class and not each task anymore.  Thor::Group is a great tool to create
generators, since you can define several steps which are invoked in the order they
are defined (Thor::Group is the tool use in generators in Rails 3.0). 

Besides, Thor::Group can parse arguments and options as Thor tasks: 

    class Counter < Thor::Group
      # number will be available as attr_accessor
      argument :number, :type => :numeric, :desc => "The number to start counting"
      desc "Prints the 'number' given upto 'number+2'"
      
      def one
        puts number + 0
      end
      
      def two
        puts number + 1
      end
      
      def three
        puts number + 2
      end
    end

The counter above expects one parameter and has the folling outputs:

    thor counter 5
    # Prints "5 6 7"

    thor counter 11
    # Prints "11 12 13"

You can also give options to Thor::Group, but instead of using <tt>method_option</tt>
and <tt>method_options</tt>, you should use <tt>class_option</tt> and <tt>class_options</tt>.
Both argument and class_options methods are available to Thor class as well.

## Actions

Thor comes with several actions which helps with script and generator tasks.  You
might be familiar with them since some came from Rails Templates.  They are:
<tt>say</tt>, <tt>ask</tt>, <tt>yes?</tt>, <tt>no?</tt>, <tt>add_file</tt>,
<tt>remove_file</tt>, <tt>copy_file</tt>, <tt>template</tt>, <tt>directory</tt>,
<tt>inside</tt>, <tt>run</tt>, <tt>inject_into_file</tt> and a couple more. 

To use them, you just need to include Thor::Actions in your Thor classes:

    class App < Thor
      include Thor::Actions
      # tasks
    end

Some actions like copy file requires that a class method called source_root is
defined in your class.  This is the directory where your templates should be
placed.  Be sure to check the documentation on [actions](http://rdoc.info/rdoc/wycats/thor/blob/f939a3e8a854616784cac1dcff04ef4f3ee5f7ff/Thor/Actions.html).

## Generators

A great use for Thor is creating custom generators.  Combining Thor::Group,
Thor::Actions and ERB templates makes this very easy.  Here is an example:

    class Newgem < Thor::Group
      include Thor::Actions

      # Define arguments and options
      argument :name
      class_option :test_framework, :default => :test_unit

      def self.source_root
        File.dirname(__FILE__)
      end

      def create_lib_file
        template('templates/newgem.tt', "#{name}/lib/#{name}.rb")
      end

      def create_test_file
        test = options[:test_framework] == "rspec" ? :spec : :test
        create_file "#{name}/#{test}/#{name}_#{test}.rb"
      end

      def copy_licence
        if yes?("Use MIT license?")
          # Make a copy of the MITLICENSE file at the source root
          copy_file "MITLICENSE", "#{name}/MITLICENSE"
        else
          say "Shame on you", :red
        end
      end
    end

Doing a <tt>thor -T</tt> will show how to run our generator.  It should read:
<tt>thor newgem NAME</tt>.  This shows that we have to supply a NAME
argument for our generator to run.

The <tt>create_lib_file</tt> uses an ERB template. This is what it looks like:

    class <%= name.capitalize %>
    end

The arguments that you set in your generator will automatically be passed in
when <tt>template</tt> gets called.  Be sure to read the [documentation](http://rdoc.info/rdoc/wycats/thor/blob/f939a3e8a854616784cac1dcff04ef4f3ee5f7ff/Thor/Actions.html) for
more options.

Running the generator with <tt>thor newgem devise</tt> will
create two files: "devise/lib/devise.rb", and "devise/test/devise_test.rb".  The user will then be asked (via a prompt by the <tt>yes?</tt> method) whether or not they would like to copy the MIT License.  If you want to change the test framework, you can add the option: <tt>thor newgem devise --test-framework=rspec</tt> 

This will generate two files - "devise/lib/devise.rb" and "devise/spec/devise_spec.rb".

## Further Reading

Thor offers many scripting possibilities beyond these examples.  Be sure to read
through the [documentation](http://rdoc.info/rdoc/wycats/thor/blob/f939a3e8a854616784cac1dcff04ef4f3ee5f7ff/Thor.html) and [specs](http://github.com/wycats/thor/tree/master/spec/) to get a better understanding of the options available. 

## License

Released under the MIT License.  See the LICENSE file for further details. 

__start__
README
__end__

Support
=======

Support for Treetop is provided through the mailing list you can join or browse here:
http://groups.google.com/group/treetop-dev 

Tutorial
========
Languages can be split into two components, their *syntax* and their *semantics*. It's your understanding of English syntax that tells you the stream of words "Sleep furiously green ideas colorless" is not a valid sentence. Semantics is deeper. Even if we rearrange the above sentence to be "Colorless green ideas sleep furiously", which is syntactically correct, it remains nonsensical on a semantic level. With Treetop, you'll be dealing with languages that are much simpler than English, but these basic concepts apply. Your programs will need to address both the syntax and the semantics of the languages they interpret.

Treetop equips you with powerful tools for each of these two aspects of interpreter writing. You'll describe the syntax of your language with a *parsing expression grammar*. From this description, Treetop will generate a Ruby parser that transforms streams of characters written into your language into *abstract syntax trees* representing their structure. You'll then describe the semantics of your language in Ruby by defining methods on the syntax trees the parser generates.

Parsing Expression Grammars, The Basics
=======================================
The first step in using Treetop is defining a grammar in a file with the `.treetop` extension. Here's a grammar that's useless because it's empty:
    
    # my_grammar.treetop
    grammar MyGrammar
    end

Next, you start filling your grammar with rules. Each rule associates a name with a parsing expression, like the following:

    # my_grammar.treetop
    # You can use a .tt extension instead if you wish
    grammar MyGrammar
      rule hello
        'hello chomsky'
      end
    end

The first rule becomes the *root* of the grammar, causing its expression to be matched when a parser for the grammar is fed a string. The above grammar can now be used in a Ruby program. Notice how a string matching the first rule parses successfully, but a second nonmatching string does not.

    # use_grammar.rb
    require 'rubygems'
    require 'treetop'
    Treetop.load 'my_grammar'
    # or just:
    # require 'my_grammar'                     # This works because Polyglot hooks "require" to find and load Treetop files
    
    parser = MyGrammarParser.new
    puts parser.parse('hello chomsky')         # => Treetop::Runtime::SyntaxNode
    puts parser.parse('silly generativists!')  # => nil

Users of *regular expressions* will find parsing expressions familiar. They share the same basic purpose, matching strings against patterns. However, parsing expressions can recognize a broader category of languages than their less expressive brethren. Before we get into demonstrating that, lets cover some basics. At first parsing expressions won't seem much different. Trust that they are.

Terminal Symbols
----------------
The expression in the grammar above is a terminal symbol. It will only match a string that matches it exactly. There are two other kinds of terminal symbols, which we'll revisit later. Terminals are called *atomic expressions* because they aren't composed of smaller expressions.

Ordered Choices
---------------
Ordered choices are *composite expressions*, which allow for any of several subexpressions to be matched. These should be familiar from regular expressions, but in parsing expressions, they are delimited by the `/` character. Its important to note that the choices are prioritized in the order they appear. If an earlier expression is matched, no subsequent expressions are tried. Here's an example:

    # my_grammar.treetop
    grammar MyGrammar
      rule hello
        'hello chomsky' / 'hello lambek'
      end
    end
    
    # fragment of use_grammar.rb
    puts parser.parse('hello chomsky')         # => Treetop::Runtime::SyntaxNode
    puts parser.parse('hello lambek')          # => Treetop::Runtime::SyntaxNode
    puts parser.parse('silly generativists!')  # => nil

Note that once a choice rule has matched the text using a particular alternative at a particular location in the input and hence has succeeded, that choice will never be reconsidered, even if the chosen alternative causes another rule to fail where a later alternative wouldn't have. It's always a later alternative, since the first to succeed is final - why keep looking when you've found what you wanted? This is a feature of PEG parsers that you need to understand if you're going to succeed in using Treetop. In order to memoize success and failures, such decisions cannot be reversed. Luckily Treetop provides a variety of clever ways you can tell it to avoid making the wrong decisions. But more on that later.

Sequences
---------
Sequences are composed of other parsing expressions separated by spaces. Using sequences, we can tighten up the above grammar.

    # my_grammar.treetop
    grammar MyGrammar
      rule hello
        'hello ' ('chomsky' / 'lambek')
      end
    end

Note the use of parentheses to override the default precedence rules, which bind sequences more tightly than choices.

Once the whole sequence has been matched, the result is memoized and the details of the match will not be reconsidered for that location in the input.

Nonterminal Symbols
-------------------
Here we leave regular expressions behind. Nonterminals allow expressions to refer to other expressions by name. A trivial use of this facility would allow us to make the above grammar more readable should the list of names grow longer.

    # my_grammar.treetop
    grammar MyGrammar
      rule hello
        'hello ' linguist
      end
      
      rule linguist
        'chomsky' / 'lambek' / 'jacobsen' / 'frege'
      end
    end

The true power of this facility, however, is unleashed when writing *recursive expressions*. Here is a self-referential expression that can match any number of open parentheses followed by any number of closed parentheses. This is theoretically impossible with regular expressions due to the *pumping lemma*.

    # parentheses.treetop
    grammar Parentheses
      rule parens
        '(' parens ')' / ''
      end
    end


The `parens` expression simply states that a `parens` is a set of parentheses surrounding another `parens` expression or, if that doesn't match, the empty string. If you are uncomfortable with recursion, its time to get comfortable, because it is the basis of language. Here's a tip: Don't try and imagine the parser circling round and round through the same rule. Instead, imagine the rule is *already* defined while you are defining it. If you imagine that `parens` already matches a string of matching parentheses, then its easy to think of `parens` as an open and closing parentheses around another set of matching parentheses, which conveniently, you happen to be defining. You know that `parens` is supposed to represent a string of matched parentheses, so trust in that meaning, even if you haven't fully implemented it yet.

Repetition
----------
Any item in a rule may be followed by a '+' or a '*' character, signifying one-or-more and zero-or-more occurrences of that item. Beware though; the match is greedy, and if it matches too many items and causes subsequent items in the sequence to fail, the number matched will never be reconsidered. Here's a simple example of a rule that will never succeed:

    # toogreedy.treetop
    grammar TooGreedy
      rule a_s
      	'a'* 'a'
      end
    end

The 'a'* will always eat up any 'a's that follow, and the subsequent 'a' will find none there, so the whole rule will fail. You might need to use lookahead to avoid matching too much. Alternatively, you can use an occurrence range:

    # toogreedy.treetop
    grammar TooGreedy
      rule two_to_four_as
      	'a' 2..4
      end
    end

In an occurrence range, you may omit either the minimum count or the maximum count, so that "0.. " works like "*" and "1.. " works like '+'.

Negative Lookahead
------------------

When you need to ensure that the following item *doesn't* match in some case where it might otherwise, you can use negat!ve lookahead, which is an item preceeded by a ! - here's an example:

    # postcondition.treetop
    grammar PostCondition
      rule conditional_sentence
        ( !conditional_keyword word )+ conditional_keyword [ \t]+ word*
      end

      rule word
        ([a-zA-Z]+ [ \t]+) 
      end

      rule conditional_keyword
        'if' / 'while' / 'until'
      end
    end

Even though the rule `word` would match any of the conditional keywords, the first words of a conditional_sentence must not be conditional_keywords. The negative lookahead prevents that matching, and prevents the repetition from matching too much input. Note that the lookahead may be a grammar rule of any complexity, including one that isn't used elsewhere in your grammar.

Positive lookahead
------------------

Sometimes you want an item to match, but only if the *following* text would match some pattern. You don't want to consume that following text, but if it's not there, you want this rule to fail. You can append a positive lookahead like this to a rule by appending the lookahead rule preceeded by an & character.

Semantic predicates
-------------------

Warning: This is an advanced feature. You need to understand the way a packrat parser operates to use it correctly. The result of computing a rule containing a semantic predicate will be memoized, even if the same rule, applied later at the same location in the input, would work differently due to a semantic predicate returning a different value. If you don't understand the previous sentence yet still use this feature, you're on your own, so test carefully!

Sometimes, you need to run external Ruby code to decide whether this syntax rule should continue or should fail. You can do this using either positive or negative semantic predicates. These are Ruby code blocks (lambdas) which are called when the parser reaches that location. For this rule to succeed, the value must be true for a positive predicate (a block like &{ ... }), or false for a negative predicate (a block like !{ ... }).

The block is called with one argument, the array containing the preceding syntax nodes in the current sequence. Within the block, you cannot use node names or labels for the preceding nodes, as the node for the current rule does not yet exist. You must refer to preceding nodes using their position in the sequence.

    grammar Keywords
      rule sequence_of_reserved_and_nonreserved_words
      	( reserved / word )*
      end

      rule reserved
        word &{ |s| symbol_reserved?(s[0].text_value) }
      end

      rule word
        ([a-zA-Z]+ [ \t]+) 
      end
    end

One case where it is always safe to use a semantic predicate is to invoke the Ruby debugger, but don't forget to return true so the rule succeeds! Assuming you have required the 'ruby-debug' module somewhere, it looks like this:

      rule problems
        word &{ |s| debugger; true }
      end

When the debugger stops here, you can inspect the contents of the SyntaxNode for "word" by looking at s[0], and the stack trace will show how you got there.

= TZInfo -- Daylight-savings aware timezone support for Ruby

TZInfo[http://tzinfo.rubyforge.org] uses the tz database 
(http://www.twinsun.com/tz/tz-link.htm) to provide
daylight-savings aware transformations between times in different timezones.
This is the same database as used for zoneinfo on Unix machines.

The tz database has been imported (using TZDataParser) and turned into a set of
Ruby modules (which are packaged with this release).


== Example usage

To convert a time in UTC to a local time in the America/New_York timezone, you
can do the following:

  require 'tzinfo'
  
  tz = TZInfo::Timezone.get('America/New_York')
  local = tz.utc_to_local(Time.utc(2005,8,29,15,35,0))

Note that the Time returned will look like it is UTC (Time.zone will return 
"UTC"). This is because it is not currently possible to change the offset of 
an individual Time instance.
  
To convert from a local time to UTC, the local_to_utc method can be used. 

  utc = tz.local_to_utc(local)

Note that the timezone information of the time you pass in is ignored. The
following two lines will return the same result regardless of the local 
timezone:

  tz.local_to_utc(Time.local(2006,6,26,1,0,0))
  tz.local_to_utc(Time.utc(2006,6,26,1,0,0))
  
To get information about the rules in force at a particular UTC or local time,
the Timezone.period_for_utc and Timezone.period_for_local methods can be used.
Both of these methods return TimezonePeriod objects. The following gets the 
identifier for the period (in this case EDT).

  period = tz.period_for_utc(DateTime.new(2005,8,29,15,35,0))
  id = period.zone_identifier
  
In all the above examples, instances of Time can be used instead of DateTime.
Timezone#utc_to_local and Timezone#local_to_utc both return the type they are 
passed.

You can get the current local time in a Timezone with the Timezone#now method:

  now = tz.now

All methods in TZInfo that take a time can be used with either Time, DateTime
or Integers (Time#to_i). The return type will be the same as the type passed in.
  
You can also access Timezones by Country (ISO 3166 country code). The following 
gets all the Timezone identifiers for the US:

  us = TZInfo::Country.get('US')
  timezones = us.zone_identifiers
  
The zone_info method of Country provides an additional description and
location for each Timezone in the Country.
  
The above covers the most common uses of Timezone and Country. For more detail,
see the API documentation for the individual classes.


== Download

The latest version of TZInfo can be found at

* http://rubyforge.org/frs/?group_id=894

API documentation can be found at 

* http://tzinfo.rubyforge.org/doc/


== Installation

The preferred method of installing TZInfo is through the GEM file (RubyGems[http://docs.rubygems.org/] required):

  % gem install tzinfo-x.y.z.gem
  
or to automatically download and install:

  % gem install tzinfo --remote
  

== License

TZInfo is released under the MIT[http://opensource.org/licenses/mit-license.html] license.


== Support

Please post to the TZInfo Users mailing list (http://rubyforge.org/mailman/listinfo/tzinfo-users)
if you require assistance or have any suggestions.

Alternatively, you can contact the author Philip Ross directly at phil.ross@gmail.com.
ironruby-rack
=============
Deploy and run Rack-based web applications on IIS with IronRuby ([announcement blog-post](http://blog.jimmy.schementi.com/2009/05/ironruby-at-railsconf-2009.html#iis))

Setup
-----
TODO need to make a gem/binary for this, and automate IIS/Cassini installation
and setup. The first binary release of ironruby-rack (as a gem) will be soon after
ironruby-1.0rc4.

Install Rack

    igem install rack

Install IIS 6 or 7 (this set of features might be overkill)

*  Internet Information Services
   *  World Wide Web Services
      *  Application Development Features
      *  Common HTTP Features -> Default Document, Directory Browsing, 
         HTTP Redirection and Static Content
      *  Performance features -> Static Content Compression
      *  Security -> Request Filtering and Windows Authentication
   *  Web Management Tools
      *  IIS 6 Management Compatibility -> IIS Metabase and IIS6 configuration
         compatibility
      *  IIS Management Console
      *  IIS Management Script and Tools
      *  IIS Management Service

Copy web.config and config.ru (if your app does't already have one) to your
application's root directory, and tweak any settings in web.config as necessary.

Add your application as a "Web Application" in IIS's control panel.

* Also, I suggest to create a seperate app-pool for all your Ruby applications, 
  make sure your application is assigned to it. Also make sure the app is 
  running as a user that has (at least) read-only permission to Ruby's
  standard libraries and RubyGems (the path's defined in web.config).

Navigate to your application in a browser, and Rails will start on first load.

For developers
--------------
First see the general Setup instruction above.

* Open IronRuby.Rack.sln in Visual Studio 2008 (or IronRuby.Rack.4.sln 
  for Visual Studio 2010).
* Click "OK" to prompts about creating virtual directories, otherwise not 
  all the project files will load. This also requires you run Visual Studio
  as an Administrator. This installs the test apps in IIS.
* IIS usually runs as IIS_IUSRS, which means that IIS won't have access
  to your application or the Ruby/IronRuby libraries unless you either grant
  read access to IIS_IUSRS (and write access to your application so it can
  write the log files). You can also run the application in an AppPool which
  has the identity of another user, if you don't want to give IIS free range.
* Right-click on IronRuby.Rack.Example and select "Set as StartUp Project".
* press F5 (Compile and Debug), and the Rack application will start.

Running tests
-------------
To run the tests, just launch the test.bat file:

    test.bat

This will test that IronRuby and Ruby can run a simple Rack, Sinatra, and Rails
application, and benchmarks under various loads (first 10 requests, and then
100 simultaneous requests).

To run an actual test of ironruby-rack, use the -w flag:

    ir test.rb rack -w

This will run just the rack tests in IronRuby, and then do 100 simultaneous
requests against the IIS hosted version (TODO you must have set this up first).

See the help for more info

    ir test.rb -h

How it works
------------
* Uses ASP.NET's HttpHandlers to
   * Registering IronRuby.Rack in the Rack-based application's Web.config
   * Load a Rack-based application on startup (HttpHandlerFactory and 
     Application constructor).
     * Initializes Rack and runs the application's config.ru, which tells Rack
       what application (any Ruby object that responds to 'call')
   * Intercept web requests (HttpHandler.ProcessRequest)
     * Creates a Request and a Response, and passes it off to IIS.Handle which:
       * Set up the environment according to the Rack specification
       * Calls Application.Call with the prepared environment, which delegates 
         to the Rack application's "call" method (registered in the config.ru
         file). All C# <-> Ruby interaction happens in the RubyEngine.
       * Rack application does its thing (process Rails/Sinatra request, or 
         deal with things itself) and returns a response according to the Rack 
         specification.
       * Takes the Rack response and pass the appropriate data to the IIS 
         response (response body, status, headers)

TODO
----
* Support Rack::Handler::IIS.run as a way to launch cassini, so
  "rackup" works as well (without depending on webrick).
* Should rename to AspDotNet or something like that, as it's not IIS-specific
  (works on cassini).
* Run actual non-webserver-specific rack tests, to verify that this adapter
  is a good rack-citizen.
* Add ASP.NET specific tests to rack, and try to get this merged in entirely?

Cassini Web Server Sample v3.5 README.TXT
------------------------------------------

This Cassini version requires .NET Framework v3.5

This sample illustrates using the ASP.NET hosting APIs (System.Web.Hosting)
to create a simple managed Web Server with System.Net APIs.

New in Cassini v3.5:
* Runs as a single EXE -- does not require an assembly in GAC
* Supported IPv6-only configurations
* Upgraded to support .NET Framework 3.5
* Includes VS project file
* License changed to Ms-PL

Instructions to Run Cassini
---------------------------

Cassini-v35 <physical-path> <port> <virtual-path>
For example:
    Cassini-v35 c:\ 80 /

Chiron.exe - Silverlight Development Utility

Chiron is a command-line utility for creating Silverlight XAP files and
enabling package-less development of dynamic language applications.

1. Creating Silverlight XAP files

  Chiron can produce Silverlight application packages (XAP) for C#/VB
  applications, as well as any Dynamic Language Runtime (DLR) based language.
  The Silverlight SDK provides IronRuby, IronPython, and Managed JScript.

  a. XAP a C#/VB application

    The Silverlight Visual Studio Tools use Chiron in a post-build step to
    package a Silverlight application. However, if you had a un-packaged built
    Silverlight application, you could package it with the following:

    >Chiron.exe /directory:MyApp /xap:MyApp.xap

  b. XAP a DLR application

    Dynamic language applications require the DLR and language assemblies to be
    inside the package as well. To do this automatically:

    >Chiron.exe /directory:MyApp\app /zipdlr:app.xap

    This will XAP the app directory, generate an AppManifest.xaml if necessary, 
    and insert the DLR assemblies and the language assemblies of the languages 
    you usedin your app.

    Given this simple application:

    MyApp\
    MyApp\index.html
    MyApp\app\
    MyApp\app\app.rb

    Chiron will generate an app.xap (in the MyApp folder) with these contents:

    app.rb
    AppManifest.xaml
    IronRuby.dll
    IronRuby.Libraries.dll
    Microsoft.Dynamic.dll
    Microsoft.Scripting.dll
    Microsoft.Scripting.Silverlight.dll

2. Package-less development of DLR applications

  Generating a XAP file works great for compiled languages since they can do it
  as a post-build step. However, dynamic languages are traditionally not 
  compiled to disk, so Chiron automates the XAP file creation with every 
  web-request.

  So, with our same sample app:

  >cd MyApp
  >Chiron.exe /webserver

  Chiron will launch a localhost-only web-server at http://localhost:2060 with
  the webroot being the current working directory. When it receives a request 
  for "app.xap", it will look for a folder named "app", XAP the contents (same 
  behavior as the /zipdlr flag) in memory, and send it back to the client.

  This allows for the developer to edit a file and simply hit refresh on their
  browser to see the change.

3. Configuration

  Chiron allows you to configure what languages it knows about and the
  AppManifest.xaml template by modifying Chiron.exe.config.

  New languages can be added in the <languages> section as follows:

  <language extensions="myext"
            assemblies="MyLanguageRuntime.dll"
            languageContext="MyLanguage.Namespace.MyLanguageContextClass" />

  Customizations to the AppManifest template go in the <appManifestTemplate>
  section.

4. Documentation

  Running Chiron without any command-line arguments will show you the avaliable
  flags Chiron will accept.
  
  >Chiron.exe
  Microsoft(R) Silverlight(TM) Development Utility. Version 1.0.0.0
  Copyright (c) Microsoft Corporation.  All rights reserved.

  Usage: Chiron [<options>]

  General Options:

    /d[irectory]:<path>
      Specifies directory on disk (default: the current directory)

    /x[ap]:<file>
      Specifies XAP file to generate
      Does not start the web server, cannot be combined with /w or /b

    /n[ologo]
      Suppresses display of the logo banner

    /s[ilent]
      Suppresses display of all output

  Dynamic Language Options:

    /z[ipdlr]:<file>
      Like /x, but includes files needed for dyanmic language apps
      Does not start the web server, cannot be combined with /w or /b

    /w[ebserver][:<port number>]
      Launches a development web server that automatically creates
      XAP files for dynamic language applications
      Optionally specifies server port number (default: 2060)

    /b[rowser]
      Launches the default browser and starts the web server
      Implies /w, cannot be combined with /x or /z

    /r[efpath]:<path>
      Specifies the directory that contains dynamic language assemblies
      Only copies the assemblies for the languages used in the project
      (defaults to "dlr" subfolder under Chrion install location)

    /m[anifest]
      Saves the generated AppManifest.xaml file to disk
      Use /d to set the directory containing the sources
      Can only be combined with /d, /n and /s


Dynamic Languages in Silverlight
========================================
  [Dynamic Languages on Silverlight.net](http://silverlight.net/dlr) 

  Microsoft.Scripting.Silverlight.dll is the integration 
  between Silverlight and Dynamic Languages running on the Dynamic Language 
  Runtime (DLR). The supported languages are IronPython and IronRuby.

  Note: this is meant to be used to develop applications with 
  Silverlight. Install Silverlight for [Windows](http://go.microsoft.com/fwlink/?LinkID=119972)
  or [Mac](http://go.microsoft.com/fwlink/?LinkID=119973)

Package
-------
  /Samples:   See /samples/README.markdown for more information
  
  /Utils:     See /Utils/README.markdown

  /Chiron:    Source code for Chiron.exe. See /Chiron/README

  /Microsoft.Scripting.Silverlight: Source code for Microsoft.Scripting.Silverlight.dll

  /Public:    Tools for creating and running Silverlight applications, and the
              Apache License, Version 2.0

Getting Started
---------------
  1. Create a new Silverlight application

      script/sl [ruby|python] <application_name>

    This will create a Silverlight application in the language of your choosing in
    the "application_name" directory where you ran the script.

  2. Run an application

      script/server /b

    This will launch Chiron, the Silverlight development utility, as well as open
    your default browser to [http://localhost:2060](http://localhost:2060). If you pass the /w
    instead of the /b switch, it will just start the server and not launch your
    browser. See the Chiron section below for more of its usage details.

    This command requires Mono to be installed on the Mac.
    [Download Mono](http://www.go-mono.com/mono-downloads/download.html)

CHANGELOG
---------
  
  2010-03-05
  
  - MIX10 release
  
  2009-11-??
  
  - RubyConf release
  
  - Adds support for DLR-based languages embedded in the HTML page:
    <script type="text/python">, <script type="text/ruby">, and
    <script type="text/arbitrary-dlr-language">.

  2009-03-20

  - MIX09 release for Silverlight 2 and Silverlight 3 Beta.

  - Adds a dynamic language REPL to any Silverlight app for a explorative
    developer experience (add console=true to initParams. See 
    samples/(python|ruby)/repl as well for how to use Repl programatically.)

  - Run the Test suite (using IronRuby and Bacon) as any other Silverlight
    application, and use Bacon to write your own tests suites. 
    http://github.com/jschementi/eggs

  - Beginnings of a port of the internal Microsoft DLR Silverlight test suite.

  - API improvement for hosting DLR language in C#/VB Silverlight applications.

  - Fix Codeplex Bug# 11803 (zip version fix)

  - chiron-here.reg - Run Chiron by right-clicking on a directory (in utilities)

  - set DynamicApplication.XapFile to change where a language's filesystem 
    features/libraries look for files.

  - Chiron /path option - ";" separated list of folder to be included in XAP
    (poor mans lib path)

  - New versions of IronRuby (0.3) and IronPython (2.6 pre-alpha)

  - DynamicApplication.LoadAssemblies - support for SL3 Transparent Platform
    Extensions.

  - Managed JScript has been removed from the package.

  - Thanks for the contributions!
    * Removed UI thread check in FileExists (Eloff) November 26, 2008
      commit bd9b2d56eeda8aea69b90245f86493fc22ca0803
    * Fixed ErrorReporter bug when _sourceFileName is not a file on disk (e.g. <string>) (Eloff) November 26, 2008
      commit 61ee0134167a546a55cf138ef63edc5d7eb4b830
    * XapHttpHandler gives IIS or Cassini the auto-XAPing power of Chiron (also in utilities) (Harry Pierson) March 19, 2009
      commit 63a5ea3cf94068b87273531b5c96d84d8de983d2

  2008-10-15

  - New builds of DLR/Languages for Silverlight 2 RTW

  - Custom Fonts: In Silverlight 2 Beta 2 a custom font could either be placed 
    in the XAP file, or as an assembly resource, and loaded by Silverlight. 
    In Silverlight 2 RC0, only an assembly resource is allowed. The current 
    work-around for dynamic languages is to load a dummy DLL with the fonts as
    resources.

  - JScript/Python Interop: This version breaks JScript/Python interop since
    JScript does not support IDynamicObject, which Python uses to do dynamic 
    method dispatch. Therefore, the sample that showed this, jscript/fractulator,
    is not in this release.

  2008-09-29

  - New builds of DLR/Languages for Silverlight 2 RC

  2008-08-29

  - New builds of DLR/Languages

  2008-06-11

  - Now script/sl.bat does not depend on Ruby being installed

  2008-06-09

  - Release for Silverlight 2 Beta 2. Removes samples and source code from 
    main project to seperate downloads on http://codeplex.com/sdlsdk.

  2008-05-06

  - Adds Managed JScript to the package, as well as the "sl" command

  2008-03-07

  - MIX08 release for Silverlight 2; IronRuby and IronPython support for 
    Silverlight 2 Beta 1.
    
  - Abandons <x:Code /> model for a in XAP solution, and uses a auto-xapping 
    tool (Chiron.exe) for a nice development experience.


Run "run.bat" to prepare the samples and launch index.html.
Run "units.bat" to run the units sample

Silverlight Tests
=================

To run, simply run rbr4 -S rake. It will launch both ie and firefox and display the
test results on completion.

Utilities
=========
chiron-here.reg
---------------
Runs Chiron on any directory just by right-clicking on it.

1. UPDATE SDLSDK LOCATION!

  chiron-here.reg assumes that you unzipped sdl-sdk.zip into C:\sdl-sdk. If this
  is not the case, open chiron-here.reg in your editor of choice (notepad will do)
  and change the two paths to point to your sdl-sdk location. 

2. INSTALL

  Double click on chiron-here.reg file. It will prompt you to make sure you trust
  the source of the .reg file; click *Yes* if you want to install it. That's it! No
  reboot required.

3. USAGE

  You will now have two extra options when you right-click on a folder: "Start
  Chiron Here" and "Generate XAP Here". 

  "Start Chiron Here" will run Chiron on port 2060at the directory you right-clicked 
  on. Then navigate to http://localhost:2060 with your web-browser.

  "Generate XAP Here" will generate a XAP file to disk to deployment. The
  directory you right-clicked on will appear as a .xap file in the same parent
  directory.

XAP HTTP Handler
================

Chiron.exe contains the XapHttpHandler type, which is a HttpHandler to enable 
IIS or the ASP.NET Development WebServer (Cassini) to auto-xap any directory
when requested with the .xap extension, just like Chiron does.

xap-http-handler\XapHttpHandler.sln is a example of this working in action. Make
sure to run xap-http-handler\update.bat first, so the DLR binaries are copied to
the website.

To set it up for your own project:

Visual Studio ASP.NET Development WebServer (Cassini)
-----------------------------------------------------
1. Create a ASP.NET Website project
2. Add the binaries in the bin folder to a Bin folder inside the website.
3. Copy xap-http-handler\XapHttpHandler.SampleSite\web.config to your app

IIS
---
Works the same as above; just move your project to IIS.

Known issues:
- Requires Silverligh 3 build of DLR.
- Doesn't support delay-signed binaries.

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

#if FEATURE_CORE_DLR
using System.Linq.Expressions;
#else
using Microsoft.Scripting.Ast;
#endif

using System;
using System.Dynamic;

using Microsoft.Scripting;
using Microsoft.Scripting.Actions;
using Microsoft.Scripting.Actions.Calls;
using Microsoft.Scripting.Runtime;
using Microsoft.Scripting.Utils;

using IronPython.Runtime.Operations;
using IronPython.Runtime.Types;

namespace IronPython.Runtime.Binding {
    using Ast = Expression;
    using AstUtils = Microsoft.Scripting.Ast.Utils;

    class MetaBuiltinMethodDescriptor : MetaPythonObject, IPythonInvokable, IPythonOperable {
        public MetaBuiltinMethodDescriptor(Expression/*!*/ expression, BindingRestrictions/*!*/ restrictions, BuiltinMethodDescriptor/*!*/ value)
            : base(expression, BindingRestrictions.Empty, value) {
            Assert.NotNull(value);
        }

        #region IPythonInvokable Members

        public DynamicMetaObject/*!*/ Invoke(PythonInvokeBinder/*!*/ pythonInvoke, Expression/*!*/ codeContext, DynamicMetaObject/*!*/ target, DynamicMetaObject/*!*/[]/*!*/ args) {
            return InvokeWorker(pythonInvoke, codeContext, args);
        }

        #endregion

        #region MetaObject Overrides

        public override DynamicMetaObject/*!*/ BindInvokeMember(InvokeMemberBinder/*!*/ action, DynamicMetaObject/*!*/[]/*!*/ args) {
            return BindingHelpers.GenericInvokeMember(action, null, this, args);
        }

        public override DynamicMetaObject/*!*/ BindInvoke(InvokeBinder/*!*/ call, params DynamicMetaObject/*!*/[]/*!*/ args) {
            // TODO: Context should come from BuiltinFunction
            return InvokeWorker(call, PythonContext.GetCodeContext(call), args);
        }

        #endregion

        #region Invoke Implementation

        private DynamicMetaObject/*!*/ InvokeWorker(DynamicMetaObjectBinder/*!*/ call, Expression/*!*/ codeContext, DynamicMetaObject/*!*/[] args) {
            PerfTrack.NoteEvent(PerfTrack.Categories.Binding, "BuiltinMethodDesc Invoke " + Value.DeclaringType + "." + Value.__name__ + " w/ " + args.Length + " args");
            PerfTrack.NoteEvent(PerfTrack.Categories.BindingTarget, "BuiltinMethodDesc Invoke");

            CallSignature signature = BindingHelpers.GetCallSignature(call);
            BindingRestrictions selfRestrict = BindingRestrictions.GetInstanceRestriction(Expression, Value).Merge(Restrictions);

            selfRestrict = selfRestrict.Merge(
                BindingRestrictions.GetExpressionRestriction(
                    MakeFunctionTest(
                        Ast.Call(
                            typeof(PythonOps).GetMethod("GetBuiltinMethodDescriptorTemplate"),
                            Ast.Convert(Expression, typeof(BuiltinMethodDescriptor))
                        )
                    )
                )
            );

            return Value.Template.MakeBuiltinFunctionCall(
                call,
                codeContext,
                this,
                args,
                false,  // no self
                selfRestrict,
                (newArgs) => {
                    BindingTarget target;
                    PythonContext state = PythonContext.GetPythonContext(call);

                    DynamicMetaObject res = state.Binder.CallMethod(
                        new PythonOverloadResolver(
                            state.Binder,
                            newArgs,
                            signature,
                            codeContext
                        ),
                        Value.Template.Targets,
                        selfRestrict,
                        Value.Template.Name,
                        NarrowingLevel.None,
                        Value.Template.IsBinaryOperator ? PythonNarrowing.BinaryOperator : NarrowingLevel.All,
                        out target
                    );

                    return BindingHelpers.CheckLightThrow(call, res, target);
                });            
        }

        internal Expression MakeFunctionTest(Expression functionTarget) {
            return Ast.Equal(
                functionTarget,
                AstUtils.Constant(Value.Template)
            );
        }

        #endregion

        #region Helpers

        public new BuiltinMethodDescriptor/*!*/ Value {
            get {
                return (BuiltinMethodDescriptor)base.Value;
            }
        }

        #endregion

        #region IPythonOperable Members

        DynamicMetaObject IPythonOperable.BindOperation(PythonOperationBinder action, DynamicMetaObject[] args) {
            switch (action.Operation) {
                case PythonOperationKind.CallSignatures:
                    return PythonProtocol.MakeCallSignatureOperation(this, Value.Template.Targets);
            }

            return null;
        }

        #endregion
    }
}

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

using System;
using IronPython.Runtime.Operations;
using IronPython.Runtime.Types;
using Microsoft.Scripting.Runtime;

namespace IronPython.Runtime {
    [PythonType("method_descriptor"), DontMapGetMemberNamesToDir]
    public class ClassMethodDescriptor : PythonTypeSlot, ICodeFormattable {
        internal readonly BuiltinFunction _func;

        internal ClassMethodDescriptor(BuiltinFunction func) {
            this._func = func;
        }

        internal override bool TryGetValue(CodeContext context, object instance, PythonType owner, out object value) {
            owner = CheckGetArgs(context, instance, owner);
            value = new Method(_func, owner, DynamicHelpers.GetPythonType(owner));
            return true;
        }

        #region Descriptor Protocol
        
        private PythonType CheckGetArgs(CodeContext context, object instance, PythonType owner) {
            if (owner == null) {
                if (instance == null) throw PythonOps.TypeError("__get__(None, None) is invalid");
                owner = DynamicHelpers.GetPythonType(instance);
            } else {
                if (!owner.IsSubclassOf(DynamicHelpers.GetPythonTypeFromType(_func.DeclaringType))) {
                    throw PythonOps.TypeError("descriptor {0} for type {1} doesn't apply to type {2}",
                        PythonOps.Repr(context, _func.Name),
                        PythonOps.Repr(context, DynamicHelpers.GetPythonTypeFromType(_func.DeclaringType).Name),
                        PythonOps.Repr(context, owner.Name));
                }
            }
            if (instance != null)
                BuiltinMethodDescriptor.CheckSelfWorker(context, instance, _func);

            return owner;
        }

        #endregion

        #region ICodeFormattable Members

        public virtual string/*!*/ __repr__(CodeContext/*!*/ context) {
            BuiltinFunction bf = _func as BuiltinFunction;
            if (bf != null) {
                return String.Format("<method {0} of {1} objects>",
                    PythonOps.Repr(context, bf.Name),
                    PythonOps.Repr(context, DynamicHelpers.GetPythonTypeFromType(bf.DeclaringType).Name));
            }

            return String.Format("<classmethod object at {0}>",
                IdDispenser.GetId(this));
        }

        #endregion

        public override bool Equals(object obj) {
            ClassMethodDescriptor cmd = obj as ClassMethodDescriptor;
            if (cmd == null) return false;

            return cmd._func == _func;
        }

        public override int GetHashCode() {
            return ~_func.GetHashCode();
        }
    } 
}

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;

using Microsoft.Scripting;
using Microsoft.Scripting.Runtime;
using Microsoft.Scripting.Utils;

using IronPython.Runtime.Operations;
using IronPython.Runtime.Types;

namespace IronPython.Runtime {
    [PythonType]
    public class staticmethod : PythonTypeSlot {
        internal object _func;

        public staticmethod(object func) {
            this._func = func;
        }

        internal override bool TryGetValue(CodeContext context, object instance, PythonType owner, out object value) {
            value = __get__(instance, PythonOps.ToPythonType(owner));
            return true;
        }

        internal override bool GetAlwaysSucceeds {
            get {
                return true;
            }
        }

        public object __func__ {
            get {
                return _func;
            }
        }

        #region IDescriptor Members

        public object __get__(object instance) { return __get__(instance, null); }

        public object __get__(object instance, object owner) {
            return _func;
        }

        #endregion
    }

    [PythonType]
    public class classmethod : PythonTypeSlot {
        internal object func;

        public classmethod(CodeContext/*!*/ context, object func) {
            if (!PythonOps.IsCallable(context, func))
                throw PythonOps.TypeError("{0} object is not callable", PythonTypeOps.GetName(func));
            this.func = func;
        }

        internal override bool TryGetValue(CodeContext context, object instance, PythonType owner, out object value) {
            value = __get__(instance, PythonOps.ToPythonType(owner));
            return true;
        }

        internal override bool GetAlwaysSucceeds {
            get {
                return true;
            }
        }

        public object __func__ {
            get {
                return func;
            }
        }

        #region IDescriptor Members

        public object __get__(object instance) { return __get__(instance, null); }

        public object __get__(object instance, object owner) {
            if (owner == null) {
                if (instance == null) throw PythonOps.TypeError("__get__(None, None) is invalid");
                owner = DynamicHelpers.GetPythonType(instance);
            }
            return new Method(func, owner, DynamicHelpers.GetPythonType(owner));
        }

        #endregion
    }

    [PythonType("property")]
    public class PythonProperty : PythonTypeDataSlot {
        private object _fget, _fset, _fdel, _doc;

        public PythonProperty() {
        }

        public PythonProperty(params object[] args) {
        }

        public PythonProperty(
            [ParamDictionary]IDictionary<object, object> dict, params object[] args) {
        }

        public void __init__([DefaultParameterValue(null)]object fget,
                        [DefaultParameterValue(null)]object fset,
                        [DefaultParameterValue(null)]object fdel,
                        [DefaultParameterValue(null)]object doc) {
            _fget = fget; _fset = fset; _fdel = fdel; _doc = doc;
            if (GetType() != typeof(PythonProperty) && _fget is PythonFunction) {
                // http://bugs.python.org/issue5890
                PythonDictionary dict = UserTypeOps.GetDictionary((IPythonObject)this);
                if (dict == null) {
                    throw PythonOps.AttributeError("{0} object has no __doc__ attribute", PythonTypeOps.GetName(this));
                }

                dict["__doc__"] = ((PythonFunction)_fget).__doc__;
            }
        }

        internal override bool TryGetValue(CodeContext context, object instance, PythonType owner, out object value) {
            value = __get__(context, instance, PythonOps.ToPythonType(owner));
            return true;
        }

        internal override bool GetAlwaysSucceeds {
            get {
                return true;
            }
        }

        internal override bool TrySetValue(CodeContext context, object instance, PythonType owner, object value) {
            if (instance == null) {
                return false;
            }
            __set__(context, instance, value);
            return true;
        }

        internal override bool TryDeleteValue(CodeContext context, object instance, PythonType owner) {
            if (instance == null) {
                return false;
            } 
            __delete__(context, instance);
            return true;
        }

        [SpecialName, PropertyMethod, WrapperDescriptor]
        public static object Get__doc__(CodeContext context, PythonProperty self) {
            if (self._doc == null && PythonOps.HasAttr(context, self._fget, "__doc__")) {
                return PythonOps.GetBoundAttr(context, self._fget, "__doc__");
            } else if (self._doc == null) {
                System.Console.WriteLine("No attribute __doc__");
            }
            return self._doc;
        }

        [SpecialName, PropertyMethod, WrapperDescriptor]
        public static void Set__doc__(PythonProperty self, object value) {
            throw PythonOps.TypeError("readonly attribute");
        }

        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Usage", "CA1801:ReviewUnusedParameters", MessageId = "value")]
        public object fdel {
            get { return _fdel; }
            set {
                throw PythonOps.TypeError("readonly attribute");
            }
        }

        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Usage", "CA1801:ReviewUnusedParameters", MessageId = "value")]
        public object fset {
            get { return _fset; }
            set {
                throw PythonOps.TypeError("readonly attribute");
            }
        }

        [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Usage", "CA1801:ReviewUnusedParameters", MessageId = "value")]
        public object fget {
            get { return _fget; }
            set {
                throw PythonOps.TypeError("readonly attribute");
            }
        }

        public override object __get__(CodeContext/*!*/ context, object instance, [DefaultParameterValue(null)]object owner) {
            if (instance == null) {
                return this;
            } else if (fget != null) {
                var site = PythonContext.GetContext(context).PropertyGetSite;

                return site.Target(site, context, fget, instance);
            }
            throw PythonOps.UnreadableProperty();
        }

        public override void __set__(CodeContext/*!*/ context, object instance, object value) {
            if (fset != null) {
                var site = PythonContext.GetContext(context).PropertySetSite;

                site.Target(site, context, fset, instance, value);
            } else {
                throw PythonOps.UnsetableProperty();
            }
        }

        public override void __delete__(CodeContext/*!*/ context, object instance) {
            if (fdel != null) {
                var site = PythonContext.GetContext(context).PropertyDeleteSite;

                site.Target(site, context, fdel, instance);
            } else {
                throw PythonOps.UndeletableProperty();
            }
        }

        public PythonProperty getter(object fget) {
            PythonProperty res = new PythonProperty();
            res.__init__(fget, _fset, _fdel, _doc);
            return res;
        }

        public PythonProperty setter(object fset) {
            PythonProperty res = new PythonProperty();
            res.__init__(_fget, fset, _fdel, _doc);
            return res;
        }

        public PythonProperty deleter(object fdel) {
            PythonProperty res = new PythonProperty();
            res.__init__(_fget, _fset, fdel, _doc);
            return res;
        }
    }

}

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

#if FEATURE_CORE_DLR
using System.Linq.Expressions;
#else
using Microsoft.Scripting.Ast;
#endif

using System;
using System.Collections.Generic;
using System.Dynamic;
using System.Runtime.CompilerServices;

using Microsoft.Scripting;
using Microsoft.Scripting.Generation;
using Microsoft.Scripting.Utils;

using IronPython.Runtime.Binding;
using IronPython.Runtime.Operations;

namespace IronPython.Runtime.Types {
    using Ast = Expression;
    using AstUtils = Microsoft.Scripting.Ast.Utils;

    [PythonType("method_descriptor"), DontMapGetMemberNamesToDir]
    public sealed class BuiltinMethodDescriptor : PythonTypeSlot, IDynamicMetaObjectProvider, ICodeFormattable {
        internal readonly BuiltinFunction/*!*/ _template;

        internal BuiltinMethodDescriptor(BuiltinFunction/*!*/ function) {
            _template = function;
        }

        #region Internal APIs

        internal object UncheckedGetAttribute(object instance) {
            return _template.BindToInstance(instance);
        }

        internal override bool TryGetValue(CodeContext context, object instance, PythonType owner, out object value) {
            if (instance != null || owner == TypeCache.Null) {
                CheckSelf(context, instance);
                value = UncheckedGetAttribute(instance);
                return true;
            }
            value = this;
            return true;
        }

        internal override void MakeGetExpression(PythonBinder/*!*/ binder, Expression/*!*/ codeContext, DynamicMetaObject instance, DynamicMetaObject/*!*/ owner, ConditionalBuilder/*!*/ builder) {
            if (instance != null) {
                builder.FinishCondition(
                    Ast.Call(
                        typeof(PythonOps).GetMethod("MakeBoundBuiltinFunction"),
                        AstUtils.Constant(_template),
                        instance.Expression
                    )
                );
            } else {
                builder.FinishCondition(AstUtils.Constant(this));
            }
        }

        internal override bool GetAlwaysSucceeds {
            get {
                return true;
            }
        }

        internal BuiltinFunction/*!*/ Template {
            get { return _template; }
        }

        public Type/*!*/ DeclaringType {
            [PythonHidden]
            get {
                return _template.DeclaringType;
            }
        }

        internal static void CheckSelfWorker(CodeContext/*!*/ context, object self, BuiltinFunction template) {
            // to a fast check on the CLR types, if they match we can avoid the slower
            // check that involves looking up dynamic types. (self can be null on
            // calls like set.add(None) 
            Type selfType = CompilerHelpers.GetType(self);
            if (selfType != template.DeclaringType && !template.DeclaringType.IsAssignableFrom(selfType)) {
                // if a conversion exists to the type allow the call.
                context.LanguageContext.Binder.Convert(self, template.DeclaringType);
            }
        }

        internal override bool IsAlwaysVisible {
            get {
                return _template.IsAlwaysVisible;
            }
        }

        #endregion

        #region Private Helpers

        private void CheckSelf(CodeContext/*!*/ context, object self) {
            if ((_template.FunctionType & FunctionType.FunctionMethodMask) == FunctionType.Method) {
                CheckSelfWorker(context, self, _template);
            }
        }

        #endregion
        
        #region Public Python API

        public string __name__ {
            get {
                return Template.__name__;
            }
        }

        public string __doc__ {
            get {
                return Template.__doc__;
            }
        }

        public object __call__(CodeContext context, SiteLocalStorage<CallSite<Func<CallSite, CodeContext, object, object[], IDictionary<object, object>, object>>> storage, [ParamDictionary]IDictionary<object, object> dictArgs, params object[] args) {
            return _template.__call__(context, storage, dictArgs, args);
        }

        public PythonType/*!*/ __objclass__ {
            get {
                return DynamicHelpers.GetPythonTypeFromType(_template.DeclaringType);
            }
        }

        public bool __eq__(object other) {
            BuiltinMethodDescriptor bmd = other as BuiltinMethodDescriptor;
            if (bmd == null) {
                return false;
            }
            if (PythonOps.Id(__objclass__) != PythonOps.Id(bmd.__objclass__)) {
                return false;
            }
            return __name__ == bmd.__name__;
        }

        public int __cmp__(object other) {
            BuiltinMethodDescriptor bmd = other as BuiltinMethodDescriptor;
            if (bmd == null) {
                throw PythonOps.TypeError("instancemethod.__cmp__(x,y) requires y to be a 'instancemethod', not a {0}", PythonTypeOps.GetName(other));
            }

            long result = PythonOps.Id(__objclass__) - PythonOps.Id(bmd.__objclass__);
            if (result != 0) {
                return (result > 0) ? 1 : -1;
            }
            
            return StringOps.Compare(__name__, bmd.__name__);
        }

        #endregion

        #region ICodeFormattable Members

        public string/*!*/ __repr__(CodeContext/*!*/ context) {
            return String.Format("<method '{0}' of '{1}' objects>",
                Template.Name,
                DynamicHelpers.GetPythonTypeFromType(DeclaringType).Name);
        }

        #endregion

        #region IDynamicMetaObjectProvider Members

        DynamicMetaObject/*!*/ IDynamicMetaObjectProvider.GetMetaObject(Expression/*!*/ parameter) {
            return new Binding.MetaBuiltinMethodDescriptor(parameter, BindingRestrictions.Empty, this);
        }

        #endregion
    }
}

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

using System;
using System.Diagnostics;
using Microsoft.Scripting.Runtime;
using IronPython.Runtime.Operations;

namespace IronPython.Runtime.Types {
    public sealed class PythonTypeUserDescriptorSlot : PythonTypeSlot {
        private object _value;
        private int _descVersion;
        private PythonTypeSlot _desc;

        private const int UserDescriptorFalse = -1;

        internal PythonTypeUserDescriptorSlot(object value) {
            _value = value;
        }
        
        internal PythonTypeUserDescriptorSlot(object value, bool isntDescriptor) {
            _value = value;
            if (isntDescriptor) {
                _descVersion = UserDescriptorFalse;
            }
        }

        internal override bool TryGetValue(CodeContext context, object instance, PythonType owner, out object value) {
            try {
                value = PythonOps.GetUserDescriptor(Value, instance, owner);
                return true;
            } catch (MissingMemberException) {
                value = null;
                return false;
            }
        }

        internal object GetValue(CodeContext context, object instance, PythonType owner) {
            if (_descVersion == UserDescriptorFalse) {
                return _value;
            } else if (_descVersion != DynamicHelpers.GetPythonType(_value).Version) {
                CalculateDescriptorInfo();
                if (_descVersion == UserDescriptorFalse) {
                    return _value;
                }
            }

            object res;
            Debug.Assert(_desc.GetAlwaysSucceeds);
            _desc.TryGetValue(context, _value, DynamicHelpers.GetPythonType(_value), out res);
            return PythonContext.GetContext(context).Call(context, res, instance, owner);
        }

        private void CalculateDescriptorInfo() {
            PythonType pt = DynamicHelpers.GetPythonType(_value);
            if (!pt.IsSystemType) {
                _descVersion = pt.Version;
                if (!pt.TryResolveSlot(pt.Context.SharedClsContext, "__get__", out _desc)) {
                    _descVersion = UserDescriptorFalse;
                }
            } else {
                _descVersion = UserDescriptorFalse;
            }
        }

        internal override bool TryDeleteValue(CodeContext context, object instance, PythonType owner) {
            return PythonOps.TryDeleteUserDescriptor(Value, instance);
        }

        internal override bool TrySetValue(CodeContext context, object instance, PythonType owner, object value) {
            return PythonOps.TrySetUserDescriptor(Value, instance, value);
        }

        internal override bool IsSetDescriptor(CodeContext context, PythonType owner) {
            object dummy;
            return PythonOps.TryGetBoundAttr(context, Value, "__set__", out dummy);
        }

        internal object Value {
            get {
                return _value;
            }
            set {
                _value = value;
            }
        }
    }
}

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

using System;
using System.Collections.Generic;
using System.Text;

namespace IronPython.Runtime {
    /// <summary>
    /// Marks a method/field/property as being a wrapper descriptor.  A wrapper desriptor
    /// is a member defined on PythonType but is available both for type and other
    /// instances of type.  For example type.__bases__.
    /// </summary>
    [AttributeUsage(AttributeTargets.Method | AttributeTargets.Field | AttributeTargets.Property, AllowMultiple = true, Inherited = false)]
    internal sealed class WrapperDescriptorAttribute : Attribute {
    }
}

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

#if !SILVERLIGHT // TypeDescriptor, COM

using System;
using System.Collections;
using System.ComponentModel;
using System.Runtime.InteropServices;

namespace IronPythonTest {
    /// <summary>
    /// Test cases for verifying IronPython plays nicely with reflection and you
    /// can reflect over python objects in the proper way.
    /// </summary>
    public class TypeDescTests {
        public object TestProperties(object totest, IList shouldContain, IList shouldntContain) {
            if (shouldContain != null) {
                foreach (object o in shouldContain) {
                    bool fFound = false;
                    foreach (PropertyDescriptor pd in TypeDescriptor.GetProperties(totest)) {
                        if ((string)o == pd.Name) {
                            fFound = true; break;
                        }
                    }

                    if (!fFound) return false;
                }
            }

            if (shouldntContain != null) {
                foreach (object o in shouldntContain) {
                    bool fFound = false;
                    foreach (PropertyDescriptor pd in TypeDescriptor.GetProperties(totest)) {
                        if ((string)o == pd.Name) {
                            fFound = true;
                            break;
                        }
                    }

                    if (fFound) return false;
                }
            }/*
            foreach (PropertyDescriptor pd in TypeDescriptor.GetProperties(totest)) {
                if (shouldContain != null && !shouldContain.Contains(pd.Name)) {
                    Console.WriteLine("No {0}", pd.Name);
                    return Ops.FALSE;
                } else if (shouldntContain != null && shouldntContain.Contains(pd.Name)) {
                    return Ops.FALSE;
                }
            }*/
            return true;
        }

        public object GetClassName(object totest) {
            return TypeDescriptor.GetClassName(totest);
        }

        public object GetComponentName(object totest) {
            return TypeDescriptor.GetComponentName(totest);
        }

        public object GetConverter(object totest) {
            return TypeDescriptor.GetConverter(totest);
        }

        public object GetDefaultEvent(object totest) {
            return TypeDescriptor.GetDefaultEvent(totest);
        }

        public object GetDefaultProperty(object totest) {
            return TypeDescriptor.GetDefaultProperty(totest);
        }

        public object GetEditor(object totest, Type editorBase) {
            return TypeDescriptor.GetEditor(totest, editorBase);
        }

        public object GetEvents(object totest) {
            return TypeDescriptor.GetEvents(totest);
        }
        public object GetEvents(object totest, Attribute[] attributes) {
            return TypeDescriptor.GetEvents(totest, attributes);
        }

        public object GetProperties(object totest) {
            return TypeDescriptor.GetProperties(totest);
        }

        public object GetProperties(object totest, Attribute[] attributes) {
            return TypeDescriptor.GetProperties(totest, attributes);
        }

        public object CallCanConvertToForInt(object totest) {
            return TypeDescriptor.GetConverter(totest).CanConvertTo(typeof(int));
        }
    }

    /// <summary>
    /// Registration-free COM activation
    /// </summary>

    [ComImport]
    [Guid("00000001-0000-0000-C000-000000000046")]
    [InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
    public interface IClassFactory {
        [return: MarshalAs(UnmanagedType.Interface)]
        object CreateInstance(
            [MarshalAs(UnmanagedType.IUnknown)]object pOuterUnk,
            ref Guid iid);

        void LockServer(bool Lock);
    }

    public class ScriptPW {
        [DllImport("scriptpw.dll", PreserveSig = false)]
        static extern void DllGetClassObject(
            [In] ref Guid rclsid,
            [In] ref Guid riid,
            [MarshalAs(UnmanagedType.Interface)][Out] out object ppv);


        [DllImport("ole32.dll", PreserveSig = false)]
        public static extern void CoRegisterClassObject(
            [In] ref Guid rclsid,
            [MarshalAs(UnmanagedType.IUnknown)] object pUnk,
            /* CLSCTX */ int dwClsContext,
            /* REGCLS */ int flags,
            out uint lpdwRegister
            );

        [DllImport("ole32.dll", PreserveSig = false)]
        public static extern void CoRevokeClassObject(uint dwRegister);

        static Guid ProgID_IPassword = new Guid("{834C5A62-E0BB-4FB4-87B9-F37C869C976B}");
        static Guid IID_IClassFactory = typeof(IClassFactory).GUID;
        static Guid IID_IUnknown = new Guid("{00000000-0000-0000-C000-000000000046}");

        public static object CreatePassword() {
            object classObject;
            DllGetClassObject(ref ProgID_IPassword, ref IID_IClassFactory, out classObject);

            uint dwRegister;
            CoRegisterClassObject(ref IID_IClassFactory, classObject, 0, 0, out dwRegister);

            IClassFactory classFactory = classObject as IClassFactory;
            object password = classFactory.CreateInstance(null, ref IID_IUnknown);
            return password;
        }

    }
}

#endif
<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>IronPython ReadMe</title>
</head>

<body style="color: #000000">

<h1></h1>
    <h1>
        </h1>
    <h1>
        IronPython %IRONPYTHON_VERSION%</h1>
    <p>
            IronPython is a new implementation of the Python programming language on .NET.&nbsp; The .NET Framework
                is a managed programming model for Windows; Microsoft standardized part of it in&nbsp;<a href="http://www.ecma-international.org/">ECMA</a>
            years ago as the 
		<a href="http://www.ecma-international.org/publications/standards/Ecma-335.htm">Common Language Infrastructure</a> and 
		<a href="http://www.ecma-international.org/publications/standards/Ecma-334.htm">C# Language Specification</a>
            standards.</p>
    <p>
            IronPython is fast - up to 37% faster than Python-2.6 on the standard 
			PyStone benchmark.&nbsp; It supports an interactive interpreter
            with fully dynamic compilation.&nbsp; It is well integrated with
            the rest of the framework and makes the whole .NET Framework class 
			library easily available to Python
            programmers.</p>
<p>
            The best place to learn more about IronPython is the
			<a href="http://www.ironpython.net">official website</a>.&nbsp; 
			There you'll find links to our
			<a href="http://www.codeplex.com/ironpython">CodePlex site</a> which 
			includes IronPython sources, binaries, and samples<span style="color: #000000">.&nbsp; 
			You can also file bugs and generally interact with the 
			IronPython team through this shared project site.&nbsp; Finally, there's a 
			mailing list you can join for discussing issues and releases if you 
			like.</span></p>
<p>
            There's a good introductory tutorial at
			<a href="Tutorial/Tutorial.htm">IronPython Tutorial</a>.</p>
<p>
            IronPython has a high degree of compatibility with CPython, but 
			there are some differences. See
			<a href="http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython&title=Differences">IronPython Differences</a> document for details.</p>
<p>
    IronPython %IRONPYTHON_VERSION% is suitable for building Python applications where you want 
	to make use of .NET Framework and pure python modules. There are still some 
	missing standard CPython libraries (See
	<a href="http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython&title=Differences">IronPython Differences</a> for details.), and there are some known issues 
	with the IronPython implementation 
	(see <a href="http://www.codeplex.com/ironpython">
	www.codeplex.com/ironpython</a>).</p>
<p>
    &nbsp;</p>
<h2>
    Prerequisites</h2>
    <p>
        To run, IronPython %IRONPYTHON_VERSION% requires .NET Framework version 
		4.0 to be installed
        on your system. You can install the latest version from Microsoft:</p>
    <ul>
        <li>
		<a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=9cfb2d51-5ff4-4491-b0e5-b386f32c0992&amp;displaylang=en">Microsoft .NET Framework Version 
		4.0</a></li></ul>
    <p>
        IronPython should also run on any platform that implements the CLI specification v4.0.</p>
    <p>
        There are <a href="#BuilFromSource">more prerequisites</a> if you want to build IronPython from source.</p>
<p>
        &nbsp;</p>
    <h2>
        Running IronPython</h2>
<p>If you did not download the binaries, you'll need to
<a href="#BuilFromSource">build IronPython</a> first.&nbsp; After building 
IronPython or unpacking the binary distribution, you can complete the installation by 
adding the IronPython installation directory to your PATH.&nbsp; To test the installation, you 
should launch the interactive interpreter as shown below:</p>
<blockquote>
	<pre>C:\IronPython&gt;ipy
IronPython 2.7.0 on .NET 4.0.30319.1
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; 2+2
4</pre>
</blockquote>
<p>You can use IronPython to run Python scripts by passing the script name on 
the command-line just as with standard Python.&nbsp; If hello.py had the 
displayed contents, the following ipy command line would run it:</p>
    <blockquote>
		<pre>Hello.py:

for i in xrange(3):
    print "Hello World"


C:\IronPython&gt;ipy Hello.py
Hello World
Hello World
Hello World
</pre>
</blockquote>

This simple example shows how you can start using WinForms from IronPython:

<blockquote>
	<pre>C:\IronPython&gt;ipy
IronPython 2.7.0 on .NET 4.0.30319.1
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import clr
&gt;&gt;&gt; clr.AddReference(&quot;System.Windows.Forms&quot;)
&gt;&gt;&gt; import System.Windows.Forms as WinForms
&gt;&gt;&gt; WinForms.MessageBox.Show(&quot;Hello&quot;, &quot;Hello World&quot;)
OK
</pre>
</blockquote>
<p>For more information on the clr.AddReference function, see the
<a href="Tutorial/Tutorial.htm#T1.3">Loading .NET Libraries</a> exercise in the
<a href="Tutorial/Tutorial.htm">IronPython Tutorial</a><span style="color: #000000">, 
which has many examples of using IronPython in various ways.</span></p>
<p>&nbsp;</p>
<h2><a name="silverlight"></a>IronPython in Silverlight</h2>
<div style="border-left: 10px solid yellow; padding: 10px;">
<h3>ATTENTION!</h3>
<p>
  See <a href="http://ironpython.net/browser/" target="_blank">ironpython.net/browser</a>
  for the most up-to-date information on using Python in the browser with Silverlight.
  For example, this HTML page hosts Silverlight to run Python code, and requires no extra
  dependencies:
</p>
<blockquote><pre>&lt;html&gt;
  &lt;head&gt;
    &lt;script type="text/javascript" 
            src="http://gestalt.ironpython.net/dlr-latest.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="message"&gt;Loading ...&lt;/div&gt;
    &lt;script type="text/python"&gt;
      document.message.innerHTML = "Hello from python!"
      def on_click(obj, args):
          obj.innerHTML = "Clicked!"
      document.message.events.onclick += on_click
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></blockquote>
<p>
Keep in mind the information, binaries, and examples in this package
will still help you build Silverlight applications with IronPython, but
using HTML script-tags is the preferred model going forward; the
ways described here will be deprecated in a future release.
</p>
</div>
<h3>Generating an application</h3>
<blockquote><pre>script\sl python MyApp</pre></blockquote>
<p>Will create "MyApp" in the current directory.</p>
<p>For more information on the "server" script, run <code>script\server</code></p>
<h3>Running an app</h3>
<blockquote><pre>script\server /b:MyApp\index.html</pre></blockquote>
<p>This will launch the default browser pointed at the application.</p>
<p>&nbsp;</p>
<h2><a name="BuilFromSource"></a>Building IronPython from Source</h2>
    <p>
        If you downloaded the binaries from
		<a href="http://www.codeplex.com/ironpython">www.codeplex.com/ironpython</a><span style="color: #000000">, 
		you do not need to build it.&nbsp; </span>To compile IronPython from the source code, you can install either Visual
        Studio 2010 or .NET Framework 4.0 using one
        of the following
        links:</p>
    <ul>
        <li>
		<a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=9cfb2d51-5ff4-4491-b0e5-b386f32c0992&amp;displaylang=en">Microsoft .NET Framework Version 
		4.0</a></li><li>
		<a href="http://www.microsoft.com/visualstudio/en-us/howtobuy/default.mspx">Visual Studio 2010
		</a> </li>
    </ul>
    <h3>
        Building using Visual Studio 2010</h3>
    <p>
        Open IronPython.sln in Visual Studio 2010 and build (from menu: Build-&gt;Build Solution).&nbsp; Set IronPythonConsole as your startup project
        in the Solution Explorer.</p>
    <h3>
        Building using .NET Framework 4.0</h3>
    <p>
        .NET Framework 4.0 comes with the C# compiler and Microsoft's msbuild.&nbsp; After installing 
		.NET, open any command prompt, 
		cd to the IronPython directory, and execute:</p>
    <blockquote>
		<pre>%SystemDrive%\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild Solutions\IronPython.sln</pre>
</blockquote>
<p>This will build all required Dynamic Language Runtime and IronPython 
assemblies which include but are not limited to: IronPython.dll, IronPython.Modules.dll, Microsoft.Scripting.dll, 
Microsoft.Dynamic.dll, Microsoft.Scripting.Debugging.dll, ipy.exe, and ipyw.exe.</p>

</body>

</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>

<head>
<link rel="stylesheet" type="text/css" href="../Samples.css">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Bad Paint</title>
<style type="text/css">
  .style1 {
	font-size: 11pt;
	font-family: Verdana;
}
.style6 {
	text-align: center;
}
.style14 {
	font-family: Verdana, Geneva, Tahoma, sans-serif;
	font-size: x-small;
}
</style>
</head>

<body class="body">

<hr>
<p class="CopyrightText">Information in this document is subject to change without notice. The example companies, organizations, 
products, people, and events depicted herein are fictitious. No association with any real company, organization, product, 
person or event is intended or should be inferred. Complying with all applicable copyright laws is the responsibility of 
the user. Without limiting the rights under copyright, no part of this document may be reproduced, stored in or introduced 
into a retrieval system, or transmitted in any form or by any means (electronic, mechanical, photocopying, recording, or 
otherwise), or for any purpose, without the express written permission of Microsoft Corporation.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="CopyrightText">Microsoft may have patents, patent applications, trademarked, copyrights, or other intellectual 
property rights covering subject matter in this document. Except as expressly provided in any written license agreement 
from Microsoft, the furnishing of this document does not give you any license to these patents, trademarks, copyrights, 
or other intellectual property.</p>
<p class="CopyrightText">&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, Active Directory, BizTalk, SQL Server, SharePoint, 
	Outlook, PowerPoint, FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual SourceSafe, Visual C#, 
	Visual J#,&nbsp; and Visual Studio are either registered trademarks or trademarks of Microsoft Corporation in the 
	U.S.A. and/or other countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the trademarks of their respective owners.</p>
</div>
<hr>
<p class="body">&nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="body">&nbsp;</p>
<p class="title2">Bad Paint</p>
<p class="body">Bad paint is a sample paint program built upon the Windows 
Presentation Foundation framework.&nbsp; What distinguishes this paint 
application from others is it's use of Microsoft .NET 4.0's Dynamic Language 
Runtime (DLR) feature.&nbsp; The DLR is utilized to dynamically and 
programmatically modify visual objects within the paint canvas.&nbsp; Such a 
feat is extremely difficult to accomplish with statically typed languages, and 
the DLR makes this a breeze to implement for Python.</p>
<p class="body">&nbsp;</p>
<p class="contentsheading">Prerequisites</p>
<p class="body">The prerequisites to successfully run the Bad Paint demo are:</p>
<ul>
  <li class="normal" type="disc">Microsoft .NET Framework Version 4.0</li><ul>
		<li><span class="style1">Download from </span>
		<a href="http://www.microsoft.com/NET/"><span class="style1">here</span></a></li>
	</ul>
	<li class="normal">IronPython 2.6.1 for .NET 4.0
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a href="http://ironpython.codeplex.com/releases/view/36280">here</a></li>
	</ul>
	</li>
	<li><span class="style14">IronRuby 1.0v4</span><ul>
		<li><span class="style1">Optional.&nbsp; Available</span><font face="Verdana" style="font-size: 11pt"> from
		<a href="http://ironruby.codeplex.com/releases/view/25901">here</a></font></li>
	</ul>
</ul>
<p class="contentsheading">Getting Started<br>
</p>
<p class="body">Please make sure the sample folder, <i>BadPaint, </i>(where this readme.htm is located)<i> </i>
contains at least the following:</p>
<blockquote>
	<blockquote>
		<p class="body">.\App.config<br>.\App.xaml<br>.\App.xaml.cs<br>
		.\BadPaint.csproj<br>.\BadPaint.sln<br>.\demo_snippets.py<br>
		.\MainWindow.xaml<br>.\MainWindow.xaml.cs<br>.\Properties\</p>
		<p class="body">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
		AssemblyInfo.cs<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
		Resources.Designer.cs<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
		Resources.resx<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
		Settings.Designer.cs<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
		Settings.settings</p>
		<p class="body"><br>
		</p>
	</blockquote>
</blockquote>
<p class="body"><strong>IMPORTANT NOTE</strong>: if the folder containing the IronPython distribution
is not in the default MSI install location, &quot;%ProgramFiles%\IronPython 2.6 for 
.NET 4.0&quot;, you'll need to modify <em>BadPaint.csproj</em> to point to the 
correct installation location.&nbsp; This means you'll need to adjust the <em>
HintPath</em> elements within <em>BadPaint.csproj</em> which can be done either 
with <em>notepad.exe</em> or <em>Visual Studio 2010</em>. </p>
<hr>
<p class="contentsheading">Building Bad Paint</p>
<p class="body">We recommend building the &quot;Release&quot; configuration of&nbsp; <em>
BadPaint.sln</em> directly from Visual Studio, although you can also build the 
demo from the command prompt by navigating to the <em>BadPaint</em> 
directory and typing the following: </p>
<p class="typedexample">C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild 
BadPaint.sln /p:configuration=Release</p>
<p class="body">&nbsp;</p>
<p class="body">Running this command or building directly from Visual Studio 
will yield <em>bin\Release\Demo.exe</em>. </p>
<hr>
<p class="contentsheading">Playing with Demo.exe</p>
<p class="body">From the command prompt, navigate to the <em>BadPaint</em> 
directory and type the following: </p>
<p class="typedexample">&gt; bin\Release\Demo.exe</p>
<p class="body">&nbsp;</p>
<p class="body">An application similar to the screenshot below will then start:</p>
<p class="style6">
<img alt="BadPaint Start Screenshot" src="screenshot1.jpg" height="531" width="715"></p>
<p class="body">&nbsp;</p>
<p class="body">Try dragging a square onto the black canvas and follow this up 
by dragging the color green into the square: </p>
<p class="style6">
<img alt="Paint Screenshot with green square" height="531" src="screenshot2.jpg" width="715"></p>
<p class="style6">&nbsp;</p>
<p class="body">At this point let's try to dynamically modify the canvas.&nbsp; 
First, click on the green square to select it.&nbsp; Now type &quot;<strong>A</strong>&quot; 
into the &quot;Selected Item&quot; textbox and strike the <em>Enter</em> key once.&nbsp; 
Behind the scenes, this sequence of actions has associated our green square as 
the &quot;<strong>A</strong>&quot; attribute of the <em>Application</em> object from 
IronPython.&nbsp; </p>
<p class="body">Now click the &quot;Language&quot; drop-down menu and select the <em>
IronPython 2.6</em> option.&nbsp; This allows us to input some Python code into 
the textbox immediately below the &quot;Language&quot; drop-down menu.&nbsp; Type:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'>
<span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
<o:p>Application.A.Width = 100</o:p></span></p>

<p class="body">into this box:</p>
<p class="style6">
<img alt="Demo with Python text" height="531" src="screenshot3.jpg" width="715"></p>
<p class="body">&nbsp;</p>
<p class="body">Finally, click the &quot;Run Code&quot; button to actually run your Python 
code against the canvas contents: </p>
<p class="style6">
<img alt="Demo after the Python snippet has run" height="531" src="screenshot4.jpg" width="715"></p>
<p class="body">As you can imagine, at this point we've only touched the surface 
so to speak with respect to what's possible from the scripting code textbox.&nbsp; 
This sample includes a demo_snippets.py file which as its name might imply, 
includes a few less trivial snippets of Python code intended to be copied and 
pasted into this sample's textbox and run.</p>
<hr>
<p class="body">This concludes our tutorial. Have fun playing with this sample!</p>

</body>

</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=windows-1252">
  <title>Dynamic Web Service Helpers</title>
  <style>
p.Normal, li.Normal
	{margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
h1
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:Verdana;
	}
h2
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:150%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Verdana;
	}
h3
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	line-height:150%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.Toc1
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	font-size:10.0pt;
	font-family:Verdana;
	text-transform:uppercase;
	font-weight:bold;
	}
p.Toc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:12.0pt;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	}
p.Toc3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:24.0pt;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	}
a:link
	{color:blue;
	text-decoration:underline;
	}
a:visited
	{color:purple;
	text-decoration:underline;
	}
p.Body
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:-116%;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.TypedExample
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.5in;
	line-height:150%;
	font-size:10.0pt;
	font-family:Verdana;
	font-weight:bold}
p.ContentsHeading
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:Verdana;
	font-weight:bold}
p.Step
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0.1in;
	font-size:11.0pt;
	font-family:Verdana
	}
p.StepNote
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.25in;
	line-height:150%;
	font-size:10.0pt;
	font-family:Verdana;
	font-weight:bold
	}
p.Code-Background
	{margin-top:0;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:0;
	font-size:10.0pt;
	font-family:"Courier New"
	}
p.Title1
	{margin-bottom:.0001pt;
	font-size:36.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
p.Title2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	page-break-after:avoid;
	font-size:28.0pt;
	font-family:Verdana;
	}
p.CopyrightText
	{margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
p.ExerciseList
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.5in;
	text-indent:-.25in;
	line-height:-116%;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.LabSummary
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:150%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Verdana;
	font-weight:bold;
	}
p.Code-Highlighted
	{margin-top:0;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:0;
	background:#E6E6E6;
	font-size:10.0pt;
	font-family:"Courier New"
	}
p.Stepnonumbering
	{margin-top:0;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:30.25pt;
	font-size:11.0pt;
	font-family:Verdana
	}
ul
	{margin-bottom:0in;}
  </style>
</head>
<body lang="EN-US" link="#0000FF" vlink="#800080">
<p class="Normal" align="center"></p>
<hr>
<p class="CopyrightText"> Information in this document is subject to
change without notice. The example companies, organizations, products,
people, and events depicted herein are fictitious. No association with
any real company, organization, product, person or event is intended or
should be inferred. Complying with all applicable copyright laws is the
responsibility of the user. Without limiting the rights under
copyright, no part of this document may be reproduced, stored in or
introduced into a retrieval system, or transmitted in any form or by
any means (electronic, mechanical, photocopying, recording, or
otherwise), or for any purpose, without the express written permission
of Microsoft Corporation.</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText"> Microsoft may have patents, patent
applications, trademarked, copyrights, or other intellectual property
rights covering subject matter in this document. Except as expressly
provided in any written license agreement from Microsoft, the
furnishing of this document does not give you any license to these
patents, trademarks, copyrights, or other intellectual property.</p>
<p class="CopyrightText">
&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, 
	Active Directory, BizTalk, SQL Server, SharePoint, Outlook, PowerPoint, 
	FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual 
	SourceSafe, Visual C#, Visual J#,&nbsp; and Visual Studio are either registered 
	trademarks or trademarks of Microsoft Corporation in the U.S.A. and/or other 
	countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the 
	trademarks of their respective owners.</div>
<hr>
<p class="body">&nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">
&nbsp;</p>
<p class="body">&nbsp;</p>
<p class="Title1">ClrType</p><p class="Body">&nbsp;</p>
<p class="Normal">&nbsp;</p>
<p class="Title2"> Prerequisites</p>
<p class="body"> The prerequisites to successfully run this application
are:</p>
<ul>
    <li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a
 href="http://www.codeplex.com/IronPython/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
</ul>
<p>&nbsp;</p>
<p class="Title2">Getting Started</p>
<p class="body">Please make sure the folder structure in the 
<i>ClrType</i> directory is:</p>
<blockquote>
  <blockquote>
      <p class="body">
      .\sample.py<br>.\clrtype.py<br></p>
  </blockquote>
</blockquote>
<p class="body">HINT: if the folder containing the IronPython distribution is not 
    already in your PATH environment variable, please add it from the command prompt 
    you&#39;ll be working in.&nbsp; By doing this you will be able to run the &quot;ipy&quot; 
    command from any arbitrary directory:</p>
<p class="TypedExample">set PATH=%PATH%;%ProgramFiles%\IronPython 2.6</p><p class="body">
        From the command prompt, navigate to the ClrType directory and type the 
        following:</p>
    <p class="TypedExample">ipy.exe sample.py</p>
<p class="Title2">Overview</p>
<p class="Body">The ClrType sample shows how to define a class in IronPython with 
    required CLR members. Normally, a class definition in Python does not map 
    directly to a 
    unique CLR type. This is because the semantics of classes is different between Python 
    and the CLR. For example, in Python it is possible to change the base types just 
    by assigning to the <code>__bases__</code> attribute on the type object. However, the same is 
    not possible with CLR classes. Hence, IronPython implements Python classes 
    without mapping them directly to CLR types.</p>
    <p class="Body">However, it is sometimes required to have control over the CLR type 
        generated for the Python class. This is because some .NET APIs expect the user 
        to define a CLR type with certain attributes and members. For example, to define a pinvoke 
        method, the user is required to define a CLR type with a CLR method marked with 
        <code>DllImportAttribute</code>, and where the signature of the CLR method 
        exactly describes the target platform method. Similarly, 
        Windows Communication Foundation (WCF) requires an interface to be marked with
        <code>System.ServiceModel.ServiceContractAttribute</code> to indicate that
        it defines a service contract.</p>
    <p class="Body">Starting with IronPython 2.6, IronPython supports a low-level hook 
        referred to as the <code>__clrtype__</code> class attribute that allows customization of the CLR type 
        corresponding to a Python class. However, this is a low-level hook, and the user 
        is expected to build on top of it. The ClrType sample shows how to build on top 
        of the <code>__clrtype__</code> hook. The <code>clrtype.ClrMetaclass</code> metaclass can be used to define CLR 
        fields, properties and class-level attributes. Also, you can declare
        declare strongly-typed methods.</p>
<p class="Body">In the future, the sample is expected to become a fully supported 
    IronPython module.</p>

<div style="text-align: center;"><br>
</div>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>

<head>
<link rel="stylesheet" type="text/css" href="../Samples.css">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Comment Checker</title>
<style type="text/css">
  .style1 {
	font-size: 11pt;
	font-family: Verdana;
}
.style5 {
	margin-left: 40px;
}
  .style3 {
	font-weight: normal;
}
.style6 {
	text-align: center;
}
.style7 {
	background-color: #FF0000;
}
.style8 {
	text-indent: -.25in;
	line-height: 11.0pt;
	font-size: 9.0pt;
	font-family: Arial, sans-serif;
	margin-left: .05in;
	margin-right: 0in;
	margin-top: 2.0pt;
	margin-bottom: 3.0pt;
}
.style9 {
	line-height: 11.0pt;
	font-size: 9.0pt;
	font-family: Arial, sans-serif;
	margin-left: .05in;
	margin-right: 0in;
	margin-top: 2.0pt;
	margin-bottom: 3.0pt;
	background: #D9D9D9;
}
.style10 {
	font-size: 10.0pt;
	font-family: Arial, sans-serif;
	border-style: none;
	border-color: inherit;
	border-width: medium;
	margin-left: .75in;
	margin-right: 9.35pt;
	margin-top: 12.0pt;
	margin-bottom: 12.0pt;
	padding: 0in;
	background: #C9E9FF;
}
.style11 {
	font-weight: bold;
}
.style13 {
	margin-left: 92px;
}
</style>
</head>

<body class="body">

<hr>
<p class="CopyrightText">Information in this document is subject to change without notice. The example companies, organizations, 
products, people, and events depicted herein are fictitious. No association with any real company, organization, product, 
person or event is intended or should be inferred. Complying with all applicable copyright laws is the responsibility of 
the user. Without limiting the rights under copyright, no part of this document may be reproduced, stored in or introduced 
into a retrieval system, or transmitted in any form or by any means (electronic, mechanical, photocopying, recording, or 
otherwise), or for any purpose, without the express written permission of Microsoft Corporation.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="CopyrightText">Microsoft may have patents, patent applications, trademarked, copyrights, or other intellectual 
property rights covering subject matter in this document. Except as expressly provided in any written license agreement 
from Microsoft, the furnishing of this document does not give you any license to these patents, trademarks, copyrights, 
or other intellectual property.</p>
<p class="CopyrightText">&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, Active Directory, BizTalk, SQL Server, SharePoint, 
	Outlook, PowerPoint, FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual SourceSafe, Visual C#, 
	Visual J#,&nbsp; and Visual Studio are either registered trademarks or trademarks of Microsoft Corporation in the 
	U.S.A. and/or other countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the trademarks of their respective owners.</p>
</div>
<hr>
<p class="body">&nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="body">&nbsp;</p>
<p class="title2">Comment Checker</p>
<p class="body">A brief example which utilizes Microsoft Word to check the 
spelling of # style code comments.&nbsp; The application will then display 
suggestions for misspelled words in a visually appealing manner via Microsofts 
Windows Presentation Foundation libraries. </p>
<p class="body">&nbsp;</p>
<p class="contentsheading">Overview</p>
<p class="Body">One of the key benefits of programming in the Microsoft 
ecosystem is the wide breadth of existing libraries and tools available to the 
developer.&nbsp; For example, included with every installation of Microsoft 
Office are .NET wrappers for Word/Excel/etc objects.&nbsp; Not only do these 
wrappers allow one to generate Office documents programmatically, they also 
allow you to use features built directly into Office applications from <strong>
your</strong> .NET application.&nbsp; Just imagine for a moment what you 
could do with access to Word's spell checker.&nbsp; Perhaps an English teacher 
would want to couple Office 2007's Optical Character Recognition (OCR) 
technology with spell checking to automatically grade students' essays.&nbsp; 
The possibilities here are truly unlimited!</p>
<p class="Body">What could possibly make these Office libraries better?&nbsp; 
Couple them one of the easiest, most productive programming languages on the 
planet today - Python.&nbsp; In this sample/tutorial, not only will we show how 
to utilize Word's spell checking functionality from IronPython; we'll also use 
it to make <strong>our own</strong> Python code better!&nbsp; You see, this 
sample processes Python files looking for code comments that contain 
misspellings.&nbsp; Once these mistakes have been identified we utilize Word 
again to present you with the correct spellings.&nbsp; All of this is tied 
together with an elegant, user-friendly interface constructed from .NET's 
Windows Presentation Framework.</p>
<p class="contentsheading">Prerequisites</p>
<p class="body">The prerequisites to successfully run the Comment Checker demo are:</p>
<ul>
  <li class="normal" type="disc">Microsoft .NET Framework Version 3.5 SP1<ul>
		<li>Windows 7 already includes a compatible version of the .NET Framework,
		so this requirement is not necessary on this particulr platform</li>
    </ul>
  </li>
    <ul>
		<li><span class="style1">Download from </span>
		<a href="http://www.microsoft.com/downloads/details.aspx?familyid=AB99342F-5D1A-413D-8319-81DA479AB0D7&amp;displaylang=en">
		<span class="style1">here</span></a></li>
	</ul>
	<li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
	<li>
	<span class="style1">Microsoft Word 2007</span></li>
	<ul>
		<li><span class="style1">Available</span><font face="Verdana" style="font-size: 11pt"> from
		<a href="http://store.microsoft.com">here</a></font></li>
	</ul>
</ul>
<p class="contentsheading">Getting Started<br>
</p>
<p class="body">Please make sure the sample folder, <i>CommentChecker, </i>(where this readme.htm is located)<i> </i>
contains at least the following:</p>
<blockquote>
	<blockquote>
		<p class="body">.\main.py<br>.\misspelled.py<br>
		.\spelling.py<br>
		</p>
	</blockquote>
</blockquote>
<p class="body">HINT: if the folder containing the IronPython distribution
is not already in your <strong>PATH</strong> environment variable, please add it from the command 
prompt you'll be working in.&nbsp; By doing this you will be able to run the &quot;ipy&quot; 
command from any arbitrary directory: </p>
<p class="style5"><strong>s</strong><span class="style3">e<span class="typedexample"><strong>t 
PATH=%PATH%;%ProgramFiles%\IronPython 2.6</strong></span></span></p>
<p class="style5">&nbsp;</p>
<hr>
<p class="contentsheading">Playing with the Pre-written Sample</p>
<p class="body">From the command prompt, navigate to the <em>CommentChecker</em> 
directory and type the following: </p>
<p class="typedexample">&gt; ipyw.exe main.py misspelled.py</p><p class="typedexample">&nbsp;</p>
<p class="body">This starts an IronPython Windows application that displays the
<em>misspelled.py</em> file and highlights each spelling mistake inside code 
comments in a <span class="style7">red</span> background. If you click on any of 
the misspelled words, you'll be presented with a drop-down list of alternate 
spellings to use.&nbsp; You can run Comment Checker against your own Python files 
as well by changing the second parameter passed to ipyw (e.g., <em>misspelled.py</em> 
in the command above).&nbsp; The running application should look similar to the 
following:</p>
<p class="style6"><img alt="CommentChecker Screenshot" src="screenshot.jpg"></p>
<p class="style6">&nbsp;</p>
<hr>
<p class="contentsheading">Step-by-step Instructions on Implementing the Sample</p>

<p class="body">While a fully implemented &quot;comment checker&quot; is already provided 
for your enjoyment (see previous section), you can discover exactly how it works 
by following this section which is deemed suitable for both Python/.NET 
beginners and experts.</p>
<div style="page: Section3;">

<h3><a name="_Toc196122512">Create a New Python File to Edit</a><![if !supportLists]><span
style='font-size:11.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-list:Ignore'>.<span style='font:7.0pt "Times New Roman"'>&nbsp;</span></span></span><![endif]></h3>

<p class=style8 style='mso-list:l17 level1 lfo17'><![if !supportLists]><span
style='font-size:11.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>From a<span style='font-size:11.0pt;font-family:"Times New Roman","serif"'> new <b style='mso-bidi-font-weight:normal'>Command Prompt</b> window 
navigate to your favorite directory and please
type:<o:p></o:p></span></p>

<p class=style9 style='mso-background-themecolor:
background1;mso-background-themeshade:217'><b style='mso-bidi-font-weight:normal'><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'>notepad</span></b><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'> <b
style='mso-bidi-font-weight:normal'>spelling.py</b><o:p></o:p></span></p>

<div style='mso-element:para-border-div;border:solid windowtext 1.5pt;
padding:4.0pt 6.0pt 4.0pt 6.0pt;background:#C9E9FF;margin-left:.75in;
margin-right:9.35pt'>

<p class=style10><span class=style11>Note:</span> Do not
close the <b>Command Prompt</b> window as well be using this later.</p>
	<p class=style10><strong>Note: </strong>From
this point you should add Python code described in later steps to <b>spelling.py</b>.</p>

</div>

<p class=style8 style='mso-list:l17 level1 lfo17'><![if !supportLists]><span
style='font-size:11.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><b style='mso-bidi-font-weight:normal'><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'>notepad</span></b><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'> should now
start a new window and inform you that <b style='mso-bidi-font-weight:normal'><i
style='mso-bidi-font-style:normal'>spelling.py</i></b><i style='mso-bidi-font-style:
normal'> not found</i>.<span style='mso-spacerun:yes'> </span>When asked if
youd like to create this new file, click the <b style='mso-bidi-font-weight:
normal'>Yes</b> button<o:p>.</o:p></span></p>
	<p class=style8 style='mso-list:l17 level1 lfo17'>
	<o:p></o:p></p>

	<h3><a name="_Toc196122513">Use the clr Module to Access MS Word APIs</a></h3>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l11 level1 lfo21'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Add
the following to <b style='mso-bidi-font-weight:normal'>spelling.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>import</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> clr<o:p></o:p></span></p>

<p class=MsoNormal>The <b style='mso-bidi-font-weight:normal'>import</b>
statement is used to import other Python modules.<span
style='mso-spacerun:yes'> </span>The <b style='mso-bidi-font-weight:normal'>clr</b>
module is provided by IronPython to do Common Language Runtime oriented tasks such
as adding .NET assembly references.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l11 level1 lfo21'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Add
the following to <b style='mso-bidi-font-weight:normal'>spelling.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>clr.AddReferenceByPartialName(<span
style='color:maroon'>&quot;Microsoft.Office.Interop.Word&quot;</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>from</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> Microsoft.Office.Interop.Word <span
style='color:blue'>import</span> ApplicationClass<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>These two lines inject Microsoft Words <b style='mso-bidi-font-weight:
normal'>ApplicationClass</b> COM class into our namespace.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l11 level1 lfo21'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Add
the following to <b style='mso-bidi-font-weight:normal'>spelling.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
ms_word
= ApplicationClass()<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
ms_word.Documents.Add()<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Here we create a global variable, <b style='mso-bidi-font-weight:
normal'>ms_word</b>, which is really an instance of the winword.exe
process.<span style='mso-spacerun:yes'> </span>Also, we add a document to it
so that we can get Word to offer spelling suggestions later on in this
exercise.</p>

<h3><a name="_Toc196122514">Checkpoint</a></h3>

<p class=MsoNormal>At this point your copy of <b style='mso-bidi-font-weight:
normal'>spelling.py</b> should be capable of displaying functionality provided
by the Microsoft Word API:</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l9 level1 lfo20'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Save
<b style='mso-bidi-font-weight:normal'>spelling.py</b> in <b style='mso-bidi-font-weight:
normal'>notepad</b> by holding down the <b style='mso-bidi-font-weight:normal'>Ctrl</b>
key and pressing <b style='mso-bidi-font-weight:normal'>S </b>once.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l9 level1 lfo20'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>From
the <b style='mso-bidi-font-weight:normal'>Command Prompt</b> started earlier
in this exercise, start IronPython in interactive mode.<span
style='mso-spacerun:yes'> </span>This is accomplished by running the following
in the <b style='mso-bidi-font-weight:normal'>Command Prompt</b> window:</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:.25in;background:#D9D9D9;
mso-background-themecolor:background1;mso-background-themeshade:217'>ipy i spelling.py</p>

<p class=MsoNormal style='margin-left:.75in'>The <i style='mso-bidi-font-style:
normal'>-i</i> flag tells IronPython to run in interactive mode. <span
style='mso-spacerun:yes'></span>The Python module specified after <i
style='mso-bidi-font-style:normal'>-i</i> (e.g., <b style='mso-bidi-font-weight:
normal'>spelling.py</b>) will be automatically run and its contents injected into
the global namespace.<span style='mso-spacerun:yes'> </span>In the <b
style='mso-bidi-font-weight:normal'>Command Prompt</b> you should now see the
following:</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:.25in;background:#D9D9D9;
mso-background-themecolor:background1;mso-background-themeshade:217'>&gt;&gt;&gt;<o:p>&nbsp;</o:p></p>

<div style='mso-element:para-border-div;border:solid windowtext 1.5pt;
padding:4.0pt 6.0pt 4.0pt 6.0pt;background:#C9E9FF;margin-left:.75in;
margin-right:9.35pt'>

<p class=style10><span class=style11>Note:</span> If you cut and paste the ipy 
command above directly from your web browser into the Command Prompt,
you may end up seeing an error message such as:</p>

<p class=style10><span style='mso-tab-count:1'> </span>File
-i does not exist.</p>

<p class=style10>To get around this, simply type out the
command by hand in the Command Prompt.</p>

</div>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l9 level1 lfo20'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Type:</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:.25in;background:#D9D9D9;
mso-background-themecolor:background1;mso-background-themeshade:217'>dir(ms_word)</p>

<p class=MsoNormal style='margin-left:.75in'>in the <b style='mso-bidi-font-weight:
normal'>Command Prompt</b> and press the <b style='mso-bidi-font-weight:normal'>Enter</b>
key.<span style='mso-spacerun:yes'> </span>You should now see all methods and
properties Word provides us with.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l9 level1 lfo20'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Type:
</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:.25in;background:#D9D9D9;
mso-background-themecolor:background1;mso-background-themeshade:217'>ms_word.Visible
= True</p>

<p class=style13 style="width: 1010px">&nbsp;in the <b style='mso-bidi-font-weight:normal'>Command Prompt</b>
and press <b style='mso-bidi-font-weight:normal'>Enter</b>.<span
style='mso-spacerun:yes'> </span>Microsoft Word should open a new window.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l9 level1 lfo20'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Type:</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:.25in;background:#D9D9D9;
mso-background-themecolor:background1;mso-background-themeshade:217'>ms_word.Quit()</p>

<p class=MsoNormal style='margin-left:.75in'>in the <b style='mso-bidi-font-weight:
normal'>Command Prompt</b> and press <b style='mso-bidi-font-weight:normal'>Enter</b>.<span
style='mso-spacerun:yes'> </span>This shuts down the new instance of Word.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l9 level1 lfo20'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Hold
down the <b style='mso-bidi-font-weight:normal'>Ctrl</b> key and press <b
style='mso-bidi-font-weight:normal'>Z</b> in the <b style='mso-bidi-font-weight:
normal'>Command Prompt</b>.<span style='mso-spacerun:yes'> </span>Now press <b
style='mso-bidi-font-weight:normal'>Enter</b> to exit out of the interactive
session.</p>

<div style='mso-element:para-border-div;border:solid windowtext 1.5pt;
padding:4.0pt 6.0pt 4.0pt 6.0pt;background:#C9E9FF;margin-left:.75in;
margin-right:9.35pt'>

<p class=style10><span class=style11>Important Note:</span>
Its advisable that you save your changes in <b>notepad</b> by pressing <b>Ctrl+S</b>
after completing every section!</p>

</div>

<h3><a name="_Toc196122515">Check the Spelling of a Word</a></h3>

<p class=MsoNormal>Add the following to <b style='mso-bidi-font-weight:normal'>spelling.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>def</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> check_word(x):<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>return</span>
ms_word.CheckSpelling(x)<o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>check_word</b>
returns <i style='mso-bidi-font-style:normal'>True</i> if Microsoft Word thinks
the spelling of the input parameter, <b style='mso-bidi-font-weight:normal'>x</b>,
is correct.</p>

<h3><a name="_Toc196122516">Spelling Suggestions</a></h3>

<p class=MsoNormal>Add the following to <b style='mso-bidi-font-weight:normal'>spelling.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>def</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> suggestions(x):<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>res_objects =
ms_word.GetSpellingSuggestions(x)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>return</span>
[y.Name <span style='color:blue'>for</span> y <span style='color:blue'>in</span>
res_objects.GetEnumerator()]</span></p>

<p class=MsoNormal>The <b style='mso-bidi-font-weight:normal'>suggestions</b>
function asks MS Word for spelling suggestions of the misspelled word <b
style='mso-bidi-font-weight:normal'>x.</b> <span
style='mso-spacerun:yes'></span>It then returns these suggestions in the form
of a Python list using list comprehension (i.e., the <i style='mso-bidi-font-style:
normal'>[y.Name for y in ]</i><i style='mso-bidi-font-style:normal'> </i>line).<span
style='mso-spacerun:yes'> </span>Specifics about Python list comprehension are
beyond the scope of this exercise, but you can learn more about them here - <a
href="http://docs.python.org/tut/node7.html#SECTION007140000000000000000">http://docs.python.org/tut/node7.html#SECTION007140000000000000000</a>.
</p>

<h3><a name="_Toc196122517">Checkpoint</a> </h3>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l14 level1 lfo22'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Save
<b style='mso-bidi-font-weight:normal'>spelling.py</b> in <b style='mso-bidi-font-weight:
normal'>notepad</b>.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l14 level1 lfo22'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>From
the <b style='mso-bidi-font-weight:normal'>Command Prompt</b>, run spelling.py
in interactive mode again:</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:.25in;background:#D9D9D9;
mso-background-themecolor:background1;mso-background-themeshade:217'>ipy i spelling.py</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l14 level1 lfo22'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Play
around with the functions you created:</p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'>&gt;&gt;&gt;
check_word(&quot;ab&quot;)</p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'>False</p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'>&gt;&gt;&gt;
suggestions(&quot;ab&quot;)</p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'>['abs', 'alb', 'am', 'an', 'as',
'at', 'a', 'bad', 'ad', 'ax']</p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'>&gt;&gt;&gt;<o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l14 level1 lfo22'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Once
youre satisfied that the functions work as intended, press <b
style='mso-bidi-font-weight:normal'>Ctrl+Z</b> followed by <b style='mso-bidi-font-weight:
normal'>Enter</b> to exit out of the interactive session.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l14 level1 lfo22'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Youve
now completed the first part of this exercise and may close <b
style='mso-bidi-font-weight:normal'>notepad</b>.</p>

<h3><a name="_Toc196122518">Create Ano</a>ther Python Module</h3>

<p class=style8 style='mso-list:l16 level1 lfo25'><![if !supportLists]><span
style='font-size:11.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:11.0pt;font-family:"Times New Roman","serif"'>In
the <b style='mso-bidi-font-weight:normal'>Command Prompt</b> window please type:<o:p></o:p></span></p>

<p class=style9 style='mso-background-themecolor:
background1;mso-background-themeshade:217'><b style='mso-bidi-font-weight:normal'><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'>notepad</span></b><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'> <b
style='mso-bidi-font-weight:normal'>main.py</b><o:p></o:p></span></p>

<p class=style8 style='mso-list:l16 level1 lfo25'><![if !supportLists]><span
style='font-size:11.0pt;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman"'><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><b style='mso-bidi-font-weight:normal'><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'>notepad</span></b><span
style='font-size:11.0pt;font-family:"Times New Roman","serif"'> should now
start a new window and inform you that <b style='mso-bidi-font-weight:normal'><i
style='mso-bidi-font-style:normal'>main.py</i></b><i style='mso-bidi-font-style:
normal'> not found</i>.<span style='mso-spacerun:yes'> </span>When asked if
youd like to create this new file, click the <b style='mso-bidi-font-weight:
normal'>Yes</b> button.<o:p></o:p></span></p>

<div style='mso-element:para-border-div;border:solid windowtext 1.5pt;
padding:4.0pt 6.0pt 4.0pt 6.0pt;background:#C9E9FF;margin-left:.3in;margin-right:
9.35pt'>

<p class=style10><span class=style11>Note:</span> From
this point on you should add Python code described in later steps to <b>main.py</b>.</p>

</div>

<h3><a name="_Toc196122519">Open a Source File With #Style Comments</a></h3>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l24 level1 lfo27'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Add
the following to <b style='mso-bidi-font-weight:normal'>main.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>import </span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'>sys<span style='color:blue'><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>import</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> clr<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>from<span style='mso-spacerun:yes'> </span></span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;
mso-no-proof:yes'><span style='mso-spacerun:yes'></span>spelling <span
style='color:blue'>import</span> *<o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>sys</b> is a standard
CPython module which we use to access command-line parameters.<span
style='mso-spacerun:yes'> </span>The <b style='mso-bidi-font-weight:normal'>clr</b>
module was described previously.<span style='mso-spacerun:yes'> </span>The
third line above shows how to import all functions and global variables defined
in the <b style='mso-bidi-font-weight:normal'>spelling.py</b> module you
created into <b style='mso-bidi-font-weight:normal'>main.py</b>s namespace.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l24 level1 lfo27'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Add
the following to <b style='mso-bidi-font-weight:normal'>main.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
_temp_file
= open(sys.argv[1], <span style='color:maroon'>&quot;r&quot;</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
lines_in_file
= _temp_file.readlines()<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
_temp_file.close()<o:p></o:p></span></p>

<p class=MsoNormal>This little snippet opens a file and stores all of its lines
to a list/array called <b style='mso-bidi-font-weight:normal'>lines_in_file</b>.<span
style='mso-spacerun:yes'> </span>The name of the file is passed into
IronPython from the command-line and obtained via the <b style='mso-bidi-font-weight:
normal'>argv</b> module attribute of <b style='mso-bidi-font-weight:normal'>sys</b>.</p>

<h3><a name="_Toc196122520">Access Windows Presentation Foundation Types</a></h3>

<p class=MsoNormal>Add the following to <b style='mso-bidi-font-weight:normal'>main.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>clr.AddReferenceByPartialName(<span
style='color:maroon'>&quot;PresentationCore&quot;</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>clr.AddReferenceByPartialName(<span
style='color:maroon'>&quot;PresentationFramework&quot;</span>) <o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>from</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> System.Windows <span
style='color:blue'>import</span> Window, Application, HorizontalAlignment<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>from</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> System.Windows.Controls <span
style='color:blue'>import</span> FlowDocumentScrollViewer, ComboBox<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>from</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> System.Windows.Documents <span
style='color:blue'>import</span> FlowDocument, Paragraph, Run<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'><span style='font-size:10.0pt;
font-family:"Courier New";color:blue;mso-fareast-language:EN-US;mso-no-proof:
yes'>from</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> System.Windows.Media.Brushes <span
style='color:blue'>import</span> Black, PaleGreen, Red</span></p>

<p class=MsoNormal>Here we import various types from Microsofts Windows
Presentation Foundation assemblies which we will later use to display our file.</p>

<h3><a name="_Toc196122521">Create a Window</a></h3>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l7 level1 lfo24'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Add
the following to <b style='mso-bidi-font-weight:normal'>main.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window
= Window()<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window.Title
= <span style='color:maroon'>&quot;IronPython Comment Checker&quot;<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window.Background
= Black<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window.Foreground
= PaleGreen</span></p>

<p class=MsoNormal>Weve now created our main <b style='mso-bidi-font-weight:
normal'>Window</b> and set a few of its properties.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l7 level1 lfo24'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Add
the following text to <b style='mso-bidi-font-weight:normal'>main.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window.Content
= FlowDocumentScrollViewer()<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window.Content.Document
= FlowDocument()<o:p></o:p></span></p>

<p class=MsoNormal>Our <b style='mso-bidi-font-weight:normal'>main_window</b> object
would not be very useful without any content attached to it.<span
style='mso-spacerun:yes'> </span>For this reason we attach a document viewer which
is used to dynamically display documents.</p>

<h3><a name="_Toc196122522">Generate a Paragraph</a></h3>

<p class=MsoNormal>In this part of the exercise, we will add a function to
create, populate, and return a <b style='mso-bidi-font-weight:normal'>Paragraph</b>
object which we will later add to the document.<span style='mso-spacerun:yes'>
</span>This paragraph will consist of the entire file passed in from the
command prompt (e.g., misspelled.py) with suggestions for all misspelled words
in # style comments.</p>

<p class=MsoNormal>Add the following to <b style='mso-bidi-font-weight:normal'>main.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:blue;mso-fareast-language:EN-US;
mso-no-proof:yes'>def</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'> create_paragraph(file_lines):<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Create a
&quot;Paragraph&quot; object to hold all text from the file<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>paragraph = Paragraph()<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Text in the
paragraph will have a font size of 16<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:green;mso-fareast-language:EN-US;
mso-no-proof:yes'><span style='mso-spacerun:yes'> </span></span><span
style='font-size:10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;
mso-no-proof:yes'>paragraph.FontSize = 16.0<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Go through every
line in the file passed in from the command<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:green;mso-fareast-language:EN-US;
mso-no-proof:yes'><span style='mso-spacerun:yes'> </span>#line...</span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>for</span> x <span
style='color:blue'>in</span> file_lines:<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#...looking
for Python/Ruby/PowerShell style comments<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>if</span> <span
style='color:maroon'>&quot;#&quot;</span> <span style='color:blue'>in</span> x:<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Split
the line whenever a comment is found</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>first, second = x.split(<span
style='color:maroon'>&quot;#&quot;</span>, 1)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Add the
first part of the line to the paragraph</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>paragraph.Inlines.Add(Run(first +
&quot;#&quot;))<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Split
the second part of the line based on whitespace</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>for</span>
y <span style='color:blue'>in</span> second.split():<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#If
the word is misspelled...</span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>if</span>
<span style='color:blue'>not</span> check_word(y):<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Add
a drop down menu to offer alternative<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:green;mso-fareast-language:EN-US;
mso-no-proof:yes'><span style='mso-spacerun:yes'>
</span>#spelling suggestions</span><span style='font-size:10.0pt;font-family:
"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>c = ComboBox()<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>c.Background = Red<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>c.HorizontalAlignment =
HorizontalAlignment.Left<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Add
the misspelled word to the drop down menu<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:green;mso-fareast-language:EN-US;
mso-no-proof:yes'><span style='mso-spacerun:yes'>
</span>#and make it the first item</span><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>c.AddText(y)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>c.SelectedItem = y<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Offer
alternative spellings in the drop down menu</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>for</span>
suggest <span style='color:blue'>in</span> suggestions(y):<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>c.AddText(suggest)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#Add
the combo box to the drop down menu</span><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>paragraph.Inlines.Add(c)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>else</span>:<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'>
</span>paragraph.Inlines.Add(Run(y))<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>paragraph.Inlines.Add(<span
style='color:maroon'>&quot; &quot;</span>)<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>paragraph.Inlines.Add(Run(<span
style='color:maroon'>&quot;\n&quot;</span>))<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>else</span>:<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:green'>#If
there's no comment in the line, just directly<o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";color:green;mso-fareast-language:EN-US;
mso-no-proof:yes'><span style='mso-spacerun:yes'> </span>#add it to
the paragraph</span><span style='font-size:10.0pt;font-family:"Courier New";
mso-fareast-language:EN-US;mso-no-proof:yes'><o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span>paragraph.Inlines.Add(Run(x))<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:0in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'><span style='font-size:10.0pt;
font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'><span
style='mso-spacerun:yes'> </span><span style='color:blue'>return</span>
paragraph</span></p>

<h3><a name="_Toc196122523">Attach the Paragraph to the Document</a></h3>

<p class=MsoNormal>Add the following to <b style='mso-bidi-font-weight:normal'>main.py</b>:</p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window.Content.Document.Blocks.Add(create_paragraph(lines_in_file))<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
main_window.Show()<span
style='color:green'><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>Application().Run()<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
background:#D9D9D9;mso-background-themecolor:background1;mso-background-themeshade:
217;mso-layout-grid-align:none;text-autospace:none'><span style='font-size:
10.0pt;font-family:"Courier New";mso-fareast-language:EN-US;mso-no-proof:yes'>
ms_word.Quit()<o:p></o:p></span></p>

<p class=MsoNormal style='margin:0in;margin-bottom:.0001pt;line-height:normal;
mso-layout-grid-align:none;text-autospace:none'><span style='font-size:10.0pt;
font-family:"Courier New";color:green;mso-fareast-language:EN-US;mso-no-proof:
yes'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Last but not least we:</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l2 level1 lfo23'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>
Add the paragraph created in the previous step to our document</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l2 level1 lfo23'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Make
<b style='mso-bidi-font-weight:normal'>main_window</b> visible by calling the <b
style='mso-bidi-font-weight:normal'>Show</b> method</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l2 level1 lfo23'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Call
<i style='mso-bidi-font-style:normal'>Application().Run()</i> to begin
accepting events and stop ipy.exe from exiting out of <b style='mso-bidi-font-weight:
normal'>main.py</b> until the end-user closes the window.</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.25in;mso-list:l2 level1 lfo23'><![if !supportLists]><span
style='mso-fareast-font-family:"Times New Roman"'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>Finally
when the main window has finished running, we tell Microsoft Word to terminate.<span
style='mso-spacerun:yes'> </span>Take note that this is the same <b
style='mso-bidi-font-weight:normal'>ms_word</b> object found in the <b
style='mso-bidi-font-weight:normal'>spelling.py</b> module.</p>

<h3><a name="_Toc196122524">Run Your Application</a></h3>

<p class=MsoNormal>Now that youve finished coding this part of the exercise,
its time to run it!<span style='mso-spacerun:yes'> </span>Due to the <i
style='mso-bidi-font-style:normal'>Application().Run()</i> call made in the
last step, you cannot pass the <i style='mso-bidi-font-style:normal'>-i</i>
flag to ipy.<span style='mso-spacerun:yes'> </span>Instead you should call <b
style='mso-bidi-font-weight:normal'>main.py</b> using one of the following two
patterns:</p>

<p class=MsoNormal style='text-indent:.5in;background:#D9D9D9;mso-background-themecolor:
background1;mso-background-themeshade:217'>ipy main.py misspelled.py</p>

<p class=MsoNormal>or preferably:</p>

<p class=MsoNormal style='background:#D9D9D9;mso-background-themecolor:background1;
mso-background-themeshade:217'><span style='mso-tab-count:1'> </span>ipyw
main.py misspelled.py</p>

<p class=MsoNormal>from the <b style='mso-bidi-font-weight:normal'>Command
Prompt</b>.<span style='mso-spacerun:yes'> </span>ipy is a console process and
ipyw returns control immediately from the <b style='mso-bidi-font-weight:normal'>Command
Prompt</b>.<span style='mso-spacerun:yes'> </span>The second parameter to
ipy/ipyw above, misspelled.py, is a file containing # style code comments and
many misspelled words.<span style='mso-spacerun:yes'> </span>This file is
denoted by sys.argv[1] in main.py.</p>

</div>
<h2>
<o:p>&nbsp;</o:p></h2>
<p class="body">This concludes our tutorial. Have fun playing with this sample!</p>

</body>

</html>

<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 12 (filtered)">
<title>3D Graphics in IronPython</title> 

<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
 /* Style Definitions */
 span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
p.Offset, div.Offset
	{
	mso-style-name: Offset;
	margin-top: 0in;
	margin-right: .5in;
	margin-bottom: 0in;
	margin-left: .5in;
	margin-bottom: .0001pt;
	border: none;
	padding: 0in;
	font-size: 12.0pt;
	font-family: Verdana;
}
p.OffsetHeader, div.OffsetHeader
	{
	mso-style-name: "Offset Header";
	margin-top: 0in;
	margin-right: .5in;
	margin-bottom: 0in;
	margin-left: .5in;
	margin-bottom: .0001pt;
	text-align: center;
	border: none;
	padding: 0in;
	font-size: 12.0pt;
	font-family: Verdana;
	font-weight: bold;
}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;}
 /* List Definitions */
  -->
</style>

<link rel="stylesheet" type="text/css" href="../Samples.css">

</head>

<body lang=EN-US link=blue vlink=purple>

<div class=Section1>

    <hr />
        <p class="CopyrightText">
            Information in this document is subject to change without notice. The example companies,
            organizations, products, people, and events depicted herein are fictitious. No association
            with any real company, organization, product, person or event is intended or should
            be inferred. Complying with all applicable copyright laws is the responsibility
            of the user. Without limiting the rights under copyright, no part of this document
            may be reproduced, stored in or introduced into a retrieval system, or transmitted
            in any form or by any means (electronic, mechanical, photocopying, recording, or
            otherwise), or for any purpose, without the express written permission of Microsoft
            Corporation.</p>
        <p class="CopyrightText">
            &nbsp;</p>
        <p class="CopyrightText">
            Microsoft may have patents, patent applications, trademarked, copyrights, or other
            intellectual property rights covering subject matter in this document. Except as
            expressly provided in any written license agreement from Microsoft, the furnishing
            of this document does not give you any license to these patents, trademarks, copyrights,
            or other intellectual property.</p>
        <p class="CopyrightText">
            &nbsp;</p>
        <div class="Section1">
			<p class="CopyrightText"> Microsoft Corporation. All rights 
			reserved.</p>
			<p class="CopyrightText">&nbsp;</p>
			<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, 
			MSDN, Active Directory, BizTalk, SQL Server, SharePoint, Outlook, PowerPoint, FrontPage, Visual Basic, 
			Visual C++, Visual J++, Visual InterDev, Visual SourceSafe, Visual C#, Visual J#,&nbsp; and Visual Studio 
			are either registered trademarks or trademarks of Microsoft Corporation in the U.S.A. and/or other 
			countries.</p>
			<p class="CopyrightText">&nbsp;</p>
			<p class="CopyrightText">Other product and company names herein may 
			be the trademarks of their respective owners.</div>
	<hr>
	<p class="body">&nbsp;</p>
	<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
	<p class="CopyrightText">
            &nbsp;</p>
	<p class="CopyrightText">
            &nbsp;</p>
	<p class=Normal><b>
	<span style='font-size:16.0pt;font-family:"Arial","sans-serif"'>3D
Graphics in IronPython</span></b></p>

<p class=Normal><span style='font-size:14.0pt;font-family:"Arial","sans-serif"'>A
Flexible DirectX Framework in IronPython</span></p>

<p class=Normal><span style='font-size:14.0pt;font-family:"Arial","sans-serif"'>By
Lee Culver</span></p>

<p class=Normal><span style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;</span></p>

<p class=Normal><span style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;</span></p>

<p class=Toc1><span
class=MsoHyperlink><a href="#_Toc140655628">Getting Started<span
style='color:windowtext;display:none;text-decoration:none'>. 2</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655629">Introduction<span
style='color:windowtext;display:none;text-decoration:none'>. 2</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655630">Prerequisites<span
style='color:windowtext;display:none;text-decoration:none'>. 2</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655631">How to Use
this Tutorial<span style='color:windowtext;display:none;text-decoration:none'> 2</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655632">Objectives
for this Tutorial<span style='color:windowtext;display:none;text-decoration:
none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>2</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655633">Final Note<span
style='color:windowtext;display:none;text-decoration:none'>. 2</span></a></span></p>

<p class=Toc1><span class=MsoHyperlink><a href="#_Toc140655634">Creating the
Framework for a DirectX Application<span style='color:windowtext;display:none;
text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></span></p>

</div>
<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655635">Loading
Assemblies and Importing Them<span style='color:windowtext;display:none;
text-decoration:none'>.. </span>
<span
style='color:windowtext;display:none;text-decoration:none'>3</span></a></span></p>
<div class=Section1>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655636">The
RenderWindow Class<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>4</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655637">Code
Checkpoint 1<span style='color:windowtext;display:none;text-decoration:none'>. 6</span></a></span></p>

<p class=Toc1><span class=MsoHyperlink><a href="#_Toc140655638">Your First
DirectX Application (in IronPython)<span style='color:windowtext;display:none;
text-decoration:none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>6</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655639">Setting up
DirectX<span style='color:windowtext;display:none;text-decoration:none'>.. 6</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655640">Code
Checkpoint 2<span style='color:windowtext;display:none;text-decoration:none'>. 9</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655641">An
Introduction to Duck Typing<span style='color:windowtext;display:none;
text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>9</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655642">Loading
Meshes<span style='color:windowtext;display:none;text-decoration:none'>. 10</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655643">Rendering
Meshes<span style='color:windowtext;display:none;text-decoration:none'>. 11</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655644">Code
Checkpoint 3<span style='color:windowtext;display:none;text-decoration:none'>. 13</span></a></span></p>

<p class=Toc1><span class=MsoHyperlink><a href="#_Toc140655645">Cameras,
Moving Objects, and Events<span style='color:windowtext;display:none;
text-decoration:none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>13</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655646">The Event
System<span style='color:windowtext;display:none;text-decoration:none'>.. 14</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655647">Code
Checkpoint 4<span style='color:windowtext;display:none;text-decoration:none'>. 17</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655648">Exercises<span
style='color:windowtext;display:none;text-decoration:none'>. 17</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655649">Moving
Objects on Screen<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>17</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655650">Rotating
Objects on the Screen<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>20</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655651">Putting it
All Together<span style='color:windowtext;display:none;text-decoration:none'> 20</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655652">Cameras<span
style='color:windowtext;display:none;text-decoration:none'>. 21</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655653">Code
Checkpoint<span style='color:windowtext;display:none;text-decoration:none'> 23</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655654">Exercises<span
style='color:windowtext;display:none;text-decoration:none'>. 23</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655655">Framework
Optimization<span style='color:windowtext;display:none;text-decoration:none'>. 24</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655656">Adding Other
Types of Objects<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>26</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655657">A Better
Main Function<span style='color:windowtext;display:none;text-decoration:none'>. 28</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655658">Code Checkpoint
6<span style='color:windowtext;display:none;text-decoration:none'>. 29</span></a></span></p>

<p class=Toc1><span class=MsoHyperlink><a href="#_Toc140655659">Cool Things
to Do with the Project<span style='color:windowtext;display:none;text-decoration:
none'> </span><span
style='color:windowtext;display:none;text-decoration:none'>30</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655660">Moving
Objects Around, Part I<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>30</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655661">Moving
Objects Around, Part II<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>31</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655662">Moving
Objects Around, Part III<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>33</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655663">Auto
Tracking<span style='color:windowtext;display:none;text-decoration:none'>. 35</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655664">Gravity and
Free Floating Bodies<span style='color:windowtext;display:none;text-decoration:
none'>. </span><span
style='color:windowtext;display:none;text-decoration:none'>36</span></a></span></p>

<p class=Toc1><span class=MsoHyperlink><a href="#_Toc140655665">Where to Go
from Here<span style='color:windowtext;display:none;text-decoration:none'>. 40</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655666">Managed
DirectX and XNA<span style='color:windowtext;display:none;text-decoration:none'>.. 40</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655667">IronPython<span
style='color:windowtext;display:none;text-decoration:none'>. 41</span></a></span></p>

<p class=Toc2><span class=MsoHyperlink><a href="#_Toc140655668">Extending
the Framework<span style='color:windowtext;display:none;text-decoration:none'>. 41</span></a></span></p>

<p class=Normal><span style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;</span></p>

<p class=Normal><span style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;</span></p>

<h1><a name="_Toc140655628">Getting Started</a></h1>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655629">Introduction</a></h2>

<p class=Normal>In this tutorial we will be creating a highly flexible
Python graphical framework as an introduction to IronPython. By the end of
this tutorial you will have a better understanding of IronPython, a basic grasp
of DirectX, and a better understanding of how IronPython utilizes and interacts
with the .NET framework. </p>

<h2><a name="_Toc140655630">Prerequisites</a></h2>

<p class=Normal>This tutorial assumes only a basic knowledge of the Python
syntax and how to use some of its basic constructs (such as lists and tuples).
No prior knowledge of DirectX or Windows.Forms is required, though a basic
grasp of the .Net platform will go a long way to understanding a few sections
of code.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>We will be building this application from scratch, and all
portions of the code will be fully explained. Note that if you are already
familiar with Python, you should probably skip the sections labeled For Python
Beginners.</p>

<p class=Normal>&nbsp;</p>

<p class="body">
            Further, you will need the following:</p>
	<ul>
			<li class="normal">IronPython 2.6 distribution
			<ul>
				<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
				<li>Download from 
				<a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
			</ul>
			</li>
			<li class="normal">DirectX End-user Runtime and a compatible video card<ul>
				<li>Download from 
					<a href="http://www.microsoft.com/games/en-US/aboutgfw/Pages/directx10-a.aspx">here</a>.</li>
			</ul>
			</li>
</ul>
    <p class=Normal>&nbsp;</p><p class=Normal><b><font size="3">Important Note </font></b></p>
    <p class=Normal>If you've previously installed a DirectX SDK there's a good chance you might have the 
Managed DirectX 2.0 Beta assembly installed.&nbsp; This assembly is incompatible with the Python sample code 
distributed with this tutorial and cannot be uninstalled.&nbsp; If you experience difficulties running the 
samples (particularly when there are error messages stating that the <i>Matrix</i> class has no 
<i>LookAtLH</i> method) and are sure you meet the prerequisites above, please replace all occurrences 
of:</p><p class=Normal><b>&nbsp;&nbsp;&nbsp; </b><i>clr.AddReference(Microsoft.DirectX)</i></p>
<p class=Normal>with:</p><p class=Normal><b>&nbsp;&nbsp;&nbsp; </b><i>clr.AddReferenceByName('Microsoft.DirectX, Version=1.0.2902.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35')</i></p>
<p class=Normal>&nbsp;</p><p class=Normal>throughout the samples.&nbsp; This change basically means that the 
sample code will use Managed DirectX 1 instead of the 2.0 beta which would normally have precedence.</p>

<h2><a name="_Toc140655631">How to Use this Tutorial</a></h2>

<p class=Normal>This tutorial will start from a small set of code and slowly
build a full framework from scratch. Throughout this tutorial you should be
slowly adding code to a Python source file of your own and watching the results
as we build it. There is no substitute for actual programming; I highly
recommend that you resist the urge to simply read along.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655632">Objectives for this Tutorial</a></h2>

<p class=Normal>By the end of the first part of this tutorial we will build a framework which will allow you to import any number of DirectX meshes and view 
them inside of a .NET form.&nbsp; The framework will provide methods for positioning and rotating objects and the camera, as well as examples of using the 
framework to implement more advanced functionality such as having objects move around a track and have cameras auto-track objects in the scene.&nbsp; Lastly, we 
will implement a small scale demo which demonstrates Newtons law of universal
gravitation, which will allow you to specify an arbitrary number of free
floating bodies in space (planets), and watch them interact with each other.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655633">Final Note</a></h2>

<p class=Normal>Throughout this tutorial be very careful to keep the same
indentation levels that have been used here. In Python, white space is a part of
the language, and you must take care to ensure that everything is correctly
aligned or you will receive errors. I suggest setting your text editor of
choice to use 4 spaces instead of tabs (which I have done for all code
presented here).</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Lastly, if you are getting compile errors, check to make
sure you have not inserted extra returns in the middle of statements. The code
may be slightly skewed if you have word wrap turned on.</p>

<p class=Normal>&nbsp;</p>

<h1><a name="_Toc140655634">Creating the Framework for a DirectX Application</a></h1>

<p class=Normal>&nbsp;</p>

<h3><a name="_Toc140655635">Loading Assemblies and Importing Them</a></h3>

<p class=Normal>&nbsp;</p>

<p class=Normal>The first thing we will do is add a few references to
assemblies we will be using. Create a new file called tutorial.py and add
the following code to it:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>import clr</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>clr.AddReferenceByPartialName(&quot;System.Drawing&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>clr.AddReferenceByPartialName(&quot;System.Windows.Forms&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>clr.AddReferenceByPartialName(&quot;Microsoft.DirectX&quot;)</p><p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>clr.AddReferenceByPartialName(&quot;Microsoft.DirectX.Direct3D&quot;)<span style="background-color: #C0C0C0; background-position: 0% 0%"><br>
</span>clr.AddReferenceByPartialName(&quot;Microsoft.DirectX.Direct3DX&quot;)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you do not add the reference to assemblies that you use,
the IronPython interpreter will not know how to load them. If you run into
problems where an import statement does not give the expected results, check to
make sure you have referenced all of the appropriate assemblies first. Note
that IronPython automatically adds the System library.</p><p class=Normal>&nbsp;</p><p class=Normal>If you encounter 
difficulties running the snippet of code above, please see the <b>Important Notes</b> section in the 
<a href="#_Toc140655630">Prerequisites</a>.</p>

<p class=Normal>&nbsp;</p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to IronPython?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>The clr import is not just a library; it actually changes the
  dynamics of several basic constructs. To see this first hand, open up a
  fresh IronPython interpreter and run this code:</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>&nbsp;</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'><span style='font-size:10.0pt;font-family:"Courier New"'>print
  dir([])</span></p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'><span style='font-size:10.0pt;font-family:"Courier New"'>import
  clr</span></p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'><span style='font-size:10.0pt;font-family:"Courier New"'>print
  dir([])</span></p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'><span style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;</span></p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Notice that it adds a number of functions which makes IronPython
  very similar to .NET (though all of the Python functions are still there).
  This also replaces the standard Python string with the .Net string class.
  Throughout this tutorial I will be using the IronPython methods instead of
  the standard Python methods as this produces a more consistent code base.</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we will import all of the libraries we will need for
this tutorial.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>import System</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>from System import Drawing</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>from System.Windows import Forms</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>from Microsoft import DirectX</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>from Microsoft.DirectX import Direct3D</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>In this tutorial I have kept namespaces and never imported
everything into the global namespace. This will make the rest of the tutorial
slightly more verbose, but it will also be very explicit as to which functions
we are calling.</p>

<p class=Normal>&nbsp;</p>

<h3><a name="_Toc140655636">The RenderWindow Class</a></h3>

<p class=Normal>&nbsp;</p>

<p class=Normal>The next thing we need to do is to create a new Form to
house our application. In IronPython we can natively derive from any .Net
class which is not sealed or a value type. We will define a constructor which
takes in a single argument (a class which contains a Paused attribute).
Though I am calling this variable sceneManager here, and we will be providing a
class called SceneManager later, we could easily swap it for any other class
which understands how to pause and unpause the system:</p>

<p class=Normal><span style='font-size:10.0pt;font-family:"Courier New"'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class RenderWindow(Forms.Form):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, sceneManager):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.SceneManager = sceneManager</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Text = &quot;IronPython Direct3D&quot;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.ClientSize = Drawing.Size(640, 480)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Here we have set our own instance variable SceneManager to
be the sceneManager variable that was passed in. We have also set the Text
and ClientSize properties, which are properties defined by the Forms.Form
class.</p>

<p class=Normal>&nbsp;</p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to Python?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>When defining a classs method in Python, you always add a
  parameter for the object you are currently operating on. In languages such
  as C# or C++ this parameter is implicitly passed as the this parameter.
  Note that we cannot access a classs member methods or data without using
  this self parameter.</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next, we want our window to close (and the application to
exit) whenever the escape key is pressed. We will override the OnKeyDown
method of Forms.Form to do this.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnKeyDown(self, args):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if args.KeyCode ==
System.Windows.Forms.Keys.Escape:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Dispose()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Finally, we want the application to pause and stop rendering
any time the application is minimized or not visible. For now we will set the
Paused variable on the SceneManager variable we have created. We will actually
implement the code for this later.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnResize(self, args):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.SceneManager.Paused = not self.Visible or
\</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> (self.WindowState ==
Forms.FormWindowState.Minimized)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we are going to add the shell of the SceneManager
class. The first three methods are very simple (and we will revisit their
implementations later). The first is the constructor, the second is a method
which sets up DirectX, and the third is the Render method, which is called
from within our render loop. We will cover these in detail later.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class SceneManager(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pass</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def InitGraphics(self, handle):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Render(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pass</p>

</div>

<p class=Normal>&nbsp;</p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to Python?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Whenever we define a method or class which has no body, we
  always must use the pass keyword. This keyword has no meaning outside of
  saying empty code block.</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>&nbsp;</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Note that we have returned True from InitGraphics. One
  important thing to note about Python is that any time you do not return a
  value, you are implicitly returning the None type (which is roughly
  equivalent to null, with a few exceptions). This is why you will see some
  code paths in Python which have return statements and some which do not.
  This is perfectly valid, and generally accepted as normal.</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we need to create the render loop for the application.
This loop will pump the Windows.Forms event queue and call the Render method:</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Go(self, window):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> while window.Created:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Render()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Forms.Application.DoEvents()</p>

</div>

<p class=Normal><span style='font-size:10.0pt;font-family:Consolas'>&nbsp;</span></p>

<p class=Normal>Finally, we will create the main function which creates the
basic objects and starts the render loop.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>def main():</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sceneManager = SceneManager()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> window = RenderWindow(sceneManager)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if not sceneManager.InitGraphics(window.Handle):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Forms.MessageBox.Show(&quot;Could not init
Direct3D.&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> else:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> window.Show()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sceneManager.Go(window)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>if __name__ == '__main__':</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> main()</p>

</div>

<p class=Normal>&nbsp;</p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to Python?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>In a Python script it is ok to have code which runs at the file
  level (that is, not inside of a function, not inside of a class). This code
  is run every time the code is imported. If you want to have the code run
  only when the module is explicitly ran (not imported) we use the built in
  __name__ variable to determine if we have been explicitly invoked from the
  command line. It will always equal __main__ if we have been run from the
  command line. If the module was loaded using the import statement,
  __name__ would be the name of the file otherwise.</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>&nbsp;</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>We have explicitly created a main function so that if this code
  is imported into an IronPython console, the main function can be invoked
  explicitly. If we replaced the call to main with the contents of the main
  function, there would be no way to run the code outside of actually running
  it from the command line (and not importing it). This is sometimes
  desirable, but not in our application. We will be using this much later in
  the tutorial when we actually import our framework from a separate file.</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>&nbsp;</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Notice also that creating a class does not use the new keyword
  like C# and C++ do. The syntax for creating a new class is the exact same
  as calling a function. This is by design. In many cases we can use function
  calls and class constructors interchangeably when we are passing functions as
  parameters.</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655637">Code Checkpoint 1</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run the code from within IronPython. You should see an empty
Windows.Forms window. If you are having problems with the code, you should
compare your source file with checkpoint1.py.</p>

<p class=Normal>&nbsp;</p>

<h1><a name="_Toc140655638">Your First DirectX Application (in IronPython)</a></h1>

<p class=Normal>&nbsp;</p>

<p class=Normal>In this section we will create a basic scene in DirectX. By
the end of this section, we will have created a DirectX context, rendered a
mesh to the scene, and explored the Python concept of Duck Typing along the
way.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655639">Setting up DirectX</a></h2>

<p class=Normal>This section will deal exclusively with the SceneManager
class. The first thing we need to do is initialize a few variables which we
will be using in this code. Be sure to always remove the pass statement when
we add code to empty methods.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>We will add three variables: The first will contain our
DirectX device when we have created it. The second will determine if the
DirectX context is paused (in case we are minimized or hidden). The third will
be the background color for the DirectX rendering device.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class SceneManager(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device = None</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Paused = False</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Background = System.Drawing.Color.Black</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we will fill in the InitGraphics method. This
section of code creates the DirectX device we will use in this tutorial.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The first thing we will do is set up the parameters that we
will pass to DirectX. We will set DirectX to be in windowed mode, set the swap
effect for drawing frames, and enable the auto depth stencil (so that DirectX
tracks the depth of our objects for us). For more information on the specifics
on these properties and parameters, consult the DirectX documentation. Since
creating a DirectX device requires a window handle to place it in, we will take
in a handle parameter to use this.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def InitGraphics(self, handle):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; params = Direct3D.PresentParameters()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> params.Windowed = True</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>params.SwapEffect =
Direct3D.SwapEffect.Discard</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>params.EnableAutoDepthStencil = True</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>params.AutoDepthStencilFormat =
Direct3D.DepthFormat.D16</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to actually create the Direct3D device. Note
that we are passing in the handle parameter to the constructor of the Direct3D
device. This is what tells DirectX to use the window that we have created. We
also pass in the PresentParameters object we just created. For more specifics
on the Device creation parameters, consult the managed DirectX documentation. </p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Device = Direct3D.Device(0,
Direct3D.DeviceType.Hardware, handle,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>
Direct3D.CreateFlags.SoftwareVertexProcessing,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> params)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>After creating the device, we need to set a couple of
properties on the Device. The first thing we need to do is enable the
ZBuffer. If we did not do this, we could not draw in 3 dimensions (which is
basically the point of this tutorial). We also need to set the ambient light
to be a full white. There are multiple types of lighting which DirectX uses:
diffuse, ambient, specular and emissive. A full treatise on lighting would be
far beyond the scope of this document. For this tutorial we are going to
simply set the ambient light to full (white), and force every mesh we load to
use ambient lighting. This, effectively, turns off lighting so we do not have
to worry about it.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Device.RenderState.ZBufferEnable =
True</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Device.RenderState.Ambient =
Drawing.Color.White</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we need to set up two of the three matricies which
DirectX uses to render the scene. The Projection matrix is the most
complicated. It basically transforms the 3D matrix of objects into a 2
dimensional plane to display on the screen. We will not have to deal with this
matrix after we have set it the first time.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The second matrix DirectX uses is the View matrix which
defines where the camera is looking. DirectX has some very nice methods which
allow us to deal with cameras in a very natural way. The
Matrix.LookAtLH takes in three parameters. The first is the position
of the camera. The second is what the camera looks at. The third is the up
vector, which is the up direction for the camera. Setting the up vector
incorrectly would result in the scene being rotated in strange ways.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Device.Transform.Projection =
DirectX.Matrix.PerspectiveFovLH(System.Math.PI/4.0, 1, 1, 100)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Device.Transform.View =
DirectX.Matrix.LookAtLH(DirectX.Vector3(<span style='font-size:10.0pt'>0,
3, -5</span>), DirectX.Vector3(0, 0, 0), DirectX.Vector3(0, 1, 0))</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The rest of our code simply sets the Paused property to be
false. We will return true to indicate no error occurred.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'># ensure we are not paused</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Paused = False</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The last thing we need to do is render the scene. For now
this code is very basic, but we will be adding to it later. First, we only
render if the Device has already been created and we are not paused.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 0in 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Render(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if self.Device is None or self.Paused:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>At the beginning of each render, we clear the scene with a
specific background color (which we set in the constructor).</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.Device.Clear(Direct3D.ClearFlags.Target | Direct3D.ClearFlags.ZBuffer,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.Background, </p>
<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1, </p>
<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.BeginScene()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> # scene render here</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.EndScene()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.Present()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run the application. We have now created a DirectX render
loop in under 100 lines of IronPython code. Now we need to make something
useful out of it</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655640">Code Checkpoint 2</a></h2>

<p class=Normal>Run your Python application. At this point you should have
the same window as the previous checkpoint, but with a black DirectX context.
If you are having problems with the code, you should compare your source file
with checkpoint2.py.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655641">An Introduction to Duck Typing</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have an application running, what we need to do is
load a mesh and render it in the scene. To do this, DirectX needs four pieces
of information: the Mesh, the World Matrix (to position the object), a list of
materials, and a list of textures. We will provide one extra constraint that
we will use: every object we render in the scene will need a Name so that we
can place it into a dictionary for easy access.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>A common approach to solving this problem in strongly typed
languages such as C++ and C# is to define an interface which classes must
implement to be used by the SceneManager. This is a good approach for these
languages, but it can be extraordinarily limiting when using a more flexible
language such as IronPython. The concept of an interface still exists in
IronPython, but instead of being an explicit interface, it is a more
contractual negotiation between objects which interact with each other.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>In this case, we need to implement an interface for our
Renderable objects. The nave approach (for python programming) would be to
define an explicit class to handle this (this code should not be added to the
project):</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class IRenderable:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Name = &quot;&quot;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Mesh = None</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Textures = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Materials = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def GetWorldMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pass</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>def function(renderable):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if not isinstance(renderable, IRenderable):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> raise TypeError</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> # use the instance</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>This is certainly a valid solution, but completely
unnecessary. Instead, the Python way is to simply define the required
methods and attributes and only use inheritance when code is actually being
shared between classes. This can lead to many interesting uses of a class
which were not anticipated by the programmer who wrote the original code. The
fact that we have not constrained the Name attribute to be a string type
means we can use any hashable object (such as integers, strings, the None type,
classes, instances of classes) to access scene objects. This style of
programming also has the obvious benefit of less coding overhead. We do not
have to define the interface in the code, nor do we have to explicitly declare it,
so long as we implement all of the correct functionality in an object.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>A good example of this would be the RenderWindow class. We
pass the scene manager into the RenderWindow class so that the window can pause
the scene manager when it is not being shown. From the RenderWindows
perspective, it doesnt care what object it is given so long as that object
understands what is meant when the programmer sets the Paused variable. This
can be seen as an implicit interface, containing only the Paused property as
the member of the interface. As briefly mentioned before, we could easily swap
the object we pass to RenderWindow with a different one if we so choose (so
long as the new object understood what to do with that Paused property),
without ever having to change the RenderWindow class.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>This is what is meant when Python programmers refer to Duck
Typing. The idea is if it walks like a duck, quacks like a duck, it might as
well be a duck. Or to use a less obtuse metaphor, if a class implements
everything that is needed to perform a task, do we really care what class it <b>actually</b>
is, or what interfaces it claims to implement?</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Along with the general flexibility of the syntax and
constructs of the language, Duck Typing is the primary reason that Python as a
whole is so lightweight. A change to a method in one class only has to be
reflected in the other classes which rely on this method.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655642">Loading Meshes</a></h2>

<p class=Normal><br>
With this in mind, we will now set out to implement our first iteration at
rendering meshes. The first thing we will do is create a new class which loads
a mesh and implements the interface we have outlined. The constructor for our
class will take in three items. The first is the DirectX device to use to load
it, the second is the name of the object, and the last is the .x file we are
loading.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class MeshRenderable(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, device, name, file):<span
style='font-size:10.0pt'> </span></p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'><span style='font-size:10.0pt'> self.Name =
name</span></p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to load the actual mesh itself. The major
parameters we are passing are the Direct3D device, the filename to load the
mesh from, and an empty list of materials which DirectX will populate . Please 
consult the managed DirectX documentation for more information on the other 
parameters, if you are curious.</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; materials = clr.Reference[System.Array[Direct3D.ExtendedMaterial]](())<span 
style="background-color: #C0C0C0; background-position: 0% 0%"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>self.Mesh = Direct3D.Mesh.FromFile(file,<span style="background-color: #C0C0C0; background-position: 0% 0%"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>Direct3D.MeshFlags.SystemMemory,<span style="background-color: #C0C0C0; background-position: 0% 0%"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>device, materials)<span style="background-color: #C0C0C0; background-position: 0% 0%"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>materials = materials.Value</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have loaded the mesh into self.Mesh and loaded a
list of materials into the materials variable, we will build a list of
preloaded Materials and Textures. As mentioned previously, we are going to use
only the ambient lighting for this tutorial and we implement this by setting
the ambient color to be the diffuse color on the mesh.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Materials = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Textures = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for i in range(materials.Length):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> # load material, set color</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> material = materials[i].Material3D</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> material.AmbientColor =
material.DiffuseColor</p>

</div>

<p class=Normal> </p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The material itself only provides us with the textures file
name We actually have to load the texture ourselves.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> texture = None</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> texFile = materials[i].TextureFilename</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if texFile is not None and texFile.Length:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> texture = Direct3D.TextureLoader.FromFile(device, texFile)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we add the material and the texture to their respective
lists.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Materials.append(material)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Textures.append(texture)</p>

</div>

<p class=Normal><span style='font-size:10.0pt;font-family:Consolas'>&nbsp;</span></p>

<p class=Normal><span style='font-size:10.0pt;font-family:Consolas'>&nbsp;</span></p>

<p class=Normal>Lastly we need to implement the <span style='font-size:10.0pt;
font-family:Consolas'>GetWorldMatrix</span> method. For now, we will simply
return the identity matrix, because we have not implemented any positioning
code.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def GetWorldMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return DirectX.Matrix.Identity</p>

</div>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655643">Rendering Meshes</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have code for loading a mesh, we need to add
some code to actually render it. Along the way, we will want to collect the
objects into a common place, and the SceneManager class seems like an obvious
place to do this.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>First, add a new dictionary to the SceneManager class called
Objects.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class SceneManager(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device = None</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Paused = False</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Background = System.Drawing.Color.Black</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Objects = {}</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>To abstract away some of the details of loading a mesh we
will provide a mechanism for loading textures. This method will take in the
name of the object and the filename to load, store the object in the Objects
dictionary, and return the Mesh (in case the caller actually needed to
manipulate the object after creating it).</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def LoadMesh(self, name, filename):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> mesh = MeshRenderable(self.Device, name,
filename)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Objects[mesh.Name] = mesh</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>return mesh</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to actually render the Objects. Find the
comment in the Render method which says scene render here. We will implement
this by walking through all of the values in the Objects dictionary. For each
object that has the GetWorldMatrix attribute, we will assume that it is a
mesh and render it as such.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>To accomplish this we will use Pythons generator
expressions to iterate through the Objects. To determine which objects have
the GetWorldMatrix method we will use Pythons hasattr function. The hasattr
function returns true if the first parameter passed into it contains an
attribute which is named the second parameter. In Python, using reflection is
as natural as breathing, and learning to use it effectively is the key to
writing clean and concise code.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Between the self.Device.BeginScene() and
self.Device.EndScene() calls, add the following code:</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for mesh in (x for x in self.Objects.Values if
hasattr(x, &quot;GetWorldMatrix&quot;)):</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>There is one catch, we have only determined that the
GetWorldMatrix exists, not if it is a callable method. Python implements a
handy method for determining if an attribute is callable:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if callable(mesh.GetWorldMatrix):</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Note we could have added the callable if statement to the
end of the generator expression by adding the and boolean operator. As an exercise,
make this change now.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The process for rendering a mesh is to specify the world
matrix, then for each subset of a mesh, set the material and texture then
render the subset. We can actually share mesh data between multiple objects by
simply using the same Direct3D.Mesh objects and setting the world matrix for
each render. For now, we will simply render the mesh without this optimization.
</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.Transform.World =
mesh.GetWorldMatrix()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> materials = mesh.Materials</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> textures = mesh.Textures</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for i in range(len(materials)):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.Material =
materials[i]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if i &lt; len(textures):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.SetTexture(0,
textures[i])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> else:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.SetTexture(0,
None)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> mesh.Mesh.DrawSubset(i)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Note here that we have only set the texture if there is
actually a texture for this particular material. There must be a material for
the subset we are drawing, but there does not have to be a texture for that
particular material.</p>

<h2><a name="_Toc140655644">Code Checkpoint 3</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Save your work and run the file. For all of our new
changes, we dont actually have anything new to show for it yet. Find the main
function and add a call to the LoadMesh method as follows:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if not sceneManager.InitGraphics(window.Handle):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Forms.MessageBox.Show(&quot;Could not init
Direct3D.&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> else:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sceneManager.LoadMesh(&quot;tiger&quot;,
&quot;tiger.x&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> window.Show()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sceneManager.Go(window)</p>

</div>

<p class=Normal><br>
Now run the application. You should see a tiger facing the camera. The next
thing we will do is implement a flexible event system to move the tiger.
Remove the call to LoadMesh from the main function, as that was only to
demonstrate that we are indeed loading the mesh.</p>

<h1><a name="_Toc140655645">Cameras, Moving Objects, and Events</a></h1>

<p class=Normal>&nbsp;</p>

<p class=Normal>In this section of the tutorial we will be exploring an event
system which allows us to manipulate the scene by responding to events such as
the scene being created or a frame being rendered. We will also add
positioning code and rotational code, so you can arbitrarily move and rotate
objects. Lastly, we will implement a camera system which allows us to set
cameras throughout our scene and switch between them at will.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655646">The Event System</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Though our event system will be able to handle any arbitrary
events we create later, we will start with three basic events: OnSceneCreate, OnSceneBegin, and OnFrame. The OnFrame method will be called
just before rendering a frame. This will allow us to reposition objects (or do
other updates) which require action every frame. The OnSceneCreate method will
be called before the scene starts rendering, and it is used for creating and
adding objects (such as meshes and cameras) to the scene. The OnSceneBegin
event will be fired right after the OnSceneCreate event has finished. The
OnSceneBegin method is used to move and position objects which have not been
created by that event handler. This is an important distinction since we are
not guaranteeing anything about the order in which event handlers of the same
type are called. By offering these two events separately, we can allow a
single listener to create an object that another object uses without worrying
about the order in which events are passed.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The OnSceneCreate and OnSceneBegin events will accept a
single parameter (the scene manager who is calling them), and the OnFrame events
will accept a parameter for the number of seconds since the last frame was
rendered. Lastly, events return values indicating whether or not they have completed their
operations. By returning True an
object signifies that it should no longer receive any events.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>To implement this, we will start by creating a dictionary
which holds the event name as a key, and a list of event handlers as the
value. Find the SceneManager constructor and add this code:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Listeners = {&quot;OnFrame&quot; : [],</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> &quot;OnSceneBegin&quot; :
[],</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> &quot;OnSceneCreate&quot; :
[]}</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>We will add two methods for adding listeners to the class.
The first is the AddListenerByName method, which takes in an event listener and
a name of the event. The implementation is very straight-forward (raising a
TypeError if we are given an event listener which is not callable):</p>

<p class=Normal>&nbsp;</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'> </span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def AddListenerByName(self, key, function):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if not callable(function):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> raise TypeError, &quot;Object not
callable.&quot;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Listeners[key].Add(function)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>This is good to have, but this would quickly become tedious
to use if we had a large number of objects, each registering for multiple
events. What we would like to do is to inspect an object, and register their
event handlers based on the function names.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>This is extraordinarily easy to do in Python. We will walk
through each of the keys in the Listeners dictionary, and if the object has a
function by that name, we will register it as an event listener:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def AddListener(self, obj):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for key in self.Listeners.Keys:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if hasattr(obj, str(key)):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> function = GetAttr(obj, str(key))</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.AddListenerByName(key, function)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Only four lines of actual code to walk the object and pull
out the functions we are looking for.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to add a method for actually firing the
events. As I mentioned earlier, each event will return whether or not it has
completed its operations. In practice this means that if we are complete we
return True, if we are not complete (or if the listener never completesif it
should be registered for the entire lifetime of the SceneManager), then we can
either return False, or simply not return anything at all. Since all methods
implicitly return the None type, and since None always evaluates to false in a
Boolean expression, this allows us to implicitly return false when we do not
return at all. While difficult to explain the reasoning for this concisely, it
will make our listener code easier to write.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>To implement a method which fires events, then removes
objects which return True, we will call every function in the appropriate
listener list, keeping track of each function which returned true.</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __FireEvent(self, event, arg):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> listeners = self.Listeners[event]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> toRemove = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for f in listeners:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if f(arg):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> toRemove.Add(f) </p>

</div>

<p class=Normal> </p>

<p class=Normal>Now we walk the toRemove list and remove them.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for f in toRemove:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> listeners.Remove(f)</p>

</div>

<p class=Normal>&nbsp;</p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to Python?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Whenever you prefix a method or variable with two underscores,
  that method or variable is hidden. This is roughly equivalent to declaring
  it as private in a C++ or C#. The major difference is the variable or
  method is still actually there, its just difficult to modify unless you
  understand the internals of how Python hides it. This is implemented such
  that it is possible to have a friend class as you do in other languages
  (allowing you to access an objects private data), but at the same time
  letting you know that you are doing something you really should try not to.</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal>&nbsp;</p>

<p class=Normal>Lastly, we need to actually call the __FireEvent method to
send the events. To do this we will modify SceneManagers Go method, so clear
out the contents of it. Well start by firing the scene creation and scene
begin events:</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Go(self, window):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__FireEvent(&quot;OnSceneCreate&quot;,
self)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__FireEvent(&quot;OnSceneBegin&quot;,
self)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we need to add code for firing the OnFrame event. The
trick is we have to keep track of how long it has been since we last fired a
frame event. Well use the System.Environment.TickCount (measured in
milliseconds) to do this.</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> lastTick = System.Environment.TickCount</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> while window.Created:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> currTick = System.Environment.TickCount</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__FireEvent(&quot;OnFrame&quot;,
(currTick-lastTick)/1000.0)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> lastTick = currTick</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Render()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Forms.Application.DoEvents()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Note that the extra .0 in the __FireEvent call is very
important. Both currTick and lastTick are integer values and currTick-lastTick
is certainly less than 1000. If we did not divide it by a floating point
number we would always be passing 0 (the integer division value).</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>We will now create a very simple event listener which adds
our tiger mesh to the scene. We will be expanding this event listener in later
sections.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class SceneCreator(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneCreate(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Tiger = sm.LoadMesh(&quot;Tiger&quot;,
&quot;tiger.x&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now, we need to register this listener. In general, we
could have many listeners in our application. What we want to do now is to
make the main function take in an optional parameter which defines a sequence
of objects to register as listeners. Find the main function and change its
function header:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>def main(listeners = [SceneCreator]):</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>This creates an optional parameter listeners which, by
default, contains our SceneCreator class.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>As you see, we have passed in a class instead of an instance
of the class. What we want is for our function to iterate over the sequence we
are given, adding instances of the objects to the scene manager. If an entry
in the sequence is a class, we want to create an instance of it and add it. Find
the else clause in the main function, and add the following code:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> else:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for obj in listeners:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if callable(obj):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> obj = obj()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sceneManager.AddListener(obj)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> window.Show()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sceneManager.Go(window)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Note that we have assumed here that a callable object is a
constructor (or, at least, returns an instance of a listener object). This
works well enough in most cases. The biggest problem we can run into is the
fact that objects in Python can implement the __call__ method, which makes an
object instance act like a function. If we added a class like this to the
parameter list in main, we could run into trouble. There are ways around this,
but I have left it out of this tutorial as this is a bit outside what we are
exploring in Python. Feel free to look up Pythons documentation for more
information related to classes.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655647">Code Checkpoint 4</a></h2>

<p class=Normal>Save your work and run the file. You should now see a tiger
standing in front of the camera. If you are having trouble at this point,
compare your code to checkpoint4.py.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655648">Exercises</a></h2>

<p class=Normal>Before moving on, I would like to note that we have skipped over a couple of useful methods which a full application would need.&nbsp; If you 
are new to Python, I suggest you implement these methods as an exercise.&nbsp; This is not required to move onto the next section, as we will not be making use 
of any of these.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>First, implement a RemoveListenerByName method which takes
in a name and a listener and unregisters that listener from the specified
event.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Implement a RemoveListener method which unregisters a
listener from all events.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655649">Moving Objects on Screen</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>The next thing we will implement is moving and rotating objects
in the scene. To do this we will create two classes which will be subclassed
by other scene objects to share the functionality.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The first thing we will implement is a PositionableObject
class. This class will provide a Position property (containing a
DirectX.Vector3 object), and a Translate method. The Position property will
always contain a Vector3 instance that we can always directly pass into
a DirectX function without having to convert it. To do this, we will add a
function at the top level of the file which takes in a parameter and if the
parameter is of sequence type, well convert it to a Vector3. Be sure this
function is added near the beginning of the file.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>def Vectorize(v):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if type(v)==list:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> v = DirectX.Vector3(v[0], v[1], v[2])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return v</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will implement the PositionableObject class using a
Python property object for the Position variable. To define a property in
Python, we first define a get method, a set method, a delete method, and a
hidden variable to contain the value. (Note we will always call
the Vectorize function before actually assigning to the __Position variable.)</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class PositionableObject(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = DirectX.Vector3(0, 0, 0)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __GetPosition(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.__Position</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __SetPosition(self, pos): </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = Vectorize(pos)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __DelPosition(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = DirectX.Vector3(0, 0, 0)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>To create the actual property itself, we call the property
function:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Position = property(__GetPosition, __SetPosition,
__DelPosition)</p>

</div>

<p class=Normal>&nbsp;</p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to Python?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>The property function takes in 4 parameters. The first is the
  get method, the second is the set method, the third is the delete
  method, and the fourth is a help string. Only the first parameter (the get
  method) is required. If we do not specify a delete method, this will
  create a property which throws an AttributeError if the user tries to delete
  it. If we do not supply a set property then the variable will be read-only.
  The help string is also completely optional.</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next, we will implement the Translate method. This is also
straight forward, converting parameter then translating it.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Translate(self, amount):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> amount = Vectorize(amount)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position += amount</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>At this point you may wonder, Why do we bother with a Translate
method? The problem we are faced with is that we are trying to support a
native Python solution to this problemthat is, we would like our movable
objects to work with lists in addition to DirectX.Vector3 objects. This
works fine until we try to use them in conjunction with the Vector3 class
(which has no idea how to deal with a python list). For example, this code
works fine (do not add this to the project):</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>a = DirectX.Vector3(1, 2, 3)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>b = DirectX.Vector3(3, 2, 1)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>c = a + b</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>This, however, will fail (do not add this to the project):</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>a = DirectX.Vector3(1, 2, 3)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>b = [3, 2, 1]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>c = a + b</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>DirectX.Vector3 objects simply have no idea how to deal with
lists (or any other object than Vector3s, for that matter). A common solution
to this problem is to subclass the object and redefine its math operations such
that it would convert from a list to a Vector3 automatically. This is unfortunately
not possible since .Net does not support subclassing sealed or value types (and
DirectX.Vector3 is a value type).</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Our only option at this point is to add a Translate method
which knows how to convert between sequence types and Vector3 objects, and add
the result. For example (do not add this to the project):</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'># this will work</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>somePositionableObject.Position += DirectX.Vector3(1,
2, 3)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'># this will not work</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>somePositionableObject.Position += 1, 2, 3</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'># this will work, which is why we created it</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>a = 1, 2, 3</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>somePositionableObject.Translate(a)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'># this works too </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>a = DirectX.Vector3(1, 2, 3)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>somePositionableObject.Translate(a)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The last thing we need to add is a read-only property called
PositionMatrix, which (predictably) will return a matrix based on the position.
We need this because all of DirectXs positioning code relies on matrices and
not vectors. To implement this we will use the DirectX.Matrix.Translation method to build a translation matrix based on the position vector, and then
use this to create the PositionMatrix property:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __GetPositionMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return DirectX.Matrix.Translation(self.Position)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> PositionMatrix = property(__GetPositionMatrix)</p>

</div>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655650">Rotating Objects on the Screen</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>The next thing we will do is add a class which handles rotating
objects. The RotatableObject will act quite differently from PositionableObject
in the sense that we do not have a single property we are interacting with.
Instead we are going to implement four simple methods to perform rotations.
The Pitch method will rotate the object around the x-axis, the Yaw method
will rotate the object around the y-axis, the Roll method will rotate the
object around the z-axis, and the ResetOrientation method will revert all
orientation changes to the object.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class RotatableObject(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.RotationMatrix = DirectX.Matrix.Identity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def ResetOrientation(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.RotationMatrix = DirectX.Matrix.Identity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Pitch(self, p):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.RotationMatrix *=
DirectX.Matrix.RotationX(p)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Yaw(self, y):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.RotationMatrix *=
DirectX.Matrix.RotationY(y)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Roll(self, r):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.RotationMatrix *=
DirectX.Matrix.RotationZ(r)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>That is all that is required for adding object rotation.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655651">Putting it All Together</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>The final thing we need to do before actually playing with
our new code is have our MeshRenderable class actually implement these two base
classes. Modify the MeshRenderable class to inherit from the
PositionableObject and RotatableObjects, making sure to call the base
constructors:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class MeshRenderable(PositionableObject,
RotatableObject):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, device, name, file):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> PositionableObject.__init__(self)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> RotatableObject.__init__(self)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next, change the GetWorldMatrix method to return the
rotation matrix multiplied by the position matrix (remember that matrix
multiplication is not commutative, and it matters greatly the order in which
you multiply these two matrices).</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def GetWorldMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.RotationMatrix *
self.PositionMatrix</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we can finally put this to use. We have already loaded
a tiger mesh in our SceneCreator class. Now we will create a new class to
position and animate the tiger. Have the tiger rotate around the y-axis. To
do this, well add a frame event which calls the Yaw method, passing in the
elapsed time as the amount to rotate it.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class TigerAnimator(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneBegin(self, sceneManager):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Tiger =
sceneManager.Objects[&quot;Tiger&quot;]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Tiger.Yaw(elapsed)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Finally, we need to add this listener to the SceneManager
class. Since objects which affect a scene are parts of the scene too, it seems
natural to have the SceneCreator class actually instantiate this object.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Update SceneCreators OnSceneCreate method to add this
listener:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneCreate(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Tiger = sm.LoadMesh(&quot;Tiger&quot;,
&quot;tiger.x&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(TigerAnimator())</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655652">Cameras</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>The last major scene object we will be adding to our framework
is a Camera object. We will introduce a new variable in the SceneManager class
called ActiveCamera to store the camera actually being used to view the
scene. We will store inactive cameras in SceneManagers Objects dictionary
so that they may be accessed by any object which has a reference to the scene
manager.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Our camera class will be a bit different from our object
positioning and rotation code. Instead of rotating the camera around various
axes to face the objects we wish to look at, we will instead implement a camera
class which always looks at a given position. Nine times out of ten, this is
what we wanted to do with a camera anyway (have it look at an object). In a
full framework we would need to add a camera which did a bit more than look at
a given position, but this will work for now.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class Camera(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, name):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Name = name</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__LookAtVector = DirectX.Vector3(0, 0,
-1)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = DirectX.Vector3(0, 0, 0)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The next bit of code calculates a matrix based on the
position of the camera and the position we want the camera to look at. It
creates two properties (one for Position, one for LookAtVector), and updates
the matrix every time either of these are changed.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __UpdateMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Matrix =
DirectX.Matrix.LookAtLH(self.__Position, self.__LookAtVector,
DirectX.Vector3(0, 1, 0))</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __GetLookAtVector(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.__LookAtVector</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __SetLookAtVector(self, v):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> v = Vectorize(v)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__LookAtVector = v</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__UpdateMatrix()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __GetPosition(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.__Position</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __SetPosition(self, pos):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos = Vectorize(pos)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = pos</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__UpdateMatrix()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Position = property(__GetPosition, __SetPosition)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> LookAtVector = property(__GetLookAtVector,
__SetLookAtVector)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def LookAt(self, loc):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.LookAtVector = loc</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Finally, we will return the matrix using the GetViewMatrix method.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def GetViewMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.Matrix</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to update the SceneManager class to use the new
camera class. Find the SceneManager classs constructor and add an
ActiveCamera variable:</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.ActiveCamera = None</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will add a CreateCamera method to SceneManager which creates a camera of the given name and adds it to the
Objects dictionary, returning the result. We will have an added constraint
that if no camera has been set to be active, we will set the newly created
camera to be the active camera. This lets us ignore setting
the ActiveCamera variable if the application only uses one camera.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def CreateCamera(self, name):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam = Camera(name)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Objects[cam.Name] = cam</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if self.ActiveCamera is None:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.ActiveCamera = cam</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return cam</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>To finish updating the SceneManager class to use cameras, we need to update the Render method to set the View matrix based on the active
camera. Add the following code between the return statement at the beginning
and before the call to self.Device.Clear in SceneManagers Render class:</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if self.ActiveCamera is not None:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Device.Transform.View = self.ActiveCamera.GetViewMatrix()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Finally, we need to add code to create a default camera and
have it look at the Tiger object. Add the following code to SceneCreators OnSceneCreate method:</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam = sm.CreateCamera(&quot;Player Cam&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam.Position = [0, 3, -5]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam.LookAt(self.Tiger.Position)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Thats it. If you run your application now, you will notice
that really nothing has changed. This is because I cheated a little in the
beginning and set up the view matrix to be in the exact same position and look
at the tiger anyway. If you wish to explore the camera a bit, try moving it
(or moving it around each frame).</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655653">Code Checkpoint 5</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run your application. You should see a tiger onscreen
rotating. If this is not the case, compare your code with checkpoint5.py.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655654">Exercises</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>We have introduced a lot of functionality in this section of
the tutorial, and not made use of any of it. I would recommend that you take
some time to play with the framework we have created.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Try adding more tiger meshes to the scene (remember to give
them unique names when you call LoadMesh). Position them in different places
around the scene. Add new OnFrame code to rotate them at different speeds, in
different directions, and in multiple different axes.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Try moving an object around by setting its position
incrementally every frame. Define movement speed to be a variable which can be
changed. Move this change into a generic class of its own which takes in a
name of the object and the speed as a parameter to the constructor.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655655">Framework Optimization</a></h2>

<p class=Normal>At this point I would like to point out that there are
several places in the code which can be optimized, but I did not want to muddle
the tutorial with too much extra code which are not strictly necessary to
understand what is going on. We will now eliminate a large number of the
calculations done every frame.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The GetViewMatrix classes and GetWorldMatrix classes
multiply the rotation and position matrices every time they are called. It
would be better if this calculation were only done when either the
PositionMatrix or the RotationMatrix variables are actually updated, and the
result of this multiplication be cached in a local variable.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>One simple solution to this problem would be to implement a
lightweight event system which notifies a listener whenever these matrices
change. This is a valid solution, but the PositionableObject and
RotatableObject classes were designed to be lightweight and completely
orthogonal to any other component in the system. In other words, a perfect
mixin we can add to any class.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>We can actually do much better than an event system thanks
to the elegance Python affords us. Notice that PositionMatrix and
RotationMatrix are simply variables. If we created a PositionMatrix and
RotationMatrix property in the child class, we could intercept the variable
assignment and perform the calculations then. The first thing we need to
change is to modify the PositionableObject class so that it no longer uses a
property for PositionMatrix, but a variable instead. Every time we update the
position we will rebuild the matrix. Here is the PositionableObject class
after we have made this change:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class PositionableObject(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = DirectX.Vector3(0, 0, 0)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.PositionMatrix = DirectX.Matrix.Identity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __GetPosition(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.__Position</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __SetPosition(self, pos):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos = Vectorize(pos)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = pos</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.PositionMatrix = DirectX.Matrix.Translation(self.__Position)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __DelPosition(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position = DirectX.Vector3(0, 0, 0)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.PositionMatrix = DirectX.Matrix.Identity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Translate(self, amount):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> amount = Vectorize(amount)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__Position += amount</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.PositionMatrix =
DirectX.Matrix.Translation(self.__Position)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Position = property(__GetPosition, __SetPosition,
__DelPosition)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will build a class which combines the
PositionableObject and RotatableObject such that every time either the
PostionMatrix or the RotationMatrix changes, it will update a variable called
Matrix to contain the combined matrix. Ill call this class SceneObject, for
lack of a better term. Well start by defining the constructor for this class.
Note we have to set our local variables first since they will actually be used
within the constructors of the two ancestor classes:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class SceneObject(PositionableObject,
RotatableObject):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Matrix = DirectX.Matrix.Identity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__PositionMatrix =
DirectX.Matrix.Identity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__RotationMatrix =
DirectX.Matrix.Identity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> PositionableObject.__init__(self)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> RotatableObject.__init__(self)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Then we need to create the get and set properties for
PositionMatrix and RotationMatrix. The only thing to note here is that
whenever we call the set method we update the Matrix variable as well.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __GetPositionMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.__PositionMatrix</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __SetPositionMatrix(self, value):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__PositionMatrix = value</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Matrix = self.__RotationMatrix *
self.__PositionMatrix</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __GetRotationMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.__RotationMatrix</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __SetRotationMatrix(self, value):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__RotationMatrix = value</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Matrix = self.__RotationMatrix *
self.__PositionMatrix</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> PositionMatrix = property(__GetPositionMatrix,
__SetPositionMatrix)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> RotationMatrix = property(__GetRotationMatrix,
__SetRotationMatrix)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to update any subclasses which wish to make use
of this functionality. Currently the only thing we need to update is the MeshRenderable class. Update the class definition, making sure to replace the
constructor calls to PositionableObject and RotatableObject with one to
SceneObject:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class MeshRenderable(SceneObject):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, device, name, file):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> SceneObject.__init__(self)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Name = name</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> # ...</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Lastly, update the GetWorldMatrix method:</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def GetWorldMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.Matrix</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run the application. Though there is no graphical
difference in the program, we have eliminated many calculations performed with each frame.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655656">Adding Other Types of Objects</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>We can load meshes with ease, but often we will want to have
just a simple box, or sphere, or other basic object in our scene. This also
comes in handy when we need to test code which acts on objects. To start, we
will create a class which represents basic objects. Well use a dictionary to keep
track of the constructors for each type of object:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class BasicObject(SceneObject):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> ObjectTypes = {'cylinder' :
Direct3D.Mesh.Cylinder,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> 'polygon' : Direct3D.Mesh.Polygon,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> 'sphere' : Direct3D.Mesh.Sphere,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> 'teapot' : Direct3D.Mesh.Teapot,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> 'torus' : Direct3D.Mesh.Torus,</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> 'box' : Direct3D.Mesh.Box</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> }</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will create the constructor. We will take in the
DirectX device, the type of the object, the name of the object, a color for the
object, and then a variable number of other parameters to pass to the
objects constructor.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, device, type, name, color,
*params):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> SceneObject.__init__(self)</p>

</div>

<p class=Normal>&nbsp;</p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to Python?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Python allows you to define a function with a variable number of
  arguments by placing a star (*) in front of the variable which will hold the
  rest of the parameters. This must always follow all of the regular
  parameters.</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>&nbsp;</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Python also allows you to define a parameter which accepts named
  parameters to the function and places them in a dictionary. This is done by
  placing a double star (**) in front of the parameter which will receive all
  named attributes. See the Python documentation for examples and more information
  on using these constructs.</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal>&nbsp;</p>

<p class=Normal>For the type parameter, we will allow the user to either
pass in a constructor for the type (callable) or a string to look up in the
ObjectTypes dictionary:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if not callable(type):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> type = self.ObjectTypes[type]</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will create the object, create a material, and set
the color. Note we are expanding the params tuple into a parameter list for
the constructor:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Name = name</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Mesh = type(device, *params)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> color = Direct3D.ColorValue.FromColor(color)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> material = Direct3D.Material()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> material.AmbientColor = color</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Materials = [material]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Textures = []</p>

</div>

<p class=Normal><span style='font-size:10.0pt;font-family:Consolas'>&nbsp;</span></p>

<div>

<table cellspacing=0 cellpadding=0 hspace=0 vspace=0 align=right>
 <tr>
  <td valign=top align=left style='padding-top:0in;padding-right:0in;
  padding-bottom:0in;padding-left:0in'>
  <div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
  margin-left:.5in;margin-right:.5in'>
  <p class=OffsetHeader style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>New to Python?</p>
  <p class=Offset style='margin:0in;margin-bottom:.0001pt;border:none;
  padding:0in'>Python allows you to expand a list into parameters for a function.
  Lets say a function takes in 3 parameters. It is perfectly valid to pass in
  the first parameter normally, then specify a list as the second argument and
  expand it by placing a star (*) in front of the parameter (as we have done
  above when calling type).</p>
  </div>
  </td>
 </tr>
</table>

</div>

<br clear=ALL>

<p class=Normal><span style='font-size:10.0pt;font-family:Consolas'>&nbsp;</span></p>

<p class=Normal>Lastly, we need to provide the GetWorldMatrix method so
that the SceneManager knows how to render it.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def GetWorldMatrix(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return self.Matrix</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that the class is implemented, we need to add a method
to the SceneManager which creates the class and adds it to the Objects
dictionary. This is very similar to the LoadMesh method, and should be
nothing new aside from the variable arguments, and argument expansion:</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def LoadBasicObject(self, type, name, color,
*args):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> mesh = BasicObject(self.Device, type,
name, color, *args)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>self.Objects[mesh.Name] = mesh</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>return mesh</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Thats it! Now we can load up basic objects. Temporarily
clear out the code in the SceneCreator class and add this in its place:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneCreate(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> teapot =
sm.LoadBasicObject(&quot;teapot&quot;, &quot;teapot&quot;, Drawing.Color.White)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam = sm.CreateCamera(&quot;Player Cam&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam.Position = [0, 3, -5]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam.LookAt(teapot.Position)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run the code and check it out. We can also load other
objects which have parameters to their constructors:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.LoadBasicObject(&quot;box&quot;, &quot;some
box&quot;, Drawing.Color.Green, 1, 1, 1)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.LoadBasicObject(&quot;sphere&quot;,
&quot;some sphere&quot;, Drawing.Color.Blue, 1, 25, 25)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>See the managed DirectX documentation for more information
on the parameters for these constructors.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>You should now replace the OnSceneCreate method with the
previous one (which loads the tiger and animates it), as this was just example
code to ensure our code works.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655657">A Better Main Function</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>There is one last thing I feel we should look at before
finishing up with this tutorial: the main function. The main function we
currently have works, but its a bit rough around the edges. Instead, what I
would like to do is create a singleton class which keeps track of our
SceneManager object so we do not have to keep an explicit pointer to it. Well
also add threading support in the mix to allow us to work with our framework
from the console. Remove the main function from this program entirely.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>We will not <i>exactly</i> use a singleton for this class.
Python has a better pattern to use which maps more naturally to its language
constructs. What we will do instead is to create an object whose instances all
share the same dictionary (that is, all of them share the same variables and
methods). This is known as the Borg pattern, and it takes only a couple of lines
to implement:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class Root(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> __State = {}</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.__dict__ = self.__ State</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Note we must be very careful when defining the constructor of
any Borg class. After we assign the __dict__ variable, we have synced up with
the global object and should not re-initialize the object. This means that if
we need to initialize any variables in the init method, we need to be careful
to only do it the first time we create an instance of this object. This is
usually accomplished by a boolean variable which specifies if we have
initialized the class or not. Our Root class does not require any
initialization, so we are in the clear.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>To see this pattern in action, try this code (do not add
this to the framework, instead use import * from framework in an IronPython
console):</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>borg1 = Root()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>borg2 = Root()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>borg1.Test = Hello World!</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>print borg2.Test</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will add a new main function inside the root class.
Note that we have kept the listeners parameter, but removed the SceneCreator
default value from it.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def Main(self, listeners = []):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.SceneManager = SceneManager()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Window = RenderWindow(self.SceneManager)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if not
self.SceneManager.InitGraphics(self.Window.Handle):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Forms.MessageBox.Show(&quot;Could not init
Direct3D.&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> else:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for obj in listeners:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if callable(obj):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> obj = obj()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.SceneManager.AddListener(obj)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Window.Show()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.SceneManager.Go(self.Window)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The last thing we will add to our Root class is a threaded
call to Main. This will allow us to play with our framework from the console.
The Python API gives us a very easy to use thread library. This library implements
a function called start_new_thread which takes in a function to start in a new
thread, and a list with the arguments to the function. </p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def ThreadMain(self, listeners = []):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> import thread</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> args = (listeners,)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> thread.start_new_thread(self.Main, args)</p>

</div>

<p class=Normal> </p>

<p class=Normal>Finally, we need to update the call to the main class.
Change the call to be this:</p>

<p class=Normal> </p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>if __name__ == '__main__':</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Root().Main([SceneCreator])</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you run the application now, you should see the same
result as we had before starting this section. The reason we took the time to
implement this change is so that we can now launch the framework in a
background thread and manipulate the contents of the scene from the console.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>To test this out, open up a Python console and type out the
following code (do not add this to the project):</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&gt;&gt;&gt; from framework import *</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&gt;&gt;&gt; root = Root()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&gt;&gt;&gt; root.ThreadMain()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&gt;&gt;&gt; sm = root.SceneManager</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&gt;&gt;&gt; tiger = sm.LoadMesh(&quot;Tiger&quot;,
&quot;tiger.x&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&gt;&gt;&gt; class TigerRotator(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>... def OnFrame(self, ticks):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>... tiger.Yaw(ticks)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>...</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&gt;&gt;&gt; sm.AddListener(TigerRotator())</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>You should see the tiger rotating in the scene, and we did
all of this from the console alone.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655658">Code Checkpoint 6</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>We have implemented a complex change to the code. Be sure
that your application is working properly at this point. If it is not, compare
your project with checkpoint6.py.</p>

<p class=Normal>&nbsp;</p>

<h1><a name="_Toc140655659">Cool Things to Do with the Project</a></h1>

<p class=Normal>&nbsp;</p>

<p class=Normal>We have spent a good amount of time creating our framework,
and there are many other things we could add to it. Instead of this, I thought
it would be much more fun to try it out a bit.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>For this portion of the tutorial we are no longer going to
change the contents of the Python file we have been building. Instead we will
be making a new file which contains all of our demo code we will be creating. <b>Take
the file you have been making up to this point and rename it to framework.py.</b></p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Create a new file called demo.py, and place the following
contents into it:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>import clr</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>from framework import *</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class DemoSceneCreator(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneCreate(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam = sm.CreateCamera(&quot;Player Cam&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam.Position = [0, 3, -5]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> box = sm.LoadBasicObject(&quot;box&quot;,
&quot;box 1&quot;, Drawing.Color.Red, 0.25, 0.25, 0.25)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> box.Position = [-1, 0, 0]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> box = sm.LoadBasicObject(&quot;box&quot;,
&quot;box 2&quot;, Drawing.Color.Green, 0.25, 0.25, 0.25)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> box.Position = [0, 0, 0]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam.LookAt(box.Position)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> box = sm.LoadBasicObject(&quot;box&quot;,
&quot;box 3&quot;, Drawing.Color.Blue, 0.25, 0.25, 0.25)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> box.Position = [1, 0, 0]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>if __name__ == '__main__':</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> main([DemoSceneCreator])</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you run this file now you should see three boxes
and the view should be centered on the green one.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655660">Moving Objects Around, Part I</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>The first thing we will add is a class to move an object in
a specific direction. We will create an object which stores four pieces of
information: the object to act on, the direction to move in, the speed at which
to move, and the distance to travel before stopping. Here is the first piece
of this class:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class DirectionalMover(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, obj, direction, speed,
distance):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object = obj</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Speed = speed</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Distance = distance</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Direction = Vectorize(direction)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Direction.Normalize()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The only major thing to note here is that we have normalized
the direction vector, meaning that the total length of the vector is equal to
one.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will add code to move the object every frame. The
first thing we will do is calculate the amount with which we wish to move it
this frame.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> toTravel = self.Speed * elapsed</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>We have to be careful that we do not overshoot the distance
we wish to travel. To keep track of this, we will constantly subtract the
toTravel variable from the Distance variable. Once our Distance variable is
less than the amount we would travel this frame, we translate the rest of the
distance and return True (to remove ourselves from the listener pool):</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if self.Distance &lt; toTravel:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.Translate(self.Direction *
self.Distance)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Otherwise, subtract, and then translate:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> else:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Distance -= toTravel</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.Translate(self.Direction *
toTravel)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Thats it! Now lets test it out. Add the following
method to the DemoSceneCreator class:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneBegin(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> dm = DirectionalMover(sm.Objects[&quot;box 1&quot;], 
[1, 0, 0], 0.3, 3)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(dm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> dm = DirectionalMover(sm.Objects[&quot;box 2&quot;], 
[0, 1, 0], 0.2, 2)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(dm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> dm = DirectionalMover(sm.Objects[&quot;box 3&quot;], 
[0, 0, 1], 1, 10)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(dm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now run the application. You should see the three boxes
moving in different directions, reaching different locations simultaneously
(after 10 seconds).</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you are having trouble with this example, compare your
code with the contents of demo1.py.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655661">Moving Objects Around, Part II</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Sometimes it is not convenient to simply move an object in a
direction. Often we need to move an object to a location instead. What we
would like, in this case, is an object mover which takes in a position to move
to, and a speed at which to move.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>One approach to this would be to use the class we have
already created and simply figure out the distance between the current position
and the position we wish to move to. This would be a valid approach in some
situations, but what if the position of the object was changed by some other
object in between the time the mover object was created, and the time at which
the object reached its destination? Then the object would be off-target by the
time it reached its destination.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>To remedy this problem, we will create a new class to
perform this action. This is the constructor for this class:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class PositionalMover(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, obj, destination, speed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object = obj</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Dest = Vectorize(destination)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Speed = speed</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>In the OnFrame method, we need to calculate the distance we
will travel that frame, the distance we have left to travel (so we do not
overshoot our destination), and the direction we will travel in.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> toTravel = self.Speed * elapsed</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> direction = self.Dest - self.Object.Position</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> distance = direction.Length()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> direction.Normalize()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Once we have this information, the rest of our method should
look very familiar.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 0in 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if distance &lt; toTravel:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.Translate(direction *
distance)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> else:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.Translate(direction *
toTravel)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Note that we are doing a lot more calculations per frame in
PositionalMover than we did in DirectionalMover (normalizing a vector is a
costly operation as it involves a square root). We have to be careful how
often we use this class, as it could possibly bog down our application if we
overused it. However, this would not really become a concern until we are
moving a large amount of objects with this class.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now lets test our class. Clear out the contents of
DemoSceneCreators OnSceneBegin method, if you have not already, and add this:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneBegin(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PositionalMover(sm.Objects[&quot;box 1&quot;], 
[2, 0, 0], 0.3)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PositionalMover(sm.Objects[&quot;box 2&quot;], 
[0, 2, 0], 0.2)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PositionalMover(sm.Objects[&quot;box 3&quot;], 
[1, 0, 10], 1)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The results should be exactly the same as before. We have
moved the boxes to the same locations at the same speed. Try playing around
with the locations the boxes move to, and the speed at which they move. Try
adding both a PositonalMover and DirectionalMover affectors to the same object
(be sure to register both listeners with the SceneManager) and watch the
effects.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you are having trouble with this example, compare your
code with the contents of demo2.py.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655662">Moving Objects Around, Part III</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>This is very cool, but still, there are many situations
where simply moving from a location to another location would not be enough. Sometimes
we need to set up a list of points for an object (or character) to walk between.
This can be accomplished by keeping track of a set of points (and speeds at
which to travel to these points) and delegating the actual movement task to
PositionalMover.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>We will implement this class as PointMover, for lack of a
better term. The constructor for this object will take in only one parameter,
the object to move. The object will also keep track of a list of points to
walk between, and the current PositionableMover object (which is doing the
actual work).</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class PointMover(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, obj):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object = obj</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Points = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Current = None</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to create a method to add points for the
object to move to. This method will take two parameters: the point to
move to and the speed at which to move. Well simply throw this into the
Points list as a tuple.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def AddPoint(self, point, speed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Points.append((point, speed))</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to implement a method which sets the Current
variable by taking the first item in the list and creating a PositionalMover
for it. We will return True if we are successful in creating the object:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def NextPoint(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if len(self.Points):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> dest, speed = self.Points[0]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> del self.Points[0]</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Current =
PositionalMover(self.Object, dest, speed)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Notice that we have not added a return False to the end of
this method. This would be valid, but unnecessary. Whenever you do not
return a value, you are implicitly returning None. Since None evaluates to be
false, you actually <b>are</b> returning false implicitly whenever you do not
return anything. (Or more specifically, you are returning an expression which
evaluates to False.)</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have all of the helper methods that are
required, we are ready to create the OnFrame method. The first part of the
method will handle the first call to the method (in which case self.Current
is None). If it is None then we will attempt to set it by calling NextPoint.
If NextPoint returns False then the user never bothered to add any points, and
we will return True to tell SceneManager that we are done:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if self.Current is None:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if not self.NextPoint():</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have setup self.Current, we need to actually
move the object. As soon as self.Current.OnFrame returns false, we need to
move onto the pointif there are any left. This is the rest of the method:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if self.Current.OnFrame(elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return not self.NextPoint()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have implemented this class, its time to test
it. Clear out the contents of DemoSceneCreators OnSceneBegin method, if you
have not already. Place this code there:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneBegin(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PointMover(sm.Objects[&quot;box 1&quot;])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [2, -1, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [0, 1, 2], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [0, 0, 10], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm) </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PointMover(sm.Objects[&quot;box 2&quot;])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [2, 1, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [-1, -3, 5], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [-1, 0, 10], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm) </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PointMover(sm.Objects[&quot;box 3&quot;])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [-2, -1, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [1, -3, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [1, 0, 10], 1.15 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run the program to watch the cubes dart around the scene. Take
some time to play around with the points the objects move to, and the speed at
which they move.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you are having trouble with this example, compare your
code with the contents of demo3.py.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655663">Auto Tracking</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>It would be very useful in many situations to make the
camera (or other object) track something on screen. That is, every time the
object moves, the camera is readjusted to face it. Fortunately for us, this is
a nearly trivial thing to implement with the framework we have created:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class AutoTrack(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, obj, target):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object = obj</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Target = target</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.LookAt(self.Target.Position)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Replace DemoSceneCreators OnSceneBegin method with the
following code:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneBegin(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PointMover(sm.Objects[&quot;box 1&quot;])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [2, -1, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [0, 1, 2], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [0, 0, 10], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PointMover(sm.Objects[&quot;box 2&quot;])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [2, 1, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [-1, -3, 5], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [-1, 0, 10], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm = PointMover(sm.Objects[&quot;box 3&quot;])</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [-2, -1, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [1, -3, 0], 1 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pm.AddPoint( [1, 0, 10], 1.15 )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(pm)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener( AutoTrack(sm.Objects[&quot;Player
Cam&quot;], sm.Objects[&quot;box 3&quot;]) )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>&nbsp;</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run the demo. This probably looks very strange. You will
see one box not moving, while the other two fly around. This shows that our
camera is tracking the object we have specified. To confirm this, comment
out the line which adds the AutoTrack to the SceneManager. The boxes move as
normal. The reason this looks so strange is because we have not set a
background to contrast the movement of the boxes. This would look a lot more natural
in a real-world application.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you are having trouble with this example, compare your
code with the contents of demo4.py.</p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655664">Gravity and Free Floating Bodies</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>I have saved the best part of the tutorial for last. In
this section, we will implement a gravity simulator. The simulator will allow
you to create any number of free floating bodies in space (like planets) by setting
their mass, position, initial velocity, and color (the color is just for visual
distinction).</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The first thing we need to do is to create a class which
understands how to apply the physics of gravity to a particular object. This
object will keep track of an objects Mass, Velocity, Acceleration, and a list
of objects which are affecting the object. Additionally we will keep track of
the objects radius to handle what happens when objects get too close to each
other. The constructor for this class is very simple, taking in a few of these
as parameters and setting up variables:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class GravityAffector(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, obj, mass, radius,
initialVelocity):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object = obj</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Radius = radius</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Affectors = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Mass = mass</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Velocity = Vectorize(initialVelocity)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Acceleration = DirectX.Vector3(0,0,0)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to create a method which figures out exactly
how much acceleration is being applied to an object at any given moment. The
result will be stored in the self.Acceleration variable.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def ApplyGravity(self):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Acceleration = DirectX.Vector3(0,0,0)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we need to loop through all of the objects affecting the
current object and apply Newtons law of universal gravitation to the current
object. To simplify a lot of later code, we will assume the self.Affectors
list could possibly contain the object we are acting on. In this case well
simply ignore it.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for obj in self.Affectors:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if obj != self.Object:</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>To calculate the affect of gravity, we need to know the
direction (unit vector) that the force is acting in, and the squared distance
between the two objects.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> direction = obj.Object.Position -
self.Object.Position</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> distSquared =
direction.LengthSquared()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> direction.Normalize()</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Finally, we need to calculate the change in acceleration due
to this object. There is one small catch though. We are not doing any
collision detection in this piece of code, and if objects are too close to each
other the gravitation formulas explode, giving accelerations which should be
technically impossible. To fix this problem, we only apply gravity when the
squared distance is greater than the radius of the object. So long as the
radius is set to be a reasonable amount (say 0.05 units), this will fix the
problem of planets having acceleration they should not have when colliding.</p>

<p class=Normal style='text-autospace:none'><span style='font-size:10.0pt;
font-family:Consolas'>&nbsp;</span></p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if distSquared &gt; self.Radius:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Acceleration += direction *
(obj.Mass / distSquared)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Any physicist who just read that probably physically cringed
at this equation. This is not exactly Newtons law of universal gravitation.
However, since we are arbitrarily defining the mass of our objects, this should
be good enough for our simulation.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Finally, during each frame we need to apply the acceleration
to the velocity of the object, and apply the velocity to the position of the
object.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Velocity += self.Acceleration * elapsed</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.Translate(self.Velocity * elapsed)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>We now need to ensure that the acceleration of all objects is
calculated before we apply it. We do not want to move any object before all
other objects get the position of the object. In theory, the small amount of
motion should not affect the overall mechanics of the scene, but in practice
our scene will have few enough objects (close enough together) that this will
actually impact it.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>To solve this, we will create a GravityManager class which
calls the ApplyGravity methods of all objects before it calls the OnFrame method. Here is the code for this class:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class GravityManager(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, objs = []):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Objects = objs</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for obj in self.Objects:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> obj.ApplyGravity()</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for obj in self.Objects:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> obj.OnFrame(elapsed)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we are almost ready to create our scene, but there is
one final snag we must correct before we are ready to do that. When we start
our simulation up, all of the objects we have created will go flying around the
scene. We need the camera to watch all of them so that we can see what is
going on. The AutoTrack class we have already created seems like a good
choice, but objects could move too far to actually be seen.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Our solution will be a new auto tracking class which finds
the midpoint of all objects on the screen and looks at that instead. It will
also always stay a specified distance from the midpoint, so objects have a
harder time moving off camera. I will warn you up front that this is not a
complete solution (objects will still fall off screen eventually), but it
should at least allow us to watch our simulation for longer than our original
AutoTrack class would.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>The constructor for this class should take in the object we
will be operating on (the camera in this case), the list of objects to find the
midpoint for, and a distance (offset) to stay from this midpoint.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class MidpointAutoTrack(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def __init__(self, obj, others, offset):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object = obj</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Others = others</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Offset = Vectorize(offset)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The OnFrame method will calculate the midpoint for the objects and have the camera object look at it. We will first check to see if
the self.Others variable is a sequence. If it is not we will assume the user
just passed in a singular object. Otherwise, we will store the length of our
self.Others sequence in the l variable:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnFrame(self, elapsed): </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> l = None</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos = DirectX.Vector3(0, 0, 0)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if type(self.Others)==list:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> l = len(self.Others)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> if l is None:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos = self.Others.Position</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>We need to handle the case where the length is equal to one
specially:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> elif l == 1:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos = self.Others[0].Position</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>If we did not do this, we would get a divide by zero error
in the code which handles the midpoint calculation:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> elif l &gt; 1:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for o in self.Others:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos += o.Position</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos.X /= l-1</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos.Y /= l-1</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> pos.Z /= l-1</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have calculated the position, we need to set the
position of the current object and have it look at the calculated position:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.Position = pos + self.Offset</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> self.Object.LookAt(pos)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>This completes our MidpointAutoTrack class.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have all of the code we need, lets create the
scene. The first thing we will do is create a list which contains information
for all of the objects we will place in the scene. By building this list first
(and then using this list to actually create the scene), we are making it much
easier to add and remove objects from the scene later.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>class GravityDemoCreator(object):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> def OnSceneCreate(self, sm):</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> objs = []</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Next we will populate the objs list with tuples containing
the color, mass, position, and velocity of each object in the scene. Note that
I have purposefully commented out the last line. The first couple of times you
run the code you should only have three objects in the scene (since the gravity
for this is much more stable). You should uncomment this line to add a fourth
after you have played with the code with only 3 objects.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> # add: color, mass, poition, velocity</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> objs.Add( (Drawing.Color.Red, 1, [-1, 0,
0], [0.05, 0.05, 0]) )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> objs.Add( (Drawing.Color.Green, 1, [0, 1,
0], [0.1, 0, 0]) )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> objs.Add( (Drawing.Color.Blue, 1, [1, 0, 1], [-0.1, 0, 0]) )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> #objs.Add( (Drawing.Color.White, 1,[0, 0,
1],&nbsp; [0, 0, 0]) )</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now we will loop through the objects, placing the created object
in a list called finalObjects, and placing a GravityAffector for the objects
into a list called affectors:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> radius = 0.05</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> affectors = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> finalObjects = []</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> i = 0</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for color, mass, position, velocity in objs:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sphere =
sm.LoadBasicObject(&quot;sphere&quot;, &quot;planet &quot; + str(i), color,
radius, 25, 25)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sphere.Position = position</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> affectors.Add( GravityAffector(sphere,
mass, radius, velocity) )</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> finalObjects.Add(sphere)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> i += 1</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Now that we have created all of the GravityAffector objects,
we need to set them to affect each other. We do that by setting the Affectors
variable on all of them. After this is done, we need to add create the GravityManager
class and add it to the SceneManager.</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> for g in affectors:</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> g.Affectors = affectors</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> gm = GravityManager(affectors)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(gm)</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>The last thing we need to do in this method is to create the
camera and have it autotrack the midpoint of all of these items:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> cam = sm.CreateCamera(&quot;Player Cam&quot;)</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> sm.AddListener(MidpointAutoTrack(cam,
finalObjects, [0, 0, 15]))</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> </p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> return True</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Finally, we need to update the call to the main function
such that it uses the GravityDemoCreator. Find that section of code and change
it so it reads:</p>

<p class=Normal>&nbsp;</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:silver;margin-left:.25in;margin-right:.25in'>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'>if __name__ == '__main__':</p>

<p class=Code-Highlighted style='margin:0in;margin-bottom:.0001pt;background:silver;
border:none;padding:0in'> Root().Main([GravityDemoCreator])</p>

</div>

<p class=Normal>&nbsp;</p>

<p class=Normal>Run the application and watch the simulation. Be sure to
run it multiple times, as you will get different results each time.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>After running this several times, you may notice some
peculiar things happening with our simulation. First and foremost, why do we
get different results each time we run the program? Nowhere did we make a call
to a random number generator The reason for this is floating point rounding
errors. If you add code to dump the current velocity and acceleration of each
object to a file every frame, you will notice that after a frame or two small
rounding errors explode into large changes to the overall system. Chaos theory
at work. We could fix this by using a more accurate floating point class (and
chopping off the rounding error portions based on the accuracy of this class).</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Another strange thing is, if you run the program long
enough, you may notice that some objects occasionally wobble in ways which
seem unnatural. This is due to the fact that our camera is not actually
stationary, but moving and changing directions every frame to keep the moving
objects on screen. A lot of the weirdness of object wobble goes away if you
simply turn off camera movementbut good luck keeping them on screen if you do
not move the camera to keep up with them.</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>Try adding more objects to the system and changing the mass
of objects (along with the other initial conditions of the system).</p>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you are having trouble with this example, compare your
code with the contents of GravityDemo.py.</p>

<p class=Normal>&nbsp;</p>

<h1><a name="_Toc140655665">Where to Go from Here</a></h1>

<p class=Normal>&nbsp;</p>

<p class=Normal>I hope you have enjoyed working through this tutorial as
much as I have enjoyed making it. There are several resources I would like to
point out if you are interested in further study of IronPython or DirectX. </p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655666">Managed DirectX and XNA</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>Managed DirectX 1 (which this tutorial makes heavy use of) is not scheduled for any future updates. Instead,
Microsoft made a new managed 3D library built on top of DirectX
called XNA. You can find more information on XNA on their web site:</p>

<p class=Normal><a href="http://www.microsoft.com/xna/">http://www.microsoft.com/xna/</a></p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655667">IronPython</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>You can find more information on IronPython by visiting the
IronPython Codeplex site:</p>

<p class=Normal><a href="http://www.codeplex.com/IronPython">
http://www.codeplex.com/IronPython</a></p>

<p class=Normal>&nbsp;</p>

<p class=Normal>You can subscribe to the IronPython mailing list for any
questions you have about the project:</p>

<p class=Normal><a
href="http://lists.ironpython.com/listinfo.cgi/users-ironpython.com">http://lists.ironpython.com/listinfo.cgi/users-ironpython.com</a></p>

<p class=Normal>&nbsp;</p>

<p class=Normal>There are also several blogs from the people who use
IronPython on a daily basis. I suggest starting here:</p>

<p class=Normal><a href="http://blogs.msdn.com/ironpython/">
http://blogs.msdn.com/ironpython/</a></p>

<p class=Normal>&nbsp;</p>

<h2><a name="_Toc140655668">Extending the Framework</a></h2>

<p class=Normal>&nbsp;</p>

<p class=Normal>If you are a graphics hobbyist like I am, you may wish to
continue extending this framework. It already has the basic features for
positioning and rotating objects, however, what it truly lacks is extra
functionality to handle more complex meshes and materials. I have implemented
some of these things in the framework.py file which comes with this tutorial, but I did not have enough time to roll these changes back into the tutorial.&nbsp; 
If you are interested, read through the framework Python module to get a good feel for the updates.</p>

</div>

</body>

</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=windows-1252">
  <title>DiskUse</title>
  <style>
p.Normal, li.Normal
	{margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
h1
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:Verdana;
	}
h2
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:150%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Verdana;
	}
h3
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	line-height:150%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.Toc1
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	font-size:10.0pt;
	font-family:Verdana;
	text-transform:uppercase;
	font-weight:bold;
	}
p.Toc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:12.0pt;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	}
p.Toc3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:24.0pt;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	}
a:link
	{color:blue;
	text-decoration:underline;
	}
a:visited
	{color:purple;
	text-decoration:underline;
	}
p.Body
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:-116%;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.TypedExample
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.5in;
	line-height:150%;
	font-size:10.0pt;
	font-family:Verdana;
	font-weight:bold}
p.ContentsHeading
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:Verdana;
	font-weight:bold}
p.Step
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0.1in;
	font-size:11.0pt;
	font-family:Verdana
	}
p.StepNote
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.25in;
	line-height:150%;
	font-size:10.0pt;
	font-family:Verdana;
	font-weight:bold
	}
p.Code-Background
	{margin-top:0;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:0;
	font-size:10.0pt;
	font-family:"Courier New"
	}
p.Title1
	{margin-bottom:.0001pt;
	font-size:36.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
p.Title2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	page-break-after:avoid;
	font-size:28.0pt;
	font-family:Verdana;
	}
p.CopyrightText
	{margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
p.ExerciseList
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.5in;
	text-indent:-.25in;
	line-height:-116%;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.LabSummary
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:150%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Verdana;
	font-weight:bold;
	}
p.Code-Highlighted
	{margin-top:0;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:0;
	background:#E6E6E6;
	font-size:10.0pt;
	font-family:"Courier New"
	}
p.Stepnonumbering
	{margin-top:0;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:30.25pt;
	font-size:11.0pt;
	font-family:Verdana
	}
ul
	{margin-bottom:0in;}
  .style1 {
	font-size: 11pt;
	font-family: Verdana;
}
.style3 {
	font-weight: normal;
}
.style5 {
	margin-left: 40px;
}
  </style>
  <meta content="IronPython, WPF, WinForms" name="keywords">
</head>
<body lang="EN-US" link="blue" vlink="purple">
<p class="Normal" align="center"></p>
<hr>
<p class="CopyrightText"> Information in this document is subject to
change without notice. The example companies, organizations, products,
people, and events depicted herein are fictitious. No association with
any real company, organization, product, person or event is intended or
should be inferred. Complying with all applicable copyright laws is the
responsibility of the user. Without limiting the rights under
copyright, no part of this document may be reproduced, stored in or
introduced into a retrieval system, or transmitted in any form or by
any means (electronic, mechanical, photocopying, recording, or
otherwise), or for any purpose, without the express written permission
of Microsoft Corporation.</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText"> Microsoft may have patents, patent
applications, trademarked, copyrights, or other intellectual property
rights covering subject matter in this document. Except as expressly
provided in any written license agreement from Microsoft, the
furnishing of this document does not give you any license to these
patents, trademarks, copyrights, or other intellectual property.</p>
<p class="CopyrightText">
&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, 
	Active Directory, BizTalk, SQL Server, SharePoint, Outlook, PowerPoint, 
	FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual 
	SourceSafe, Visual C#, Visual J#,&nbsp; and Visual Studio are either registered 
	trademarks or trademarks of Microsoft Corporation in the U.S.A. and/or other 
	countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the 
	trademarks of their respective owners.</div>
<hr>
<p class="body">&nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">
&nbsp;</p>
<p class="body">&nbsp;</p>
<p class="Title2">DiskUse - Graphical Disk Usage Utility</p>
<p class="Normal">Contributor: Jocelyn Turcotte</p>
<p class="Normal">&nbsp;</p>
<p class="contentsheading"> Prerequisites</p>
<p class="body"> The prerequisites to successfully run this application
are:</p>
<ul>
  <li class="normal" type="disc">Microsoft .NET Framework Version 3.5
    SP1
	<ul>
		<li>Windows 7 already includes a compatible version of the .NET Framework,
		so this requirement is not necessary.</li>
	</ul>
  </li>
    <ul>
		<li><span class="style1">Download from </span>
		<a href="http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=ab99342f-5d1a-413d-8319-81da479ab0d7">
		<span class="style1">here</span></a></li>
	</ul>
	<li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
</ul>
<p class="Normal">&nbsp;</p>
<h1 class="contentsheading">Getting Started</h1>
<p class="body">Please make sure the folder structure in your current
working directory (the DiskUse directory) is:</p>
<blockquote>
  <blockquote>
    <p class="body">.\app.py </p>
    <p class="body">.\dialogutil.py </p>
    <p class="body">.\filestruct.py </p>
    <p class="body">.\mainWindow.xaml </p>
    <p class="body">.\readme.htm </p>
    <p class="body">.\renderers.py </p>
    <p class="body">.\uilogic.py </p>
  </blockquote>
</blockquote>
<p class="body">HINT: if the folder containing the IronPython distribution
is not already in your PATH environment variable, please add it from the command 
prompt you'll be working in.&nbsp; By doing this you will be able to run the &quot;ipy&quot; 
command from any arbitrary directory: </p>
<p class="style5"><strong>s</strong><span class="style3">e<span class="typedexample"><strong>t 
PATH=%PATH%;%</strong><strong>ProgramFiles%\IronPython 2.6</strong></span></span></p>
<p class="body">&nbsp;</p>
<p class="body">From the command prompt, navigate to the DiskUse
directory and type the following: </p>
<p class="typedexample">C:\Users\username&gt; ipy.exe app.py</p>
<p class="typedexample" &gt;&gt;&gt="" ipy.exe="" app.py=""></p>
<h1 class="contentheading">Overview</h1>
<ul>
  <li>
    <p class="body">This utility asks you to choose a base directory on
your disk or network, and displays the subdirectories and files in that
base directory within a TreeView widget.&nbsp;
When you expand a directory node of the TreeView, DiskUse calculates the
sizes of all files in that directory and builds a graphical diagram
that is displayed in the right pane of the main window. </p>
  </li>
  <li>
    <p class="body">This utility uses Windows Presentation Foundation
(WPF) for user interface (UI) rendering.&nbsp;
It uses a simple Xaml file for UI structure and geometries to draw the
diagrams on a canvas. </p>
  </li>
  <li>
    <p class="body">DiskUse utilizes
Windows Forms for the directory selection dialog as well as to get the
absolute pointer position on the screen.</p>
  </li>
</ul>
<div style="text-align: center;"><img
 alt="Screenshot of DiskUse in Action" src="Screenshot.jpg"
 style="width: 439px; height: 356px;"><br>
</div>
<p class="body">&nbsp;</p>
<p class="contentsheading">More Details</p>
<ul>
  <li>
    <p class="body">The application can be started by running app.py
directly or by importing app.py in a console session.&nbsp; Importing
app.py will run the application in a new thread allowing
interactive queries.&nbsp; </p>
  </li>
  <li>
    <p class="body">After initialization, an IronDiskUsage object is
created - this object creates the main window from the Xaml file and
attaches events to the window.&nbsp;
The two main components of the application are the file list and
diagram renderer, both of which are controlled by their respective
attached objects, FileListKeeper and VerticalRectanglesRenderer. <br>
The module <em>filestruct</em> interfaces with the file system and builds the DiskFile and DiskDir 
	classes that are used by the file list and
renderer to display information to the user (names and size of files
and directories). </p>
  </li>
</ul>
<h1 class="contentheading">Notes</h1>
<ul>
  <li>
    <p class="body">This utility will show file sizes and not actual
"cluster space" used by them </p>
  </li>
  <li>
    <p class="body">To select a different base directory for DiskUse to
analyze, just restart the application </p>
  </li>
</ul>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=windows-1252">
  <title>Dynamic Web Service Helpers</title>
  <style>
p.Normal, li.Normal
	{margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
h1
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:Verdana;
	}
h2
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:150%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Verdana;
	}
h3
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	line-height:150%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.Toc1
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	font-size:10.0pt;
	font-family:Verdana;
	text-transform:uppercase;
	font-weight:bold;
	}
p.Toc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:12.0pt;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	}
p.Toc3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:24.0pt;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	}
a:link
	{color:blue;
	text-decoration:underline;
	}
a:visited
	{color:purple;
	text-decoration:underline;
	}
p.Body
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:-116%;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.TypedExample
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.5in;
	line-height:150%;
	font-size:10.0pt;
	font-family:Verdana;
	font-weight:bold}
p.ContentsHeading
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	page-break-before:always;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:Verdana;
	font-weight:bold}
p.Step
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0.1in;
	font-size:11.0pt;
	font-family:Verdana
	}
p.StepNote
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:.25in;
	line-height:150%;
	font-size:10.0pt;
	font-family:Verdana;
	font-weight:bold
	}
p.Code-Background
	{margin-top:0;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:0;
	font-size:10.0pt;
	font-family:"Courier New"
	}
p.Title1
	{margin-bottom:.0001pt;
	font-size:36.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
p.Title2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:12.0pt;
	margin-left:0in;
	page-break-after:avoid;
	font-size:28.0pt;
	font-family:Verdana;
	}
p.CopyrightText
	{margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:Verdana;
	margin-left:0in; margin-right:0in; margin-top:0in}
p.ExerciseList
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:.5in;
	text-indent:-.25in;
	line-height:-116%;
	font-size:11.0pt;
	font-family:Verdana;
	}
p.LabSummary
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:150%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Verdana;
	font-weight:bold;
	}
p.Code-Highlighted
	{margin-top:0;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:0;
	background:#E6E6E6;
	font-size:10.0pt;
	font-family:"Courier New"
	}
p.Stepnonumbering
	{margin-top:0;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:30.25pt;
	font-size:11.0pt;
	font-family:Verdana
	}
ul
	{margin-bottom:0in;}
  .style1 {
	font-size: 11pt;
	font-family: Verdana;
}
.style2 {
	margin-bottom: 3px;
}
  </style>
</head>
<body lang="EN-US" link="#0000FF" vlink="#800080">
<p class="Normal" align="center"></p>
<hr>
<p class="CopyrightText"> Information in this document is subject to
change without notice. The example companies, organizations, products,
people, and events depicted herein are fictitious. No association with
any real company, organization, product, person or event is intended or
should be inferred. Complying with all applicable copyright laws is the
responsibility of the user. Without limiting the rights under
copyright, no part of this document may be reproduced, stored in or
introduced into a retrieval system, or transmitted in any form or by
any means (electronic, mechanical, photocopying, recording, or
otherwise), or for any purpose, without the express written permission
of Microsoft Corporation.</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText"> Microsoft may have patents, patent
applications, trademarked, copyrights, or other intellectual property
rights covering subject matter in this document. Except as expressly
provided in any written license agreement from Microsoft, the
furnishing of this document does not give you any license to these
patents, trademarks, copyrights, or other intellectual property.</p>
<p class="CopyrightText">
&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, 
	Active Directory, BizTalk, SQL Server, SharePoint, Outlook, PowerPoint, 
	FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual 
	SourceSafe, Visual C#, Visual J#,&nbsp; and Visual Studio are either registered 
	trademarks or trademarks of Microsoft Corporation in the U.S.A. and/or other 
	countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the 
	trademarks of their respective owners.</div>
<hr>
<p class="body">&nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">
&nbsp;</p>
<p class="body">&nbsp;</p>
<p class="Title1">Dynamic Web Service Helpers</p><p class="Body">&nbsp;</p>
<p class="Normal">&nbsp;</p>
<p class="Title2"> Prerequisites</p>
<p class="body"> The prerequisites to successfully run this application
are:</p>
<ul>
  <li class="normal" type="disc">Microsoft .NET Framework Version 3.5
    SP1
    <ul>
		<li>Needed to build a C# project distributed with this sample</li>
    </ul>
  </li>
    <ul>
		<li><span class="style1">Download from </span>
		<a href="http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=ab99342f-5d1a-413d-8319-81da479ab0d7">
		<span class="style1">here</span></a></li>
	</ul>
	<li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a
 href="http://www.codeplex.com/IronPython/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
</ul>
<p>&nbsp;</p>
<p class="Title2">Getting Started</p>
<p class="body">Please make sure the folder structure in the 
<i>DynamicWebServiceHelpers</i> directory is:</p>
<blockquote>
  <blockquote>
      <p class="body">
      .\bing.py<br>.\flickr.py<br>.\injectors.py<br>.\mathservice.py<br>.\rss.py<br>
	  .\sources\DynamicWebServiceHelpers.csproj<br>.\stocks.py<br>.\weather.py</p>
  </blockquote>
</blockquote>
<p class="body">At this point, it will be necessary to build <i>DynamicWebServiceHelpers.dll</i>.&nbsp; 
This can be accomplished by building <i>DynamicWebServiceHelpers.csproj</i> 
using nothing more than .NET 3.5 and a command prompt (in the 
DynamicWebServiceHelpers directory) as shown below:</p>
<ol>
	<li>
	<p class="body">copy &quot;%ProgramFiles%\IronPython 2.6\*.dll&quot; .</p>
	</li>
	<li>
	<p class="body">%WINDIR%\Microsoft.NET\Framework\v3.5\MSBuild.exe 
	sources\DynamicWebServiceHelpers.csproj</p>
	</li>
</ol>
<p class="body">Next, you should verify that the newly built <i>DynamicWebServiceHelpers.dll</i> 
has indeed been installed into the DynamicWebServiceHelpers directory.</p><p class="body">&nbsp;</p>
<p class="Title2">Overview</p>
<p class="Body">The Dynamic Web Service Helpers library is intended to simplify the consumption of web services for IronPython developers. This package includes the DynamicWebServiceHelpers 
sources and a set of samples that show how to utilize them.</p>

<p class="Body">&nbsp;</p><p class="Body">Consuming web services from code usually requires help from a tool and involves the following steps:</p>
<ol>
 <li><p class="Body">Download WSDL</li><li><p class="Body">Generate proxy code</li><li><p class="Body">Include proxy code within the project</li><li><p class="Body">Instantiate web service proxy class from code</li>
 <li><p class="Body">Call the web method</li></ol>

<p class="Body">&nbsp;</p><p class="Body">The Dynamic Web Service Helpers library allows IronPython users to significantly simplify access to web services.
All it takes is loading the web service given the URL and calling the web method:</p>
<pre style="color:Navy">&gt;&gt;&gt; ws = DynamicWebServiceHelpers.WebService.Load(<i>web_service_url</i>)
&gt;&gt;&gt; result = ws.<i>web_method</i>(<i>args</i>)
</pre>
<p class="Body">The Dynamic Web Service Helpers library supports the consumption of WSDL, REST/XML web services, and RSS feeds.
It also introduces the IronPython concept of attribute injectors, the ability to extend .NET classes
with dynamic attributes on a per-instance basis.</p>

<div style="text-align: center;"><br>
</div>
<p class="Title2">Examples</p>
<h3>Generic Usage</h3><p class="Body">To use Dynamic Web Service Helpers in IronPython simply load the assembly and import DynamicWebServiceHelpers:</p>
<pre style="color:Navy">>>> import clr
>>> clr.AddReference('DynamicWebServiceHelpers.dll')
>>> import<b> DynamicWebServiceHelpers</b>
</pre>
<p class="Body">
The library contains a public static class, <i>DynamicWebServiceHelpers</i>,
that has public static properties (for example, <i>WebService</i>). You can use 
the Python
command <i>'dir'</i> to view all public properties from this module:</p>
<pre style="margin: 0 0 0 0; color:Navy" class="style2">>>> dir(<b>DynamicWebServiceHelpers</b>)
['Equals', 'GetHashCode', 'GetType', 'MemberwiseClone', 'Pluralizer', 'ReferenceEquals', 'Register', 'SimpleXml', 'ToString', 'WebService',</pre>
<pre style="margin: 0 0 0 0; color:Navy">'__all__', '__class__', '__delattr__', '__doc__', '__format__', '__getattribute__', '__hash__', '__init__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', </pre>
<pre style="margin: 0 0 0 0; color:Navy">'__setattr__', '__sizeof__', '__str__', '__subclasshook__']</pre>
<pre style="margin: 0 0 auto 0; color:Navy">
</pre>
<p class="Body">
A beneficial side effect of this design is the ability to execute code while
importing the static class (static constructor is run at that time). This is a good place to perform operations like registering attribute
injectors.
</p><p class="Body">
&nbsp;</p>

<h3>
    Simple WSDL Web Service -- mathservice.py</h3>
<p class="Body">This sample calls a simple web service that adds two numbers.</p><p class="Body">&nbsp;</p>

<h3>WSDL Web Service With Complex Return Values -- weather.py</h3>
<p class="Body">This sample calls a weather web service that returns the weather forecast as
a complex object containing a collection of per-day weather data.
Please note that it is not necessary to know the type names of the data being
returned in order to process the result from a dynamic language like IronPython.</p><p class="Body">&nbsp;</p>

<h3>Attribute Injectors -- injectors.py</h3>
<p class="Body">This sample illustrates attribute injectors: English noun string pluralization and 'natural' access to XML.</p><p class="Body">&nbsp;</p>

<h3>WSDL Web Service Returning XML -- stocks.py</h3>
<p class="Body">
    This example calls a stock quote web service that returns the data as XML, and XML
    attribute injectors are then used to access the returned data in a 'natural' way.</p><p class="Body">
    &nbsp;</p>

<h3>RSS Feeds -- rss.py</h3>
<p class="Body">
    This example downloads an RSS feed and accesses it using XML attribute injectors.</p><p class="Body">
    &nbsp;</p>

<h3>Bing API Web Service to perform a web search -- bing.py</h3>
<p class="Body">
    This example calls the Bing API web service to perform a web search.</p><p class="Body">
    <b>Important Note</b>: the <i>bing.py</i> script requires you to pass your own Bing Web Service AppId to it from the command line.&nbsp; Information on obtaining this key can 
    be obtained from <a href="http://bing.com/developers">here</a>.</p><p class="Body">
    &nbsp;</p>

<h3>Flickr.com REST/XML Web Service -- flickr.py</h3>
<p class="Body">
    This example calls the Flickr REST web service to perform a photo search. The
    returned XML is accessed via XML attribute injectors.</p><p class="Body">
    <b>Important Note</b>: the <i>flickr.py</i> script requires you to pass your own flickr.com Web Service API key to it from the command line.&nbsp; Information on obtaining this key can 
    be obtained from <a href="http://www.flickr.com/services/api/misc.api_keys.html">here</a>.</p>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <link rel="stylesheet" type="text/css" href="../Samples.css">
  <meta http-equiv="Content-Type"
 content="text/html; charset=windows-1252">
  <title>FMsynth</title>
  </head>
<body>
<hr>
<p class="CopyrightText"> Information in this document is subject to
change without notice. The example companies, organizations, products,
people, and events depicted herein are fictitious. No association with
any real company, organization, product, person or event is intended or
should be inferred. Complying with all applicable copyright laws is the
responsibility of the user. Without limiting the rights under
copyright, no part of this document may be reproduced, stored in or
introduced into a retrieval system, or transmitted in any form or by
any means (electronic, mechanical, photocopying, recording, or
otherwise), or for any purpose, without the express written permission
of Microsoft Corporation.</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText"> Microsoft may have patents, patent
applications, trademarked, copyrights, or other intellectual property
rights covering subject matter in this document. Except as expressly
provided in any written license agreement from Microsoft, the
furnishing of this document does not give you any license to these
patents, trademarks, copyrights, or other intellectual property.</p>
<p class="CopyrightText">
&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, 
	Active Directory, BizTalk, SQL Server, SharePoint, Outlook, PowerPoint, 
	FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual 
	SourceSafe, Visual C#, Visual J#,&nbsp; and Visual Studio are either registered 
	trademarks or trademarks of Microsoft Corporation in the U.S.A. and/or other 
	countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the 
	trademarks of their respective owners.</div>
<hr>
<p class="body"> &nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="Title2"> FMsynth </p>
<p class="body"> A frequency modulation synthesizer implemented in
IronPython </p>
<p class="body"> Contributor: Matt Gruskin</p>
<p class="contentsheading"> &nbsp;</p>
<p class="contentsheading"> Prerequisites</p>
<p class="body"> The prerequisites to successfully run FMSynth are:</p>
<ul>
	<li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
	<li class="normal">DirectX 9.0c and a compatible sound card
    <ul>
		<li>Download from 
		<a
 href="http://www.microsoft.com/downloads/details.aspx?FamilyId=2DA43D38-DB71-4C1B-BC6A-9B6652CD92A3&amp;displaylang=en">here</a></li>
	</ul>
	</li>
</ul>
<p class="ContentsHeading">Contents</p>
<p class="Toc1"><a href="#Introduction">Introduction</a></p>
<p class="Toc1"><a href="#HowToUse">How To Use FMsynth</a></p>
<p class="Toc1"><a href="#Design">Design and Implementation</a></p>
<p class="Toc2"><a href="#UserInterface">User Interface</a></p>
<p class="Toc2"><a href="#BufferPlayer">The BufferPlayer Object</a></p>
<p class="Toc2"><a href="#WaveSource">The WaveSource Object</a></p>
<h1> <a name="Introduction">Introduction</a> </h1>
<p class="Body"> FMsynth is a frequency modulation synthesizer
implemented in IronPython. Frequency modulation synthesis is a
technique for combining audio waveforms to generate interesting musical
tones and sound effects, used in many classic music synthesizers. </p>
<p class="Body"> FMsynth demonstrates the use of many different
technologies in IronPython. </p>
<ul type="disc">
  <li class="Normal">Managed DirectSound is used to output the audio
data. FMsynth contains examples of the use of the following classes:
    <ul type="circle">
      <li class="Normal">Microsoft.DirectX.DirectSound.Device</li>
      <li class="Normal">Microsoft.DirectX.DirectSound.SecondaryBuffer</li>
      <li class="Normal">Microsoft.DirectX.DirectSound.WaveFormat</li>
      <li class="Normal">Microsoft.DirectX.DirectSound.BufferDescription</li>
    </ul>
  </li>
  <li class="Normal">System.Array is used for storing and manipulating
audio data.</li>
  <li class="Normal">System.Windows.Forms is used to create the user
interface. FMsynth contains examples of the use of the following
classes:
    <ul type="circle">
      <li class="Normal">System.Windows.Forms.TreeView</li>
      <li class="Normal">System.Windows.Forms.PictureBox</li>
      <li class="Normal">System.Windows.Forms.HScrollBar</li>
      <li class="Normal">System.Windows.Forms.VScrollBar</li>
      <li class="Normal">System.Windows.Forms.Label</li>
      <li class="Normal">System.Windows.Forms.TextBox</li>
      <li class="Normal">System.Windows.Forms.CheckBox</li>
      <li class="Normal">System.Windows.Forms.ComboBox</li>
      <li class="Normal">System.Windows.Forms.Button</li>
      <li class="Normal">System.Windows.Forms.OpenFileDialog</li>
      <li class="Normal">System.Windows.Forms.SaveFileDialog</li>
      <li class="Normal">System.Drawing.Font</li>
    </ul>
  </li>
  <li class="Normal">System.Xml is used to save and load synthesizer
description files. FMsynth contains examples of the use of the
following classes:
    <ul type="circle">
      <li class="Normal">System.Xml.XmlTextWriter</li>
      <li class="Normal">System.Xml.XmlDocument</li>
    </ul>
  </li>
</ul>
<h1><a name="HowToUse">How To Use FMsynth</a></h1>
<img src="fmsynth.png">
<p class="Body"> Using FMsynth, you can define a frequency modulation
synthesizer by combining any number of carrier and modulator wave
sources together. You can then listen to your synthesizer by specifying
a test frequency and clicking "Play", or by clicking a note on the
piano keyboard. You can load and save synthesizers using XML files, by
clicking on the "Load Synth" or "Save Synth" buttons. </p>
<p class="Body"> A synthesizer is made up of carrier and modulator wave
sources. A synthesizer can have any number of carriers, and each
carrier can have any number of modulators, and each modulator can have
any number of modulators. Modulators affect the frequency of the wave
they are modulating - by adding modulators to wave sources you can
create very interesting sounds! </p>
<p class="Body"> Each wave source has a type which is "sine", "square",
or "sawtooth" - these are the three wave types FMsynth knows how to
generate. You can see the differences between these by playing a single
carrier source set to one of these types, and observing the drawing of
the waveform. Each wave source also has either an absolute frequency or
a ratio. A ratio setting causes the wave source to change its frequency
based on the base frequency selected. Ratios allow you to create
synthesizers that will play different notes when different keys on the
piano keyboard are clicked. Each waveform also has an amplitude, which
affects the volume of a carrier with respect to the other carriers, or
the magnitude of the effect of a modulator. </p>
<p class="Body"> There are a number of sample synthesizers provided in
the "synths\" folder. Some of these samples are musical in nature,
while others use very low frequency modulators to create sound effects.<br>
</p>
<p class="Body">To run the synthesizer, simply issue the following
command from the FMsynth folder:<br>
&nbsp;&nbsp;&nbsp; <big><span style="font-weight: bold;"><small>ipy.exe
fmsynth.py</small><br>
</span></big> </p>
<h1><a name="Design">Design and Implementation</a></h1>
<p class="Body"> The source code for FMsynth is split into two Python
source files. </p>
<ul type="disc">
  <li class="Normal"> fmsynth.py contains the code to create the user
interface and handle user interface events. </li>
  <li class="Normal"> fmsynthlib.py contains code for the BufferPlayer
and WaveSource objects, which generate all of the sound data and
interact with DirectSound. </li>
</ul>
<h1><a name="UserInterface">User Interface</a></h1>
<p class="Body"> The user interface code is located in fmsynth.py. Some
of the more interesting methods are described below. </p>
<ul type="disc">
  <li class="Normal"> createUI() is run when the program is launched,
and sets up all of the user interface elements. This method sets
coordinates, text, and other properties for each control, adds event
handlers to the necessary controls, and adds each control to the form. </li>
  <li class="Normal"> pianoClick() is the event handler for clicks on
the piano picturebox. It uses findPianoNote() to determine which piano
key was pressed, and then uses noteToFreq to convert this note number
into a sound frequency. It then utilizes play() to begin playing a
sound buffer at that frequency. </li>
  <li class="Normal"> load() and save() are the event handlers for
clicks on the "Load Synth" and "Save Synth" buttons, and present
OpenFileDialog and SaveFileDialog objects to the user. If the user
chooses a file, the BufferPlayer is used to either load or save an XML
file describing the current synth. After a file is loaded, load() uses
buildTree() to populate the TreeView control with WaveSource nodes. </li>
  <li class="Normal"> buildTree() is a recursive method used to add
nodes to the TreeView control after a synth is loaded. It traverses the
BufferPlayer's tree of WaveSource objects, creating a node for each
WaveSource and setting that node's Tag property to the WaveSource
object. </li>
  <li class="Normal"> stop() and stopall() are the event handlers for
the "Stop" and "Stop All" buttons, and stop buffers that the
BufferPlayer is currently playing. </li>
  <li class="Normal"> play() is the event handler for the "Play"
button, and starts a buffer playing at the current base frequency. </li>
  <li class="Normal"> paint() is the event handler for the form's Paint
event, and draws a waveform image of the current sound on the form. The
data for this image is generated by the BufferPlayer as it generates
the actual sound data, and is saved as BufferPlayer.drawdata. </li>
  <li class="Normal"> addCarrier() and addModulator() are the event
handlers for the "Add Carrier" and "Add Modulator" buttons, and add new
nodes to the TreeView control and new WaveSource objects to the
BufferPlayer. </li>
  <li class="Normal"> removeNode() is the event handler for the "Remove
Source" button. It removes a node and all of its children from the
TreeView control, and removes the associated WaveSource and all of its
modulators. </li>
</ul>
<p class="Body">There are also several methods which are event handlers
for when user interface controls are changed, which are fairly
self-explanatory.</p>
<h1><a name="BufferPlayer">The BufferPlayer Object</a></h1>
<p class="Body"> The BufferPlayer class is defined in fmsynthlib.py,
and is responsible for managing DirectSound buffers as well as mixing
all of the carrier signals of a synthesizer together. It also reads and
writes XML files which contain synthesizer definitions. </p>
<p class="Body"> The addBuffer() method creates a new DirectSound
buffer to store sound data at the provided base frequency. It creates a
DirectSound.WaveFormat object which is initialized to describe
1-channel, 16-bit, 44100 Hz PCM audio. It then creates a
DirectSound.BufferDescription object, and sets the BufferBytes property
to the desired buffer size. findGCDFreq() is used to calculate the
smallest buffer size which will still be long enough to contain an
entire cycle of audio for this particular synthesizer. Finally, a
DirectSound.SecondayBuffer object is created, filled with audio data by
genWaveSources(), and added to the bufs dictionary. </p>
<p class="Body"> The genWaveSources() method generates audio data from
each carrier wave source, normalizes and mixes them together, and then
writes the audio data into the SecondaryBuffer. This method also fills
the drawdata array which is later used to draw the audio data on
screen. The audio data is mixed in two passes. In the first pass, each
audio sample is summed together, and the maximum sample is found. In
the second pass, the audio data is normalized using the maximum value
found before, and is converted from floating point numbers to unsigned
integers in the appropriate range for the DirectSound buffer. The final
audio data is then written to the buffer using SecondaryBuffer.Write().
</p>
<p class="Body"> readXML() creates an XmlDocument object which is used
to load the synthesizer XML file. FMsynth iterates through the child
nodes of the BufferPlayer node. As it encounters WaveSource nodes, it
creates new WaveSource objects and calls readXML() on these objects,
having each WaveSource read its own properties from the XmlDocument.
writeXML() works similarly, first writing the root BufferPlayer node
and then having each WaveSource write itself to the XML file using an
XmlTextWriter object. </p>
<h1><a name="WaveSource">The WaveSource Object</a></h1>
<p class="Body"> The WaveSource class is defined in fmsynthlib.py and
is responsible for storing the parameters for each wave source as well
as generating audio data. It also provides methods for reading and
writing wave sources as XML data. The WaveSource class is a base class
which is inherited by SineSource, SquareSource, and SawSource, which
implement algorithms for generating the different wave source types. </p>
<p class="Body"> Each WaveSource has a list of modulators, where each
modulator is also a WaveSource. prepModData() generates the audio data
for each modulation source, while addModData() combines and returns the
modulation data for a given sample. </p>
<p class="Body"> Each child class of WaveSource implements the
genData() method, which generates the audio data. This method
calculates the number of samples needed for a complete cycle, and then
generates this many samples of data. It then uses fillData() to repeat
that data for the full length of the buffer. </p>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>

<head>
<link rel="stylesheet" type="text/css" href="../Samples.css">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>PowerShell from IronPython</title>
<style type="text/css">
  .style5 {
	margin-left: 40px;
}
  .style3 {
	font-weight: normal;
}
</style>
</head>

<body class="body">

<hr>
<p class="CopyrightText">Information in this document is subject to change without notice. The example companies, organizations, 
products, people, and events depicted herein are fictitious. No association with any real company, organization, product, 
person or event is intended or should be inferred. Complying with all applicable copyright laws is the responsibility of 
the user. Without limiting the rights under copyright, no part of this document may be reproduced, stored in or introduced 
into a retrieval system, or transmitted in any form or by any means (electronic, mechanical, photocopying, recording, or 
otherwise), or for any purpose, without the express written permission of Microsoft Corporation.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="CopyrightText">Microsoft may have patents, patent applications, trademarked, copyrights, or other intellectual 
property rights covering subject matter in this document. Except as expressly provided in any written license agreement 
from Microsoft, the furnishing of this document does not give you any license to these patents, trademarks, copyrights, 
or other intellectual property.</p>
<p class="CopyrightText">&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, Active Directory, BizTalk, SQL Server, SharePoint, 
	Outlook, PowerPoint, FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual SourceSafe, Visual C#, 
	Visual J#,&nbsp; and Visual Studio are either registered trademarks or trademarks of Microsoft Corporation in the 
	U.S.A. and/or other countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the trademarks of their respective owners.</p>
</div>
<hr>
<p class="body">&nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="body">&nbsp;</p>
<p class="title2">PowerShell from IronPython</p>
<p class="body">A brief example which utilizes managed Windows PowerShell APIs to run shell commands directly from IronPython.</p>
<p class="body">&nbsp;</p>
<p></p>
<p class="contentsheading">Overview</p>
<p class="Body">PowerShell (PS) is a new command-line shell for Windows which provides some pretty dramatic improvements over 
its predecessor - the DOS prompt. The most important new feature PS provides as far as IronPython is concerned 
is a set of managed interfaces accessible via the Common Language Runtime. We 
can tap directly into these from IronPython.</p><p class="Body">Utilizing PS from IronPython offers quite a bit 
more to developers than the standard Python modules used to run commands, manipulate the filesystem, etc. This sample 
includes two Python scripts, each of which are designed to determine if your host meets some of the minimum system requirements to 
play the game &quot;Age of Empires III Trial Edition&quot;. What sets these two scripts apart is that the first script, minsysreq_ps.py, leverages a helper module, powershell.py, to obtain 
PS functionality in a very useful and 
object-oriented way. The second script, minsysreq.py, uses PS commands directly to 
achieve the same results.</p><p class="Body">Note: the scripts distributed with this sample collect various performance 
and runtime info about your PC and emit this to the console for your own personal use.&nbsp; None of this information is 
transmitted to Microsoft.</p>
<p class="contentsheading">Prerequisites</p>
<p class="body">The prerequisites to successfully run the PowerShell from IronPython demo are:</p>
<ul>
	<li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
	<li>
	<font face="Verdana" style="font-size: 11pt">Windows PowerShell 2.0</font><ul>
		<li>
		<font face="Verdana" style="font-size: 11pt">Needed to access the managed PS APIs</font></li>
		<li>
		<font face="Verdana" style="font-size: 11pt">Download from
		<a href="http://technet.microsoft.com/en-us/scriptcenter/default.aspx">here</a></font></li>
	</ul>
	</li>
	<li>
	<font face="Verdana" style="font-size: 11pt">Age of Empires III Trial Edition (<b>Optional</b>)</font><ul>
		<li><font face="Verdana" style="font-size: 11pt">Run this while executing the minsysreq* scripts distributed with this sample to get runtime info about Age 
		of Empires III</font></li><li><font face="Verdana" style="font-size: 11pt">This step is entirely optional. The 
		sample scripts will still run without installing Age of Empires III!</font></li><li>
		<font face="Verdana" style="font-size: 11pt">Download from
		<a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=f627e37b-a8e8-4537-9a88-3c19b670c92a&DisplayLang=en">
		here</a></font></li>
	</ul>
	</li>
</ul>
<p class="contentsheading">Getting Started<br>
</p>
<p class="body">Please make sure the sample folder <i>IPPowerShell </i>(where this readme.htm is located)<i> </i>
contains at least the following:</p>
<blockquote>
	<blockquote>
		<p class="body">.\minsysreq.py</p><p class="body">.\minsysreq_ps.py</p><p class="body">.\powershell.py<br>
		</p>
	</blockquote>
</blockquote>
<p class="body">HINT: if the folder containing the IronPython distribution
is not already in your PATH environment variable, please add it from the command 
prompt you'll be working in.&nbsp; By doing this you will be able to run the &quot;ipy&quot; 
command from any arbitrary directory: </p>
<p class="style5"><strong>s</strong><span class="style3">e<span class="typedexample"><strong>t 
PATH=%PATH%;%ProgramFiles%\IronPython 2.6</strong></span></span></p>
<p class="contentsheading">Using powershell.py from an Interactive IronPython Session</p>
<p class="body">From the command prompt, navigate to the <i>IPPowerShell</i> directory and type the following command: </p>
<p class="typedexample">&gt; ipy.exe -i powershell.py</p><p class="typedexample">&nbsp;</p>
<p class="body">This starts an interactive IronPython session and imports quite a few modules, 
functions, objects, etc. into the global namespace. Most importantly you should find a &quot;shell&quot; object. &quot;shell&quot; 
is an instance of the Shell class (defined within powershell.py) which in turn is a wrapper for the standard PS 
cmdlets and aliases. You should take special note that the conversion from PS to IronPython involved the 
following rules with respect to Shell's methods:</p><ul>
	<li>
	<p class="body">for every PS cmdlet, there is a corresponding Shell method where the name is completely 
	lowercase with &quot;-&quot;s translated into &quot;_&quot;s.&nbsp; E.g., the PS command &quot;<b>Get-Process</b>&quot; becomes the Shell method 
	&quot;<b>shell.get_process()</b>&quot;</p></li>
	<li>
	<p class="body">for most simple PS aliases, there is a corresponding Shell method where the name is 
	completely lowercase with &quot;-&quot;s translated into &quot;_&quot;s.&nbsp; E.g., the PS alias &quot;<b>ls</b>&quot; becomes the Shell 
	method &quot;<b>shell.ls()</b>&quot;. Aliases that do not directly map into a corresponding 
	PS cmdlet (such as &quot;more&quot;) have no Shell method mapping.</p></li>
	<li>
	<p class="body">if a PS cmdlet accepts (non-parameter) arguments, they are supplied directly to the Shell 
	method in the form of a single string parameter. E.g., the PS command &quot;<b>Write-Error &quot;Some error message 
	here...&quot;</b>&quot; would become &quot;<b>shell.write_error(&quot;Some error message here...&quot;)</b>&quot;</p></li>
	<li>
	<p class="body">cmdlet parameters are mapped as keyword parameters of Shell methods.&nbsp; E.g., the PS 
	command &quot;<b>Get-Date -DisplayHint date</b>&quot; becomes the Shell method &quot;<b>shell.get_date(DisplayHint='date')</b>&quot; </p></li>
	<li>
	<p class="body">the return value from one cmdlet can be piped in as the input to another cmdlet. To do this, one just needs to invoke the 2nd cmdlet method on the return value of the first cmdlet.&nbsp; E.g., the 
	PS command &quot;<b>Get-Process ipy | ConvertTo-Html</b>&quot; becomes &quot;<b>shell.get_process(&quot;ipy&quot;).convertto_html()</b>&quot;</p></li>
	<li>
	<p class="body">properties of the return value object from a PS cmdlet are accessible as Python object attributes.&nbsp; 
	E.g., the PS command &quot;<b>Get-Process ipy | Select-Object -First 1 -Property WS</b>&quot; becomes &quot;<b>shell.get_process(&quot;ipy&quot;)[0].WS</b>&quot;&nbsp;
	</p></li>
</ul>
<p class="body">&nbsp;</p>
<table border="0" width="100%" height="36" bgcolor="#E6E6E6" cellpadding="15" cellspacing="1">
	<tr>
		<td height="36" width="523">
		&gt;&gt;&gt; from powershell import *<br>
		&gt;&gt;&gt; shell.dir()<br>
		Directory: Microsoft.PowerShell.Core\FileSystem::E:\Ip\IronPython\Samples\IPPowerShell<br>
		<br>
		<br>
		Mode LastWriteTime Length Name<br>
		---- ------------- ------ ----<br>
		-a--- 9/7/2006 3:38 PM 3602 minsysreq.py<br>
		-a--- 9/11/2006 12:54 PM 3206 minsysreq_ps.py<br>
		-a--- 9/11/2006 12:21 PM 6261 powershell.py<br>
		-a--- 9/11/2006 1:06 PM 11567 readme.htm<br>
		&gt;&gt;&gt;<br>
		&gt;&gt;&gt;<br>
		&gt;&gt;&gt; shell.dir().sort(&quot;LastWriteTime&quot;, Descending=True).select_object(&quot;Name&quot;)<br>
		Name<br>
		----<br>
		readme.htm<br>
		minsysreq_ps.py<br>
		powershell.py<br>
		minsysreq.py<br>
		&gt;&gt;&gt;</td>
	</tr>
</table>

<p class="contentsheading">Checking Minimum System Requirements for AOE III Trial 
Edition</p>
<p class="body">Included with this sample are two scripts designed to automatically determine if your system is capable 
of playing Age of Empires III Trial Edition by using PS API(s) from IronPython. The first script, 
minsysreq_ps.py, uses the nice PS wrapper module powershell.py, while minsysreq.py uses the managed PS assembly directly 
to achieve the same goal. Furthermore, both scripts will emit some runtime information such as memory usage if AOE III 
is currently running. This serves as a nice example because the standard Python modules provide little support for 
obtaining this type of information.</p><p class="body">To run these scripts it is necessary to issue the following 
commands from the <i>IPPowerShell</i> directory: &quot;<b>ipy.exe minisysreq_ps.py</b>&quot; and &quot;<b>ipy.exe minsysreq.py</b>&quot;. The output for both of 
these scripts should be identical and similar to the following:</p><p class="body">&nbsp;</p>
<table border="0" width="100%" height="36" bgcolor="#E6E6E6" cellpadding="15" cellspacing="1">
	<tr>
		<td height="36" width="523">
		E:\Ip\IronPython\Samples\IPPowerShell&gt;ipy minsysreq.py<br>
		This program will determine if your PC meets some of the<br>
		minimum system requires to play the game, Age of Empires III Trial.<br>
		<br>
		Your CPU is fast enough (2.211Ghz)!<br>
		<br>
		256 MB is enough video memory!<br>
		<br>
		Have a nice day!</td>
	</tr>
</table>

<p class="body">&nbsp;</p><p class="body">If you are 
already running AOE III, you'd also see the following extra output:</p>
<table border="0" width="100%" height="36" bgcolor="#E6E6E6" cellpadding="15" cellspacing="1">
	<tr>
		<td height="36" width="523">
		It appears as if you're currently running Age of Empires III Trial !<br>
		The game is using 77 megs of RAM and has a process ID of 3956.</td>
	</tr>
</table>

<p class="body">&nbsp;</p><p class="body"><font size="4">Please explore the contents of both scripts in the <i>IPPowerShell</i> 
directory to assist you in using PowerShell from your own IronPython scripts and modules! </font></p><p class="body">&nbsp;</p>
<p class="body">This concludes our tutorial. Have fun playing with PowerShell from IronPython!</p>

</body>

</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link rel="stylesheet" type="text/css" href="../Samples.css">
  <meta http-equiv="Content-Type"
 content="text/html; charset=windows-1252">
  <title>IronTunes Tutorial</title>
</head>
<body lang="EN-US">
<hr>
<p class="CopyrightText"> Information in this document is subject to
change without notice. The example companies, organizations, products,
people, and events depicted herein are fictitious. No association with
any real company, organization, product, person or event is intended or
should be inferred. Complying with all applicable copyright laws is the
responsibility of the user. Without limiting the rights under
copyright, no part of this document may be reproduced, stored in or
introduced into a retrieval system, or transmitted in any form or by
any means (electronic, mechanical, photocopying, recording, or
otherwise), or for any purpose, without the express written permission
of Microsoft Corporation.</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText"> Microsoft may have patents, patent
applications, trademarked, copyrights, or other intellectual property
rights covering subject matter in this document. Except as expressly
provided in any written license agreement from Microsoft, the
furnishing of this document does not give you any license to these
patents, trademarks, copyrights, or other intellectual property.</p>
<p class="CopyrightText"> &nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, 
	Active Directory, BizTalk, SQL Server, SharePoint, Outlook, PowerPoint, 
	FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual 
	SourceSafe, Visual C#, Visual J#,&nbsp; and Visual Studio are either registered 
	trademarks or trademarks of Microsoft Corporation in the U.S.A. and/or other 
	countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the 
	trademarks of their respective owners.</div>
<hr>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="Title1">&nbsp;</p>
<p class="Title1">IronTunes</p>
<p class="Body">A music player built in IronPython</p>
<p class="Body">Contributor: Brad Dodson</p>
<p class="contentsheading"> &nbsp;</p>
<p class="contentsheading"> Prerequisites</p>
<p class="body"> The prerequisites to successfully run IronTunes are:</p>
<ul>
  <li class="normal" type="disc">Microsoft .NET Framework Version 3.5 Service 
  Pack 1 (or Windows 7)
    <ul>
      <li class="Normal">Required to run IronPython</li>
      <li class="Normal">Download from 
	  <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=AB99342F-5D1A-413D-8319-81DA479AB0D7&amp;displaylang=en">here</a></li>
    </ul>
  </li>
  <li class="normal" type="disc">Microsoft Visual Studio 2008
    <ul>
      <li class="Normal">Required for the COM interoperability</li>
      <li class="Normal">Get it
	  <a href="http://www.microsoft.com/visualstudio/en-us/howtobuy/default.mspx">here</a></li>
    </ul>
  </li>
  <li class="normal"> IronPython 2.6 distribution
    <ul>
      <li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
      <li>Download from 
	  <a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a><br>
      </li>
    </ul>
  </li>
    <li class="normal">DirectX 9.0c and a compatible sound card</li>
    <ul>
		<li class="normal">Download from 
		<a
 href="http://www.microsoft.com/downloads/details.aspx?FamilyId=2DA43D38-DB71-4C1B-BC6A-9B6652CD92A3&amp;displaylang=en">here</a></li>
	</ul>
	<li class="normal">Follow the instructions on generating an Interop
Assembly for DirectShow (i.e., quartz.dll) found 
	<a href="#Generating_the_COM_Interop_Assembly_">here</a><br></li>
</ul>
<p class="Normal">
<br>
<em>Microsoft Windows SDK for Windows 7 and .NET Framework 3.5 SP1</em> can be used in place of the
<em>Visual Studio 2008</em> installation.</p>
<h1>Introduction</h1>
<p class="Normal">IronTunes is a music player built upon the IronPython
framework and utilizes several Windows libraries to play music
files. For example, COM Interop is used to connect to the DirectShow
API which in turn plays the actual files. This simply means that we do
not
have to implement the code to convert audio files to actual sounds
ourselves. Additionally, IronTunes uses
a Windows Presentation Foundation based graphical
user interface. One of the major benefits of using WPF from IronPython
is that it makes writing GUIs very easy.</p>
<p class="Normal">&nbsp;</p>
<p class="Normal">IronTunes comes with two separate GUIs to showcase that you 
can design UI independently from the code.&nbsp; To see this, save a copy of 
CurrentSkin.xaml, and copy NewSkin.xaml over CurrentSkin.xaml.&nbsp; Then 
re-launch IronTunes.&nbsp; NewSkin.xaml adds a seek slider and images for the 
buttons.&nbsp; Use the thinner plus-sign button to add an individual file and 
the thicker plus-sign button to add an entire directory.<br>
</p>
<h2>Using IronTunes</h2>
<p class="Normal">
To start IronTunes, run "ipy.exe IronTunes.py" from
the IronTunes directory. Add files by clicking the "Add File" or "Add
Dir" buttons. The files you add will show up in the library view below.
You can select a file and click "Play/Pause" to start playing it. <br>
Typing in the search box in the top right will filter the library as
you type.<br>
The other features work pretty much as expected: Back, Forward, and
Volume Control. Information about the currently playing track is
displayed at the top in the center.</p>
<h2>COM Interop and General Explanation of How IronTunes Functions</h2>
<p class="Normal">IronTunes uses quartz.dll (in the system32 directory) by 
generating an interop assembly with the tlbimp.exe tool.&nbsp; See the 
IronPython tutorial for more info. The Player object (player.py)
constructs a FilegraphManagerClass object from quartz.dll via the interop 
assembly QuartzTypeLib.dll.&nbsp; Player calls into the FilegraphManagerClass 
object to play the audio files. The Player object calls the RenderFile method
with a filename to setup the filter graph to render the file. Then it
can call the Run (to play), Stop, and Pause methods. The Player object also registers
the program's main window with the filter graph manager to send
notification messages. In order to handle these there is an extra wndproc hooked into the main window which sends notifications to the
player object when it needs to respond to filter graph events (it calls
the ProcessEvents method). This allows the program to advance to the
next item on the playlist when an item finishes playing.<br>
</p>
<h3><a name="Generating_the_COM_Interop_Assembly_"></a>Generating the
COM Interop Assembly<br>
</h3>
<p class="Normal">For this example
to run, it is
required that you create the quartz (i.e., DirectShow) interop assembly
on your own by following these simple
steps:<br>
</p>
<ol>
  <li>
    <p class="Step">Open the &quot;Visual Studio
2008 Command Prompt" from the start menu.</p>
  </li>
  <li>
    <p class="Step">Change the current directory to Samples\IronTunes.</p>
  </li>
  <li>
    <p class="Step">Use the tlbimp tool to
generate the interop assembly for quartz (tlbimp writes to the current
directory):</p>
  </li>
</ol>
<p class="TypedExample">tlbimp
%SystemRoot%\System32\quartz.dll<br>
<br>
</p>
<p class="Step">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
C:\IronPython\Samples\IronTunes&gt;tlbimp
%SystemRoot%\System32\quartz.dll<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Microsoft (R) .NET Framework Type
Library to Assembly Converter
2.0.50727.42<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Copyright (C) Microsoft
Corporation.&nbsp; All rights reserved.<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Type library imported to
QuartzTypeLib.dll<br>
</p>
<h2>Windows Presentation Foundation</h2>
<p class="Normal">IronTunes builds a
new WPF window and loads the XAML
file CurrentSkin.xaml. It then sets the window's DataContext to be
the application's dataModel, so that the bindings in the XAML file can
allow the user interface to reflect the program's state. It also
creates an IronTunesWindow object (IronTunesWindow.py) and uses its
enliven method to attach event handlers to the buttons.
</p>
<h2>Library Management</h2>
<p class="Normal">The Library class
(library.py) manages the current
music library. It implements the functionality of adding files and
directories (recursively) to the current library, and allows the
current library view to be filtered and sorted (by a SearchFilter
object implemented in SearchFilter.py).</p>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <link rel="stylesheet" type="text/css" href="../Samples.css">
  <meta http-equiv="Content-Type"
 content="text/html; charset=windows-1252">
  <title>Puzzle</title>
  <style type="text/css">
  .style5 {
	margin-left: 40px;
}
  .style3 {
	font-weight: normal;
}
.style6 {
	font-size: large;
}
</style>
</head>
<body class="body">
<hr>
<p class="CopyrightText"> Information in this document is subject to
change without notice. The example companies, organizations, products,
people, and events depicted herein are fictitious. No association with
any real company, organization, product, person or event is intended or
should be inferred. Complying with all applicable copyright laws is the
responsibility of the user. Without limiting the rights under
copyright, no part of this document may be reproduced, stored in or
introduced into a retrieval system, or transmitted in any form or by
any means (electronic, mechanical, photocopying, recording, or
otherwise), or for any purpose, without the express written permission
of Microsoft Corporation.</p>
<p class="CopyrightText"> &nbsp;</p>
<p class="CopyrightText"> Microsoft may have patents, patent
applications, trademarked, copyrights, or other intellectual property
rights covering subject matter in this document. Except as expressly
provided in any written license agreement from Microsoft, the
furnishing of this document does not give you any license to these
patents, trademarks, copyrights, or other intellectual property.</p>
<p class="CopyrightText">
&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, 
	Active Directory, BizTalk, SQL Server, SharePoint, Outlook, PowerPoint, 
	FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual 
	SourceSafe, Visual C#, Visual J#,&nbsp; and Visual Studio are either registered 
	trademarks or trademarks of Microsoft Corporation in the U.S.A. and/or other 
	countries.</p>
	<p class="CopyrightText">&nbsp;</p>
	<p class="CopyrightText">Other product and company names herein may be the 
	trademarks of their respective owners.</div>
<hr>
<p class="body"> &nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">
&nbsp;</p>
<p class="body"> &nbsp;</p>
<p class="title2"> Puzzle</p>
<p class="body"> A slide puzzle game using Virtual Earth maps</p>
<p class="body"> Contributor: Ravi Chugh</p>
<p> </p>
<p class="contentsheading"> Prerequisites</p>
<p class="body"> The prerequisites to successfully run the Puzzle
puzzle game are:</p>
<ul>
	<li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
		that comes with this distribution</li>
		<li>Download from 
		<a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
</ul>
<p class="contentsheading">Getting Started<br>
</p>
<p class="body"><img alt="Screenshot of Puzzle" src="Screenshot.jpg"
 style="width: 487px; height: 500px;" align="right">Please make sure
the folder structure in the Puzzle directory is:</p>
<blockquote>
  <blockquote>
    <p class="body">.\banner.bmp </p>
    <p class="body">.\cache (Note: This is a subfolder)</p>
    <p class="body">.\copyright.py</p>
    <p class="body">.\icon.ico </p>
    <p class="body">.\load.xml </p>
    <p class="body">.\loadpanel.py </p>
    <p class="body">.\puzzle.py </p>
    <p class="body">.\quadkey.py </p>
    <p class="body">.\readme.htm</p>
    <p class="body">.\tiles.py </p>
    <p class="body">.\winforms.py<br>
    </p>
    <p style="text-align: center;" class="body"><br>
    </p>
  </blockquote>
</blockquote>
<p class="body">HINT: if the folder containing the IronPython distribution
is not already in your PATH environment variable, please add it from the command 
prompt you'll be working in.&nbsp; By doing this you will be able to run the &quot;ipy&quot; 
command from any arbitrary directory: </p>
<p class="style5"><strong>s</strong><span class="style3">e<span class="typedexample"><strong>t 
PATH=%PATH%;%ProgramFiles%\IronPython 2.6</strong></span></span></p>
<p class="body">From the command prompt, navigate to the Puzzle
directory and type the following: </p>
<p class="typedexample">&gt; ipy.exe -D puzzle.py</p>
<p class="body">At this point, Puzzle's GUI window should come up.
You're ready to play!</p>
<p class="body">If you launch with the ipyw.exe executable, the cmd window will 
be free to use while the application is running.</p>
<p class="body">&nbsp;</p>
<p class="style6"><strong>Note</strong></p>
<p class="body">It's very important you pass the '-D' flag to ipy.exe when 
running the Puzzle sample.&nbsp; Due to a
<a href="http://ironpython.codeplex.com/WorkItem/View.aspx?WorkItemId=25404">bug</a>, 
IronPython may not run this sample properly without use of this flag. <br>
</p>
<p class="contentsheading">Some Additional Features</p>
<p class="body">Note that using any features described below from
within the console instead of from the GUI game form itself may yield
errors if argument values are invalid.</p>
<p class="normal">&nbsp;</p>
<p class="normal"><i>1) Setting the puzzle board</i></p>
<p class="body">Instead of using the Create panel to navigate to a
scene, you can create a puzzle using latitude/longitude directly using
the 'SetBoard' method.</p>
<p class="body">'SetBoard' takes 5 arguments:</p>
<blockquote>
  <p class="body">map types: r (road), a (aerial), and h (hybrid).</p>
  <p class="body">latitude: -85 to 85</p>
  <p class="body">longitude: -180 to 180</p>
  <p class="body">zoom level: 1 through 19.</p>
  <p class="body">grid size: 3x3 and 4x4.</p>
</blockquote>
<p class="typedexample">&gt;&gt;&gt; p.SetBoard(a, 50, -100, 12, 3)</p>
<p class="body">This will create a 3x3 puzzle board of zoom level 12
aerial images centered (as close as possible) to (50, -100).</p>
<p class="body">&nbsp;</p>
<p class="normal"><i>2) Saving the current game</i></p>
<p class="body">In case you want to save the puzzle configuration you
are currently playing:</p>
<p class="typedexample">&gt;&gt;&gt; p.SaveCurrentGame(caption)</p>
<p class="body">This will save the current puzzle, along with the
specified caption, into load.xml so that next time you start the
puzzle, you can choose the game you just saved from the Load panel.</p>
<p class="body">Note that this does not save the current state of your
puzzle pieces. It saves the puzzle so you can start from the beginning
again.</p>
<p class="body">&nbsp;</p>
<p class="normal"><i>3) Resizing the puzzle pieces</i></p>
<p class="body">The full tiles downloaded from the tile server are
256x256. When the grid size is 3x3, the tiles are 128x128 at 50%,
192x192 at 75%, and 256x256 at 100%. When the grid size is 4x4, the
tiles are further reduced by 25%. So the size is 96x96 at 50%, 144x144
at 75%, and 192x192 at 100%.</p>
<p class="body">If you want to specify a different tile size:</p>
<p class="typedexample">&gt;&gt;&gt; p.ResizeEverything(200)</p>
<p class="body">This will resize the window so that in 3x3 grids, each
tile will be 200x200, and in 4x4 grids, each tile will be 150x150.</p>
<p class="contentsheading">Downloading tiles</p>
<p class="body">Images for puzzle pieces are downloaded directly from
Microsoft's Virtual Earth tile servers. There is no API for downloading
specific images directly from the tile server, but the process for
converting particular scenes to tiles can be seen in quadkeys.py.
Because there is no such API, the URL structure representing
particular images from the tile server can change at any time, breaking
the way Puzzle downloads tiles. If it does, the GetImgUrl()
function in tiles.py will have to be updated to match the new scheme.</p>
<p class="body">&nbsp;</p>
<p class="body">This sample will contact Virtual Earth when started to download 
an initial map and then again when the user manually changes the map from either 
the &quot;create&quot; or&nbsp; &quot;load&quot; menu options.&nbsp; Information sent to the Virtual 
Earth servers will include your IP address along with the location and type of 
the map requested.&nbsp; You may view the Virtual Earth terms of use and privacy 
policy at: <a href="http://www.microsoft.com/virtualearth/control/terms.mspx">
http://www.microsoft.com/virtualearth/control/terms.mspx</a>.</p>
<p class="contentsheading">Caching</p>
<p class="body">When caching is enabled, all downloaded tiles are saved
into to the \cache folder. If a particular image request has already
been cached, the image will be loaded from the appropriate file instead
of downloading it again from the tile server. Note that the size of
\cache folder can grow quickly, so keep an eye on it.</p>
<p class="body">To get stats about the cache run the following function:</p>
<p class="typedexample">&gt;&gt;&gt; CacheStats()</p>
<p class="body">When you click the Clear Cache button, the files in the
cache will get deleted once the game is closed. The handles on files
(downloaded tiles) associated with the current puzzle pieces are not
guaranteed to be closed when ClearCache() is called, so not all images
in the cache get deleted. Any remaining images can be manually deleted.</p>
</body>
</html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
<title>Integrating Voice into .NET</title>
<link rel="stylesheet" href="../IronPython.css" type="text/css"/>
</head>

<body lang="EN-US">

<div class="Section1">

<hr>
<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">Information in this document is subject to change without notice. The example companies, organizations, 
products, people, and events depicted herein are fictitious. No association with any real company, organization, product, 
person or event is intended or should be inferred. Complying with all applicable copyright laws is the responsibility of 
the user. Without limiting the rights under copyright, no part of this document may be reproduced, stored in or introduced 
into a retrieval system, or transmitted in any form or by any means (electronic, mechanical, photocopying, recording, or 
otherwise), or for any purpose, without the express written permission of Microsoft Corporation.</p>
<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">&nbsp;</p>
<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">Microsoft may have patents, patent applications, trademarked, copyrights, or other intellectual 
property rights covering subject matter in this document. Except as expressly provided in any written license agreement 
from Microsoft, the furnishing of this document does not give you any license to these patents, trademarks, copyrights, 
or other intellectual property.</p>
<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">&nbsp;</p>
<div class="Section1">
	<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0"> Microsoft Corporation. All rights reserved.</p>
	<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">&nbsp;</p>
	<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">Microsoft, MS-DOS, MS, Windows, Windows NT, MSDN, Active Directory, BizTalk, SQL Server, SharePoint, 
	Outlook, PowerPoint, FrontPage, Visual Basic, Visual C++, Visual J++, Visual InterDev, Visual SourceSafe, Visual C#, 
	Visual J#,&nbsp; and Visual Studio are either registered trademarks or trademarks of Microsoft Corporation in the 
	U.S.A. and/or other countries.</p>
	<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">&nbsp;</p>
	<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">Other product and company names herein may be the trademarks of their respective owners.</p>
</div>
<hr>
<p class="body" style="margin-top: 0; margin-bottom: 0">&nbsp;</p>
<p class="CopyrightText" style="margin-top: 0; margin-bottom: 0">
    This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
	<p class="Title2">&nbsp;</p><h1>Integrating Voice into .NET</h1><font SIZE="2">
	<h3>Contributor: Richard Guo</h3>
	</font>
	<p class="ContentsHeading">&nbsp;</p>
	<h1>Contents</h1>
	<p class="Toc1">Exercise 1: <a href="#T1">Building a Web Browser</a></p>
	<blockquote>
		<p class="Toc3">Task 1: <a href="#T1.1.1">Making a Window</a></p><p class="Toc3">Task 2: 
		<a href="#T1.1.2">Making a Browser</a></p><p class="Toc3">Task 3: <a href="#T1.1.3">Putting it Together</a></p>
	</blockquote>
	<p class="Toc1">Exercise 2: <a href="#T2">Building a Voice Recognition System</a></p>
	<blockquote>
		<p class="Toc3">Task 1: <a href="#T2.1.1">Configuring Everything</a></p><p class="Toc3">Task 2: 
		<a href="#T2.1.2">Your Speech Recognizer</a></p>
	</blockquote>
	<p class="Toc1">Exercise 3: <a href="#T3">Sidetrack: Launcher Application</a></p>
	<blockquote>
		<p class="Toc3">Task 1: <a href="#T3.1">Voice-based Launching</a></p>
	</blockquote>
	<p class="Toc1">Exercise 4: <a href="#T4">Basic Functionality in Voice Browsing</a></p>
	<blockquote>
		<p class="Toc3">Task 1: <a href="#T4.1">Class Abstraction and Integration</a></p><p class="Toc3">&nbsp;</p>
	</blockquote>
	
</div>
<div class="Section2">
	<h1 style="margin-top: 0; margin-bottom: 0">Introduction</h1>
	<p class="Normal" style="margin-top: 0; margin-bottom: 0">IronPython is the .NET implementation of the Python programming language
        (<a href="http://www.python.org">www.python.org</a>).  It's a dynamically typed language with support
        for many programming paradigms such as object-oriented programming, and also allows seamless use of .NET code.  
        The goal of this tutorial is to demonstrate how easy it is to make an 
	application using the power of the .NET libraries, specifically the ones relating to windows forms and speech. We 
	will also see how the interactive nature of Python is well suited to rapid 
	prototyping, debugging, and experimentation. Due to the complexity of the 
	program, it is assumed that you have already completed the main IronPython 
	tutorial that teaches the basics of Python and how to run applications in 
	IronPython. However, in an effort to be friendly to newcomers who learn better through a case study that 
	can be played with, I have broken down elements of the program into exercises that can be completed 
	independently. This division also corresponds to my steps in coding this application, so it might be 
	worthwhile to see how the use of Python accelerated development.</p>
	<p class="Normal">The following packages are required:</p>
	<ul>
		<li class="Normal">Windows Vista</li>
	</ul>
	<p></p><p class="Body">Visual Studio 2005 is an optional supplement that can be helpful for viewing 
	methods and GUI element properties. However, this is not a requirement.</p>
<h1 style="margin-top: 0; margin-bottom: 0">Getting Started<br>
</h1>
<p class="body" style="margin-top: 0; margin-bottom: 0">Please make sure the sample folder <i>Voice </i>(where this readme.htm is located)<i> </i>
contains at least the following:</p>
<blockquote>
	<blockquote>
		<p class="body" style="margin-top: 0; margin-bottom: 0">.\Exer1.py</p>
		<p class="body" style="margin-top: 0; margin-bottom: 0">.\Exer2.py</p>
		<p class="body" style="margin-top: 0; margin-bottom: 0">.\Exer3.py</p>
		<p class="body" style="margin-top: 0; margin-bottom: 0">.\Exer4.py</p>
		<p class="body" style="margin-top: 0; margin-bottom: 0">.\favs.txt<br>
		</p>
	</blockquote>
</blockquote>
<p class="body">Add the folder containing the IronPython distribution to your <i>Path</i> environment variable.</p>
	<p class="body">&nbsp;</p>
	<h1><a name="T1">Exercise 1: Building a Web Browser</a></h1>
	<p class="Body">In this section, we will learn the basics of manipulating UI in 
	IronPython and to do something useful with it: build a web browser!</p>
	<p class="Body">Specifically, we will use Windows Forms or <i>winforms</i>, the 
	established way of building graphical applications. We will examine how to 
	set parameters, add controls, and display the application. This will lay the 
	foundation for building a graphical web browser that has all the power of 
	the rendering engine of IE. This idea was inspired by the presence of 
	the &quot;Web Browser&quot; control in the toolbox of VS 2005.</p>
	<p class="Body">The code for this section can be found in <strong>Exer1.py</strong></p>
	<h3><a name="T1.1.1">Task 1: Making a Window</a></h3>
	<ol>
		<li>
		<p class="Step">Start the IronPython console</p>
		</li>
	</ol>
	<ol start="2">
		<li>
		<p class="Step">Execute the following:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import System</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import clr</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">clr.AddReference(&quot;System.Windows.Forms&quot;)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">clr.AddReference(&quot;System.Drawing&quot;)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Windows.Forms import *</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Drawing import *</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code.</p>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import System</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import clr</p>
	</blockquote>
	<p class="Stepnonumbering">This block is the Python equivalent of the using statement in C# and the 
	#include statement from C/C++. We are loading libraries/modules/namespaces to use for our main program.</p>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">clr.AddReference("System.Windows.Forms")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">clr.AddReference("System.Drawing")</p>
	</blockquote>
	<p class="Stepnonumbering">Here we are calling a basic method of clr. We are adding references to more complicated libraries. For this exercise, we will need to load System.Windows.Forms and System.Drawing 
	in addition to System. Note that we need to add these separately instead of importing them because they are not part of the basic namespaces that we can just import. They are in separate dlls on your hard drive and the information for accessing them must be retrieved through this method. For now, consider basic namespaces such as System and clr as having already been added as references.</p>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Windows.Forms import *</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Drawing import *</p>
	</blockquote>
	<p class="Stepnonumbering">This might seem complicated. However, what we are doing is just unpacking namespaces. We are importing the contents of these two namespaces 
	into the global environment. Now, if we do dir() before and after, we can see the difference. This trick allows us to make classes with Form() instead of having to type out System.Windows.Forms.Form().<br></br>Note that we don't need to add a reference to System.Console because it is not a separate 
	DLL. Rather, it is contained in System. It is important to make the distinction between the libraries that have to be added and then imported and those that are contained in basic namespaces such as System. The documentation for this is on the MSDN website.</p>
	
	<ol start="3">
		<li>
		<p class="Step">Execute the following:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">f = Form(Text = "My Web Browser")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">f.AutoScroll = True</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">f.AutoSize = True</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">f.MinimumSize = Size(40,40)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">f.Size = Size(500,500)</p>
	</blockquote>
	<p class="Stepnonumbering">The first line creates an instance, f, of the object Form (from System.Windows.Forms if you were wondering). This is a winform element that is basically a blank window to be controlled by the OS.
	<br></br>
	Next, we set four properties of the form. The syntax of this is almost identical to C# code. The &quot;.&quot; operator allows us to access properties of the instance and set them. Words such as True and False are 
	Python Boolean values. Do not confuse this with &quot;True&quot;, which is a string. We can also pass the values of 
	the properties as arguments to the constructor. We set the title of the form to be "My Web Browser". We could just as easily 
	use <i>f.Text = "My Web Browser"</i>. Likewise, we can move one of the other lines into the constructor.
	<br></br>
	Autoscroll tells the form to automatically add scroll bars when there is more content than the form can contain. This lets us display large web pages.
	Autosize resizes the window to fit the content.
	MinimumSize is the smallest that we can manually resize the window to be.
	Size is the default size that the form has when first called.
	<br></br>
	Note that the code is different from C# in that we do not need to prefix declarations by new. Also note that like most high-level scripting languages, objects are untyped in Python.</p>
	
	<h3><a name="T1.1.2">Task 2: Making a Browser</a></h3>
	<ol start="1">
		<li>
		<p class="Step">Execute the following:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">browser = WebBrowser()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">browser.Dock = DockStyle.Fill</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">browser.MinimumSize = Size(40,40)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">browser.Url = System.Uri("http://www.msn.com")</p>
	</blockquote>
	<p class="Stepnonumbering">Likewise, here we are instantiating a Web Browser object found in System.Windows.Forms.WebBrowser. It is a control element that acts like a web browser except that it can be embedded in other applications. Neat, isn't it?
	<br></br>
	We also set some properties to desirable values. In this case, we are setting the position (DockStyle.Fill tells the element to take up all the space in the form), the minimum size, and the default URL to be shown upon initialization.
	<br></br>
	If you are wondering how I get the values to set properties, I'm going to point you to the MSDN site. Everything is there, including documentation on attributes and examples of usage. There are no Python examples yet, so use the ones in your 
	favorite language. The rest is experimenting with the environment. For example, if I'm unsure of what to do after I make a browser element, I can do 
	<i>dir(browser)</i> to list all the methods and attributes of the browser element. Then, I can look up the documentation on MSDN and find appropriate values. If you do something wrong, the system will simply throw an exception. It's a lot easier to debug and code like this (freeform experimentation) than to code in an IDE.
	
	<h3><a name="T1.1.3">Task 3: Putting it Together</a></h3>
	<ol start="1">
		<li>
		<p class="Step">Execute the following:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">f.Controls.Add(browser)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">f.ShowDialog()</p>
	</blockquote>
	<p class="Stepnonumbering">Our objects are now created. The next step is to link them by putting the browser in the form f. We do that 
	with the &quot;Add&quot; method of <i>f.Controls</i> by passing &quot;browser&quot; as a parameter.
	<br></br>
	Verify the results of&nbsp; <i>f.ShowDialog()</i>. This method of &quot;f&quot; draws the form in all its glory to your screen. You should see a web browser embedded there. Congratulations.
	
		<h1><a name="T2">Exercise 2: Building a Voice Recognition System</a></h1>
	<p class="Body">In this section, we will learn about the powerful voice recognition capabilities added to .NET in version 3.0. As part of 
	Windows Presentation Foundation, System.Speech 
	adds two engines, one for rendering text as speech through a variety of synthesized voices and another for 
	interpreting speech as text according to certain grammar rules.</p>
	<p class="Body">In our example, we will start by building small modules and walking through the code for making grammar rules to recognize speech. We will not be touching on any speech synthesis tools. All of our efforts will focus on recognition. Thus, it is important to have a good microphone and to be operating in a quiet environment.</p>
	<p class="Body">The code for this section can be found in <strong>Exer2.py</strong></p>
	
<h3><a name="T2.1.1"></a>Task 1: Configuring Everything</h3>
	<p class="Step">At this point, it's important to make sure the audio recognition system is properly configured. 
	Go to Speech Recognition in the Control Panel and configure the microphone. After that, train a recognition profile. Then test to make sure that your machine can accept audio input. Once you are sure that everything is done, proceed to the next step.</p>
<h3><a name="T2.1.2"></a>Task 2: Your Speech Recognizer</h3>
	<ol start="1">
		<li>
		<p class="Step">Now let's build a basic recognizer engine. Open a new console and enter the following:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import System</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import clr</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">clr.AddReference("System.Speech")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Speech import *</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">def recognized(o, eventArgs):</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;System.Console.WriteLine(eventArgs.Result.Text)</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code. By now, you should recognize the basic import commands and that we are loading the System.Speech library. The library is a component of .NET 3.0's WPF pillar and uses SAPI as an internal speech decoding engine.</p>
	<p class="Stepnonumbering">However, we are introducing something new here when we define a function. This function is an event handler, meaning that it is executed when a certain event happens. Because Python is untyped, we can write events that we then plug into any situation. Examples of this will be shown later. For now, notice that this 
	handler prints out the content of some object passed to it. System.Console.WriteLine is the basic printing mechanism for .NET. We could just as easily have called Python's native print command.</p>
	<ol start="2">
		<li>
		<p class="Step">Execute the following code:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">recognizer = Recognition.SpeechRecognizer()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">choices = Recognition.Choices()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">choices.Add("Sam")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">choices.Add("Mary")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">choices.Add("Bob")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">builder = Recognition.GrammarBuilder()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">builder.Append(choices)</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code.</p>
	<p class="Stepnonumbering">First, we create an instance of the Speech Recognizer Engine. This is a class in System.Speech and serves as the connector to the SAPI engine. Once it's constructed, it's automatically initialized and when it detects speech, it will send the signal to the grammar engine to interpret. Right now, it's picking up everything we say into the 
	microphone, but since we have no grammar instances attached, nothing will happen.</p>
	<p class="Stepnonumbering">Choices can only recognize one of its states at a time. We added three strings to our choice builder, so we can say any of the three names and have the 
	name recognized.</p>
	<p class="Stepnonumbering">The speech engine must be very precise, so it cannot interpret any arbitrary sound. Thus, we use grammar to define precisely what the engine can recognize. The sound is parsed to match the grammar choices. If there is a match, we trigger the event handler for speech recognized, else, we trigger the speech detected handler or do nothing. 
	Grammar Builder is quite simple to use. We can append strings or choices. If we append a string, it *must* be said for that grammar path to be followed. If we encounter a choice, we must satisfy one of the choice conditions before proceeding. When we reach the end, the speech engine triggers the handler.</p>

	<ol start="3">
		<li>
		<p class="Step">Execute the following code:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">my Grammar = Recognition.Grammar(builder)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">myGrammar.SpeechRecognized += recognized</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">recognizer.LoadGrammar(myGrammar)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">System.Console.ReadLine()</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code.</p>
	<p class="Stepnonumbering">Finally, we're at the stage of building the grammar engine. Initialization proceeds as above. Attaching the handler is done with the += option. We link the function to the port SpeechRecognized. A list of available ports is on MSDN. The last step is to load the grammar processor into the speech recognizer. The ReadLine() statement simply stops the program from closing because we are not executing any more lines. This gives time for the Recognizer(on a separate thread) to read your voice.</p>
	<p class="Stepnonumbering">After connecting the two, we can try speaking into the microphone. The handler should be triggered as appropriate, and the name of the person you called will be printed in the console.</p>

		<h1><a name="T3">Exercise 3: Sidetrack: Launcher Application</a></h1>
	<p class="Body">Voice in general is not a good way to interface completely with a program. As an input method, it is far too unreliable (poor sound quality, misunderstood commands, poor vocabulary/grammar selection, etc.) and inefficient (enormous CPU power to accurately decode speech). Humans can enter text through the keyboard and mouse much faster than through voice. All potential uses of voice systems should be application-specific. That is, they leverage commands through Hash tables, mapping a certain word or phrase to an action within the context of the program. It should not be used for blind text input (which is why our web browser will remain limited in functionality).</p>
	<p class="Body">One particular use for voice-based input is to launch applications. For office workers, it's often an adjustment when they must switch tasks. They often have to navigate through the start menu and then find the exact path of the file they want to open. We can change that by allowing the execution of any command that can be done through the command line (such as opening a file or querying a database) and abstract that as a single voice command. In this example in <strong>Exer3.py</strong>, we will do some basic application launching. This will also familiarize you with the complex abstractions coming in the last section.</p>

<h3><a name="T3.1.1"></a>Task 1: Voice-based Launching</h3>
	<p class="Step">At this point, it's important to make sure the audio recognition system is properly configured. 
	Go to Speech Recognition in the Control Panel and configure the microphone. After that, train a recognition profile. Then test to make sure that your machine can accept audio input. Once you are sure that everything is done, proceed to the next step.</p>
	<ol start="2">
		<li>
		<p class="Step">Execute the following code:</p></li>
	</ol>
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import System</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">import clr</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">clr.AddReference("System.Speech")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Speech import *</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Diagnostics import *</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">from System.Collections import *</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code.</p>
	<p class="Stepnonumbering">You might notice that we are importing new libraries this time. System.Diagnostics contains the Process class, which 
	lets you launch/terminate applications as well as set command parameters. It allows shallow interactions with a program without fully embellishing it in a .NET shell (if the program is unmanaged code, it will execute as unmanaged). System.Collections contains some basic container classes such as arrays, arraylists, and hashtables. We will primarily be using the hashtable.</p>
	
	<ol start="3">
		<li>
		<p class="Step">Execute the following code:</p></li>
	</ol>
	
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">Programs = Hashtable()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">Programs["Word"] = lambda : Process.Start("winword")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">Programs["Excel"] = lambda : Process.Start("excel")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">Programs["Powerpoint"] = lambda : Process.Start("powerpnt")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">Programs["Notepad"] = lambda : Process.Start("notepad")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">Programs["Internet"] = lambda : Process.Start("iexplore")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">Programs["Program"] = lambda : Process.Start("devenv")</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code.</p>
	<p class="Stepnonumbering">Wow. Lambda statements? These may be unfamiliar to you if you come from a C/C++ background. Essentially, all we're doing here is creating a hashtable and associating strings with functions. Then, later on, when we get a match in the hashtable with a vocal command, we execute the function. There's no need to have complex switch or if-else statements to associate commands with strings. The documentation for lambda is *not* on MSDN. Look to the Python site for documentation about this.</p>
	<p class="Stepnonumbering">Side Note: part of what's so brilliant about IronPython is that we are free to mix and match the best of all worlds. We can borrow Python libraries and syntax and tools such as lambdas. We have the .NET framework and all the languages and libraries that target it. Isn't it great?</p>

	<ol start="4">
		<li>
		<p class="Step">Execute the following code:</p></li>
	</ol>
	
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">def recognized(o, eventArgs):</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;if Programs.Contains(eventArgs.Result.Text):</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Programs[eventArgs.Result.Text]()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synthesizer.Speak(eventArgs.Result.Text)</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code.</p>
	<p class="Stepnonumbering">Simple function declaration - this should be pretty self-explanatory. We're making an event handler that says that if we receive voice input and that voice input matches one of the keys we put into the hashtable, we will execute whatever function is contained in the hashtable at that key and then say the name of the program we executed. Note that we're forward referencing the variable synthesizer as we haven't defined it yet! This is fine according to Python because it's interpreted. However, if we fail to create that variable later on or misname it, we may get headaches trying to debug our app.</p>

	<ol start="5">
		<li>
		<p class="Step">Execute the following code:</p></li>
	</ol>
	
	<blockquote>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">class VoiceRecognizer (Recognition.SpeechRecognizer):</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;def __init__(self):</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.choices = Recognition.Choices()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for x in Programs.Keys:</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.choices.Add(x)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.builder = Recognition.GrammarBuilder()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.builder.Append(self.choices)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.myGrammar = Recognition.Grammar(self.builder)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.myGrammar.SpeechRecognized += recognized</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.LoadGrammar(self.myGrammar)</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">&nbsp;</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">synthesizer = Synthesis.SpeechSynthesizer()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">recognizer = VoiceRecognizer()</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">System.Console.WriteLine("Press enter to exit...")</p>
		<p class="Code-Highlighted" style="margin-top: 0; margin-bottom: 0">System.Console.ReadLine()</p>
	</blockquote>
	<p class="Stepnonumbering">Let's examine this code.</p>
	<p class="Stepnonumbering">Here is a class definition. Notice that we are inheriting from the SpeechRecognizer class 
	and will have all of its attributes. __init__ is equivalent to a constructor and this should all be familiar if you've experienced OOP. Declaring a new variable isn't done through public or private; rather, we just call self.variablename and set it equal to something. Syntax of note here is the for statement. We don't have the numerical incrementing for statement common in C. Think of this like a foreach statement.</p>
	<p class="Stepnonumbering">Finally, we have our instantiations and they are initialized to default values.</p>


		<h1><a name="T4">Exercise 4: Basic Functionality in Voice Browsing</a></h1>
	<p class="Body">At this point, you have learned enough to put together a basic application that combines the 
	previous features. In <strong>Exer4.py</strong>, we have the code for a voice-controlled web browser with 
	significant modifications.</p>

<h3><a name="T4.1.1"></a>Task 1: Class Abstraction and Integration</h3>
	<ol>
		<li>
		<p class="Step">There is virtually nothing new here. We are expanding on our previous exercises to 
		include two classes with more methods. We are also doing text input and output, albeit with no error 
		checking. The only difficult part at this point may be finding the right methods and members for all the different classes. MSDN should be a constantly referenced site when developing .NET apps.&nbsp;
		<b>Please see Exer4.py for the source to this exercise.</b></p>
		</li>
	</ol>

</div>

</body>

</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <title>IronPython Windows Forms Tutorial</title>
  <link rel="stylesheet" type="text/css" href="../Samples.css">
  <style type="text/css">
.style1 {
	font-size: x-large;
}
</style>
</head>
<body lang="EN-US">
<div class="Section1">
<p class="Title1">IronPython Windows Forms Tutorial</p>
<p class="style1">From Empty Window to MapPoint Client</p>
<p class="Title2"><small><small><small>Contributor: Martin Schray</small></small>
</small><br>
</p>
<hr>
<p class="CopyrightText">Information in this document is subject to
change without notice. The example companies, organizations, products,
people, and events depicted herein are fictitious. No association with
any real company, organization, product, person or event is intended or
should be inferred. Complying with all applicable copyright laws is the
responsibility of the user. Without limiting the rights under
copyright, no part of this document may be reproduced, stored in or
introduced into a retrieval system, or transmitted in any form or by
any means (electronic, mechanical, photocopying, recording, or
otherwise), or for any purpose, without the express written permission
of Microsoft Corporation.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="CopyrightText">Microsoft may have patents, patent
applications, trademarked, copyrights, or other intellectual property
rights covering subject matter in this document. Except as expressly
provided in any written license agreement from Microsoft, the
furnishing of this document does not give you any license to these
patents, trademarks, copyrights, or other intellectual property.</p>
<p class="CopyrightText">
&nbsp;</p>
<p class="CopyrightText">&copy; Microsoft Corporation. All rights
reserved.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="CopyrightText">Microsoft, MS-DOS, MS, Windows, Windows NT,
MSDN, Active Directory, BizTalk, SQL Server, SharePoint, Outlook,
PowerPoint, FrontPage, Visual Basic, Visual C++, Visual J++, Visual
InterDev, Visual SourceSafe, Visual C#, Visual J#,&nbsp; and Visual
Studio are either registered trademarks or trademarks of Microsoft
Corporation in the U.S.A. and/or other countries.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="CopyrightText">Other product and company names herein may be
the trademarks of their respective owners.</p>
<hr>
<p class="CopyrightText">
&nbsp;</p>
<p class="CopyrightText">This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
    copy of the license can be found in the License.html file at the root of this distribution. If 
    you cannot locate the  Apache License, Version 2.0, please send an email to
    ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
    by the terms of the Apache License, Version 2.0.</p>
<p class="CopyrightText">&nbsp;</p>
<p class="Body">&nbsp;</p>
<p class="contentsheading"> Prerequisites</p>
<p class="body"> The prerequisites to successfully run this application
are:</p>
<ul>
	<li class="normal">IronPython 2.6 distribution
	<ul>
		<li>If you are new to IronPython, please go over the tutorial
that comes with this distribution</li>
		<li>Download from 
		<a href="http://ironpython.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12482">here</a></li>
	</ul>
	</li>
</ul>
	<p class="Body">&nbsp;</p>
<p class="ContentsHeading">Contents</p>
<p class="Toc1">Tutorial 1: <a href="#T1">Building Windows Forms
applications</a></p>
<p class="Toc2">Exercise 1: <a href="#T1.1">Building Interesting
Windows Forms Applications</a></p>
<p class="Toc3">Task 1: <a href="#T1.1.1">Create an Empty Windows
Forms Application</a></p>
<p class="Toc3">Task 2: <a href="#T1.1.2">Add Controls to a Windows
Forms Application</a></p>
<p class="Toc3">Task 3: <a href="#T1.1.3">Add Controls that Work
Together</a></p>
<p class="Toc3">Task 4: <a href="#T1.1.4">Add Non-visible Components
to the Form</a></p>
<p class="Toc3">Task 5: <a href="#T1.1.5">Use Layout Panels to
Automatically Layout Controls</a></p>
<p class="Toc3">Task 6: <a href="#T1.1.5">Add a Web Browser to the Form</a></p>
<p class="Toc3">Task 7: <a href="#T1.1.7">Displaying a Map Picture
with Data from MapPoint</a></p>
<p class="Toc3">Task 8: <a href="#T1.3.2">Add Route-finding to the Map
Application</a></p>
<p class="Body">&nbsp;</p>
<p class="Body">&nbsp;</p>
</div>
<h1><a name="T1">Tutorial 1: Building Windows Forms Applications</a></h1>
<p class="Body">In this tutorial we interactively build a Windows
Form.&nbsp; We will look at eight Windows Forms Applications that
progress from a Windows Form window with just a title to an application
that uses the MapPoint web service.&nbsp; We will discuss the Windows
Forms code so that you understand within each task what the IronPython
code is doing.&nbsp; However, though the applications are relatively
small, there's enough code that you won't want to type it into the
IronPython console.&nbsp; Each task will simply direct you to run the
application from a Windows cmd.exe window, as you would launch any
Python script.</p>
<p class="Body">Estimated time to complete this tutorial: <b>40 minutes</b></p>
<p class="Body">The objective of this tutorial is to familiarize you
with more Windows Forms features using IronPython.</p>
<ul>
  <li>
    <p class="Body"><a href="#T1.1">Building Interesting Windows Forms
Applications</a></p>
  </li>
</ul>
<h2><a name="T1.1">Exercise 1: Building Interesting Windows Forms
Applications</a></h2>
<p class="Body">The goal of this exercise is to provide some simple
examples of IronPython Windows Forms applications.&nbsp; The first few
tasks will be quite simple and lack any real sophistication, but
provide the building blocks for building more complete UI as you
progress through the tasks.&nbsp; Some of the tasks build on the code
from previous tasks, but each task provides full source code and is
meant to run as a complete example. </p>
<p class="Body">The tasks that use MapPoint Web Services require the
MapPointWebServicesProject.dll.&nbsp; Task 7 contains an extra step
that tells you how to build this DLL.</p>
<p class="Body">&nbsp;</p>
<h3><a name="T1.1.1">Task 1: Create an Empty Windows Forms Application
(FormV1.py)</a></h3>
<p class="Body">Task 1 creates an empty Windows form and sets the
window title of the form.&nbsp; The first three lines of code are the
required imports.&nbsp; We need to add a reference to
System.Windows.Forms, and then we can import all the names from it into
our module.</p>
<p class="Body">The class FormV1 inherits from
System.Windows.Forms.Form, so that it has all the default behaviors of
a form.&nbsp; The __init__ method is used to set the forms window
title.&nbsp; Finally, we invoke Application.Run to launch our form into
action. </p>
<p class="Body">&nbsp;</p>
<p class="Code-Highlighted">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
from System.Windows.Forms import *<br>
<br>
&nbsp;&nbsp;&nbsp; class FormV1(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Text = 'Hello World'<br>
<br>
Application.Run(FormV1())</p>
<p class="Body">&nbsp;</p>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV1.py</p>
<p class="Step">Note, we're using the ipyw.exe executable instead of
the ipy.exe.&nbsp; Ipyw.exe launches the Windows Forms application and
returns control to the cmd.exe it was launched from since the Windows
Form application executes independently.</p>
<p class="Step">You should see the following window pop up on your
screen:</p>
<p class="Step">&nbsp;</p>
<p class="Step">
<img src="winforms/FormV1.jpg" border="0" height="300" width="300"></p>
<p class="Body">&nbsp;</p>
<h3>Task 2: <a name="T1.1.2">Add Controls to A Windows Forms
Application (formV2.py)</a></h3>
<p class="Body">Task 2 creates a Windows form, sets the window title of
the form, adds our first control (a Button), and hooks up the Click of
the button to display a MessageBox when the Button is clicked.&nbsp; We
show the new lines of code highlighted below.&nbsp; As in the previous
task, the first three lines of code are the required imports.&nbsp; We
need to add a reference to System.Windows.Forms, and then we can import
from it to bring all the names from that module into ours.</p>
<p class="Body">The class FormV2 inherits from
System.Windows.Forms.Form, so that it has all the default behaviors of
a form.&nbsp; The __init__ method is used set up instances of our
form.&nbsp; First we set the Form's title (self.Text).</p>
<p class="Body">Now for the new code.&nbsp; We create a Button with the
text 'Message', and we set its location.&nbsp; Third we hook the
Button's Click event so that when the button is clicked the
OnMsgButtonClick method is called.&nbsp; Then we add the Button to the
form's list of controls.</p>
<p class="Body">Next we define OnMsgButtonClick, which takes two
arguments.&nbsp; OnMsgButtonClick simply calls MessageBox.Show to show
a classic message box pop up.</p>
<p class="Body">Lastly, we invoke Application.Run to launch our form
into action.</p>
<p class="Body">&nbsp;</p>
<p class="Code-Background">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
from System.Windows.Forms import *<br>
<br>
&nbsp;&nbsp;&nbsp; class FormV2(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Text = 'Hello World'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton = Button(Text='Message', Left =20, Top=20)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton.Click += self.OnMsgButtonClick<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(msgButton)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def OnMsgButtonClick(self,
*args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show("Hello World")<br>
&nbsp;</p>
<p class="Code-Background">Application.Run(FormV2())</p>
<p class="Body">&nbsp;</p>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV2.py</p>
<p class="Step"><br>
</p>
<p class="Step">You should see the following window pop up on your
screen:</p>
<p class="Body">&nbsp;</p>
<p class="Body">
<img src="winforms/FormV2.jpg" border="0" height="300" width="300"></p>
<p class="Body">&nbsp;</p>
<p class="Body">When you click the Button, you will see the following
window:</p>
<p class="Body">
<img src="winforms/FormV2-1.jpg" border="0" height="107" width="104"></p>
<p class="Body">&nbsp;</p>
<h3>Task 3:&nbsp; <a name="T1.1.3">Add Controls that Work Together
(formV3.py)</a></h3>
<p class="Body">Task 3 creates a Windows form, sets the window title of
the form, adds a Label, Textbox, and a Button.&nbsp; We hook up the
Click of the button to display a MessageBox when the Button is clicked,
but in this task we use the text from the Textbox.&nbsp; As in the
previous tasks, the first three lines of code are the required
imports.&nbsp; We need to add a reference to System.Windows.Forms, and
then we can import from it to bring all the names from that module into
ours.</p>
<p class="Body">The class FormV3 inherits from
System.Windows.Forms.Form so that it has all the default behaviors of a
form.&nbsp; The __init__ method is used to set up instances of our
form.&nbsp; First we set the Form's title (self.Text).</p>
<p class="Body">Now for the new code (highlighted below).&nbsp; We
create a Label and add it to the form's controls.&nbsp; Then we create
a TextBox, and set its location before adding it to the form's
controls.&nbsp; A reference (self.txtMessage) to the TextBox is kept so
that in OnMsgButtonClick we can get the Text from the TextBox.</p>
<p class="Body">As before, we create a Button with the text
'Message'.&nbsp; We make it visible and set its location (which is
slightly lower down in the form in this task).&nbsp; We hook the
Button's Click event up so that when the button is clicked the
OnMsgButtonClick method is called.&nbsp; Then we add the Button to the
form's list of controls. </p>
<p class="Body">Next we define OnMsgButtonClick, which takes two
arguments.&nbsp; OnMsgButtonClick simply calls MessageBox.Show to
display the text in the TextBox in a classic message box pop up.</p>
<p class="Body">Lastly, we invoke Application.Run to launch our form. </p>
<p class="Body">&nbsp;</p>
<p class="Code-Background">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
from System.Windows.Forms import *<br>
<br>
&nbsp;&nbsp;&nbsp; class FormV3(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Text = 'Hello World'</p>
<p class="Code-Background">&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# Create Label<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(Label(Text='Enter Message:'))</p>
<p class="Code-Highlighted">&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# Create TextBox<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.txtMessage = TextBox(Left=100)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(self.txtMessage)</p>
<p class="Code-Highlighted">&nbsp;</p>
<p class="Code-Background">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# Create Button<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton = Button(Text='Message', Left =20, Top=25)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton.Click += self.OnMsgButtonClick<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(msgButton)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def OnMsgButtonClick(self,
*args):</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show(self.txtMessage.Text,"Message")<br>
&nbsp;</p>
<p class="Code-Background">Application.Run(FormV3())</p>
<p class="Body">&nbsp;</p>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV3.py</p>
<p class="Step"><br>
</p>
<p class="Step">You should see the following window pop up on your
screen:</p>
<p class="Body">&nbsp;</p>
<h3><img src="winforms/FormV3.jpg" border="0" height="300" width="300"></h3>
<p class="Body">&nbsp;</p>
<h3>Task 4:&nbsp; <a name="T1.1.4">Add Non-visible Components to the
Form (formV4.py)</a></h3>
<p class="Body">Task 4 has the same basic UI that task 3 had which was
a form with a Label, TextBox, and a Button.&nbsp; The difference is
that we begin to use non-visible components in task 4.&nbsp; Components
allow us to add objects that don't necessarily have a visual
representation.&nbsp; For example, a Timer is a component that doesn't
appear visibly on the form.&nbsp; In task 4 we will use a NotifyIcon to
allow our application to appear in the system tray and ContextMenuStrip
to give NotifyIcon a right-click menu.&nbsp; Our first few lines of
code now have a few additions since we need to access and import the
System.Drawing namespace.&nbsp; We need the System.Drawing namespace to
access the Icon class.&nbsp; The Icon class is used to associate an
icon file with our NotifyIcon.</p>
<p class="Body">The good news is that the code to set the form's title,
as well as create the Label, TextBox, and Button are the same as Task
3.&nbsp; Now let's get to the new code.&nbsp; Before we can add the
Components to our form we must create the components container to hold
them.&nbsp; Next we will create the ContextMenuStrip as well as the
ContextMenuItem and add them (the ContextMenuStrip holds
ContextMenuItems).&nbsp; Next we setup the ContextMenuItem's click
event to call the OnExitClick method, which will close our
application.&nbsp; Having setup the ContextMenuStrip and it's
ContextMenuItem, we turn our attention to the NotifyIcon.&nbsp; We
setup the NotifyIcon and associate the ContextMenuStrip with the
NotifyIcon.&nbsp; The OnMsgButtonClick method displays the text in the
TextBox just as in task 3.&nbsp; Next we define our OnExitClick method 
which closes the form to exit the application.&nbsp; This is followed by 
the definition of OnNotifyIconExit used to remove the notify icon after the 
application is closed. Lastly, we invoke Application.Run to launch our 
form into action. </p>
<blockquote>
  <p class="Code-Background">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
from System.Windows.Forms import *<br>
clr.AddReference("System.Drawing")<br>
from System.Drawing import *<br>
import System<br>
from System import *<br>
  <br>
&nbsp;&nbsp;&nbsp; class FormV4(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Text = 'Hello World'<br>
  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create Label<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(Label(Text='Enter Message:'))<br>
  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create TextBox<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.txtMessage = TextBox(Left=100)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(self.txtMessage)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create Button<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton = Button(Text='Message', Left =20, Top=25)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton.Click += self.OnMsgButtonClick<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(msgButton)<br>
&nbsp;</p>
  <p class="Code-Highlighted"> <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create Component Container <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._components = System.ComponentModel.Container()<br>
  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Add component - ContextMenu<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._contextMenuStrip1 = ContextMenuStrip(self._components)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._exitToolStripMenuItem = ToolStripMenuItem(Text='Exit')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._contextMenuStrip1.Items.Add(self._exitToolStripMenuItem)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._exitToolStripMenuItem.Click += self.OnExitClick<br>
  <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
add Component - NotifyIcon<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._notifyIcon1 =
NotifyIcon(self._components,Visible=True,Text='Test')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._notifyIcon1.Icon = Icon("Winforms\\app.ico")<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._notifyIcon1.ContextMenuStrip = self._contextMenuStrip1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Closed += self.OnNotifyIconExit<br>
&nbsp;</p>
  <p class="Code-Background"> <br>
&nbsp;&nbsp;&nbsp;&nbsp; def OnMsgButtonClick(self, *args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show(self.txtMessage.Text,"Message")<br>
&nbsp;</p>
  <p class="Code-Highlighted"> <br>
&nbsp;&nbsp;&nbsp;&nbsp; def OnExitClick(self, *args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.Close()<br><br>
&nbsp;&nbsp;&nbsp;&nbsp; def OnNotifyIconExit(self, *args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._notifyIcon1.Dispose()<br>
&nbsp;</p>
  <p class="Code-Background"> <br>
Application.Run(FormV4())<br>
&nbsp;</p>
</blockquote>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV4.py</p>
<p class="Step"><br>
</p>
<p class="Step">You should see the following window pop up on your
screen:</p>
<p class="Step">&nbsp;</p>
<p class="Body"><img src="WinForms/FormV4.jpg" border="0"></p>
<p class="Body">&nbsp;</p>
<p class="Step">Additionally you should see the following icon in your
system tray.&nbsp; If you place your mouse over the icon the text
'test' will appear.&nbsp; If you right click on the icon the context
menu will appear.&nbsp; Selecting 'Exit' will cause the application to
close.</p>
<span style="font-size: 12pt; font-family: 'Times New Roman',serif;">
<img src="WinForms/FormV4-1.JPG" border="0" height="45" width="60">&nbsp;&nbsp;&nbsp;&nbsp;
<img src="WinForms/FormV4-2.JPG" border="0" height="48" width="111"></span>
<p class="Body">&nbsp;</p>
<h3>Task 5:&nbsp; <a name="T1.1.5">Use Layout Panels to Automatically
Layout Controls (formV5.py)</a></h3>
<p class="Body">Task 5 has the same basic UI that task 4 had which was
a form with a Label, TextBox, and Button.&nbsp; Task 5 also includes
the NotifyIcon, ContextMenuStrip, and ContextMenuItem components.&nbsp;
The big change in task 5 is that we begin to use layout panels to make
it easier to layout controls.&nbsp; For example, in task 4 we had to go
through the effort of setting the location of the Label, TextBox, and
Button.&nbsp; Typically it takes some trial and error to make sure the
controls are placed correctly.&nbsp; Instead, we use a FlowLayoutPanel
to automatically place the controls.&nbsp; As the name implies the
controls are flowed as space allows.</p>
<p class="Body">The best way to illustrate this is an example.&nbsp;
Notice that in the image on the left below that there is not enough
room to display all the controls horizontally, so they are stacked to
fit vertically.&nbsp; In the image on the right below there is enough
space to horizontally place all the controls so the FlowLayout Panel
does so.&nbsp; So the FlowLayoutPanel can actually reposition controls
as the form resizes.&nbsp;&nbsp;&nbsp; </p>
<p class="Body">Other than the order in which the controls are created,
the only different lines of code from the previous task are creating
the FlowLayoutPanel and adding the controls to it.&nbsp; Also, we add
the FlowLayoutPanel to the Form's controls.</p>
<p class="Body">&nbsp;</p>
<p class="Body"><img src="WinForms/FormV5-1.jpg" border="0">&nbsp;&nbsp;&nbsp;
<img src="WinForms/FormV5-2.jpg" border="0" height="300" width="315"></p>
<p class="Body">&nbsp;</p>
<p class="Code-Background">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
clr.AddReference("System.Drawing")<br>
from System.Windows.Forms import *<br>
from System.Drawing import *<br>
import System<br>
from System import *<br>
<br>
&nbsp;&nbsp;&nbsp; class FormV5(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Text = 'Hello World'</p>
<p class="Code-Background">&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.txtMessage = TextBox()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton = Button(Text='Message')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
msgButton.Click += self.OnmsgButtonClick<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create FlowPanelLayout and add controls<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1 = FlowLayoutPanel(Dock = DockStyle.Fill)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(Label(Text='Enter Message:'))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self.txtMessage)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(msgButton)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(self._flowLayoutPanel1)<br>
&nbsp;</p>
<p class="Code-Background">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._components = System.ComponentModel.Container()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Add component - ContextMenu<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._contextMenuStrip1 = ContextMenuStrip(self._components)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._exitToolStripMenuItem = ToolStripMenuItem(Text='Exit')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._exitToolStripMenuItem.Click += self.OnExitClick<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._contextMenuStrip1.Items.Add(self._exitToolStripMenuItem)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
add Component - NotifyIcon<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._notifyIcon1 =
NotifyIcon(self._components,Visible=True,Text='Test')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._notifyIcon1.Icon = Icon("Winforms\\app.ico")<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._notifyIcon1.ContextMenuStrip = self._contextMenuStrip1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Closed += self.OnNotifyIconExit<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def OnmsgButtonClick(self,
*args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show(self.txtMessage.Text,"Message")<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def OnExitClick(self, *args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Close()<br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def OnNotifyIconExit(self, *args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._notifyIcon1.Dispose()<br></p>
<p class="Code-Background">
<br>
Application.Run(FormV5())<br>
<br>
&nbsp;</p>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV5.py</p>
<p class="Step">&nbsp;</p>
<h3>Task 6:&nbsp; <a name="T1.1.6">Add a Web Browser to the Form
(formV6.py)</a></h3>
<p class="Step">Task 6 takes our basic form with a Label, TextBox, and
a Button, but now we add a WebBrowser control to make a very simple web
browser.&nbsp; Continuing on the theme from task 5, we want to build an
application with a sophisticated UI with little work to position
controls.</p>
<p class="Step">We will introduce a TabelLayoutPanel that will allow
the area of the application containing the Label, TextBox, and Button
to stay roughly the same size while allowing the web browser to fill up
any remaining space in the form.&nbsp; The TableLayoutPanel allows the
form to be broken up into rows and columns.&nbsp; The __init__ method
starts with the creation all of the controls -- first the
TableLayoutPanel and FlowLayout Panel, followed by the WebBrowser,
Label, TextBox, and Button.&nbsp; We set the TextBox's size to allow
for a lengthier URL to be entered.</p>
<p class="Step">We introduce the StatusStrip at the bottom of the form
where status information can be displayed.&nbsp; Within the StatusStrip
a StatusStripLabel is created so that text information can be
displayed.&nbsp; The StatusStripLabel will be used to display the URL
of the site being displayed in the web browser.</p>
<p class="Step">Next the form's AcceptButton is set so that if the user
hits enter, the button will be clicked.</p>
<p class="Step">We set the rows and columns for the TableLayoutPanel
and add controls to it.&nbsp; We add the appropriate controls to the
FlowLayoutPanel.</p>
<p class="Step">The OnMsgButtonClick method will be called in response
to a button click.&nbsp; This method causes the URL supplied in the
TextBox to be loaded.&nbsp; It displays the value in the TextBox that
is in the StatusStripLabel, and the method clears the TextBox.</p>
<p class="Code-Background">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
clr.AddReference("System.Drawing")<br>
from System.Windows.Forms import *<br>
from System.Drawing import *<br>
import System<br>
from System import *<br>
<br>
&nbsp;&nbsp;&nbsp; class FormV6(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):</p>
<p class="Code-Background">&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# setup TableLayoutPanel and FlowLayoutPanel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1 = TableLayoutPanel(ColumnCount = 1,RowCount =
2, Dock = DockStyle.Fill)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1 = FlowLayoutPanel(Dock = DockStyle.Fill)<br>
&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._webBrowser = WebBrowser(Dock = DockStyle.Fill)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._label1 = Label(Text ='Enter Message')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._txtMessage = TextBox(TabIndex = 0,Size = Size(200,20))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._button1 = Button(Text ='Message')<br>
&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# Setup ToolStrip and ToolStripLabel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._StatusStrip1 = StatusStrip()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._ToolStripStatusLabel1 = ToolStripStatusLabel()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._StatusStrip1.Items.Add(self._ToolStripStatusLabel1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(self._StatusStrip1)<br>
&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.AcceptButton = self._button1&nbsp;&nbsp; # when the enter key is
pressed self._button1 will be clicked<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._button1.Click += self.OnmsgButtonClick<br>
&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# Set TableLayoutPanel column and row styles and add FlowLayoutPanel
and Web Browser</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.ColumnStyles.Add(ColumnStyle(SizeType.Percent,
100.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.RowStyles.Add(RowStyle(SizeType.Absolute, 80.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.RowStyles.Add(RowStyle(SizeType.Percent, 100.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.Controls.Add(self._flowLayoutPanel1, 0, 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.Controls.Add(self._webBrowser, 0, 1)<br>
&nbsp;</p>
<p class="Code-Highlighted">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# add controls that will be contained in FlowLayoutPanel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._label1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._txtMessage)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._button1)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(self._tableLayoutPanel1)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def OnmsgButtonClick(self,
*args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._webBrowser.Navigate(self._txtMessage.Text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._ToolStripStatusLabel1.Text = self._txtMessage.Text<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._txtMessage.Text = ""<br>
&nbsp;</p>
<p class="Code-Background">
<br>
Application.Run(FormV6())</p>
<p class="Body"><br>
&nbsp;</p>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV6.py</p>
<p class="Step"><br>
</p>
<p class="Step">You should see the following window pop up on your
screen.&nbsp; If you type in a valid URL and hit enter, the web browser
control displays the selected web page.</p>
<p class="Step">&nbsp;</p>
<p class="Body"><img src="WinForms/FormV6-1.jpg" border="0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<img src="WinForms/FormV6.jpg" border="0"></p>
<p class="Body">&nbsp;</p>
<h3>Task 7:&nbsp; <a name="T1.1.7">Displaying a Map Picture with Data
from MapPoint (formV7.py)</a></h3>
<p class="Step">Task 7 takes our basic form with a Label, TextBox, and
a Button, but now we add a PictureBox control.&nbsp; We will leverage
the approach from Task 6 and use a TableLayoutPanel and FlowLayoutPanel
to make laying out our form easy.&nbsp; We will use the PictureBox to
display a map.&nbsp; The user will enter a landmark or address in the
TextBox, and we will use MapPoint Web Services to render a map of that
location.&nbsp; We will be using a C# assembly named
MapPointWebServiceProject.dll to provide access to MapPoint Web
Services.&nbsp; </p>
<blockquote>
  <p class="Step">MapPointWebServiceProject.dll has already been built for you, 
  but you are more than welcome to rebuild it.&nbsp; To build this DLL,
  open a command prompt and run &quot;%WINDIR%\Microsoft.NET\Framework\v3.5\MSBuild 
  /p:configuration=Release MapPointWebServiceProject.sln&quot; from the winformsmappoint\winforms\ 
  directory.&nbsp;
  Next simply copy winformsmappoint\winforms\bin\release\mappointwebservicesproject.dll to the winformsmappoint\ directory.</p>
</blockquote>
<p class="Step">This task and the next contact Microsoft MapPoint servers 
remotely.&nbsp; Information sent to the MapPoint servers include a username and 
password along with your IP address and the text entered into the TextBox in the 
sample interface.&nbsp; No information is sent remotely until the user clicks on 
the &quot;Get map&quot; button or presses the enter key at which point the aforementioned 
data will be sent via SOAP over HTTP, which is not encrypted in any way.</p>
<p class="Step"><strong>We will be using a MapPoint UserID of 5200 and password
of "ned68Fe".&nbsp; You can find info on applying for your own MapPoint Web Service
account here <a href="http://www.microsoft.com/mappoint/en-us/default.aspx">
http://www.microsoft.com/mappoint/en-us/default.aspx</a></strong>.</p>
<p class="Step">The first few lines of are the same as most of the
previous examples.&nbsp; We add a reference to the
MapPointWebServiceProject.dll so that we can use it inside our program
and add the appropriate imports so we can use the classes in
MapPointWebServiceProject as well as the underlying classes the
MapPoint Web Services expose (such as Location and Route).&nbsp; </p>
<p class="Step">Next we create the TabelLayoutPanel and FlowLayoutPanel
as well as creating the required controls such as Label, TextBox and
Button.&nbsp; We setup the row and column characteristics for the
TableLayoutPanel and add the controls to it.&nbsp; Then we add the
controls to the FlowLayoutPanel.</p>
<p class="Step">All of the event handling is done in
OnMsgButtonClick.&nbsp; When the button is pressed we create the
MapPointWebServiceHelper by calling
MapPointWebServiceHelper.GetInstance and pass it our UserID and password.&nbsp; Please note that when writing your own scripts <span
 style="font-weight: bold;">you should never hard code usernames or
passwords</span>. We attempt to find a location using the
MapPointWebServiceHelper.FindLocation method.&nbsp; If we are
successful we call the MapPointWebServiceHelper.GetMap method and
display the map.&nbsp; If the location can't be found we display a
message stating we couldn't find the location.&nbsp; Finally we call
application run to initiate the application.</p>
<p class="Code-Background">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
clr.AddReference("System.Drawing")<br>
from System.Windows.Forms import *<br>
from System.Drawing import *<br>
import System<br>
from System import *<br>
&nbsp;</p>
<p class="Code-Background">clr.AddReferenceToFile("MapPointWebServiceProject.dll")<br>
from MapPointWebServiceProject import *<br>
from MapPointWebServiceProject.net.mappoint.staging import *<br>
<br>
<br>
&nbsp;&nbsp;&nbsp; class FormV7(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create TableLayoutPanel and FlowLayoutPanel <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1 = TableLayoutPanel(ColumnCount = 1,Dock =
DockStyle.Fill,RowCount = 2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1 = FlowLayoutPanel(Dock = DockStyle.Fill)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create Controls<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._pictureBox1 = PictureBox(Dock = DockStyle.Fill)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._label1 = Label(Text ='Enter location:',AutoSize=True)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._txtLocation = TextBox()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._button1 = Button(Text ='Get map',AutoSize=True)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Setup TableLayoutPanel rows and columns and add controls<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.ColumnStyles.Add(ColumnStyle(SizeType.Percent,
100.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.RowStyles.Add(RowStyle(SizeType.Absolute, 45.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.RowStyles.Add(RowStyle(SizeType.Percent, 100.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.Controls.Add(self._flowLayoutPanel1, 0, 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.Controls.Add(self._pictureBox1, 0, 1)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Add controls to FlowLayoutPanel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._label1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._txtLocation)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._button1)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.AcceptButton = self._button1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._button1.Click += self.OnMsgButtonClick<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(self._tableLayoutPanel1)<br>
<br>
&nbsp;&nbsp;&nbsp; def OnMsgButtonClick(self, *args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try:</p>
<p class="Code-Background">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mapHelper = MapPointWebServiceHelper.GetInstance("5200", "ned68Fe")<br>
&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; loc
= mapHelper.FindLocation(self._txtLocation.Text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if
loc:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._pictureBox1.Image = mapHelper.GetMap(loc,
self._pictureBox1.Width, \</p>
<p class="Code-Background">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._pictureBox1.Height, 4.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show("Address or location is not valid","Invalid Location")<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except Exception, e:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show(e.Message,"MapPoint Exception")<br>
&nbsp;</p>
<p class="Code-Background">Application.Run(FormV7())<br>
&nbsp;</p>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV7.py</p>
<p class="Step">You should see the following window pop up on your
screen.&nbsp; If you type well known landmarks (Sears Tower, Navy Pier)
or a valid address, then a map will be rendered.&nbsp; If you expand or
contract the form and hit the Get Map button, the map will update to
fit within the allocated space.</p>
<p class="Step">&nbsp;</p>
<p class="Body"><img src="WinForms/FormV7-1.jpg" border="0">&nbsp;&nbsp;&nbsp;&nbsp;
<img src="WinForms/FormV7-2.jpg" border="0">&nbsp;&nbsp;</p>
<p class="Body">&nbsp;</p>
<p class="Body">&nbsp;<img src="WinForms/FormV7-3.jpg" border="0"></p>
<h3>Task 8:&nbsp; <a name="T1.1.8">Add Route-finding to the Map
Application (formV8.py)</a></h3>
<p class="Step">Task 8 takes our task 7 and expands it by allowing us
to specify start and end locations, and then generate a route
map.&nbsp; We will leverage previous tasks and use a TableLayoutPanel
and FlowLayoutPanel to make laying out our form easy.&nbsp; We will use
the PictureBox to display a map.&nbsp; </p>
<p class="Step">NOTE: See Task 7 to build and set up the
MapPointWebServiceProject.dll for this task.&nbsp; If you performed
task 7, you're fine to proceed.</p>
<p class="Step">Like task 7, this task contacts Microsoft MapPoint servers 
remotely.&nbsp; Information sent to the MapPoint servers include a username and 
password along with your IP address and the text entered into the TextBoxes in 
the sample interface.&nbsp; No information is sent remotely until the user 
clicks on the &quot;Get map&quot; button or presses the enter key at which point the 
aforementioned data will be sent via SOAP over HTTP, which is not encrypted in 
any way.</p>
<p class="Step">The first few lines of Task 8 are the same as most of
the previous examples.&nbsp; We add a reference to the
MapPointWebServiceProject.dll so that we can use it inside our
program.&nbsp; Then we add the appropriate Python import statements so
we can use the classes in MapPointWebServiceProject.dll and classes the
MapPoint Web Services exposes (such as Location and Route).&nbsp; </p>
<p class="Step">Next we create the TabelLayoutPanel and two
FlowLayoutPanel's.&nbsp; The first FlowLayoutPanel is for the control
related to specifying the starting location.&nbsp; The second
FlowLayoutPanel is for the Label, TextBox, and Button used to specify
the ending location.&nbsp; We setup the row and column characteristics
for the TableLayoutPanel and add the controls to it.&nbsp; Then we add
the appropriate controls to our two FlowLayoutPanels.</p>
<p class="Step">All of the event handling is done within
OnMsgButtonClick.&nbsp; When the button is pressed we create the
MapPointWebServiceHelper by calling
MapPointWebServiceHelper.GetInstance and pass it our UserID and
password.&nbsp; We will be using a MapPoint UserID of 5200 and password
of "ned68Fe".&nbsp; Please note that when writing your own scripts <span
 style="font-weight: bold;">you should never hard code usernames or
passwords</span>.&nbsp; You can find out how to apply for your own MapPoint Web Service
account here <a href="http://www.microsoft.com/mappoint/en-us/default.aspx">
http://www.microsoft.com/mappoint/en-us/default.aspx</a>.&nbsp;
We attempt to find our starting location using the
MapPointWebServiceHelper.FindLocation method.&nbsp; Next we attempt to
find our ending location by calling the
MapPointWebServiceHelper.FindLocation method again.&nbsp; If a location
can't be found, the helper class throws an exception, which we handle
by displaying a message.&nbsp; If both locations are found, then we
will call MapPointWebServiceHelper.GetRouteMap to get our route
map.&nbsp; If we are successful, we will display a route map, and if
not, an error message is displayed.</p>
<p class="Step">Finally, we call application run to initiate the
application.</p>
<p class="Step">&nbsp;</p>
<p class="Code-Background">import clr<br>
clr.AddReference("System.Windows.Forms")<br>
clr.AddReference("System.Drawing")<br>
from System.Windows.Forms import *<br>
from System.Drawing import *<br>
import System<br>
from System import *<br>
&nbsp;</p>
<p class="Code-Background">clr.AddReferenceToFile("MapPointWebServiceProject.dll")<br>
from MapPointWebServiceProject import *<br>
from MapPointWebServiceProject.net.mappoint.staging import *<br>
<br>
<br>
&nbsp;&nbsp;&nbsp; class FormV8(Form):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def __init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Create TableLayoutPanel and FlowLayoutPanel <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1 = TableLayoutPanel(ColumnCount = 1,Dock =
DockStyle.Fill,RowCount = 3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1 = FlowLayoutPanel(Dock = DockStyle.Fill)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel2 = FlowLayoutPanel(Dock = DockStyle.Fill)<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
controls for FlowLayout Start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._label1 = Label(Text ='Enter start location:',AutoSize=True)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._txtFromLocation = TextBox()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
controls for FlowLayout End<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._label2 = Label(Text ='Enter end location:',AutoSize=True)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._txtToLocation = TextBox()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._button1 = Button(Text ='Get map',AutoSize=True)<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
this will hold our route map<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._pictureBox1 = PictureBox(Dock = DockStyle.Fill)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Setup TableLayoutPanel rows and columns and add controls<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.ColumnStyles.Add(ColumnStyle(SizeType.Percent,
100.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.RowStyles.Add(RowStyle(SizeType.Absolute, 40.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.RowStyles.Add(RowStyle(SizeType.Absolute, 60.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.RowStyles.Add(RowStyle(SizeType.Percent, 100.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.Controls.Add(self._flowLayoutPanel1, 0, 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.Controls.Add(self._flowLayoutPanel2, 0, 1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._tableLayoutPanel1.Controls.Add(self._pictureBox1, 0, 2)<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Add controls to FlowLayoutPanel Start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._label1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel1.Controls.Add(self._txtFromLocation)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #
Add controls to FlowLayoutPanel End<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel2.Controls.Add(self._label2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel2.Controls.Add(self._txtToLocation)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._flowLayoutPanel2.Controls.Add(self._button1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.AcceptButton = self._button1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._button1.Click += self.OnMsgButtonClick<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self.Controls.Add(self._tableLayoutPanel1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def OnMsgButtonClick(self,
*args):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
mapHelper = MapPointWebServiceHelper.GetInstance("5200", "ned68Fe")<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
locFrom = mapHelper.FindLocation(self._txtFromLocation.Text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
locTo = mapHelper.FindLocation(self._txtToLocation.Text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
myRoute = mapHelper.GetRoute(locFrom, locTo)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
self._pictureBox1.Image = mapHelper.GetRouteMap(myRoute,
self._pictureBox1.Width, self._pictureBox1.Height)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except Exception, e:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MessageBox.Show(e.Message,"MapPoint Exception")<br>
<br>
Application.Run(FormV8())<br>
&nbsp;</p>
<p class="Step">1. Now let's try the Windows Form application by
launching the IronPython script from a cmd.exe window:</p>
<p class="TypedExample">ipyw.exe winforms\formV8.py</p>
<p class="Step">Note, please be patient as there are four web service
calls.&nbsp; After clicking get map it takes a little time to render
the map.&nbsp; </p>
<p class="Step">You should see the following window pop up on your
screen.&nbsp; If you type a well known landmark (Sears Tower, Navy
Pier) or a valid address for the start and end locations, then a route
map will be rendered.&nbsp; If you expand or contract the form and hit
the Get Map button, the map will update to fit within the allocated
space.</p>
<p class="Step">&nbsp;</p>
<p class="Body"><img src="WinForms/FormV8-1.jpg" border="0">&nbsp;&nbsp;
<img src="WinForms/FormV8-2.jpg" border="0">&nbsp;&nbsp;&nbsp;</p>
<p class="Body">&nbsp;</p>
<p class="Body">&nbsp;<img src="WinForms/FormV8-3.jpg" border="0"></p>
<p class="Body">&nbsp;</p>
<p class="Body">&nbsp;</p>
<p class="LabSummary">Tutorial Summary</p>
<p class="Normal">In this tutorial you learned more about building
Windows Forms applications using IronPython.&nbsp; You started with the
most basic Winforms application - an empty form with the title set -
and progressed through a series of samples that showed how to build
increasingly more complex Winforms user interfaces via
IronPython.&nbsp; You learned that even sophisticated GUIs could be
easily developed using basic controls such as Label, TextBox, Button,
PictureBox in conjunction with advanced layout controls like
TableLayoutPanel and FlowLayoutPanel.</p>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 2, revision: 4, date: new Date("Jun 19, 2007"), extensions: {}};
//]]>
</script>
<!--
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2007

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>
<!--}}}-->
<!--PRE-HEAD-END-->
<title> IronRuby Docs - Developer documentation for Microsoft IronRuby </title>
<style type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges(); if(window.scrubNodes) scrubNodes(document.body);">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
	<div id="javascriptWarning">This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background::[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity:60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0em 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0em 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0em 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 .3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0em 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0em 0em 0em; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0em;}
.wizardFooter .status {padding:0em 0.4em 0em 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em 0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0em; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em 0.2em 0.2em 0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em 0.2em 0.2em 0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em 1em 1em 1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0em;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0em 0em 0.5em;}
.tab {margin:0em 0em 0em 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0em 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0em 1em;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0em 0.25em; padding:0em 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0em; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px 1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0em; right:0em;}
#backstageButton a {padding:0.1em 0.4em 0.1em 0.4em; margin:0.1em 0.1em 0.1em 0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; margin:0em 3em 0em 3em; padding:1em 1em 1em 1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em 0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which use a logographic writing system and need larger font sizes.
***/

/*{{{*/
body {font-size:0.8em;}

#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}

.subtitle {font-size:0.8em;}

.viewer table.listView {font-size:0.95em;}

.htmlarea .toolbarHA table {border:1px solid ButtonFace; margin:0em 0em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton {display: none ! important;}
#displayArea {margin: 1em 1em 0em 1em;}
/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
noscript {display:none;}
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar closeTiddler closeOthers +editTiddler &gt; fields syncing permalink references jump'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler deleteTiddler'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:
* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* MainMenu: The menu (usually on the left)
* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These InterfaceOptions for customising TiddlyWiki are saved in your browser

Your username for signing your edits. Write it as a WikiWord (eg JoeBloggs)

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; SaveBackups
&lt;&lt;option chkAutoSave&gt;&gt; AutoSave
&lt;&lt;option chkRegExpSearch&gt;&gt; RegExpSearch
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; CaseSensitiveSearch
&lt;&lt;option chkAnimate&gt;&gt; EnableAnimations

----
Also see AdvancedOptions</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="AddAMethod" modifier="JohnLam" modified="200707190023" created="200707182349" changecount="3">
<pre>!Implementation

Let's add a {{{downcase}}} method to the MutableString class. This is the simplest kind of method - it accepts no parameters and returns a MutableString.

MutableString lives in Ruby\Builtins\MutableString.cs. Its unit tests live in Tests\Builtins\String\test_string.rb. Here's one possible implementation of this method:

{{{
[RubyMethodAttribute(&quot;downcase&quot;, RubyMethodAttributes.PublicInstance)]
public static MutableString DownCase(MutableString str) {
    MutableString result = new MutableString(str);
    DownCaseMutableString(result);
    return result;
}
}}}

Notice that the method is a _static_ method. DLR provides its own version of C#
3.0's ExtensionMethods. In library code, all methods are implemented as ''static''
methods on the type, particularly if its on a type that we define (which is the case with MutableString). 

If it's a type that we don't define, such as Int32, we define our extension
methods in a class that has the suffix &quot;Ops&quot; attached to the name. In the case
of Int32, which is really a Ruby Fixnum type, our extension methods are
implemented in a type called FixnumOps.

Notice that we have attached a RubyMethodAttribute to this class. This attribute
defines the Ruby-callable name of the method since Ruby supports method names
that are illegal in C#, such as &quot;downcase!&quot;. The RubyMethodAttributes
enumeration defines the instancing and visibility of the method; in this case we
are defining a public instance method on the String type.

!Unit Tests

Next, we have to implement the unit tests. In this early implementation of
IronRuby, we support a simple form of RSpec tests. The testing framework can be
found in Ruby\Tests\Util\simple_test.rb. Here's an implementation of the tests:

{{{
describe &quot;String#downcase&quot; do
  it &quot;returns a copy of self with all uppercase letters downcased&quot; do
    &quot;hELLO&quot;.downcase.should == &quot;hello&quot;
    &quot;hello&quot;.downcase.should == &quot;hello&quot;
  end
  
  it &quot;is locale insensitive (only replacing A-Z)&quot; do
    &quot;&quot;.downcase.should == &quot;&quot;
  end
end
}}}

Next up, lets define a method that AcceptsParameters.
</pre>
</div>
<div title="CodingStandards" modifier="JohnLam" modified="200707192257" created="200707192056" changecount="8">
<pre>IronRuby uses four-space indentation. Tabs must be expanded as spaces. No exceptions.

Public names are subject to FxCop rules.

!!Private class member variables start with underscore _:

{{{
class MyClass {
    private string _name;
    public MyClass(string name) {
        _name = name;
    }
}
}}}

!!Static variable names start with underscore followed by upper case letter:

{{{
_StaticVar
}}}

!!Open brace on same line as code:

{{{
if (true) {
  DoSomething();
}
}}}

!!Member variables should be declared at the top of a class declaration:

{{{
class MyClass {
    private string _name;
    public MyClass(string name) {
        _name = name;
    }
    // Additional Code Here
    public string Name {
        get { return _name; }
        set { _name = value; }
    }
}
}}}

Not:

{{{
class MyClass {
    public MyClass(string name) {
        _name = name;
    }
      // Additional Code Here
    private string _name;
    public string Name {
        get { return _name; }
        set { _name = value; }
    }
}
}}}

IronRuby uses uniform formatting of the C# code. Set your editor to use the IronRuby.vssettings file to set handling of tabs and formatting of the code. This file is located in the root directory of the IronRuby project.

To use the team settings in Visual Studio, go to Tools-&gt;Options Expand the Environment node, select Import and Export Settings. Check the Use team settings file and browse to the &quot;IronRuby.vssettings file located in your workspace.</pre>
</div>
<div title="CompileSources" modifier="JohnLam" created="200707230557" changecount="1">
<pre>You can compile IronRuby by running {{build.cmd}} from the root directory of your IronRuby source distribution. You must have the .NET 2.0 Framework redistributable installed, since the build scripts rely on MSBuild.

This will generate a release mode build of IronRuby in the \bin\release directory of your source distribution.</pre>
</div>
<div title="DefaultTiddlers" modifier="JohnLam" created="200707191650" changecount="1">
<pre>IronRuby</pre>
</div>
<div title="ExtensionMethods" modifier="JohnLam" modified="200707190026" created="200707190025" changecount="3">
<pre>Extension methods let us add methods (instance and static) to types that we didn't define. The DLR method dispatch mechanism generates the correct code to call these methods.

For more details on C# 3.0 extension methods, see &lt;&lt;some article&gt;&gt;</pre>
</div>
<div title="IronRuby" modifier="JohnLam" modified="200707230555" created="200707181616" changecount="8">
<pre>Welcome to the IronRuby project! 

The current version of IronRuby is the 0.1 Pre-Alpha, released on July 23. 

IronRuby is licensed under the terms of the Apache License, Version 2.0.

This release of IronRuby ships only in source form. You must CompileSources first.

If you're new here, make sure you read the NewDev page first. We're currently looking for contributions in the StandardLibraries, which you can find under \ironruby\src\ironrubylibs\.
</pre>
</div>
<div title="IronRubyLibraries" modifier="JohnLam" modified="200707191539" created="200707181722" changecount="3">
<pre>We are dividing the IronRuby libraries into BuiltIns and StandardLibraries. This is the area of IronRuby where we need external help the most. 

Make sure that you follow the CodingConventions. 

If this is your first contribution, read the tutorial on how to AddAMethod to an existing type.

</pre>
</div>
<div title="JohnLam" modifier="JohnLam" created="200707181617" changecount="1">
<pre>John Lam is an IronRuby core team member, and a Program Manager on the DynamicLanguageRuntime team at Microsoft.

John tracks the progress of the IronRuby project on his blog, http://www.iunknown.com
</pre>
</div>
<div title="MSBuild" modifier="JohnLam" created="200707181702" changecount="1">
<pre>It ships with the [[.NET 2.0 Framework redist|http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&amp;displaylang=en]]. We have build scripts to help you build the projects and run the unit tests. 

</pre>
</div>
<div title="MainMenu" modifier="JohnLam" created="200707191729" changecount="1">
<pre>IronRuby</pre>
</div>
<div title="Apache" modifier="DinoViehland" modified="201007081732" created="200707181707" changecount="3"><pre>
Apache License
Version 2.0, January 2004
http://www.apache.org/licenses/ 

TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION 

1. Definitions.

"License" shall mean the terms and conditions for use, reproduction, and distribution as defined by Sections 1 through 9 of this document. 

"Licensor" shall mean the copyright owner or entity authorized by the copyright owner that is granting the License. 

"Legal Entity" shall mean the union of the acting entity and all other entities that control, are controlled by, or are under common control with that entity. For the purposes of this definition, "control" means (i) the power, direct or indirect, to cause the direction or management of such entity, whether by contract or otherwise, or (ii) ownership of fifty percent (50%) or more of the outstanding shares, or (iii) beneficial ownership of such entity. 

"You" (or "Your") shall mean an individual or Legal Entity exercising permissions granted by this License. 

"Source" form shall mean the preferred form for making modifications, including but not limited to software source code, documentation source, and configuration files. 

"Object" form shall mean any form resulting from mechanical transformation or translation of a Source form, including but not limited to compiled object code, generated documentation, and conversions to other media types. 

"Work" shall mean the work of authorship, whether in Source or Object form, made available under the License, as indicated by a copyright notice that is included in or attached to the work (an example is provided in the Appendix below). 

"Derivative Works" shall mean any work, whether in Source or Object form, that is based on (or derived from) the Work and for which the editorial revisions, annotations, elaborations, or other modifications represent, as a whole, an original work of authorship. For the purposes of this License, Derivative Works shall not include works that remain separable from, or merely link (or bind by name) to the interfaces of, the Work and Derivative Works thereof. 

"Contribution" shall mean any work of authorship, including the original version of the Work and any modifications or additions to that Work or Derivative Works thereof, that is intentionally submitted to Licensor for inclusion in the Work by the copyright owner or by an individual or Legal Entity authorized to submit on behalf of the copyright owner. For the purposes of this definition, "submitted" means any form of electronic, verbal, or written communication sent to the Licensor or its representatives, including but not limited to communication on electronic mailing lists, source code control systems, and issue tracking systems that are managed by, or on behalf of, the Licensor for the purpose of discussing and improving the Work, but excluding communication that is conspicuously marked or otherwise designated in writing by the copyright owner as "Not a Contribution." 

"Contributor" shall mean Licensor and any individual or Legal Entity on behalf of whom a Contribution has been received by Licensor and subsequently incorporated within the Work. 

2. Grant of Copyright License. Subject to the terms and conditions of this License, each Contributor hereby grants to You a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare Derivative Works of, publicly display, publicly perform, sublicense, and distribute the Work and such Derivative Works in Source or Object form. 

3. Grant of Patent License. Subject to the terms and conditions of this License, each Contributor hereby grants to You a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable (except as stated in this section) patent license to make, have made, use, offer to sell, sell, import, and otherwise transfer the Work, where such license applies only to those patent claims licensable by such Contributor that are necessarily infringed by their Contribution(s) alone or by combination of their Contribution(s) with the Work to which such Contribution(s) was submitted. If You institute patent litigation against any entity (including a cross-claim or counterclaim in a lawsuit) alleging that the Work or a Contribution incorporated within the Work constitutes direct or contributory patent infringement, then any patent licenses granted to You under this License for that Work shall terminate as of the date such litigation is filed. 

4. Redistribution. You may reproduce and distribute copies of the Work or Derivative Works thereof in any medium, with or without modifications, and in Source or Object form, provided that You meet the following conditions: 

You must give any other recipients of the Work or Derivative Works a copy of this License; and 


You must cause any modified files to carry prominent notices stating that You changed the files; and 


You must retain, in the Source form of any Derivative Works that You distribute, all copyright, patent, trademark, and attribution notices from the Source form of the Work, excluding those notices that do not pertain to any part of the Derivative Works; and 


If the Work includes a "NOTICE" text file as part of its distribution, then any Derivative Works that You distribute must include a readable copy of the attribution notices contained within such NOTICE file, excluding those notices that do not pertain to any part of the Derivative Works, in at least one of the following places: within a NOTICE text file distributed as part of the Derivative Works; within the Source form or documentation, if provided along with the Derivative Works; or, within a display generated by the Derivative Works, if and wherever such third-party notices normally appear. The contents of the NOTICE file are for informational purposes only and do not modify the License. You may add Your own attribution notices within Derivative Works that You distribute, alongside or as an addendum to the NOTICE text from the Work, provided that such additional attribution notices cannot be construed as modifying the License. 
You may add Your own copyright statement to Your modifications and may provide additional or different license terms and conditions for use, reproduction, or distribution of Your modifications, or for any such Derivative Works as a whole, provided Your use, reproduction, and distribution of the Work otherwise complies with the conditions stated in this License. 

5. Submission of Contributions. Unless You explicitly state otherwise, any Contribution intentionally submitted for inclusion in the Work by You to the Licensor shall be under the terms and conditions of this License, without any additional terms or conditions. Notwithstanding the above, nothing herein shall supersede or modify the terms of any separate license agreement you may have executed with Licensor regarding such Contributions. 

6. Trademarks. This License does not grant permission to use the trade names, trademarks, service marks, or product names of the Licensor, except as required for reasonable and customary use in describing the origin of the Work and reproducing the content of the NOTICE file. 

7. Disclaimer of Warranty. Unless required by applicable law or agreed to in writing, Licensor provides the Work (and each Contributor provides its Contributions) on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. You are solely responsible for determining the appropriateness of using or redistributing the Work and assume any risks associated with Your exercise of permissions under this License. 

8. Limitation of Liability. In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall any Contributor be liable to You for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising as a result of this License or out of the use or inability to use the Work (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if such Contributor has been advised of the possibility of such damages. 

9. Accepting Warranty or Additional Liability. While redistributing the Work or Derivative Works thereof, You may choose to offer, and charge a fee for, acceptance of support, warranty, indemnity, or other liability obligations and/or rights consistent with this License. However, in accepting such obligations, You may act only on Your own behalf and on Your sole responsibility, not on behalf of any other Contributor, and only if You agree to indemnify, defend, and hold each Contributor harmless for any liability incurred by, or claims asserted against, such Contributor by reason of your accepting any such warranty or additional liability. 

See FAQ for answers to frequently asked questions about this license.
 </pre>
</div>
<div title="MutableString" modifier="JohnLam" created="200707182351" changecount="1">
<pre>MutableString is the CLR type that represents a Ruby String. It's currently based on the StringBuilder type, which is a very efficient implementation of a char[] buffer. The current plan of record is to use this type for the near future before we invest in converting this type to a byte[] which is the long term plan.</pre>
</div>
<div title="NewDev" modifier="JohnLam" modified="200707192306" created="200707181659" changecount="9">
<pre>New to the project? There are a few things that you should know before you dive in.

* We are currently only accepting contributions into the StandardLibraries.
* Take some time to familiarize yourself with the SourceCodeLayout. 
* Make sure you understand how the UnitTests work.
* Work through the RunningFirstTime tutorial.

Contributing code

* Read the CodingStandards
* Read the tutorial on how to AddAMethod to the libraries
* Build the solution using MSBuild and verify that the UnitTests pass</pre>
</div>
<div title="PageTemplate" modifier="YourName" modified="200701122313" created="200701122350" tags="LewcidOrangeBlogTheme" server.type="file" server.host="http://tiddlythemes.com/empties/LewcidOrangeBlog.html" server.page.revision="200701122313">
<pre>&lt;!--{{{--&gt;
&lt;div class='header'&gt;
     &lt;div class='gradient' macro='gradient vert #FF8614 #DA4A0D '&gt;
	&lt;div class='titleLine' &gt;
		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
	&lt;/div&gt;
&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div id='bodywrapper'&gt;
&lt;div id='sidebar'&gt;
	&lt;div id='sidebarOptions' refresh='content' 	tiddler='SideBarOptions'&gt;&lt;/div&gt;
	&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
	&lt;div id='messageArea'&gt;&lt;/div&gt;
	&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='contentFooter'&gt;TiddlyWiki&lt;/div&gt;
&lt;/div&gt;

&lt;!--}}}--&gt;</pre>
</div>
<div title="RunningFirstTime" modifier="JohnLam" modified="200707221829" created="200707221827" changecount="2">
<pre>This topic will teach you the basics of how things run in IronRuby.

First, we will step through the Ruby.Console application to see what happens when we run a simple program:

{{{
puts 'Hello, World!'
}}}

You will see a number of things when we step through this code:

# The hosting interfaces
# The Ruby parser
# The Ruby AST
# The transformation of the Ruby AST into the DLR AST
# Some interesting execution paths


</pre>
</div>
<div title="SideBarWG" modifier="YourName" modified="200701122313" created="200701122350" tags="LewcidOrangeBlogTheme" server.type="file" server.host="http://tiddlythemes.com/empties/LewcidOrangeBlog.html" server.page.revision="200701122313">
<pre>/***
This CSS by DaveBirss.
***/
/*{{{*/


.tabSelected {
 background: #fff;
}

.tabUnselected {
 background: #eee;
}

#sidebar {
 color: #000;
 background: transparent; 
}

#sidebarOptions {
 background: #fff;
}

#sidebarOptions input {
	border: 1px solid #ccc;
}

#sidebarOptions input:hover, #sidebarOptions input:active,  #sidebarOptions input:focus {
	border: 1px solid #000;
}

#sidebarOptions .button {
 color: #999;
}

#sidebarOptions .button:hover {
 color: #000;
 background: #fff;
 border-color:white;
}

#sidebarOptions .button:active {
 color: #000;
 background: #fff;
}

#sidebarOptions .sliderPanel {
 background: transparent;
}

#sidebarOptions .sliderPanel A {
 color: #999;
}

#sidebarOptions .sliderPanel A:hover {
 color: #000;
 background: #fff;
}

#sidebarOptions .sliderPanel A:active {
 color: #000;
 background: #fff;
}

.sidebarSubHeading {
 color: #000;
}

#sidebarTabs {`
 background: #fff
}

#sidebarTabs .tabSelected {
 color: #000;
 background: #fff;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: none;
}

#sidebarTabs .tabUnselected {
 color: #999;
 background: #eee;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: none;
}

#sidebarTabs .tabContents {
 background: #fff;
}


#sidebarTabs .txtMoreTab .tabSelected {
 background: #fff;
}

#sidebarTabs .txtMoreTab .tabUnselected {
 background: #eee;
}

#sidebarTabs .txtMoreTab .tabContents {
 background: #fff;
}

#sidebarTabs .tabContents .tiddlyLink {
 color: #999;
 border:none;
}

#sidebarTabs .tabContents .tiddlyLink:hover {
 background: #fff;
 color: #000;
 border:none;
}

#sidebarTabs .tabContents {
 color: #000;
}

#sidebarTabs .button {
 color: #666;
}

#sidebarTabs .tabContents .button:hover {
 color: #000;
 background: #fff;
}

#sidebar {color:#999;}
/*}}}*/</pre>
</div>
<div title="SiteSubtitle" modifier="YourName" created="200707181614" changecount="1">
<pre>Developer documentation for Microsoft IronRuby</pre>
</div>
<div title="SiteTitle" modifier="YourName" created="200707181614" changecount="1">
<pre>IronRuby Docs</pre>
</div>
<div title="SourceCodeLayout" modifier="JohnLam" modified="200707191618" created="200707191555" changecount="2">
<pre>The IronRuby source code has the following layout:
{{{
\ironruby
  src\
    ironruby\
    ironrubylibs\
    microsoft.scripting\
  tests\
    ironruby\
    microsoft.scripting\
  utils\
    IronRuby.Tests\
    ironruby.console\
    classinitgenerator\
}}}

The src\ironruby directory contains the code for the compiler and the BuiltIns. We are currently not AcceptingContributions into the core compiler.

The src\ironrubylibs directory contains the code for the StandardLibraries. We are AcceptingContributions into this directory tree.

The tests\ironruby directory contains the UnitTests for the compiler, BuiltIns, and StandardLibraries.

The tests\microsoft.scripting directory contains the UnitTests for the DynamicLanguageRuntime.

The utils\IronRuby.Tests directory contains a set of tests that are useful if you want to step into the core compiler using a debugger.

The utils\ironruby.console directory contains a simple console-based host for the IronRuby compiler that supports REPL-style programming.

The utils\classinitgenerator directory contains a utility that will generate code from class and method attributes used in the libraries. </pre>
</div>
<div title="StandardLibraries" modifier="JohnLam" modified="200707192244" created="200707191511" changecount="4">
<pre>The StandardLibraries are the same list of libraries described in Chapter 28 of the PickAxe book. These libraries will be compiled into a separate assembly, IronRubyLibs.dll. The sources live in \ironruby\src\ironrubylibs\.

Here's a complete list of the libraries that we are looking for contributions in:

!Libraries to be ported to C#
# [[strscan|http://ruby-doc.org/stdlib/libdoc/strscan/rdoc/classes/StringScanner.html]]: a high-speed string token scanner
# syck: high-speed YAML parser
# zlib: library for [de]compressing streams and working with gzip files
# bigdecimal: variable precision floating point library (GPL) 
# readline: wrapper around GNU readline library
# curses: wrapper around C-based curses library
# enumerator: adds enumeration support to arbitrary objects and mixes in Enumerable
# fcntl: symbolic names for fcntl constants based on underlying OS
# iconv: translates string between different character encodings
# io: adds IO#ready? and IO#wait methods to standard IO class
# pty: pseudo-terminal interface
# racc: runtime library for code produced by racc [Ruby yacc]
# stringio: treat a string as if it were an I/O stream
# thread: utility methods for multithreaded programming. Queue utility class is still used  today by some libraries - most functionality superceded by Monitor

!Libraries that should delegate functionality to existing .NET libraries
# openssl: wrapper around OpenSSL library
# digest: various hashing algorithms (md5, rmd160, sha1, sha2) 
# dl: access underlying platform's DLL infrastructure [similar to Win32API]
# socket: interface with platform socket implementation (unknown license)
# Win32API: allows access to arbitrary Win32 functions P/Invoke style wrapper
# win32ole: library for manipulating COM objects (GPL or Artistic License)

!Libraries that target non-Windows platforms
# Dbm: wrapper around DBM databases which are persistent hash-like files 
# gdbm: Ruby wrapper around GNU database
# nkf: wrapper around Network Kanji Filter library - guess character encodings
# sdbm: key-value hashtable persistence library 
# etc: used to retrieve data under /etc directory on Unix systems
# syslog: wrapper around Unix syslog library 
# tk: library for creating cross-platform UIs
</pre>
</div>
<div title="StyleSheet" modifier="YourName" modified="200701122313" created="200701122350" tags="LewcidOrangeBlogTheme" server.type="file" server.host="http://tiddlythemes.com/empties/LewcidOrangeBlog.html" server.page.revision="200701122313">
<pre>[[SideBarWG]]

/***
!Top Menu Styles
***/
/*{{{*/
#topMenu br {display:none; }
#topMenu { background: #000 ; color:#fff;padding: 1em 1em;}
/*}}}*/

/***
!General
***/
/*{{{*/
body {
 background: #444;
 margin: 0 auto;
}

 #contentWrapper{
 background: #fff;
 border: 0;
 margin: 0 auto;
 width: 792px;
 padding:0;
}
/*}}}*/

/***
!Header rules
***/
/*{{{*/
.titleLine{
 margin: 80px auto 0em ;
margin-left:1.7em;
margin-bottom: 40px;
 padding: 0;
 text-align: left;
 color: #fff;
}

.siteTitle {
	font-size: 2em;
        font-weight: bold;
}

.siteSubtitle {
	font-size: 1.1em;
        display: block;
        margin: .5em auto 1em;
}

.gradient {margin: 0 auto;}



.header {
 background: #fff; 
 margin: 0 auto;
 padding:0 12px;
 width: 768px;
}
/*}}}*/

/***
!Display Area
***/
/*{{{*/
#bodywrapper {margin:0 12px; padding:0;background:#fff; height:1%}

#displayArea{
 margin: 0em 16em 0em 1em;
 text-align: left;
}

.tiddler {
	padding: 1em 1em 0em 0em;
}

h1,h2,h3,h4,h5 { color: #000; background: transparent; padding-bottom:2px; border-bottom: 1px dotted #666; }
.title {color:black; font-size:1.8em; border-bottom:1px solid #333; padding-bottom:0.3px;}
.subtitle { font-size:90%; color:#ccc; padding-left:0.25em; margin-top:0.1em; }

.shadow .title {
	color: #aaa;
}

.tagClear{
	clear: none; 
}

* html .viewer pre {
	margin-left: 0em;
}

* html .editor textarea, * html .editor input {
	width: 98%;
}

.tiddler {margin-bottom:1em; padding-bottom:0em;}


.toolbar .button {color:#bbb; border:none;}
.toolbar .button:hover, .toolbar .highlight, .toolbar .marked, .toolbar a.button:active {background:transparent; color:#111; border:none; text-decoration:underline;}

#sidebar .highlight, #sidebar .marked {background:transparent;}

.tagging, .tagged {
	border: 1px solid #eee;
	background-color: #F7F7F7;
}

.selected .tagging, .selected .tagged {
	background-color: #eee;
	border: 1px solid #bbb;
}

 .tagging .listTitle, .tagged .listTitle {
	color: #bbb;
}

.selected .tagging .listTitle, .selected .tagged .listTitle {
	color: #222; 
}


.tagging .button:hover, .tagged .button:hover {
		border: none; background:transparent; text-decoration:underline; color:#000;
}

.tagging .button, .tagged .button {
		color:#aaa;
}

.selected .tagging .button, .selected .tagged .button {
		color:#000;
}

.viewer blockquote {
	border-left: 3px solid #000;
}

.viewer pre, .viewer code {
	border: 1px dashed #ccc;
	background: #eee;}

.viewer hr {
	border: 0;
	border-top: solid 1px #333;
 margin: 0 8em;
	color: #333;
}

.highlight, .marked {background:transparent; color:#111; border:none; text-decoration:underline;}

.viewer .highlight, .viewer .marked {text-decoration:none;}

#sidebarTabs .highlight, #sidebarTabs .marked {color:#000; text-decoration:none;}

.tabSelected {
 color: #000;
 background: #fff;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: none;
}

.viewer .tabSelected:hover{color:#000;}

.viewer .tabSelected {font-weight:bold;}

.tabUnselected {
 color: #999;
 background: #eee;
 border-top: solid 1px #ccc;
 border-left: solid 1px #ccc;
 border-right: solid 1px #ccc;
 border-bottom: solid 1px #ccc;
 padding-bottom:1px;
}

.tabContents {
 background: #fff;
  color: #000;
}
/*}}}*/
/***
!!!Tables
***/
/*{{{*/
.viewer table {
	border: 1px solid #000;
}

.viewer th, thead td {
	background: #000;
	border: 1px solid #000;
	color: #fff;
}

.viewer td, .viewer tr {
	border: 1px solid #111;
}
/*}}}*/


/***
!!!Editor area
***/
/*{{{*/
.editor input, .editor textarea {
	border: 1px solid #ccc;
}

.editor {padding-top:0.3em;}

.editor textarea:focus, .editor input:focus {
	border: 1px solid #333;
}
/*}}}*/

/***
!Sidebar
***/
/*{{{*/
#sidebar{
position:relative;
float:right;
margin-bottom:1em;
display:inline;
width: 16em;
}

#sidebarOptions .sliderPanel {
	background: #eee; border:1px solid #ccc;
}

/*}}}*/

/***
!Body Footer rules
***/
/*{{{*/
#contentFooter {
 text-align: left;
 clear: both;
 color:#fff;
 background: #000;
 padding: 1em 2em;
font-weight:bold;
}

/*}}}*/
/***
!Link Styles
***/
/*{{{*/
a{
	color: #000;
}

a:hover{
        color: #FF6600;
        background:#fff;
}


.button {
	color: #000;
	border: 1px solid #fff;
}

.button:hover {
	color: #fff;
	background: #ff8614;
	border-color: #000;
}

.button:active {
	color: #fff;
	background: #ff8614;
	border: 1px solid #000;
}

.tiddlyLink {border-bottom: 1px dotted #000;}
.tiddlyLink:hover {border-bottom: 1px dotted #FF6600;} 

.titleLine a {border-bottom: 1px dotted #FF9900;}

.titleLine a:hover {border-bottom: 1px dotted #fff;}

.siteTitle a, .siteSubtitle a{
 color: #fff;
}

.viewer .button {border: 1px solid #ff8614; font-weight:bold;}
.viewer .button:hover, .viewer .marked, .viewer .highlight{background:#ff8614; color:#fff; font-weight:bold; border: 1px solid #000;}

#topMenu .button, #topMenu .tiddlyLink {
 margin-left:0.5em; margin-right:0.5em;
 padding-left:3px; padding-right:3px;
 color:white;
}
#topMenu .button:hover, #topMenu .tiddlyLink:hover { background:#000; color:#FF8814}

#topMenu a{border:none;}
/*}}}*/

/***
!Message Area /%=================================================%/
***/
/*{{{*/
#messageArea {
	border: 4px dotted #ff8614;
	background: #000;
	color: #fff;
        font-size:90%;
}

#messageArea .button {
	padding: 0.2em;
	color: #000;
	background: #fff;
        text-decoration:none;
        font-weight:bold;
        border:1px solid #000; 
}

#messageArea a {color:#fff;}

#messageArea a:hover {color:#ff8614; background:transparent;}

#messageArea .button:hover {background: #FF8614; color:#fff; border:1px solid #fff; }

/*}}}*/

/***
!Popup /%=================================================%/
***/
/*{{{*/
.popup {
	background: #ff8814;
	border: 1px solid #333;
}

.popup hr {
	color: #333;
	background: #333;
	border-bottom: 1px;
}

.popup li.disabled {
	color: #333;
}

.popup li a, .popup li a:visited {
	color: #eee;
	border: none;
}

.popup li a:hover {
	background: #ff8614;
	color: #fff;
	border: none;
        text-decoration:underline;
}
/*}}}*/

.blog h2, .blog h3, .blog h4{
  margin:0;
  padding:0;
border-bottom:none;
}
.blog {margin-left:1.5em;}  


.blog .excerpt {
  margin:0;
margin-top:0.3em;
  padding: 0;
  margin-left:1em;
  padding-left:1em;
  font-size:90%;
  border-left:1px solid #ddd;
}

#tiddlerWhatsNew h1, #tiddlerWhatsNew h2 {border-bottom:none;}
div[tags~=&quot;RecentUpdates&quot;], div[tags~=&quot;lewcidExtension&quot;] {margin-bottom: 2em;}

#hoverMenu  .button, #hoverMenu  .tiddlyLink {border:none; font-weight:bold; background:#f37211; color:#fff; padding:0 5px; float:right; margin-bottom:4px;}
#hoverMenu .button:hover, #hoverMenu .tiddlyLink:hover {font-weight:bold; border:none; color:#f37211; background:#000; padding:0 5px; float:right; margin-bottom:4px;}

#topMenu .fontResizer {float:right;}

#topMenu .fontResizer .button{border:1px solid #000;}
#topMenu .fontResizer .button:hover {border:1px solid #f37211; color:#fff;}
#sidebarTabs .txtMainTab .tiddlyLinkExisting {
 font-weight: normal;
 font-style: normal;
}

#sidebarTabs .txtMoreTab .tiddlyLinkExisting {
 font-weight: bold;
 font-style: normal;
}

.blog h2, .blog h3, .blog h4{
  margin:0;
  padding:0;
border-bottom:none;
}
.blog {margin-left:1.5em;}  


.blog .excerpt {
  margin:0;
margin-top:0.3em;
  padding: 0;
  margin-left:1em;
  padding-left:1em;
  font-size:90%;
  border-left:1px solid #ddd;
}

#tiddlerWhatsNew h1, #tiddlerWhatsNew h2 {border-bottom:none;}
div[tags~=&quot;RecentUpdates&quot;], div[tags~=&quot;lewcidExtension&quot;] {margin-bottom: 2em;}

#hoverMenu {background:transparent;}
#hoverMenu  .button, #hoverMenu  .tiddlyLink {border:none; font-weight:bold; background:#f37211; color:#fff; padding:0 5px; float:right; margin-bottom:4px;}
#hoverMenu .button:hover, #hoverMenu .tiddlyLink:hover {font-weight:bold; border:none; color:#f37211; background:#000; padding:0 5px; float:right; margin-bottom:4px;}

#topMenu .fontResizer {float:right;}

#topMenu .fontResizer .button{border:1px solid #000;}
#topMenu .fontResizer .button:hover {border:1px solid #f37211; color:#fff;}
#sidebarTabs .txtMainTab .tiddlyLinkExisting {
 font-weight: normal;
 font-style: normal;
}

#sidebarTabs .txtMoreTab .tiddlyLinkExisting {
 font-weight: bold;
 font-style: normal;
}

</pre>
</div>
<div title="UnitTests" modifier="JohnLam" modified="200707230554" created="200707192301" changecount="2">
<pre>There are several sets of UnitTests in IronRuby. 

If you are contributing to the libraries, you will be interested in the tests under \tests\ruby\builtins. These tests use a minimalistic unit testing framework that can be found in \tests\ruby\util\simple_test.rb.

If you have added the \bin\release directory for IronRuby to your PATH, you can run the tests using: 

{{{
rbx \tests\ruby\builtins\array\test_array.rb
}}}

</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script type="text/javascript">
//<![CDATA[
//
// Please note:
// 
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
// 

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5 // Depth of cascade animation
};

// Adaptors
config.adaptors = {};

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayStartupTime: false,
	txtBackupFolder: "",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8"
	};
config.optionsDesc = {};
	
// List of notification functions to be called when certain tiddlers are changed or deleted
config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that shouldn't really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","plugins"];

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	sparkline: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {},
	edit: {},
	tagChooser: {},
	toolbar: {},
	br: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: config.userAgent.indexOf("gecko") != -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.urlPattern = "[a-z]{3,8}:[^\\s:'\"][^\\s'\"]*(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" + 
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "<!--{{{-->\n<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>\n<!--}}}-->",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ImportTiddlers: '<<importTiddlers>>'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'} 
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Reveal further commands"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	openError: "There were problems fetching the tiddlywiki file",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", color: "none"},
		changedServer: {text: "Changed on server", color: '#80ff80'},
		changedLocally: {text: "Changed while unplugged", color: '#80ff80'},
		changedBoth: {text: "Changed while unplugged and on server", color: '#ff8080'},
		notFound: {text: "Not found on server", color: '#ffff80'},
		putToServer: {text: "Saved update on server", color: '#ff80ff'},
		gotFromServer: {text: "Retrieved update from server", color: '#80ffff'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "GettingStarted",
	MainMenu: "GettingStarted",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options " "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately before the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColours: "This shadow tiddler contains CSS definitions related to the color of page elements",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
config.parsers = {}; // Hashmap of alternative parsers for the wikifier
var anim = new Animator(); // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = config.browser.isSafari || config.browser.isOpera;

// Starting up
function main()
{
	var t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	store.loadFromDiv("storeArea","store",true);
	t2 = new Date();
	loadShadowTiddlers();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	t6 = new Date();
	store.notifyAll();
	t7 = new Date();
	restart();
	t8 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	if(!readOnly)
		backstage.init();
	t9 = new Date();
	if(config.options.chkDisplayStartupTime) {
		displayMessage("Load in " + (t2-t1) + " ms");
		displayMessage("Loadshadows in " + (t3-t2) + " ms");
		displayMessage("Loadplugins in " + (t5-t4) + " ms");
		displayMessage("Notify in " + (t7-t6) + " ms");
		displayMessage("Restart in " + (t8-t7) + " ms");
		displayMessage("Total startup in " + (t9-t0) + " ms");
	}
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		var defaultParams = store.getTiddlerText("DefaultTiddlers").parseParams("open",null,false);
		invokeParamifier(defaultParams,"onstart");
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name;
		if(n) 
			map[n] = p;
		if(n = p.Source) 
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++) 
		visit(installedPlugins[i]);	
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms"; 
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce"))
		return verifyTail(plugin,true,config.messages.pluginForced);
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0]) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1]) - version.minor;
		if(w == 0 && coreVersion[2])
		 	w = parseInt(coreVersion[2]) - version.revision;
		if(w > 0)
			return verifyTail(plugin,false,config.messages.pluginVersionError);
		}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable"))
		return verifyTail(plugin,false,config.messages.pluginDisabled);
	return true;
}

function verifyTail(plugin,result,message)
{
	plugin.log.push(message);
	return result;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURI(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++) {
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		var tagged = store.getTaggedTiddlers(v,"title");
		for(var t=0; t<tagged.length; t++)
			story.displayTiddler("bottom",tagged[t].title,null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},
	
	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if (s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if (link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1){
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},

	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					this.rowHandler(w,createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow"),prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookaheadRegExp: /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForCSS",
	match: "^/\\*\\{\\{\\{\\*/\\n",
	lookaheadRegExp: /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForPlugin",
	match: "^//\\{\\{\\{\\n",
	lookaheadRegExp: /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForTemplate",
	match: "^<!--\\{\\{\\{-->\\n",
	lookaheadRegExp: /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "wikifyCommentForPlugin",
	match: "^/\\*\\*\\*\\n",
	termRegExp: /(^\*\*\*\/\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "wikifyCommentForTemplate",
	match: "^<!---\\n",
	termRegExp: /(^--->\n)/mg,
	handler: function(w) 
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "unWikiLink",
	match: config.textPrimitives.unWikiLink+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		w.outputText(w.output,w.matchStart+1,w.nextMatch);
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords == true || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "boldByChar",
	match: "''",
	termRegExp: /('')/mg,
	element: "strong",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "italicByChar",
	match: "//",
	termRegExp: /(\/\/)/mg,
	element: "em",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "underlineByChar",
	match: "__",
	termRegExp: /(__)/mg,
	element: "u",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "strikeByChar",
	match: "--(?!\\s|$)",
	termRegExp: /((?!\s)--|(?=\n\n))/mg,
	element: "strike",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	termRegExp: /(\^\^)/mg,
	element: "sup",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "subscriptByChar",
	match: "~~",
	termRegExp: /(~~)/mg,
	element: "sub",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookaheadRegExp: /\{\{\{((?:.|\n)*?)\}\}\}/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "styleByChar",
	match: "@@",
	termRegExp: /(@@)/mg,
	handler: function(w)
	{
		var e = createTiddlyElement(w.output,"span");
		var styles = config.formatterHelpers.inlineCssHelper(w);
		if(styles.length == 0)
			e.className = "marked";
		else
			config.formatterHelpers.applyCssHelper(e,styles);
		w.subWikifyTerm(e,this.termRegExp);
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
},

{
	name: "customClasses",
	match: "\\{\\{",
	termRegExp: /(\}\}\})/mg,
	lookaheadRegExp: /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch) {
			var e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			w.subWikifyTerm(e,this.termRegExp);
		}
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		if(format) {
			for(var i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(var i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "") {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.subWikifyUnterm(output);
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikifyUnterm(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "") {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	if(terminator)
		this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
	else
		this.subWikifyUnterm(output);
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first matches for the formatter and terminator RegExps
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text;
	if(params[0])
		text = now.formatString(params[0].trim());
	else
		text = now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
};

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li =createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] ? params[0] : "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler[field].formatString(this.dateFormat));
			lastDay = theDay;
		}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink");
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick);
	var txt = createTiddlyElement(place,"input",null,"txtOptionInput");
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(e)
{
	if(!e) var e = window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(this.value.length > 2) {
		if(this.value != this.getAttribute("lastSearchText")) {
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
			var txt = this;
			config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
		}
	} else {
		if(config.macros.search.timeout)
			clearTimeout(config.macros.search.timeout);
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] ? names[1] : null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args) {
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
	}
	var text = store.getTiddlerText(tiddlerName);
	if(text) {
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try {
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) {
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
			}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
		} finally {
			stack.pop();
		}
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params) 
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++) {
		createTagButton(createTiddlyElement(theList,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(theList,sep);
	}
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	theList.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(theList,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(theList,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(e)
{
	if(!e) var e = window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var cookie = cookie ? cookie : "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",cookie);
	panel.style.display = config.options[cookie] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	if(className)
		c.className = className;
	else
		c.className = typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] ? config.optionsDesc[opt] : opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if (handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType);
		}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onkeyup",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode)
			nodes[t][valueField] = value;
		}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if (h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{	
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if (h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined) 
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		var now = new Date();
		title = now.formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = document.getElementById(story.idPrefix + title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string")
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : "";
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	for(var t=0; t<params.length; t++) {
		var v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
	}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++) {
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		var v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
	}
};

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier)
{
	var terminator = ">>";
	var panel;
	if(wikifier)
		panel = createTiddlyElement(place,"div",null,"gradient");
	else
		panel = place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	var t;
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	var colours = [];
	for(t=1; t<params.length; t++) {
		var c = new RGB(params[t]);
		if(c)
			colours.push(c);
	}
	drawGradient(panel,params[0] != "vert",colours);
	if(wikifier)
		wikifier.subWikify(panel,terminator);
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var m = config;
		var p = params[0].split(".");
		for(var t=0; t<p.length; t++) {
			if(p[t] in m)
				m = m[p[t]];
			else
				break;
		}
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value != undefined) {
			switch(params[1]) {
				case undefined:
					highlightify(value,place,highlightHack,tiddler);
					break;
				case "link":
					createTiddlyLink(place,value,true);
					break;
				case "wikified":
					wikify(value,place,highlightHack,tiddler);
					break;
				case "date":
					value = Date.convertFromYYYYMMDDHHMM(value);
					createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
					break;
			}
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1];
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		if(field != "text" && !rows) {
			var e = createTiddlyElement(null,"input");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.setAttribute("edit",field);
			e.setAttribute("type","text");
			var v = store.getValue(tiddler,field);
			if(!v) 
				v = "";
			e.value = v;
			e.setAttribute("size","40");
			e.setAttribute("autocomplete","off");
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			var e = createTiddlyElement(wrapper2,"textarea");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			var v = store.getValue(tiddler,field);
			if(!v) 
				v = "";
			e.value = v;
			var rows = rows ? rows : 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
	}
};

config.macros.tagChooser.onClick = function(e)
{
	if(!e) var e = window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++) {
		var theTag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(e)
{
	if(!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var title = tiddler.title;
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",title);
	}
};

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,theClass)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
				case "popup":
					cmd = this.onClickPopup;
					break;
				case "command":
				default:
					cmd = this.onClickCommand;
					break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			if(theClass)
				addClass(btn,theClass);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText ? command.readOnlyText : command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip ? command.readOnlyTooltip : command.tooltip;
};

config.macros.toolbar.onClickCommand = function(e)
{
	if(!e) var e = window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(e)
{
	if(!e) var e = window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,theClass,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,theClass) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(e)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	removeNode(this);
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
			case '>':
				var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
				addClass(btn,"moreCommand");
				var e = createTiddlyElement(place,"span",null,"moreCommand");
				e.style.display = "none";
				place = e;
				break;
			default:
				var theClass = "";
				switch(c.substr(0,1)) {
					case "+":
						theClass = "defaultCommand";
						c = c.substr(1);
						break;
					case "-":
						theClass = "cancelCommand";
						c = c.substr(1);
						break;
				}
				if(c in config.commands)
					this.createCommand(place,c,tiddler,theClass);
				break;
		}
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = document.getElementById(story.idPrefix + title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if (config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if (deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields['server.host'];
	var serverWorkspace = tiddler.fields['server.workspace'];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = config.commands.syncing.currServerMarker + caption;
		} else {
			caption = config.commands.syncing.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			'server.type': serverType,
			'server.host': this.getAttribute("server.host"),
			'server.workspace': this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,'server',null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var fields = {};
	store.forEachField(tiddler,function(tiddler,fieldName,value) {fields[fieldName] = value;},true);
	var items = [];
	for(var t in fields) {
		items.push({field: t,value: fields[t]});
	}
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.created = new Date();
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title" + ">" + this.title.htmlEncode() + "</title" + ">");
	s.push("<description>" + wikifyStatic(this.text,null,this).htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return s.join("\n");
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(this.text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(this.text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(this.text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,theModifier,theModified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields && this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	if(serverType)
		return new config.adaptors[serverType];
	else
		return null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		return tiddlers[title];
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return typeof config.shadowTiddlers[title] == "string";
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		return tiddler.text;
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.slicesRE = /(?:[\'\/]*~?([\.\w]+)[\'\/]*\:[\'\/]*\s*(.*?)\s*$)|(?:\|[\'\/]*~?([\.\w]+)\:?[\'\/]*\|\s*(.*?)\s*\|)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	do {
		var m = this.slicesRE.exec(text);
		if(m) {
			if(m[1])
				slices[m[1]] = m[2];
			else
				slices[m[3]] = m[4];
		}
	} while(m);
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		this.incChangeCount(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	this.incChangeCount(title);
	this.notify(title,true);
	this.setDirty(true);
};

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created ? created : tiddler.created; // Preserve created date
		this.deleteTiddler(title);
	} else {
		created = created ? created : modified;
		tiddler = new Tiddler();
	}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler();
		tiddler.title = title;
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return store.getSaver().externalize(store);
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag)
{
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return an array of all the tags in use. Each member of the array is another array where [0] is the name of the tag and [1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			if(excludeTag) {
				var t = store.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					return false;
			}
			var f = false;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					f = true;
					results[c][1]++;
				}
			}
			if(!f)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	for(var n in t.fields) {
		var result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(var n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		var result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(container,idPrefix)
{
	this.container = container;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
}

Story.prototype.forEachTiddler = function(fn)
{
	var place = document.getElementById(this.container);
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,title,template,animate,unused,customFields,toggle)
{
	var place = document.getElementById(this.container);
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem) {
		if(toggle)
			this.closeTiddler(title,true);
		else
			this.refreshTiddler(title,template,false,customFields);
	} else {
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = document.getElementById(this.container);
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.idPrefix + title,"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ?  fields.decodeHashMap() : (fields ? fields : {});
	var serverType = tiddler.getServerType();
	var host = tiddler.fields['server.host'];
	var workspace = tiddler.fields['server.workspace'];
	if(!serverType | !host)
		return null;
	var sm = new SyncMachine(serverType,{
			start: function() {
				return this.openHost(host,"openWorkspace");
			},
			openWorkspace: function() {
				return this.openWorkspace(workspace,"getTiddler");
			},
			getTiddler: function() {
				return this.getTiddler(title,"gotTiddler");
			},
			gotTiddler: function(tiddler) {
				if(tiddler && tiddler.text) {
					var downloaded = new Date();
					if(!tiddler.created)
						tiddler.created = downloaded;
					if(!tiddler.modified)
						tiddler.modified = tiddler.created;
					store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
					autoSaveChanges();
				}
				delete this;
				return true;
			},
			error: function(message) {
				displayMessage("Error loading missing tiddler from %0: %1".format([host,message]));
			}
		});
	sm.go();
	return config.messages.loadingMissingTiddler.format([title,serverType,host,workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText ? defaultText : text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			var me = this;
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			var html = this.getTemplateForTiddler(title,template,tiddler);
			tiddlerElem.innerHTML = html;
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(!store.tiddlerExists(title)) {
				if(store.isShadowTiddler(title))
					addClass(tiddlerElem,"shadow");
				else
					addClass(tiddlerElem,"missing");
			} else {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = document.createElement("div");
	w.style.display = "none";
	place.appendChild(w);
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function() 
{
	var place = document.getElementById(this.container);
	var e = place.firstChild;
	if(!e)
		return;
	this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
	while((e = e.nextSibling) != null) 
		this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(e)
{
	if(!e) var e = window.event;
	var theTarget = resolveTarget(e);
	if(theTarget && theTarget.nodeName.toLowerCase() != "input" && theTarget.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	} else {
		return false;
	}
};

Story.prototype.onTiddlerKeyPress = function(e)
{
	if(!e) var e = window.event;
	clearMessage();
	var consume = false; 
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
		case 9: // Tab
			if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
				replaceSelection(target,String.fromCharCode(9));
				consume = true; 
			}
			if(config.isOpera) {
				target.onblur = function() {
					this.focus();
					this.onblur = null;
				};
			}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey) {
				blurElement(this);
				config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
				consume = true;
			}
			break; 
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
			consume = true;
			break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	var e = null;
	if(tiddlerElem != null) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = story.getTiddlerField(title,field);

	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	Story.prototype.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = document.getElementById(this.container);
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ?	 text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	var titles = [];
	for(var t=0;t<matches.length;t++)
		titles.push(matches[t].title);
	this.displayTiddlers(null,titles);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([titles.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = document.getElementById(this.idPrefix + title);
	if(e != null) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if(!tiddler)
			return false;
		for(var n in fields) {
			if(store.getValue(title,n) != fields[n])
				return true;
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title ? fields.title : title;
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.idPrefix + newTitle;
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		var extendedFields = store.tiddlerExists(newTitle) ? store.fetchTiddler(newTitle).fields : {};
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
			}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = document.getElementById("backstageToolbar");
		this.button = document.getElementById("backstageButton");
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function (e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function (e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {
			backstage.switchTab(null);
		};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			btn.setAttribute("task",taskName);
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},
	
	isVisible: function () {
		return this.area ? this.area.style.display == "block" : false;
	},
	
	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [
				{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}
			];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		this.showButton.style.display = "none";
		this.hideButton.style.display = "block";
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [
					{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}
				];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content,"backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		displayMessage(task);
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName)
			return;
		if(backstage.currTabElem) {
			removeClass(this.currTabElem,"backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},
	
	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [
				{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}
			];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},
	
	hidePanel: function() {
		backstage.currTabName = null;
		backstage.currTabElem = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		 } else {
			backstage.panel.style.display = "none";
			backstage.cloak.style.display = "none";
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = config.macros.importTiddlers.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = config.macros.importTiddlers.onBrowseChange;
	fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		this.selectedIndex = 0;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = "file://" + this.value;
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return false;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value;
	var adaptor = new config.adaptors[serverType];
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var context = {};
	var ret = adaptor.openHost(url,context,wizard,config.macros.importTiddlers.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = config.macros.importTiddlers.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	var workspace = wizard.getValue("feedWorkspace");
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value  = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = {};
	var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetTiddlerList: " + context.statusText);
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);
	wizard.setValue("listView",listView);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},
			{caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick:  config.macros.importTiddlers.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		config.macros.importTiddlers.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = new Array();
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}
		],config.macros.importTiddlers.statusDoingImport);
	for(t=0; t<rowNames.length; t++) {
		var context = {};
		context.allowSynchronous = true;
		var inbound = adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous) 
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onCancel}
			],config.macros.importTiddlers.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	this.createSyncTasks();
	this.preProcessSyncableTiddlers();
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers();
	wizard.setButtons([
			{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}
		]);
};

config.macros.sync.getSyncableTiddlers = function ()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		syncItem.serverWorkspace = tiddler.fields['server.workspace'];
		syncItem.tiddler = tiddler;
		syncItem.title = tiddler.title;
		syncItem.isTouched = tiddler.isTouched();
		syncItem.selected = syncItem.isTouched;
		syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
		syncItem.status = syncItem.syncStatus.text;
		if(syncItem.serverType && syncItem.serverHost)
			list.push(syncItem);
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function()
{
	for(var t=0; t<currSync.syncList.length; t++) {
		si = currSync.syncList[t];
		var ti = si.syncTask.syncMachine.generateTiddlerInfo(si.tiddler);
		si.serverUrl = ti.uri;
	}
};

config.macros.sync.processSyncableTiddlers = function()
{
	for(var t=0; t<currSync.syncList.length; t++) {
		si = currSync.syncList[t];
		si.rowElement.style.backgroundColor = si.syncStatus.color;
	}
};

config.macros.sync.createSyncTasks = function()
{
	currSync.syncTasks = [];
	for(var t=0; t<currSync.syncList.length; t++) {
		var si = currSync.syncList[t];
		var r = null;
		for(var st=0; st<currSync.syncTasks.length; st++) {
			var cst = currSync.syncTasks[st];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r == null) {
			si.syncTask = this.createSyncTask(si);
			currSync.syncTasks.push(si.syncTask);
		} else {
			si.syncTask = r;
			r.syncItems.push(si);
		}
	}
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];
	st.syncMachine = new SyncMachine(st.serverType,{
		start: function() {
			return this.openHost(st.serverHost,"openWorkspace");
		},
		openWorkspace: function() {
			return this.openWorkspace(st.serverWorkspace,"getTiddlerList");
		},
		getTiddlerList: function() {
			return this.getTiddlerList("gotTiddlerList");
		},
		gotTiddlerList: function(tiddlers) {
			for(var t=0; t<st.syncItems.length; t++) {
				var si = st.syncItems[t];
				var f = tiddlers.findByField("title",si.title);
				if(f !== null) {
					if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
						si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
					}
				} else {
					si.syncStatus = config.macros.sync.syncStatusList.notFound;
				}
				config.macros.sync.updateSyncStatus(si);
			}
		},
		getTiddler: function(title) {
			return this.getTiddler(title,"onGetTiddler");
		},
		onGetTiddler: function(tiddler) {
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
				syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		},
		putTiddler: function(tiddler) {
			return this.putTiddler(tiddler,"onPutTiddler");
		},
		onPutTiddler: function(tiddler) {
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.resetTiddler(tiddler.title);
				syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		}
	});
	st.syncMachine.go();
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	syncItem.rowElement.style.backgroundColor = syncItem.syncStatus.color;
};

config.macros.sync.doSync = function(e)
{
	var rowNames = ListView.getSelectedRows(currSync.listView);
	for(var t=0; t<currSync.syncList.length; t++) {
		var si = currSync.syncList[t];
		if(rowNames.indexOf(si.title) != -1) {
			config.macros.sync.doSyncItem(si);
		}
	}
	return false;
};

config.macros.sync.doSyncItem = function(syncItem)
{
	var r = true;
	var sl = config.macros.sync.syncStatusList;
	switch(syncItem.syncStatus) {
		case sl.changedServer:
			r = syncItem.syncTask.syncMachine.go("getTiddler",syncItem.title);
			break;
		case sl.notFound:
		case sl.changedLocally:
		case sl.changedBoth:
			r = syncItem.syncTask.syncMachine.go("putTiddler",syncItem.tiddler);
			break;
		default:
			break;
	}
	if(r !== true)
		displayMessage("Error in doSyncItem: " + r);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

function SyncMachine(serverType,steps)
{
	this.serverType = serverType;
	this.adaptor = new config.adaptors[serverType];
	this.steps = steps;
}

SyncMachine.prototype.go = function(step,varargs)
{
	if(!step)
		step = "start";
	var h = this.steps[step];
	if(!h)
		return null;
	var a = [];
	for(var t=1; t<arguments.length; t++)
		a.push(arguments[t]);
	var r = h.apply(this,a);
	if(typeof r == "string")
		this.invokeError(r);
	return r;
};

SyncMachine.prototype.invokeError = function(message)
{
	if(this.steps.error)
		this.steps.error(message);
};

SyncMachine.prototype.openHost = function(host,nextStep)
{
	var me = this;
	return me.adaptor.openHost(host,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep);
	});
};

SyncMachine.prototype.getWorkspaceList = function(nextStep)
{
	var me = this;
	return me.adaptor.getWorkspaceList(null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.workspaces);
	});
};

SyncMachine.prototype.openWorkspace = function(workspace,nextStep)
{
	var me = this;
	return me.adaptor.openWorkspace(workspace,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep);
	});
};

SyncMachine.prototype.getTiddlerList = function(nextStep)
{
	var me = this;
	return me.adaptor.getTiddlerList(null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.tiddlers);
	});
};

SyncMachine.prototype.generateTiddlerInfo = function(tiddler)
{
	return this.adaptor.generateTiddlerInfo(tiddler);
};

SyncMachine.prototype.getTiddler = function(title,nextStep)
{
	var me = this;
	return me.adaptor.getTiddler(title,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.tiddler);
	});
};

SyncMachine.prototype.putTiddler = function(tiddler,nextStep)
{
	var me = this;
	return me.adaptor.putTiddler(tiddler,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,tiddler);
	});
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick:  config.macros.plugins.doRemoveTag},
				{caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick:  config.macros.plugins.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},
	
	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			wikify(store.getTiddlerText(title,title),e,null);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute  && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = document.getElementById("tiddlerDisplay");
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");
	if(!title)
		title = "PageTemplate";
	var html = store.getRecursiveTiddlerText(title,null,10);
	wrapper.innerHTML = html;
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = document.getElementById("tiddlerDisplay");
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div","tiddlerDisplay");
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	var st = wikifyPlain("SiteTitle");
	var ss = wikifyPlain("SiteSubtitle");
	return st + ((st == "" || ss == "") ? "" : " - ") + ss;
}

function refreshStyles(title,doc)
{
	if(!doc)
		doc = document;
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles("StyleSheet");
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options cookie stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
				config.optionHandlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].get)
		c += config.optionHandlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function encodeCookie(s)
{
	return escape(manualConvertUnicodeToUTF8(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + store.getRecursiveTiddlerText(tiddlerName,"") + "\n");
}

function updateOriginal(original,posDiv)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToUTF8(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToUTF8(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:") {
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	// Load the original file
	var original = loadFile(localPath);
	if(original == null) {
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	// Locate the storeArea div's
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	saveBackup(localPath,original);
	saveRss(localPath);
	saveEmpty(localPath,original,posDiv);
	saveMain(localPath,original,posDiv);
}

function saveBackup(localPath,original)
{
	// Save the backup
	if(config.options.chkSaveBackups) {
		var backupPath = getBackupPath(localPath);
		var backup = config.browser.isIE ? ieCopyFile(backupPath,localPath) : saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
	}
}

function saveRss(localPath)
{
	if(config.options.chkGenerateAnRssFeed) {
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
	}
}

function saveEmpty(localPath,original,posDiv)
{
	if(config.options.chkSaveEmptyTemplate) {
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
	}
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath)
{
	var backSlash = true;
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		backSlash = false;
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? "\\" : "/") + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
	return backupPath;
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	if(window.netscape == undefined)
		return manualConvertUTF8ToUnicode(u);
	else
		return mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return (fin.length > 0) ? s+fin : s;
}

function convertUnicodeToUTF8(s)
{
	if(window.netscape == undefined)
		return manualConvertUnicodeToUTF8(s);
	else
		return mozConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var re = /[^\u0000-\u007F]/g ;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function saveFile(fileUrl,content)
{
	var r = null;
	if(!r)
		r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,00004,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return sInputStream.read(sInputStream.available());
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	} catch(ex) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor for talking to static files
//--

function FileAdaptor()
{
	this.host = null;
	this.store = null;
	return this;
}

FileAdaptor.NotLoadedError = "TiddlyWiki file has not been loaded";
FileAdaptor.serverType = 'file';

// Open the specified host/server
FileAdaptor.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	if(!context)
		context = {};
	context.adaptor = this;
	context.callback = callback;
	context.userParams = userParams;
	var ret = loadRemoteFile(host,FileAdaptor.openHostCallback,context);
	return typeof(ret) == "string" ? ret : true;
};

FileAdaptor.openHostCallback = function(status,context,responseText,url,xhr)
{
	var adaptor = context.adaptor;
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file: " + xhr.statusText;
	} else {
		// Load the content into a TiddlyWiki() object
		adaptor.store = new TiddlyWiki();
		if(!adaptor.store.importTiddlyWiki(responseText))
			context.statusText = config.messages.invalidFileError.format([url]);
	}
	context.callback(context,context.userParams);
};

// Gets the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	if(!context)
		context = {};
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
FileAdaptor.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	if(!context)
		context = {};
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback)
{
	if(!this.store)
		return FileAdaptor.NotLoadedError;
	if(!context)
		context = {};
	context.tiddlers = [];
	this.store.forEachTiddler(function(title,tiddler)
		{
		var t = new Tiddler(title);
		t.text = tiddler.text;
		t.modified = tiddler.modified;
		t.modifier = tiddler.modifier;
		t.fields['server.page.revision'] = tiddler.modified.convertToYYYYMMDDHHMM();
		t.tags = tiddler.tags;
		context.tiddlers.push(t);
		});
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieves a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	if(!this.store)
		return FileAdaptor.NotLoadedError;
	if(!context)
		context = {};
	context.tiddler = this.store.fetchTiddler(title);
	if(context.tiddler) {
		context.tiddler.fields['server.type'] = FileAdaptor.serverType;
		context.tiddler.fields['server.host'] = this.host;
		context.tiddler.fields['server.page.revision'] = context.tiddler.modified.convertToYYYYMMDDHHMM();
	}
	context.status = true;
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		callback(context,userParams);
	} else {
		window.setTimeout(function() {callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

//--
//-- Remote HTTP requests
//--

function loadRemoteFile(url,callback,params)
{
	return doHttp("GET",url,null,null,null,null,callback,params,null);
}

// HTTP status codes
var httpStatus = {
	OK: 200,
	ContentCreated: 201,
	NoContent: 204,
	Unauthorized: 401,
	Forbidden: 403,
	NotFound: 404,
	MethodNotAllowed: 405
};

function doHttp(type,url,data,contentType,username,password,callback,params,headers)
{
	// Get an xhr object
	var x = getXMLHttpRequest();
	if(!x)
		return "Can't create XMLHttpRequest object";
	// Install callback
	x.onreadystatechange = function() {
		if (x.readyState == 4 && callback && (x.status !== undefined)) {
			if([0, httpStatus.OK, httpStatus.ContentCreated, httpStatus.NoContent].contains(x.status))
				callback(true,params,x.responseText,url,x);
			else
				callback(false,params,null,url,x);
			x.onreadystatechange = function(){};
			x = null;
		}
	};
	// Send request
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try {
		url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open(type,url,true,username,password);
		if (data)
			x.setRequestHeader("Content-Type", contentType ? contentType : "application/x-www-form-urlencoded");
		if (x.overrideMimeType)
			x.setRequestHeader("Connection", "close");
		if(headers) {
			for(n in headers)
				x.setRequestHeader(n,headers[n]);
		}
		x.setRequestHeader("X-Requested-With", "TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
		x.send(data);
	} catch (ex) {
		return exceptionText(ex);
	}
	return x;
}

function getXMLHttpRequest()
{
	try {
		var x = new XMLHttpRequest(); // Modern
	} catch(ex) {
		try {
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
		} catch (ex2) {
			return null;
		}
	}
	return x;
}

//--
//-- TiddlyWiki-specific utility functions
//--

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId,theAccessKey)
{
	var theButton = document.createElement("a");
	if(theAction) {
		theButton.onclick = theAction;
		theButton.setAttribute("href","javascript:;");
	}
	if(theTooltip)
		theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	else
		theButton.className = "button";
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	if(theAccessKey)
		theButton.setAttribute("accessKey",theAccessKey);
	return theButton;
}

function createTiddlyLink(place,title,includeText,theClass,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,theClass);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(config.annotations[title])
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return theLink;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if(!e) e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		fields = theLink.getAttribute("tiddlyFields");
		noToggle = theLink.getAttribute("noToggle");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(!fields && !store.isShadowTiddler(title))
		fields = String.encodeHashMap(config.defaultCustomFields);
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		story.displayTiddler(theTarget,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return theTag;
}

// Event handler for clicking on a tiddler tag
function onClickTag(e)
{
	if(!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(e)
{
	if(!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	var titles = [];
	for(var t=0; t<tagged.length; t++)
		titles.push(tagged[t].title);
	story.displayTiddlers(this,titles);
	return false;
}

function onClickError(e)
{
	if(!e) var e = window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(e)
{
	if(!e) var e = window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(p in src) {
		if(!preserveExisting || dst[p] === undefined)
			dst[p] = src[p];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description ? e.description : e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}
//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
		case "-tw-vertScroll":
			window.scrollTo(findScrollX(),value);
			break;
		case "-tw-horizScroll":
			window.scrollTo(value,findScrollY());
			break;
		default:
			element.style[style] = value;
			break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template ? p.template : "%0";
			switch(p.format) {
				case undefined:
				case "style":
					var v = p.start + (p.end-p.start) * progress;
					this.assignStyle(this.element,p.style,template.format([v]));
					break;
				case "color":
					break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement,unused)
{
	var p = [
		{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}
	];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
			case "all":
				c = function(element,properties) {removeNode(element);};
				break;
			case "children":
				c = function(element,properties) {removeChildren(element);};
				break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,theClass)
{
	Popup.remove();
	var popup = createTiddlyElement(document.body,elem ? elem : "ol","popup",theClass ? theClass : "popup");
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(e)
{
	if (!e) var e = window.event;
	var target = resolveTarget(e);
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(unused1,unused2)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,offset)
{
	if(!offset) var offset = {x:0, y:0};
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var rootHeight = root.offsetHeight;
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + rootHeight + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	if(popupLeft + popupWidth > winWidth)
		popupLeft = winWidth - popupWidth;
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
}

Popup.remove = function()
{
	if(Popup.stack.length > 0) {
		Popup.removeFrom(0);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className ? className : "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader)
			colType.createHeader(c,columnTemplate,t);
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem)
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)
					t++;
				createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createTiddlyText(createExternalLink(place,v),c ? c : v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] == value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if (this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for (var i = 0; i<items.length; i++) {
		if (this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
String.prototype.toJSONString = function()
{
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.pushUnique(p[t].value,unique);
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end) 
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix) 
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000); 
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2),10),
			parseInt(d.substr(10,2),10),0,0));
};

//--
//-- Crypto functions and associated conversion routines
//--

// Crypto "namespace"
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be = Array();
	var len = Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4) {
		be[i] = ((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
	}
	while (j<str.length) {
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
	}
	return be;
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str = "";
	for(var i=0;i<be.length*32;i+=8)
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	return str;
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex = "0123456789ABCDEF";
	var str = "";
	for(var i=0;i<be.length*4;i++)
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	return str;
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	add32 = function(a,b)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF);
		var msw = (a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Add five 32-bit integers, wrapping at 32 bits
	add32x5 = function(a,b,c,d,e)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw = (a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Bitwise rotate left a 32-bit integer by 1 bit
	rol32 = function(n)
	{
		return (n>>>31)|(n<<1);
	};

	var len = blen*8;
	// Append padding so length in bits is 448 mod 512
	x[len>>5] |= 0x80 << (24-len%32);
	// Append length
	x[((len+64>>9)<<4)+15] = len;
	var w = Array(80);

	var k1 = 0x5A827999;
	var k2 = 0x6ED9EBA1;
	var k3 = 0x8F1BBCDC;
	var k4 = 0xCA62C1D6;

	var h0 = 0x67452301;
	var h1 = 0xEFCDAB89;
	var h2 = 0x98BADCFE;
	var h3 = 0x10325476;
	var h4 = 0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16) {
		var j,t;
		var a = h0;
		var b = h1;
		var c = h2;
		var d = h3;
		var e = h4;
		for(j = 0;j<16;j++) {
			w[j] = x[i+j];
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=16;j<20;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=20;j<40;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=40;j<60;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=60;j<80;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}

		h0 = add32(h0,a);
		h1 = add32(h1,b);
		h2 = add32(h2,c);
		h3 = add32(h3,d);
		h4 = add32(h4,e);
	}
	return Array(h0,h1,h2,h3,h4);
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,colours)
{
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var f = t/100;
		var p = f*(colours.length-1);
		bar.style.backgroundColor = colours[Math.floor(p)].mix(colours[Math.ceil(p)],p-Math.floor(p)).toString();
	}
}

function createTiddlyText(theParent,theText)
{
	return theParent.appendChild(document.createTextNode(theText));
}

function createTiddlyCheckbox(theParent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	theParent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,theParent);
	return cb;
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);};
		obj.attachEvent('on'+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

function addClass(e,theClass)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(theClass) == -1)
		e.className += " " + theClass;
}

function removeClass(e,theClass)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(theClass);
	while(i != -1) {
		currClass.splice(i,1);
		i = currClass.indexOf(theClass);
	}
	e.className = currClass.join(" ");
}

function hasClass(e,theClass)
{
	if(e.className) {
		if(e.className.split(" ").indexOf(theClass) != -1)
			return true;
	}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name ? name : "tagName";
	relative = relative ? relative : "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth ? window.innerWidth : document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight ? window.innerHeight : document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX ? window.scrollX : document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY ? window.scrollY : document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e != null && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e && e.hasChildNodes())
		removeNode(e.firstChild);
}

// Remove a node and all it's children
function removeNode(e)
{
	scrubNode(e);
	e.parentNode.removeChild(e);
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== 'style' && (typeof e[n] === 'function' || (typeof e[n] === 'object' && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id,doc)
{
	if(!id)
		id = "customStyleSheet";
	if(!doc)
		doc = document;
	var n = doc.getElementById(id);
	if(doc.createStyleSheet) {
		// Test for IE's non-standard createStyleSheet method
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
	} else {
		if(n) {
			n.replaceChild(doc.createTextNode(s),n.firstChild);
		} else {
			n = doc.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(doc.createTextNode(s));
			doc.getElementsByTagName("head")[0].appendChild(n);
		}
	}
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:-1em;margin-top:1em;}");
		setStylesheet("");
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart('character', -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = ""; 
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++)
		results.push(this.externalizeTiddler(store,tiddlers[t]));
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if (node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if (attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if (!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created.convertToYYYYMMDDHHMM();
		var modified = tiddler.modified.convertToYYYYMMDDHHMM();
		var vdate = version.date.convertToYYYYMMDDHHMM();
		var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified +'"';
		attributes += (usePre && created == vdate) ? "" :' created="' + created + '"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");
//--
//-- End of scripts
//--
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>

IronRuby - A .NET Implementation of the Ruby language

Authors: 
  Daniele Alessandri, Shri Borde, Peter Bacon Darwin, Jim Deville, 
  Curt Hagenlocher, John Lam, Haibo Luo, Tomas Matousek, John Messerly,
  Jirapong Nanta, Srivatsn Narayanan, Jimmy Schementi, Oleg Tkachenko,
  Dino Viehland, and everyone else from the community who reports bugs, 
  builds libraries, and helps enrich IronRuby.

Project Contacts: 
  Jimmy Schementi <jschementi@gmail.com>
  Miguel de Icaza <miguel@gnome.org>
  Tomas Matousek <tomas_matousek@hotmail.com>

== About

IronRuby is a Open Source implementation of the Ruby programming language
(http://www.ruby-lang.org) for .NET, heavily relying on the 
Dynamic Language Runtime (http://dlr.codeplex.com).

The project's #1 goal is to be a true Ruby implementation, meaning it runs
existing Ruby code. See
http://ironruby.net/Documentation/Real_Ruby_Applications for information about
using the Ruby standard library and 3rd party libraries in IronRuby.

IronRuby has tightly integration with .NET, so any .NET types can be used from
IronRuby, and the IronRuby runtime can be embedded into any .NET application.
See http://ironruby.net/documentation/.net for more information.

== Running

bin/ir.exe rubyfile.rb

Will run rubyfile.rb with the IronRuby compiler.

== Package

  /bin                IronRuby binaries, ir.exe, iirb, irake, igem, iri, irdoc, etc.
  /lib                Ruby standard library, including RubyGems
  CHANGELOG.txt       Changes for each release
  RELEASE.txt         Release notes
  LICENSE.Ruby.txt    Ruby license
  LICENSE.CPL.txt     Common Public License
  LICENSE.APACHE.html Apache License, Version 2.0
  README.txt          This file

== License

Read the License.* files

Content description
-------------------

ClassInitGenerator
  - A tool used to generate Initializer.Generated.cs files in libraries.

Console
  - ir.exe, ir64.exe

Docs
  - Implementation documents.

IronRuby.Tests
  - Targetted compiler and runtime unit tests hosted in a C# test harness.

Libraries
  - Builtin modules (IronRuby.Libraries.dll).

Libraries.Yaml
  - YAML standard library (IronRuby.Libraries.Yaml.dll).

Libs 
  - Includes IronRuby specific libraries.

Public
  - Misc files included in IronRuby.msi.

Ruby
  - Core compiler and runtime (IronRuby.dll)

Samples
  - samples included in IronRuby.msi

Scripts
  - Infrastructure scripts and helpers.

StdLib
  - Ruby standard library distributed in IronRuby.msi.
  - The content is a copy of MRI 1.9.2 standard library with the following changes:

    i386-mingw32 directory removed
      - *.so files need to be reimplemented in IronRuby.Libraries.dll
      - rbconfig.rb is replaced by the one in Languages\Ruby\Libs

    complex18.rb and rational18.rb are taken from MRI 1.8.6 
      - this should be replaced by IronRuby's own implementation of Complex and Rational builtins in future 

    gem_prelude.rb taked from Ruby 1.9.2 source distribution and adapted
      - should be replaced by an implementation in IronRuby.Libraries.dll

Tests 
  - Test suites.

  


/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/

#if FEATURE_CUSTOM_TYPE_DESCRIPTOR

using System;
using System.ComponentModel;
using IronRuby.Runtime;

namespace IronRuby.Builtins {
    // TODO: Generate automatically from a script
    // TODO: Generate for other "base" classes
    public partial class RubyObject : ICustomTypeDescriptor {

        #region ICustomTypeDescriptor Members

        AttributeCollection ICustomTypeDescriptor.GetAttributes() {
            return CustomTypeDescHelpers.GetAttributes(this);
        }

        string ICustomTypeDescriptor.GetClassName() {
            return CustomTypeDescHelpers.GetClassName(this);
        }

        string ICustomTypeDescriptor.GetComponentName() {
            return CustomTypeDescHelpers.GetComponentName(this);
        }

        TypeConverter ICustomTypeDescriptor.GetConverter() {
            return CustomTypeDescHelpers.GetConverter(this);
        }

        EventDescriptor ICustomTypeDescriptor.GetDefaultEvent() {
            return CustomTypeDescHelpers.GetDefaultEvent(this);
        }

        PropertyDescriptor ICustomTypeDescriptor.GetDefaultProperty() {
            return CustomTypeDescHelpers.GetDefaultProperty(this);
        }

        object ICustomTypeDescriptor.GetEditor(Type editorBaseType) {
            return CustomTypeDescHelpers.GetEditor(this, editorBaseType);
        }

        EventDescriptorCollection ICustomTypeDescriptor.GetEvents(Attribute[] attributes) {
            return CustomTypeDescHelpers.GetEvents(this, attributes);
        }

        EventDescriptorCollection ICustomTypeDescriptor.GetEvents() {
            return CustomTypeDescHelpers.GetEvents(this);
        }

        PropertyDescriptorCollection ICustomTypeDescriptor.GetProperties(Attribute[] attributes) {
            return CustomTypeDescHelpers.GetProperties(this, attributes);
        }

        PropertyDescriptorCollection ICustomTypeDescriptor.GetProperties() {
            return CustomTypeDescHelpers.GetProperties(this);
        }

        object ICustomTypeDescriptor.GetPropertyOwner(PropertyDescriptor pd) {
            return CustomTypeDescHelpers.GetPropertyOwner(this, pd);
        }

        #endregion
    }
}

#endif

/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the  Apache License, Version 2.0, please send an email to 
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/
using System;
using System.Collections.Generic;
using Microsoft.Scripting.Utils;

namespace IronRuby.Compiler.Generation {

    /// <summary>
    /// TypeDescription captures the minimal information required by TypeDispenser to define a distinct CLS type
    /// </summary>
    internal sealed class TypeDescription {
        // The CLI base-type.
        private readonly Type/*!*/ _baseType;

        // Do not override base type's virtual methods.
        private readonly bool _noOverrides;

        private readonly IList<ITypeFeature/*!*/>/*!*/ _features;
        private readonly int _hash;

        public TypeDescription(Type/*!*/ baseType, IList<ITypeFeature/*!*/>/*!*/ features, bool noOverrides) {
            Assert.NotNull(baseType);
            Assert.NotNull(features);

            _noOverrides = noOverrides;
            _baseType = baseType;
            _features = features;

            _hash = (_noOverrides ? 3 : 7) ^ _baseType.GetHashCode();
            for (int i = 0; i < features.Count; i++) {
                _hash ^= features[i].GetHashCode();
            }
        }

        public Type/*!*/ BaseType {
            get { return _baseType; }
        }

        public bool NoOverrides {
            get { return _noOverrides; }
        }

        public IList<ITypeFeature/*!*/>/*!*/ Features {
            get { return _features; }
        }

        public override int GetHashCode() {
            return _hash;
        }

        public static bool FeatureSetsMatch(IList<ITypeFeature/*!*/>/*!*/ f1, IList<ITypeFeature/*!*/>/*!*/ f2) {
            if (f1.Count != f2.Count || f1.GetHashCode() != f2.GetHashCode()) {
                return false;
            }

            // The size of a feature set is expected to be small enough that this should be
            // reasonably fast.  If in the future, sets grows much larger -- perhaps
            // because we expose a large number of CLS methods -- then the representation of
            // a feature set may need to be modified to allow for faster indexing
            foreach (ITypeFeature feature in f2) {
                if (!f1.Contains(feature)) {
                    return false;
                }
            }

            return true;
        }

        public override bool Equals(object obj) {
            TypeDescription other = obj as TypeDescription;
            if (other == null) return false;

            if (_baseType.Equals(other._baseType) && FeatureSetsMatch(Features, other.Features)) {
                return true;
            }
            return false;
        }
    }
}

IronRuby Tutorial
=================

Description
-----------

The application is an interactive tutorial, allowing users to use a REPL window to
follow along the teaching material

Topics covered
--------------

- Creating WPF UI using XAML
  - Using Blend for UI design
  - Creating WPF FlowDocument from RDoc SimpleMarkup text
- Creating domain-specific-languages (DSLs) in Ruby
- Creating an application that can be developed incrementally from an
  interactive session with ability to reload modified source files.
- Using a splash screen at application startup

Running the app
---------------

On the desktop:

    tutorial.bat

On Silverlight:

    tutorial-sl.bat

Running the app interactively
-----------------------------

Launch ir.exe:

    load "wpf_tutorial.rb"
    #=> true
    # Edit wpf_tutorial.rb. For example, change the settings on the window in
    # the XAML
    reload # This should show the new window now...
    #=> true

Running the tests
-----------------

Both desktop and Silverlight:

    tutorial-test.bat

Just desktop:

    rake tutorial:test:desktop

Just Silverlight:

    rake tutorial:test:silverlight


This directory includes a bunch of experimental scripts that are not included in any test suite. 
The scripts were used to explore MRI's behavior in corner cases. Some of them don't have stable
behavior or even crash some MRI builds. Use these as an inspiration for authoring mspecs.
= Rack, a modular Ruby webserver interface

Rack provides a minimal, modular and adaptable interface for developing
web applications in Ruby.  By wrapping HTTP requests and responses in
the simplest way possible, it unifies and distills the API for web
servers, web frameworks, and software in between (the so-called
middleware) into a single method call.

The exact details of this are described in the Rack specification,
which all Rack applications should conform to.

== Specification changes in this release

With Rack 1.1, the Rack specification (found in SPEC) changed in the
following backward-incompatible ways.

* Rack::VERSION has been pushed to [1,1].
* rack.logger is now specified.
* The SPEC now allows subclasses of the required types.
* rack.input has to be opened in binary mode.

== Supported web servers

The included *handlers* connect all kinds of web servers to Rack:
* Mongrel
* EventedMongrel
* SwiftipliedMongrel
* WEBrick
* FCGI
* CGI
* SCGI
* LiteSpeed
* Thin

These web servers include Rack handlers in their distributions:
* Ebb
* Fuzed
* Glassfish v3
* Phusion Passenger (which is mod_rack for Apache and for nginx)
* Rainbows!
* Unicorn
* Zbatery

Any valid Rack app will run the same on all these handlers, without
changing anything.

== Supported web frameworks

These frameworks include Rack adapters in their distributions:
* Camping
* Coset
* Halcyon
* Mack
* Maveric
* Merb
* Racktools::SimpleApplication
* Ramaze
* Ruby on Rails
* Rum
* Sinatra
* Sin
* Vintage
* Waves
* Wee
* ... and many others.

Current links to these projects can be found at
http://wiki.ramaze.net/Home#other-frameworks

== Available middleware

Between the server and the framework, Rack can be customized to your
applications needs using middleware, for example:
* Rack::URLMap, to route to multiple applications inside the same process.
* Rack::CommonLogger, for creating Apache-style logfiles.
* Rack::ShowException, for catching unhandled exceptions and
  presenting them in a nice and helpful way with clickable backtrace.
* Rack::File, for serving static files.
* ...many others!

All these components use the same interface, which is described in
detail in the Rack specification.  These optional components can be
used in any way you wish.

== Convenience

If you want to develop outside of existing frameworks, implement your
own ones, or develop middleware, Rack provides many helpers to create
Rack applications quickly and without doing the same web stuff all
over:
* Rack::Request, which also provides query string parsing and
  multipart handling.
* Rack::Response, for convenient generation of HTTP replies and
  cookie handling.
* Rack::MockRequest and Rack::MockResponse for efficient and quick
  testing of Rack application without real HTTP round-trips.

== rack-contrib

The plethora of useful middleware created the need for a project that
collects fresh Rack middleware.  rack-contrib includes a variety of
add-on components for Rack and it is easy to contribute new modules.

* http://github.com/rack/rack-contrib

== rackup

rackup is a useful tool for running Rack applications, which uses the
Rack::Builder DSL to configure middleware and build up applications
easily.

rackup automatically figures out the environment it is run in, and
runs your application as FastCGI, CGI, or standalone with Mongrel or
WEBrick---all from the same configuration.

== Quick start

Try the lobster!

Either with the embedded WEBrick starter:

    ruby -Ilib lib/rack/lobster.rb

Or with rackup:

    bin/rackup -Ilib example/lobster.ru

By default, the lobster is found at http://localhost:9292.

== Installing with RubyGems

A Gem of Rack is available at gemcutter.org.  You can install it with:

    gem install rack

I also provide a local mirror of the gems (and development snapshots)
at my site:

    gem install rack --source http://chneukirchen.org/releases/gems/

== Running the tests

Testing Rack requires the test/spec testing framework:

    gem install test-spec

There are two rake-based test tasks:

    rake test       tests all the fast tests (no Handlers or Adapters)
    rake fulltest   runs all the tests

The fast testsuite has no dependencies outside of the core Ruby
installation and test-spec.

To run the test suite completely, you need:

  * camping
  * fcgi
  * memcache-client
  * mongrel
  * thin

The full set of tests test FCGI access with lighttpd (on port
9203) so you will need lighttpd installed as well as the FCGI
libraries and the fcgi gem:

Download and install lighttpd:

    http://www.lighttpd.net/download

Installing the FCGI libraries:

    curl -O http://www.fastcgi.com/dist/fcgi-2.4.0.tar.gz
    tar xzvf fcgi-2.4.0.tar.gz
    cd fcgi-2.4.0
    ./configure --prefix=/usr/local
    make
    sudo make install
    cd ..

Installing the Ruby fcgi gem:

    gem install fcgi

Furthermore, to test Memcache sessions, you need memcached (will be
run on port 11211) and memcache-client installed.

== History

* March 3rd, 2007: First public release 0.1.

* May 16th, 2007: Second public release 0.2.
  * HTTP Basic authentication.
  * Cookie Sessions.
  * Static file handler.
  * Improved Rack::Request.
  * Improved Rack::Response.
  * Added Rack::ShowStatus, for better default error messages.
  * Bug fixes in the Camping adapter.
  * Removed Rails adapter, was too alpha.

* February 26th, 2008: Third public release 0.3.
  * LiteSpeed handler, by Adrian Madrid.
  * SCGI handler, by Jeremy Evans.
  * Pool sessions, by blink.
  * OpenID authentication, by blink.
  * :Port and :File options for opening FastCGI sockets, by blink.
  * Last-Modified HTTP header for Rack::File, by blink.
  * Rack::Builder#use now accepts blocks, by Corey Jewett.
    (See example/protectedlobster.ru)
  * HTTP status 201 can contain a Content-Type and a body now.
  * Many bugfixes, especially related to Cookie handling.

* August 21st, 2008: Fourth public release 0.4.
  * New middleware, Rack::Deflater, by Christoffer Sawicki.
  * OpenID authentication now needs ruby-openid 2.
  * New Memcache sessions, by blink.
  * Explicit EventedMongrel handler, by Joshua Peek <josh@joshpeek.com>
  * Rack::Reloader is not loaded in rackup development mode.
  * rackup can daemonize with -D.
  * Many bugfixes, especially for pool sessions, URLMap, thread safety
    and tempfile handling.
  * Improved tests.
  * Rack moved to Git.

* January 6th, 2009: Fifth public release 0.9.
  * Rack is now managed by the Rack Core Team.
  * Rack::Lint is stricter and follows the HTTP RFCs more closely.
  * Added ConditionalGet middleware.
  * Added ContentLength middleware.
  * Added Deflater middleware.
  * Added Head middleware.
  * Added MethodOverride middleware.
  * Rack::Mime now provides popular MIME-types and their extension.
  * Mongrel Header now streams.
  * Added Thin handler.
  * Official support for swiftiplied Mongrel.
  * Secure cookies.
  * Made HeaderHash case-preserving.
  * Many bugfixes and small improvements.

* January 9th, 2009: Sixth public release 0.9.1.
  * Fix directory traversal exploits in Rack::File and Rack::Directory.

* April 25th, 2009: Seventh public release 1.0.0.
  * SPEC change: Rack::VERSION has been pushed to [1,0].
  * SPEC change: header values must be Strings now, split on "\n".
  * SPEC change: Content-Length can be missing, in this case chunked transfer
    encoding is used.
  * SPEC change: rack.input must be rewindable and support reading into
    a buffer, wrap with Rack::RewindableInput if it isn't.
  * SPEC change: rack.session is now specified.
  * SPEC change: Bodies can now additionally respond to #to_path with
    a filename to be served.
  * NOTE: String bodies break in 1.9, use an Array consisting of a
    single String instead.
  * New middleware Rack::Lock.
  * New middleware Rack::ContentType.
  * Rack::Reloader has been rewritten.
  * Major update to Rack::Auth::OpenID.
  * Support for nested parameter parsing in Rack::Response.
  * Support for redirects in Rack::Response.
  * HttpOnly cookie support in Rack::Response.
  * The Rakefile has been rewritten.
  * Many bugfixes and small improvements.

* October 18th, 2009: Eighth public release 1.0.1.
  * Bump remainder of rack.versions.
  * Support the pure Ruby FCGI implementation.
  * Fix for form names containing "=": split first then unescape components
  * Fixes the handling of the filename parameter with semicolons in names.
  * Add anchor to nested params parsing regexp to prevent stack overflows
  * Use more compatible gzip write api instead of "<<".
  * Make sure that Reloader doesn't break when executed via ruby -e
  * Make sure WEBrick respects the :Host option
  * Many Ruby 1.9 fixes.

* January 3rd, 2010: Ninth public release 1.1.0.
  * Moved Auth::OpenID to rack-contrib.
  * SPEC change that relaxes Lint slightly to allow subclasses of the
    required types
  * SPEC change to document rack.input binary mode in greator detail
  * SPEC define optional rack.logger specification
  * File servers support X-Cascade header
  * Imported Config middleware
  * Imported ETag middleware
  * Imported Runtime middleware
  * Imported Sendfile middleware
  * New Logger and NullLogger middlewares
  * Added mime type for .ogv and .manifest.
  * Don't squeeze PATH_INFO slashes
  * Use Content-Type to determine POST params parsing
  * Update Rack::Utils::HTTP_STATUS_CODES hash
  * Add status code lookup utility
  * Response should call #to_i on the status
  * Add Request#user_agent
  * Request#host knows about forwared host
  * Return an empty string for Request#host if HTTP_HOST and
    SERVER_NAME are both missing
  * Allow MockRequest to accept hash params
  * Optimizations to HeaderHash
  * Refactored rackup into Rack::Server
  * Added Utils.build_nested_query to complement Utils.parse_nested_query
  * Added Utils::Multipart.build_multipart to complement
    Utils::Multipart.parse_multipart
  * Extracted set and delete cookie helpers into Utils so they can be
    used outside Response
  * Extract parse_query and parse_multipart in Request so subclasses
    can change their behavior
  * Enforce binary encoding in RewindableInput
  * Set correct external_encoding for handlers that don't use RewindableInput

== Contact

Please post bugs, suggestions and patches to
the bug tracker at <http://rack.lighthouseapp.com/>.

Mailing list archives are available at
<http://groups.google.com/group/rack-devel>.

Git repository (send Git patches to the mailing list):
* http://github.com/rack/rack
* http://git.vuxu.org/cgi-bin/gitweb.cgi?p=rack.git

You are also welcome to join the #rack channel on irc.freenode.net.

== Thanks

The Rack Core Team, consisting of

* Christian Neukirchen (chneukirchen)
* James Tucker (raggi)
* Josh Peek (josh)
* Michael Fellinger (manveru)
* Ryan Tomayko (rtomayko)
* Scytrin dai Kinthra (scytrin)

would like to thank:

* Adrian Madrid, for the LiteSpeed handler.
* Christoffer Sawicki, for the first Rails adapter and Rack::Deflater.
* Tim Fletcher, for the HTTP authentication code.
* Luc Heinrich for the Cookie sessions, the static file handler and bugfixes.
* Armin Ronacher, for the logo and racktools.
* Aredridel, Ben Alpert, Dan Kubb, Daniel Roethlisberger, Matt Todd,
  Tom Robinson, Phil Hagelberg, S. Brent Faulkner, Bosko Milekic,
  Daniel Rodrguez Troitio, Genki Takiuchi, Geoffrey Grosenbach,
  Julien Sanchez, Kamal Fariz Mahyuddin, Masayoshi Takahashi, Patrick
  Aljordm, Mig, and Kazuhiro Nishiyama for bug fixing and other
  improvements.
* Eric Wong, Hongli Lai, Jeremy Kemper for their continuous support
  and API improvements.
* Yehuda Katz and Carl Lerche for refactoring rackup.
* Brian Candler, for Rack::ContentType.
* Graham Batty, for improved handler loading.
* Stephen Bannasch, for bug reports and documentation.
* Gary Wright, for proposing a better Rack::Response interface.
* Jonathan Buch, for improvements regarding Rack::Response.
* Armin Rhrl, for tracking down bugs in the Cookie generator.
* Alexander Kellett for testing the Gem and reviewing the announcement.
* Marcus Rckert, for help with configuring and debugging lighttpd.
* The WSGI team for the well-done and documented work they've done and
  Rack builds up on.
* All bug reporters and patch contributers not mentioned above.

== Copyright

Copyright (C) 2007, 2008, 2009, 2010 Christian Neukirchen <http://purl.org/net/chneukirchen>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to
deal in the Software without restriction, including without limitation the
rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

== Links

Rack:: <http://rack.rubyforge.org/>
Rack's Rubyforge project:: <http://rubyforge.org/projects/rack>
Official Rack repositories:: <http://github.com/rack>
Rack Lighthouse Bug Tracking:: <http://rack.lighthouseapp.com/>
rack-devel mailing list:: <http://groups.google.com/group/rack-devel>

Christian Neukirchen:: <http://chneukirchen.org/>



This directory contains sample YAML documents. They were pulled from:

test_*.yml:     specific test cases I created
rails_*.yml:    YAML file generated by Ruby on Rails
wp_*.yml:       http://en.wikipedia.org/wiki/YAML
yamlorg_*.yml:  http://yaml.org/*.html
yts_*.yml:      http://yaml.kwiki.org/index.cgi?YamlTestingSuite

require 'mspec/runner/formatters/dotted'
require 'mspec/runner/actions/tally'

class DescribeFormatter < DottedFormatter
  # Callback for the MSpec :finish event. Prints a summary of
  # the number of errors and failures for each +describe+ block.
  def finish
    describes = Hash.new { |h,k| h[k] = Tally.new }

    @exceptions.each do |exc|
      desc = describes[exc.describe]
      exc.failure? ? desc.failures! : desc.errors!
    end

    print "\n"
    describes.each do |d, t|
      text = d.size > 40 ? "#{d[0,37]}..." : d.ljust(40)
      print "\n#{text} #{t.failure}, #{t.error}"
    end
    print "\n" unless describes.empty?

    print "\n#{@timer.format}\n\n#{@tally.format}\n"
  end
end

= Overview

MSpec is a specialized framework that is syntax-compatible with RSpec for
basic things like +describe+, +it+ blocks and +before+, +after+ actions. MSpec
contains additional features that assist in writing the RubySpecs used by
multiple Ruby implementations.

MSpec attempts to use the simplest Ruby language features so that beginning
Ruby implementations can run the Ruby specs. So, for example, there is not
great concern given to constant clashes. Namespacing (or module scoping) is
not used because implementing this correctly took a significant amount of work
in Rubinius and it is likely that other implementations would also face
difficulties.

MSpec is not intended as a replacement for RSpec. MSpec attempts to provide a
subset of RSpec's features in some cases and a superset in others. It does not
provide all the matchers, for instance. However, MSpec provides several
extensions to facilitate writing the Ruby specs in a manner compatible with
multiple Ruby implementations.

First, MSpec offers a set of guards to control execution of the specs. These
guards not only enable or disable execution but also annotate the specs with
additional information about why they are run or not run. Second, MSpec
provides a different shared spec implementation specifically designed to ease
writing specs for the numerous aliased methods in Ruby. The MSpec shared spec
implementation should not conflict with RSpec's own shared behavior facility.
Third, MSpec provides various helper methods to simplify some specs, for
example, creating temporary file names. Finally, MSpec has several specialized
runner scripts that includes a configuration facility with a default project
file and user-specific overrides.

Caveats:

* Use RSpec to run the MSpec specs. There are no plans currently to make
  the MSpec specs runnable by MSpec.
* Don't mock the #hash method as MSpec's Mock implementation uses Hash
  internally. This can be replaced if necessary, but at this point there is no
  compelling need to do so.


== Architecture


== Matchers

Matchers are additional aids for the verification process. The default
is of course to #should or #should_not using the #== operator and its
friends but the matchers add a new set of 'operators' to help in the
task. They reside in `mspec/matchers/`. There are two broad categories,
those that apply to an individual object and those that apply to a
block:

=== Object

- `base` implements the standard #==, #< #<= #>= #> and #=~ with their
  normal semantics for the objects that you invoke them on.

- `be_ancestor_of` is equivalent to checking `obj.ancestors.include?`.

- `be_close` is a "delta" for floating-point math. Due to the very
  nature of it, floating-point comparisons should never be treated as
  exact. By default the tolerance is 0.00003 but it can be altered if
  so desired. So `0.23154.should be_close(0.23157)` would succeed
  (which is usually close enough for floating point unless you are
  doing some scientific computing.)

- `be_empty` checks `obj.empty?`

- `be_kind_of` is equivalent to `obj.kind_of?`

- `include` is `obj.include?`

=== Block

All of these should be applied to a block created with `lambda` or `proc`:

- `complain` is probably clearer stated as `lambda {...}.should complain`;
  it checks that the block issues a warning. The message can be checked
  against either a String or a Regexp.

- `output` checks that the block produces the given output (stdout as well
  as stderr, in that order) matched either to a String or a Regexp. This one
  uses overrides so if that is a problem (for e.g. speccing Readline or
  something) see below.

- `output_to_fd` is a lower-level version and actually verifies that output
  to a certain file descriptor is correct whether from an in-/output stream
  or an actual file. Also can check with either a String or a Regexp.

- `raise_error` verifies the exception type (if any) raised by the block it
  is associated with. The exception class can be given for finer-grained
  control (inheritance works normally so Exception would catch everything.)

== Nested 'describe' blocks

MSpec supports nesting one 'describe' block inside another. The examples in
the nested block are evaluated with all the before/after blocks of all the
containing 'describe' blocks. The following example illustrates this:

describe "Some#method" do
  before :each do
    @obj = 1
  end

  describe "when passed String" do
    before :each do
      @meth = :to_s
    end

    it "returns false" do
      # when this example is evaluated, @obj = 1 and @meth = :to_s
    end
  end
end

The output when using the SpecdocFormatter (selected with -fs to the runners)
will be as follows:

Some#method when passed String
- returns false


== Shared 'describe' blocks

MSpec supports RSpec-style shared 'describe' blocks. MSpec also provides a
convenience method to assist in writing specs for the numerous aliased methods
that Ruby provides. The following example illustrates shared blocks:

describe :someclass_some_method, :shared => true do
  it "does something" do
  end
end

describe "SomeClass#some_method" do
  it_should_behave_like "someclass_some_method"
end

The first argument to 'describe' for a shared block is an object that
duck-types as a String. The representation of the object must be unique. This
example uses a symbol. This was the convention for the previous facility that
MSpec provided for aliased method (#it_behaves_like). However, this convention
is not set in stone (but the uniqueness requirement is). Note that the
argument to the #it_should_behave_like is a String because at this time RSpec
will not find the shared block by the symbol.

MSpec continues to support the #it_behaves_like convenience method for
specifying aliased methods. The syntax is as follows:

it_behaves_like :symbol_matching_shared_describe, :method [, :object]

describe :someclass_some_method, :shared => true do
  it "returns true" do
    obj.send(@method).should be_true
  end

  it "returns something else" do
    @object.send(@method).should be_something_else
  end
end

# example #1
describe "SomeClass#some_method" do
  it_behaves_like :someclass_some_method, :other_method
end

# example #2
describe "SomeOtherClass#some_method" do
  it_behaves_like :someclass_some_method, :some_method, OtherClass
end

The first form above (#1) is used for typical aliases. That is, methods with
different names on the same class that behave identically. The
#it_behaves_like helper creates a before(:all) block that sets @method to
:other_method. The form of the first example block in the shared block
illustrates the typical form of a spec for an aliased method.

The second form above (#2) is used for methods on different classes that are
essentially aliases, even though Ruby does not provide a syntax for specifying
such methods as aliases. Examples are the methods on File, FileTest, and
File::Stat. In this case, the #it_behaves_like helper sets both @method and
@object in the before(:all) block (@method = :some_method, @object =
OtherClass in this example).

For shared specs that fall outside of either of these two narrow categories,
use nested or shared 'describe' blocks as appropriate and use the
#it_should_behave_like method directly.

== Guards

Since Ruby is not completely isolated from its platform or execution environment, the spec files may contain guards: conditions placed around a spec or a set of specs to enable or disable them. 

You can find an overview of the current guards and their usage in: http://rubyspec.org/wiki/mspec/Guards .

== Helpers


== Runners

require File.dirname(__FILE__) + '/../../spec_helper'
require 'mspec/runner/formatters/describe'
require 'mspec/runner/example'

describe DescribeFormatter, "#finish" do
  before :each do
    MSpec.stub!(:register)
    MSpec.stub!(:unregister)

    @timer = mock("timer", :null_object => true)
    TimerAction.stub!(:new).and_return(@timer)
    @timer.stub!(:format).and_return("Finished in 2.0 seconds")

    $stdout = @out = IOStub.new
    context = ContextState.new "Class#method"
    @state = ExampleState.new(context, "runs")

    @formatter = DescribeFormatter.new
    @formatter.register

    @tally = @formatter.tally
    @counter = @tally.counter

    @counter.files!
    @counter.examples!
    @counter.expectations! 2
  end

  after :each do
    $stdout = STDOUT
  end

  it "prints a summary of elapsed time" do
    @formatter.finish
    @out.should =~ /^Finished in 2.0 seconds$/
  end

  it "prints a tally of counts" do
    @formatter.finish
    @out.should =~ /^1 file, 1 example, 2 expectations, 0 failures, 0 errors$/
  end

  it "does not print exceptions" do
    @formatter.finish
    @out.should == %[

Finished in 2.0 seconds

1 file, 1 example, 2 expectations, 0 failures, 0 errors
]
  end

  it "prints a summary of failures and errors for each describe block" do
    exc = ExceptionState.new @state, nil, MSpecExampleError.new("broken")
    exc.stub!(:backtrace).and_return("path/to/some/file.rb:35:in method")
    @formatter.exception exc
    @formatter.finish
    @out.should == %[

Class#method                             0 failures, 1 error

Finished in 2.0 seconds

1 file, 1 example, 2 expectations, 0 failures, 0 errors
]
  end
end

There are numerous possible way of categorizing the entities and concepts that
make up a programming language. Ruby has a fairly large number of reserved
words. These words significantly describe major elements of the language,
including flow control constructs like 'for' and 'while', conditional
execution like 'if' and 'unless', exceptional execution control like 'rescue',
etc. There are also literals for the basic "types" like String, Regexp, Array
and Fixnum.

Behavorial specifications describe the behavior of concrete entities. Rather
than using concepts of computation to organize these spec files, we use
entities of the Ruby language. Consider looking at any syntactic element of a
Ruby program. With (almost) no ambiguity, one can identify it as a literal,
reserved word, variable, etc. There is a spec file that corresponds to each
literal construct and most reserved words, with the exceptions noted below.
There are also several files that are more difficult to classify: all
predefined variables, constants, and objects (predefined_spec.rb), the
precedence of all operators (precedence_spec.rb), the behavior of assignment
to variables (variables_spec.rb), the behavior of subprocess execution
(execution_spec.rb), the behavior of the raise method as it impacts the
execution of a Ruby program (raise_spec.rb), and the block entities like
'begin', 'do', ' { ... }' (block_spec.rb).

Several reserved words and other entities are combined with the primary
reserved word or entity to which they are related:

false, true, nil, self              predefined_spec.rb
in                                  for_spec.rb
then, elsif                         if_spec.rb
when                                case_spec.rb
catch                               throw_spec.rb

Please see http://wiki.github.com/IronLanguages/main for information on:
- Setting up a development environment with easy access to utility scripts
- Building
- Running test
ZLIB.NET: README
==================================================

Contents
--------

  Program information
  Company information
  Description
  Specification
  Other ComponentAce compression products
  


Program information
-------------------

Program Name:
  ZLIB.NET
License Type: freeware
  
Program Version:
  1.10
Program Release Date:
  03/10/2010
Program Purpose:
  version of ZLIB compression library for .NET framework
Target Environment:
  Visual Studio 2003, 2005, 2008, Borland Developer Studio 2005, Borland Developer Studio 2006 and other


Company information
-------------------

Company Name:
  ComponentAce
Contact E-mail Address:
  support@componentace.com
Contact WWW URL:
  http://www.componentace.com


Description
-----------

100% managed version of ZLIB compression library.
Based on JZlib library (c) 2000,2001,2002,2003 ymnk, JCraft,Inc. 

The zlib compression library was written by Jean-loup Gailly gzip@prep.ai.mit.edu and Mark Adler madler@alumni.caltech.edu.

The primary site for the zlib compression library is http://www.zlib.org.

Copyright and license
---------------------

See "license.txt" file.


Warranty and guarantee
----------------------

See "license.txt" file.


Other ComponentAce compression products
---------------------------------------

ZipForge.NET  
------------

ZipForge.NET is an advanced ZIP compression library for .NET framework. 
ZipForge.NET features include streaming support, transaction system, ZIP encryption, repair, 
progress indication, Zip64 support, SFX (self-extracting) archives, unicode filenames, spanning support and much more. 

FlexCompress.NET
----------------

FlexCompress.NET is an advanced compression and encryption .NET component designed to provide archive
functionality for your applications. This solution provides flexible compression and strong encryption algorithms that
allows you to integrate archiving or backup features into your programs in a fast and easy way. 
FlexCompres.NET uses its own file format which allows to achieve high compression rate. 

For more info visit
http://www.componentace.com/.NET_components
========================================================================
    ACTIVE TEMPLATE LIBRARY : DlrComLibrary Project Overview
========================================================================

AppWizard has created this DlrComLibrary project for you to use as the starting point for
writing your Dynamic Link Library (DLL).

This file contains a summary of what you will find in each of the files that
make up your project.

DlrComLibrary.vcproj
    This is the main project file for VC++ projects generated using an Application Wizard.
    It contains information about the version of Visual C++ that generated the file, and
    information about the platforms, configurations, and project features selected with the
    Application Wizard.

DlrComLibrary.idl
    This file contains the IDL definitions of the type library, the interfaces
    and co-classes defined in your project.
    This file will be processed by the MIDL compiler to generate:
        C++ interface definitions and GUID declarations (DlrComLibrary.h)
        GUID definitions                                (DlrComLibrary_i.c)
        A type library                                  (DlrComLibrary.tlb)
        Marshaling code                                 (DlrComLibrary_p.c and dlldata.c)

DlrComLibrary.h
    This file contains the C++ interface definitions and GUID declarations of the
    items defined in DlrComLibrary.idl. It will be regenerated by MIDL during compilation.

DlrComLibrary.cpp
    This file contains the object map and the implementation of your DLL's exports.

DlrComLibrary.rc
    This is a listing of all of the Microsoft Windows resources that the
    program uses.

DlrComLibrary.def
    This module-definition file provides the linker with information about the exports
    required by your DLL. It contains exports for:
        DllGetClassObject
        DllCanUnloadNow
        DllRegisterServer
        DllUnregisterServer

/////////////////////////////////////////////////////////////////////////////
Other standard files:

StdAfx.h, StdAfx.cpp
    These files are used to build a precompiled header (PCH) file
    named DlrComLibrary.pch and a precompiled types file named StdAfx.obj.

Resource.h
    This is the standard header file that defines resource IDs.

/////////////////////////////////////////////////////////////////////////////
Proxy/stub DLL project and module definition file:

DlrComLibraryps.vcproj
    This file is the project file for building a proxy/stub DLL if necessary.
	The IDL file in the main project must contain at least one interface and you must
	first compile the IDL file before building the proxy/stub DLL.	This process generates
	dlldata.c, DlrComLibrary_i.c and DlrComLibrary_p.c which are required
	to build the proxy/stub DLL.

DlrComLibraryps.def
    This module definition file provides the linker with information about the exports
    required by the proxy/stub.

/////////////////////////////////////////////////////////////////////////////

README
/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation. 
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A 
 * copy of the license can be found in the License.html file at the root of this distribution. If 
 * you cannot locate the Apache License, Version 2.0, please send an email to 
 * ironpy@microsoft.com. By using this source code in any fashion, you are agreeing to be bound 
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 * ***************************************************************************/

using System;
using System.Collections;
using System.ComponentModel;

namespace Microsoft.VisualStudio.Project
{
	/// <summary>
	/// The purpose of DesignPropertyDescriptor is to allow us to customize the
	/// display name of the property in the property grid.  None of the CLR
	/// implementations of PropertyDescriptor allow you to change the DisplayName.
	/// </summary>
	public class DesignPropertyDescriptor : PropertyDescriptor
	{
		private string displayName; // Custom display name
		private PropertyDescriptor property;	// Base property descriptor
		private Hashtable editors = new Hashtable(); // Type -> editor instance
		private TypeConverter converter;


		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override string DisplayName
		{
			get
			{
				return this.displayName;
			}
		}

		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override Type ComponentType
		{
			get
			{
				return this.property.ComponentType;
			}
		}

		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override bool IsReadOnly
		{
			get
			{
				return this.property.IsReadOnly;
			}
		}

		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override Type PropertyType
		{
			get
			{
				return this.property.PropertyType;
			}
		}


		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override object GetEditor(Type editorBaseType)
		{
			object editor = this.editors[editorBaseType];
			if(editor == null)
			{
				for(int i = 0; i < this.Attributes.Count; i++)
				{
					EditorAttribute attr = Attributes[i] as EditorAttribute;
					if(attr == null)
					{
						continue;
					}
					Type editorType = Type.GetType(attr.EditorBaseTypeName);
					if(editorBaseType == editorType)
					{
						Type type = GetTypeFromNameProperty(attr.EditorTypeName);
						if(type != null)
						{
							editor = CreateInstance(type);
							this.editors[type] = editor; // cache it
							break;
						}
					}
				}
			}
			return editor;
		}


		/// <summary>
		/// Return type converter for property
		/// </summary>
		public override TypeConverter Converter
		{
			get
			{
				if(converter == null)
				{
					PropertyPageTypeConverterAttribute attr = (PropertyPageTypeConverterAttribute)Attributes[typeof(PropertyPageTypeConverterAttribute)];
					if(attr != null && attr.ConverterType != null)
					{
						converter = (TypeConverter)CreateInstance(attr.ConverterType);
					}

					if(converter == null)
					{
						converter = TypeDescriptor.GetConverter(this.PropertyType);
					}
				}
				return converter;
			}
		}



		/// <summary>
		/// Convert name to a Type object.
		/// </summary>
		public virtual Type GetTypeFromNameProperty(string typeName)
		{
			return Type.GetType(typeName);
		}


		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override bool CanResetValue(object component)
		{
			bool result = this.property.CanResetValue(component);
			return result;
		}

		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override object GetValue(object component)
		{
			object value = this.property.GetValue(component);
			return value;
		}

		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override void ResetValue(object component)
		{
			this.property.ResetValue(component);
		}

		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override void SetValue(object component, object value)
		{
			this.property.SetValue(component, value);
		}

		/// <summary>
		/// Delegates to base.
		/// </summary>
		public override bool ShouldSerializeValue(object component)
		{
			bool result = this.property.ShouldSerializeValue(component);
			return result;
		}

		/// <summary>
		/// Constructor.  Copy the base property descriptor and also hold a pointer
		/// to it for calling its overridden abstract methods.
		/// </summary>
		public DesignPropertyDescriptor(PropertyDescriptor prop)
			: base(prop)
		{
            if (prop == null)
            {
                throw new ArgumentNullException("prop");
            }

			this.property = prop;

			DisplayNameAttribute attr = prop.Attributes[typeof(DisplayNameAttribute)] as DisplayNameAttribute;

			if(attr != null)
			{
				this.displayName = attr.DisplayName;
			}
			else
			{
				this.displayName = prop.Name;
			}
		}
	}
}

require 'yaml'
require 'rdoc/markup/simple_markup/fragments'

# Descriptions are created by RDoc (in ri_generator) and
# written out in serialized form into the documentation
# tree. ri then reads these to generate the documentation

module RI
  class NamedThing
    attr_reader :name
    def initialize(name)
      @name = name
    end
    def <=>(other)
      @name <=> other.name
    end

    def hash
      @name.hash
    end

    def eql?(other)
      @name.eql?(other)
    end
  end

#  Alias          = Struct.new(:old_name, :new_name)

  class AliasName < NamedThing
  end

  class Attribute < NamedThing
    attr_reader :rw, :comment
    def initialize(name, rw, comment)
      super(name)
      @rw = rw
      @comment = comment
    end
  end

  class Constant < NamedThing
    attr_reader :value, :comment
    def initialize(name, value, comment)
      super(name)
      @value = value
      @comment = comment
    end
  end

  class IncludedModule < NamedThing
  end


  class MethodSummary < NamedThing
    def initialize(name="")
      super
    end
  end



  class Description
    attr_accessor :name
    attr_accessor :full_name
    attr_accessor :comment

    def serialize
      self.to_yaml
    end

    def Description.deserialize(from)
      YAML.load(from)
    end

    def <=>(other)
      @name <=> other.name
    end
  end
  
  class ModuleDescription < Description
    
    attr_accessor :class_methods
    attr_accessor :instance_methods
    attr_accessor :attributes
    attr_accessor :constants
    attr_accessor :includes

    # merge in another class desscription into this one
    def merge_in(old)
      merge(@class_methods, old.class_methods)
      merge(@instance_methods, old.instance_methods)
      merge(@attributes, old.attributes)
      merge(@constants, old.constants)
      merge(@includes, old.includes)
      if @comment.nil? || @comment.empty?
        @comment = old.comment
      else
        unless old.comment.nil? or old.comment.empty? then
          @comment << SM::Flow::RULE.new
          @comment.concat old.comment
        end
      end
    end

    def display_name
      "Module"
    end

    # the 'ClassDescription' subclass overrides this
    # to format up the name of a parent
    def superclass_string
      nil
    end

    private

    def merge(into, from)
      names = {}
      into.each {|i| names[i.name] = i }
      from.each {|i| names[i.name] = i }
      into.replace(names.keys.sort.map {|n| names[n]})
    end
  end
  
  class ClassDescription < ModuleDescription
    attr_accessor :superclass

    def display_name
      "Class"
    end

    def superclass_string
      if @superclass && @superclass != "Object"
        @superclass
      else
        nil
      end
    end
  end


  class MethodDescription < Description
    
    attr_accessor :is_class_method
    attr_accessor :visibility
    attr_accessor :block_params
    attr_accessor :is_singleton
    attr_accessor :aliases
    attr_accessor :is_alias_for
    attr_accessor :params

  end
  
end

